
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="An out-of-the-box open source library for scientific computing based on deep learning.">
      
      
        <meta name="author" content="PaddlePaddle">
      
      
        <link rel="canonical" href="https://github.com/PaddlePaddle/PaddleScience/ai4s_universal_platform/zh/development/">
      
      
        <link rel="prev" href="../user_guide/">
      
      
        <link rel="next" href="../reproduction/">
      
      
      <link rel="icon" href="../../images/icons/favcion.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.12">
    
    
      
        <title>开发指南 - PaddleScience Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e359304.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      

  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M256 512a256 256 0 1 0 0-512 256 256 0 1 0 0 512zm-86.2-346.7c7.9-22.3 29.1-37.3 52.8-37.3h58.3c34.9 0 63.1 28.3 63.1 63.1 0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6-13.3 0-24-10.7-24-24v-13.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1 0-8.4-6.8-15.1-15.1-15.1h-58.3c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM224 352a32 32 0 1 1 64 0 32 32 0 1 1-64 0z"/></svg>');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Serif SC";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="PaddleScience Docs" class="md-header__button md-logo" aria-label="PaddleScience Docs" data-md-component="logo">
      
  <img src="../../images/icons/paddle.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PaddleScience Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              开发指南
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="选择当前语言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/zh/" hreflang="zh" class="md-select__link">
              简体中文
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/en/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/PaddlePaddle/PaddleScience" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    PaddleScience
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  PaddleScience

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../examples/allen_cahn/" class="md-tabs__link">
          
  
  经典案例

        </a>
      </li>
    
  

    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../api/arch/" class="md-tabs__link">
          
  
  API 文档

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../user_guide/" class="md-tabs__link">
        
  
    
  
  使用指南

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  开发与复现指南

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../technical_doc/" class="md-tabs__link">
        
  
    
  
  技术稿件

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../cooperation/" class="md-tabs__link">
        
  
    
  
  共创计划

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://aistudio.baidu.com/aistudio/projectoverview/public?topic=15" class="md-tabs__link">
        
  
    
  
  实训社区

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PaddleScience Docs" class="md-nav__button md-logo" aria-label="PaddleScience Docs" data-md-component="logo">
      
  <img src="../../images/icons/paddle.png" alt="logo">

    </a>
    PaddleScience Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/PaddlePaddle/PaddleScience" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    PaddleScience
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    PaddleScience
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            PaddleScience
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    主页
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    功能介绍
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    安装使用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    快速开始
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    学习资料
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    经典案例
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            经典案例
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
     
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
             
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1_1" id="__nav_2_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    数学(AI for Math)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_1">
            <span class="md-nav__icon md-icon"></span>
            数学(AI for Math)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/allen_cahn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AllenCahn
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/deephpms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DeepHPMs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/deeponet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DeepONet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/euler_beam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Euler_Beam
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/laplace2d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Laplace2D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/lorenz/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lorenz_transform_physx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/pirbn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PIRBN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/rossler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rossler_transform_physx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/volterra_ide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Volterra_IDE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/nlsmb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NLSMB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/xpinns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    XPINN
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2" >
        
          
          <label class="md-nav__link" for="__nav_2_1_2" id="__nav_2_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    技术科学(AI for Technology)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2">
            <span class="md-nav__icon md-icon"></span>
            技术科学(AI for Technology)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1_2_1" id="__nav_2_1_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    流体
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2_1">
            <span class="md-nav__icon md-icon"></span>
            流体
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/amgnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AMGNet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/aneurysm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aneurysm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/bubble/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BubbleNet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/cfdgcn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CFDGCN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/cylinder2d_unsteady/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cylinder2D_unsteady
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/cylinder2d_unsteady_transformer_physx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cylinder2D_unsteady_transform_physx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/darcy2d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Darcy2D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/deepcfd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DeepCFD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/ldc2d_steady/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LDC2D_steady
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/ldc2d_unsteady/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LDC2D_unsteady
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/labelfree_DNN_surrogate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Labelfree_DNN_surrogate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/nsfnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NSFNets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/phycrnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PhyCRNet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/shock_wave/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ShockWave
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/tempoGAN/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tempoGAN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/nsfnet4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NSFNet4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/viv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ViV
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_1_2_2" id="__nav_2_1_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    结构
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2_2">
            <span class="md-nav__icon md-icon"></span>
            结构
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/biharmonic2d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Biharmonic2D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/bracket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bracket
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/control_arm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Control_arm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/epnn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EPNN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/phylstm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Phy-LSTM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/topopt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TopOpt
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_1_2_3" id="__nav_2_1_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    传热
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2_3">
            <span class="md-nav__icon md-icon"></span>
            传热
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/heat_exchanger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Heat_Exchanger
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/heat_pinn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Heat_PINN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/phygeonet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PhyGeoNet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/chip_heat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chip_heat
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3" >
        
          
          <label class="md-nav__link" for="__nav_2_1_3" id="__nav_2_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    材料科学(AI for Material)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3">
            <span class="md-nav__icon md-icon"></span>
            材料科学(AI for Material)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/hpinns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hPINNs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_4" >
        
          
          <label class="md-nav__link" for="__nav_2_1_4" id="__nav_2_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    地球科学(AI for Earth Science)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_4">
            <span class="md-nav__icon md-icon"></span>
            地球科学(AI for Earth Science)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/fourcastnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FourCastNet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/nowcastnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NowcastNet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/dgmr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DGMR
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/earthformer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EarthFormer
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API 文档
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API 文档
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ppsci
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            ppsci
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/arch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.arch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/autodiff/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.autodiff
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/constraint/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.constraint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_4" >
        
          
          <label class="md-nav__link" for="__nav_3_1_4" id="__nav_3_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ppsci.data
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_4">
            <span class="md-nav__icon md-icon"></span>
            ppsci.data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/data/dataset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.data.dataset
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/data/process/transform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.data.transform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/data/process/batch_transform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.data.batch_transform
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/equation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.equation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/geometry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.geometry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_7" >
        
          
          <label class="md-nav__link" for="__nav_3_1_7" id="__nav_3_1_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ppsci.loss
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_7">
            <span class="md-nav__icon md-icon"></span>
            ppsci.loss
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/loss/loss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.loss.loss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/loss/mtl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.loss.mtl
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/metric/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.metric
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_9" >
        
          
          <label class="md-nav__link" for="__nav_3_1_9" id="__nav_3_1_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ppsci.optimizer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_9">
            <span class="md-nav__icon md-icon"></span>
            ppsci.optimizer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/optimizer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.optimizer.optimizer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/lr_scheduler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.optimizer.lr_scheduler
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/solver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.solver
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_11" >
        
          
          <label class="md-nav__link" for="__nav_3_1_11" id="__nav_3_1_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ppsci.utils
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_11">
            <span class="md-nav__icon md-icon"></span>
            ppsci.utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/utils/checker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.checker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/utils/expression/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.expression
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/utils/initializer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.initializer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/utils/logger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.logger
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/utils/misc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.misc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/utils/ema/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.ema
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/utils/reader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.reader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/utils/writer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.writer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/utils/save_load/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.save_load
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/utils/symbolic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.symbolic
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/validate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.validate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/visualize/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.visualize
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/experimental/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.experimental
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/probability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.probability
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    deploy
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            deploy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/depoly/python_infer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    deploy.python_infer
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../user_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    使用指南
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    开发与复现指南
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            开发与复现指南
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    开发指南
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    开发指南
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 准备工作
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. 编写代码
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. 编写代码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 导入必要的包
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 设置运行环境
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 构建模型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3 构建模型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#231" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.1 构建已有模型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#232" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.2 构建新的模型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 构建方程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.4 构建方程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#241" class="md-nav__link">
    <span class="md-ellipsis">
      2.4.1 构建已有方程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#242" class="md-nav__link">
    <span class="md-ellipsis">
      2.4.2 构建新的方程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25" class="md-nav__link">
    <span class="md-ellipsis">
      2.5 构建几何模块[可选]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.5 构建几何模块[可选]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#251" class="md-nav__link">
    <span class="md-ellipsis">
      2.5.1 构建已有几何
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#252" class="md-nav__link">
    <span class="md-ellipsis">
      2.5.2 构建新的几何
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26" class="md-nav__link">
    <span class="md-ellipsis">
      2.6 构建约束条件
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.6 构建约束条件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#261" class="md-nav__link">
    <span class="md-ellipsis">
      2.6.1 构建已有约束
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#262" class="md-nav__link">
    <span class="md-ellipsis">
      2.6.2 构建新的约束
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27" class="md-nav__link">
    <span class="md-ellipsis">
      2.7 定义超参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#28" class="md-nav__link">
    <span class="md-ellipsis">
      2.8 构建优化器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#29" class="md-nav__link">
    <span class="md-ellipsis">
      2.9 构建评估器[可选]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.9 构建评估器[可选]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#291" class="md-nav__link">
    <span class="md-ellipsis">
      2.9.1 构建已有评估器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#292" class="md-nav__link">
    <span class="md-ellipsis">
      2.9.2 构建新的评估器
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#210" class="md-nav__link">
    <span class="md-ellipsis">
      2.10 构建可视化器[可选]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#211-solver" class="md-nav__link">
    <span class="md-ellipsis">
      2.11 构建Solver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212" class="md-nav__link">
    <span class="md-ellipsis">
      2.12 编写配置文件[重要]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213" class="md-nav__link">
    <span class="md-ellipsis">
      2.13 训练
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#214" class="md-nav__link">
    <span class="md-ellipsis">
      2.14 评估
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#215" class="md-nav__link">
    <span class="md-ellipsis">
      2.15 可视化[可选]
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. 编写文档
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. 编写文档">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 安装必要依赖包
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 撰写文档内容
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-markdownlint" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 使用 markdownlint 格式化文档[可选]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 预览文档
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4. 整理代码并提交
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. 整理代码并提交">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-pre-commit" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 安装 pre-commit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 整理代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-pull-request" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 提交 pull request
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reproduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    复现指南
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../technical_doc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    技术稿件
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cooperation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    共创计划
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://aistudio.baidu.com/aistudio/projectoverview/public?topic=15" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    实训社区
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 准备工作
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. 编写代码
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. 编写代码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 导入必要的包
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 设置运行环境
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 构建模型
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.3 构建模型">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#231" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.1 构建已有模型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#232" class="md-nav__link">
    <span class="md-ellipsis">
      2.3.2 构建新的模型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 构建方程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.4 构建方程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#241" class="md-nav__link">
    <span class="md-ellipsis">
      2.4.1 构建已有方程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#242" class="md-nav__link">
    <span class="md-ellipsis">
      2.4.2 构建新的方程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25" class="md-nav__link">
    <span class="md-ellipsis">
      2.5 构建几何模块[可选]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.5 构建几何模块[可选]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#251" class="md-nav__link">
    <span class="md-ellipsis">
      2.5.1 构建已有几何
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#252" class="md-nav__link">
    <span class="md-ellipsis">
      2.5.2 构建新的几何
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26" class="md-nav__link">
    <span class="md-ellipsis">
      2.6 构建约束条件
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.6 构建约束条件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#261" class="md-nav__link">
    <span class="md-ellipsis">
      2.6.1 构建已有约束
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#262" class="md-nav__link">
    <span class="md-ellipsis">
      2.6.2 构建新的约束
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27" class="md-nav__link">
    <span class="md-ellipsis">
      2.7 定义超参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#28" class="md-nav__link">
    <span class="md-ellipsis">
      2.8 构建优化器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#29" class="md-nav__link">
    <span class="md-ellipsis">
      2.9 构建评估器[可选]
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2.9 构建评估器[可选]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#291" class="md-nav__link">
    <span class="md-ellipsis">
      2.9.1 构建已有评估器
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#292" class="md-nav__link">
    <span class="md-ellipsis">
      2.9.2 构建新的评估器
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#210" class="md-nav__link">
    <span class="md-ellipsis">
      2.10 构建可视化器[可选]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#211-solver" class="md-nav__link">
    <span class="md-ellipsis">
      2.11 构建Solver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#212" class="md-nav__link">
    <span class="md-ellipsis">
      2.12 编写配置文件[重要]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#213" class="md-nav__link">
    <span class="md-ellipsis">
      2.13 训练
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#214" class="md-nav__link">
    <span class="md-ellipsis">
      2.14 评估
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#215" class="md-nav__link">
    <span class="md-ellipsis">
      2.15 可视化[可选]
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. 编写文档
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. 编写文档">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 安装必要依赖包
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 撰写文档内容
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-markdownlint" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 使用 markdownlint 格式化文档[可选]
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 预览文档
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4. 整理代码并提交
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. 整理代码并提交">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-pre-commit" class="md-nav__link">
    <span class="md-ellipsis">
      4.1 安装 pre-commit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    <span class="md-ellipsis">
      4.2 整理代码
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-pull-request" class="md-nav__link">
    <span class="md-ellipsis">
      4.3 提交 pull request
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/PaddlePaddle/PaddleScience/edit/develop/docs/zh/development.md" title="编辑此页" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/PaddlePaddle/PaddleScience/raw/develop/docs/zh/development.md" title="查看本页的源代码" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5Z"/></svg>
    </a>
  


<div><h1 id="_1">开发指南<a class="headerlink" href="#_1" title="Permanent link">¶</a></h1>
<p>本文档介绍如何基于 PaddleScience 套件进行代码开发并最终贡献到 PaddleScience 套件中。</p>
<p>PaddleScience 相关的论文复现、API 开发任务开始之前需提交 RFC 文档，请参考：<a href="https://github.com/PaddlePaddle/community/blob/master/rfcs/Science/template.md">PaddleScience RFC Template</a></p>
<h2 id="1">1. 准备工作<a class="headerlink" href="#1" title="Permanent link">¶</a></h2>
<ol>
<li>在网页上将 PaddleScience fork 到<strong>自己的仓库</strong></li>
<li>
<p>克隆<strong>自己仓库</strong>里的 PaddleScience 到本地，并进入该目录</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>develop<span class="w"> </span>https://github.com/USER_NAME/PaddleScience.git
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nb">cd</span><span class="w"> </span>PaddleScience
</span></code></pre></div>
<p>上方 <code>clone</code> 命令中的 <code>USER_NAME</code> 字段请填入自己的 github 用户名。</p>
</li>
<li>
<p>安装必要的依赖包</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt<span class="w"> </span>-i<span class="w"> </span>https://pypi.tuna.tsinghua.edu.cn/simple
</span></code></pre></div>
</li>
<li>
<p>基于当前所在的 <code>develop</code> 分支，新建一个分支(假设新分支名字为 <code>dev_model</code>)</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>git<span class="w"> </span>checkout<span class="w"> </span>-b<span class="w"> </span><span class="s2">"dev_model"</span>
</span></code></pre></div>
</li>
<li>
<p>添加 PaddleScience 目录到系统环境变量 <code>PYTHONPATH</code> 中</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$PWD</span>:<span class="nv">$PYTHONPATH</span>
</span></code></pre></div>
</li>
<li>
<p>执行以下代码，验证安装的 PaddleScience 基础功能是否正常</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">"import ppsci; ppsci.run_check()"</span>
</span></code></pre></div>
<p>如果出现 PaddleScience is installed successfully.✨ 🍰 ✨，则说明安装验证成功。</p>
</li>
</ol>
<h2 id="2">2. 编写代码<a class="headerlink" href="#2" title="Permanent link">¶</a></h2>
<p>完成上述准备工作后，就可以基于 PaddleScience 开始开发自己的案例或者功能了。</p>
<p>假设新建的案例代码文件路径为：<code>PaddleScience/examples/demo/demo.py</code>，接下来开始详细介绍这一流程</p>
<h3 id="21">2.1 导入必要的包<a class="headerlink" href="#21" title="Permanent link">¶</a></h3>
<p>PaddleScience 所提供的 API 全部在 <code>ppsci.*</code> 模块下，因此在 <code>demo.py</code> 的开头首先需要导入 <code>ppsci</code> 这个顶层模块，接着导入日志打印模块 <code>logger</code>，方便打印日志时自动记录日志到本地文件中，最后再根据您自己的需要，导入其他必要的模块。</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">import</span> <span class="nn">ppsci</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="kn">from</span> <span class="nn">ppsci.utils</span> <span class="kn">import</span> <span class="n">logger</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="c1"># 导入其他必要的模块</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="c1"># import ...</span>
</span></code></pre></div>
<h3 id="22">2.2 设置运行环境<a class="headerlink" href="#22" title="Permanent link">¶</a></h3>
<p>在运行 <code>demo.py</code> 之前，需要进行一些必要的运行环境设置，如固定随机种子(保证实验可复现性)、设置输出目录并初始化日志打印模块(保存重要实验数据)。</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="c1"># set random seed for reproducibility</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="n">ppsci</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">set_random_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    <span class="c1"># set output directory</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="n">OUTPUT_DIR</span> <span class="o">=</span> <span class="s2">"./output_example"</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    <span class="c1"># initialize logger</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">init_logger</span><span class="p">(</span><span class="s2">"ppsci"</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">OUTPUT_DIR</span><span class="si">}</span><span class="s2">/train.log"</span><span class="p">,</span> <span class="s2">"info"</span><span class="p">)</span>
</span></code></pre></div>
<p>完成上述步骤之后，<code>demo.py</code> 已经搭好了必要框架。接下来介绍如何基于自己具体的需求，对 <code>ppsci.*</code> 下的其他模块进行开发或者复用，以最终在 <code>demo.py</code> 中使用。</p>
<h3 id="23">2.3 构建模型<a class="headerlink" href="#23" title="Permanent link">¶</a></h3>
<h4 id="231">2.3.1 构建已有模型<a class="headerlink" href="#231" title="Permanent link">¶</a></h4>
<p>PaddleScience 内置了一些常见的模型，如 <code>MLP</code> 模型，如果您想使用这些内置的模型，可以直接调用 <a href="../api/arch/"><code>ppsci.arch.*</code></a> 下的 API，并填入模型实例化所需的参数，即可快速构建模型。</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># create a MLP model</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">model</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">MLP</span><span class="p">((</span><span class="s2">"x"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">),</span> <span class="p">(</span><span class="s2">"u"</span><span class="p">,</span> <span class="s2">"v"</span><span class="p">,</span> <span class="s2">"p"</span><span class="p">),</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">"tanh"</span><span class="p">)</span>
</span></code></pre></div>
<p>上述代码实例化了一个 <code>MLP</code> 全连接模型，其输入数据为两个字段：<code>"x"</code>、<code>"y"</code>，输出数据为三个字段：<code>"u"</code>、<code>"v"</code>、<code>"w"</code>；模型具有 <span class="arithmatex">\(9\)</span> 层隐藏层，每层的神经元个数为 <span class="arithmatex">\(50\)</span> 个，每层隐藏层使用的激活函数均为 <span class="arithmatex">\(\tanh\)</span> 双曲正切函数。</p>
<h4 id="232">2.3.2 构建新的模型<a class="headerlink" href="#232" title="Permanent link">¶</a></h4>
<p>当 PaddleScience 内置的模型无法满足您的需求时，您就可以通过新增模型文件并编写模型代码的方式，使用您自定义的模型，步骤如下：</p>
<ol>
<li>在 <code>ppsci/arch/</code> 文件夹下新建模型结构文件，以 <code>new_model.py</code> 为例。</li>
<li>
<p>在 <code>new_model.py</code> 文件中导入 PaddleScience 的模型基类所在的模块 <code>base</code>，并从 <code>base.Arch</code> 派生出您想创建的新模型类（以
<code>Class NewModel</code> 为例）。</p>
<div class="language-py highlight"><span class="filename">ppsci/arch/new_model.py</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kn">from</span> <span class="nn">ppsci.arch</span> <span class="kn">import</span> <span class="n">base</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="k">class</span> <span class="nc">NewModel</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Arch</span><span class="p">):</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>        <span class="o">...</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>        <span class="c1"># initialization</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>        <span class="o">...</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>        <span class="c1"># forward</span>
</span></code></pre></div>
</li>
<li>
<p>编写 <code>NewModel.__init__</code> 方法，其被用于模型创建时的初始化操作，包括模型层、参数变量初始化；然后再编写 <code>NewModel.forward</code> 方法，其定义了模型从接受输入、计算输出这一过程。以 <code>MLP.__init__</code> 和 <code>MLP.forward</code> 为例，如下所示。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked id="__tabbed_1_1" name="__tabbed_1" type="radio"><input id="__tabbed_1_2" name="__tabbed_1" type="radio"><div class="tabbed-labels"><label for="__tabbed_1_1">MLP.__init__</label><label for="__tabbed_1_2">MLP.forward</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">class</span> <span class="nc">MLP</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Arch</span><span class="p">):</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="sd">"""Multi layer perceptron network.</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="sd">    Args:</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="sd">        input_keys (Tuple[str, ...]): Name of input keys, such as ("x", "y", "z").</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="sd">        output_keys (Tuple[str, ...]): Name of output keys, such as ("u", "v", "w").</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="sd">        num_layers (int): Number of hidden layers.</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="sd">        hidden_size (Union[int, Tuple[int, ...]]): Number of hidden size.</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="sd">            An integer for all layers, or list of integer specify each layer's size.</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="sd">        activation (str, optional): Name of activation function. Defaults to "tanh".</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="sd">        skip_connection (bool, optional): Whether to use skip connection. Defaults to False.</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="sd">        weight_norm (bool, optional): Whether to apply weight norm on parameter(s). Defaults to False.</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="sd">        input_dim (Optional[int]): Number of input's dimension. Defaults to None.</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="sd">        output_dim (Optional[int]): Number of output's dimension. Defaults to None.</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="sd">        periods (Optional[Dict[int, Tuple[float, bool]]]): Period of each input key,</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="sd">            input in given channel will be period embeded if specified, each tuple of</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="sd">            periods list is [period, trainable]. Defaults to None.</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="sd">        fourier (Optional[Dict[str, Union[float, int]]]): Random fourier feature embedding,</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="sd">            e.g. {'dim': 256, 'scale': 1.0}. Defaults to None.</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="sd">        random_weight (Optional[Dict[str, float]]): Mean and std of random weight</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="sd">            factorization layer, e.g. {"mean": 0.5, "std: 0.1"}. Defaults to None.</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="sd">    Examples:</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="sd">        &gt;&gt;&gt; import paddle</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="sd">        &gt;&gt;&gt; import ppsci</span>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="sd">        &gt;&gt;&gt; model = ppsci.arch.MLP(</span>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="sd">        ...     input_keys=("x", "y"),</span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="sd">        ...     output_keys=("u", "v"),</span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a><span class="sd">        ...     num_layers=5,</span>
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="sd">        ...     hidden_size=128</span>
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="sd">        ... )</span>
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="sd">        &gt;&gt;&gt; input_dict = {"x": paddle.rand([64, 1]),</span>
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a><span class="sd">        ...               "y": paddle.rand([64, 1])}</span>
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a><span class="sd">        &gt;&gt;&gt; output_dict = model(input_dict)</span>
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="sd">        &gt;&gt;&gt; print(output_dict["u"].shape)</span>
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a><span class="sd">        [64, 1]</span>
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a><span class="sd">        &gt;&gt;&gt; print(output_dict["v"].shape)</span>
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a><span class="sd">        [64, 1]</span>
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a><span class="sd">    """</span>
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a>
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>        <span class="n">input_keys</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
</span><span id="__span-9-44"><a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a>        <span class="n">output_keys</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
</span><span id="__span-9-45"><a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a>        <span class="n">num_layers</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-9-46"><a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a>        <span class="n">hidden_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span>
</span><span id="__span-9-47"><a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a>        <span class="n">activation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"tanh"</span><span class="p">,</span>
</span><span id="__span-9-48"><a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a>        <span class="n">skip_connection</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-9-49"><a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a>        <span class="n">weight_norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-9-50"><a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a>        <span class="n">input_dim</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-9-51"><a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a>        <span class="n">output_dim</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-9-52"><a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a>        <span class="n">periods</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-9-53"><a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a>        <span class="n">fourier</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-9-54"><a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a>        <span class="n">random_weight</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-9-55"><a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a>    <span class="p">):</span>
</span><span id="__span-9-56"><a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-9-57"><a id="__codelineno-9-57" name="__codelineno-9-57" href="#__codelineno-9-57"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_keys</span> <span class="o">=</span> <span class="n">input_keys</span>
</span><span id="__span-9-58"><a id="__codelineno-9-58" name="__codelineno-9-58" href="#__codelineno-9-58"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_keys</span> <span class="o">=</span> <span class="n">output_keys</span>
</span><span id="__span-9-59"><a id="__codelineno-9-59" name="__codelineno-9-59" href="#__codelineno-9-59"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">linears</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-9-60"><a id="__codelineno-9-60" name="__codelineno-9-60" href="#__codelineno-9-60"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">acts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-9-61"><a id="__codelineno-9-61" name="__codelineno-9-61" href="#__codelineno-9-61"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">periods</span> <span class="o">=</span> <span class="n">periods</span>
</span><span id="__span-9-62"><a id="__codelineno-9-62" name="__codelineno-9-62" href="#__codelineno-9-62"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fourier</span> <span class="o">=</span> <span class="n">fourier</span>
</span><span id="__span-9-63"><a id="__codelineno-9-63" name="__codelineno-9-63" href="#__codelineno-9-63"></a>        <span class="k">if</span> <span class="n">periods</span><span class="p">:</span>
</span><span id="__span-9-64"><a id="__codelineno-9-64" name="__codelineno-9-64" href="#__codelineno-9-64"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">period_emb</span> <span class="o">=</span> <span class="n">PeriodEmbedding</span><span class="p">(</span><span class="n">periods</span><span class="p">)</span>
</span><span id="__span-9-65"><a id="__codelineno-9-65" name="__codelineno-9-65" href="#__codelineno-9-65"></a>
</span><span id="__span-9-66"><a id="__codelineno-9-66" name="__codelineno-9-66" href="#__codelineno-9-66"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
</span><span id="__span-9-67"><a id="__codelineno-9-67" name="__codelineno-9-67" href="#__codelineno-9-67"></a>            <span class="k">if</span> <span class="n">num_layers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-9-68"><a id="__codelineno-9-68" name="__codelineno-9-68" href="#__codelineno-9-68"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="__span-9-69"><a id="__codelineno-9-69" name="__codelineno-9-69" href="#__codelineno-9-69"></a>                    <span class="s2">"num_layers should be None when hidden_size is specified"</span>
</span><span id="__span-9-70"><a id="__codelineno-9-70" name="__codelineno-9-70" href="#__codelineno-9-70"></a>                <span class="p">)</span>
</span><span id="__span-9-71"><a id="__codelineno-9-71" name="__codelineno-9-71" href="#__codelineno-9-71"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-9-72"><a id="__codelineno-9-72" name="__codelineno-9-72" href="#__codelineno-9-72"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">num_layers</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-9-73"><a id="__codelineno-9-73" name="__codelineno-9-73" href="#__codelineno-9-73"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="__span-9-74"><a id="__codelineno-9-74" name="__codelineno-9-74" href="#__codelineno-9-74"></a>                    <span class="s2">"num_layers should be an int when hidden_size is an int"</span>
</span><span id="__span-9-75"><a id="__codelineno-9-75" name="__codelineno-9-75" href="#__codelineno-9-75"></a>                <span class="p">)</span>
</span><span id="__span-9-76"><a id="__codelineno-9-76" name="__codelineno-9-76" href="#__codelineno-9-76"></a>            <span class="n">hidden_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">hidden_size</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_layers</span>
</span><span id="__span-9-77"><a id="__codelineno-9-77" name="__codelineno-9-77" href="#__codelineno-9-77"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-78"><a id="__codelineno-9-78" name="__codelineno-9-78" href="#__codelineno-9-78"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="__span-9-79"><a id="__codelineno-9-79" name="__codelineno-9-79" href="#__codelineno-9-79"></a>                <span class="sa">f</span><span class="s2">"hidden_size should be list of int or int, but got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-9-80"><a id="__codelineno-9-80" name="__codelineno-9-80" href="#__codelineno-9-80"></a>            <span class="p">)</span>
</span><span id="__span-9-81"><a id="__codelineno-9-81" name="__codelineno-9-81" href="#__codelineno-9-81"></a>
</span><span id="__span-9-82"><a id="__codelineno-9-82" name="__codelineno-9-82" href="#__codelineno-9-82"></a>        <span class="c1"># initialize FC layer(s)</span>
</span><span id="__span-9-83"><a id="__codelineno-9-83" name="__codelineno-9-83" href="#__codelineno-9-83"></a>        <span class="n">cur_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_keys</span><span class="p">)</span> <span class="k">if</span> <span class="n">input_dim</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">input_dim</span>
</span><span id="__span-9-84"><a id="__codelineno-9-84" name="__codelineno-9-84" href="#__codelineno-9-84"></a>        <span class="k">if</span> <span class="n">input_dim</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">periods</span><span class="p">:</span>
</span><span id="__span-9-85"><a id="__codelineno-9-85" name="__codelineno-9-85" href="#__codelineno-9-85"></a>            <span class="c1"># period embeded channel(s) will be doubled automatically</span>
</span><span id="__span-9-86"><a id="__codelineno-9-86" name="__codelineno-9-86" href="#__codelineno-9-86"></a>            <span class="c1"># if input_dim is not specified</span>
</span><span id="__span-9-87"><a id="__codelineno-9-87" name="__codelineno-9-87" href="#__codelineno-9-87"></a>            <span class="n">cur_size</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">periods</span><span class="p">)</span>
</span><span id="__span-9-88"><a id="__codelineno-9-88" name="__codelineno-9-88" href="#__codelineno-9-88"></a>
</span><span id="__span-9-89"><a id="__codelineno-9-89" name="__codelineno-9-89" href="#__codelineno-9-89"></a>        <span class="k">if</span> <span class="n">fourier</span><span class="p">:</span>
</span><span id="__span-9-90"><a id="__codelineno-9-90" name="__codelineno-9-90" href="#__codelineno-9-90"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">fourier_emb</span> <span class="o">=</span> <span class="n">FourierEmbedding</span><span class="p">(</span>
</span><span id="__span-9-91"><a id="__codelineno-9-91" name="__codelineno-9-91" href="#__codelineno-9-91"></a>                <span class="n">cur_size</span><span class="p">,</span> <span class="n">fourier</span><span class="p">[</span><span class="s2">"dim"</span><span class="p">],</span> <span class="n">fourier</span><span class="p">[</span><span class="s2">"scale"</span><span class="p">]</span>
</span><span id="__span-9-92"><a id="__codelineno-9-92" name="__codelineno-9-92" href="#__codelineno-9-92"></a>            <span class="p">)</span>
</span><span id="__span-9-93"><a id="__codelineno-9-93" name="__codelineno-9-93" href="#__codelineno-9-93"></a>            <span class="n">cur_size</span> <span class="o">=</span> <span class="n">fourier</span><span class="p">[</span><span class="s2">"dim"</span><span class="p">]</span>
</span><span id="__span-9-94"><a id="__codelineno-9-94" name="__codelineno-9-94" href="#__codelineno-9-94"></a>
</span><span id="__span-9-95"><a id="__codelineno-9-95" name="__codelineno-9-95" href="#__codelineno-9-95"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_size</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">):</span>
</span><span id="__span-9-96"><a id="__codelineno-9-96" name="__codelineno-9-96" href="#__codelineno-9-96"></a>            <span class="k">if</span> <span class="n">weight_norm</span><span class="p">:</span>
</span><span id="__span-9-97"><a id="__codelineno-9-97" name="__codelineno-9-97" href="#__codelineno-9-97"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">linears</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WeightNormLinear</span><span class="p">(</span><span class="n">cur_size</span><span class="p">,</span> <span class="n">_size</span><span class="p">))</span>
</span><span id="__span-9-98"><a id="__codelineno-9-98" name="__codelineno-9-98" href="#__codelineno-9-98"></a>            <span class="k">elif</span> <span class="n">random_weight</span><span class="p">:</span>
</span><span id="__span-9-99"><a id="__codelineno-9-99" name="__codelineno-9-99" href="#__codelineno-9-99"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">linears</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-9-100"><a id="__codelineno-9-100" name="__codelineno-9-100" href="#__codelineno-9-100"></a>                    <span class="n">RandomWeightFactorization</span><span class="p">(</span>
</span><span id="__span-9-101"><a id="__codelineno-9-101" name="__codelineno-9-101" href="#__codelineno-9-101"></a>                        <span class="n">cur_size</span><span class="p">,</span>
</span><span id="__span-9-102"><a id="__codelineno-9-102" name="__codelineno-9-102" href="#__codelineno-9-102"></a>                        <span class="n">_size</span><span class="p">,</span>
</span><span id="__span-9-103"><a id="__codelineno-9-103" name="__codelineno-9-103" href="#__codelineno-9-103"></a>                        <span class="n">mean</span><span class="o">=</span><span class="n">random_weight</span><span class="p">[</span><span class="s2">"mean"</span><span class="p">],</span>
</span><span id="__span-9-104"><a id="__codelineno-9-104" name="__codelineno-9-104" href="#__codelineno-9-104"></a>                        <span class="n">std</span><span class="o">=</span><span class="n">random_weight</span><span class="p">[</span><span class="s2">"std"</span><span class="p">],</span>
</span><span id="__span-9-105"><a id="__codelineno-9-105" name="__codelineno-9-105" href="#__codelineno-9-105"></a>                    <span class="p">)</span>
</span><span id="__span-9-106"><a id="__codelineno-9-106" name="__codelineno-9-106" href="#__codelineno-9-106"></a>                <span class="p">)</span>
</span><span id="__span-9-107"><a id="__codelineno-9-107" name="__codelineno-9-107" href="#__codelineno-9-107"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-108"><a id="__codelineno-9-108" name="__codelineno-9-108" href="#__codelineno-9-108"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">linears</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">cur_size</span><span class="p">,</span> <span class="n">_size</span><span class="p">))</span>
</span><span id="__span-9-109"><a id="__codelineno-9-109" name="__codelineno-9-109" href="#__codelineno-9-109"></a>
</span><span id="__span-9-110"><a id="__codelineno-9-110" name="__codelineno-9-110" href="#__codelineno-9-110"></a>            <span class="c1"># initialize activation function</span>
</span><span id="__span-9-111"><a id="__codelineno-9-111" name="__codelineno-9-111" href="#__codelineno-9-111"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">acts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="__span-9-112"><a id="__codelineno-9-112" name="__codelineno-9-112" href="#__codelineno-9-112"></a>                <span class="n">act_mod</span><span class="o">.</span><span class="n">get_activation</span><span class="p">(</span><span class="n">activation</span><span class="p">)</span>
</span><span id="__span-9-113"><a id="__codelineno-9-113" name="__codelineno-9-113" href="#__codelineno-9-113"></a>                <span class="k">if</span> <span class="n">activation</span> <span class="o">!=</span> <span class="s2">"stan"</span>
</span><span id="__span-9-114"><a id="__codelineno-9-114" name="__codelineno-9-114" href="#__codelineno-9-114"></a>                <span class="k">else</span> <span class="n">act_mod</span><span class="o">.</span><span class="n">get_activation</span><span class="p">(</span><span class="n">activation</span><span class="p">)(</span><span class="n">_size</span><span class="p">)</span>
</span><span id="__span-9-115"><a id="__codelineno-9-115" name="__codelineno-9-115" href="#__codelineno-9-115"></a>            <span class="p">)</span>
</span><span id="__span-9-116"><a id="__codelineno-9-116" name="__codelineno-9-116" href="#__codelineno-9-116"></a>            <span class="c1"># special initialization for certain activation</span>
</span><span id="__span-9-117"><a id="__codelineno-9-117" name="__codelineno-9-117" href="#__codelineno-9-117"></a>            <span class="c1"># TODO: Adapt code below to a more elegant style</span>
</span><span id="__span-9-118"><a id="__codelineno-9-118" name="__codelineno-9-118" href="#__codelineno-9-118"></a>            <span class="k">if</span> <span class="n">activation</span> <span class="o">==</span> <span class="s2">"siren"</span><span class="p">:</span>
</span><span id="__span-9-119"><a id="__codelineno-9-119" name="__codelineno-9-119" href="#__codelineno-9-119"></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-9-120"><a id="__codelineno-9-120" name="__codelineno-9-120" href="#__codelineno-9-120"></a>                    <span class="n">act_mod</span><span class="o">.</span><span class="n">Siren</span><span class="o">.</span><span class="n">init_for_first_layer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linears</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-9-121"><a id="__codelineno-9-121" name="__codelineno-9-121" href="#__codelineno-9-121"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-122"><a id="__codelineno-9-122" name="__codelineno-9-122" href="#__codelineno-9-122"></a>                    <span class="n">act_mod</span><span class="o">.</span><span class="n">Siren</span><span class="o">.</span><span class="n">init_for_hidden_layer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linears</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-9-123"><a id="__codelineno-9-123" name="__codelineno-9-123" href="#__codelineno-9-123"></a>
</span><span id="__span-9-124"><a id="__codelineno-9-124" name="__codelineno-9-124" href="#__codelineno-9-124"></a>            <span class="n">cur_size</span> <span class="o">=</span> <span class="n">_size</span>
</span><span id="__span-9-125"><a id="__codelineno-9-125" name="__codelineno-9-125" href="#__codelineno-9-125"></a>
</span><span id="__span-9-126"><a id="__codelineno-9-126" name="__codelineno-9-126" href="#__codelineno-9-126"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">linears</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linears</span><span class="p">)</span>
</span><span id="__span-9-127"><a id="__codelineno-9-127" name="__codelineno-9-127" href="#__codelineno-9-127"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">acts</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LayerList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acts</span><span class="p">)</span>
</span><span id="__span-9-128"><a id="__codelineno-9-128" name="__codelineno-9-128" href="#__codelineno-9-128"></a>        <span class="k">if</span> <span class="n">random_weight</span><span class="p">:</span>
</span><span id="__span-9-129"><a id="__codelineno-9-129" name="__codelineno-9-129" href="#__codelineno-9-129"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_fc</span> <span class="o">=</span> <span class="n">RandomWeightFactorization</span><span class="p">(</span>
</span><span id="__span-9-130"><a id="__codelineno-9-130" name="__codelineno-9-130" href="#__codelineno-9-130"></a>                <span class="n">cur_size</span><span class="p">,</span>
</span><span id="__span-9-131"><a id="__codelineno-9-131" name="__codelineno-9-131" href="#__codelineno-9-131"></a>                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_keys</span><span class="p">)</span> <span class="k">if</span> <span class="n">output_dim</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">output_dim</span><span class="p">,</span>
</span><span id="__span-9-132"><a id="__codelineno-9-132" name="__codelineno-9-132" href="#__codelineno-9-132"></a>                <span class="n">mean</span><span class="o">=</span><span class="n">random_weight</span><span class="p">[</span><span class="s2">"mean"</span><span class="p">],</span>
</span><span id="__span-9-133"><a id="__codelineno-9-133" name="__codelineno-9-133" href="#__codelineno-9-133"></a>                <span class="n">std</span><span class="o">=</span><span class="n">random_weight</span><span class="p">[</span><span class="s2">"std"</span><span class="p">],</span>
</span><span id="__span-9-134"><a id="__codelineno-9-134" name="__codelineno-9-134" href="#__codelineno-9-134"></a>            <span class="p">)</span>
</span><span id="__span-9-135"><a id="__codelineno-9-135" name="__codelineno-9-135" href="#__codelineno-9-135"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-9-136"><a id="__codelineno-9-136" name="__codelineno-9-136" href="#__codelineno-9-136"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">last_fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span>
</span><span id="__span-9-137"><a id="__codelineno-9-137" name="__codelineno-9-137" href="#__codelineno-9-137"></a>                <span class="n">cur_size</span><span class="p">,</span>
</span><span id="__span-9-138"><a id="__codelineno-9-138" name="__codelineno-9-138" href="#__codelineno-9-138"></a>                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_keys</span><span class="p">)</span> <span class="k">if</span> <span class="n">output_dim</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">output_dim</span><span class="p">,</span>
</span><span id="__span-9-139"><a id="__codelineno-9-139" name="__codelineno-9-139" href="#__codelineno-9-139"></a>            <span class="p">)</span>
</span><span id="__span-9-140"><a id="__codelineno-9-140" name="__codelineno-9-140" href="#__codelineno-9-140"></a>
</span><span id="__span-9-141"><a id="__codelineno-9-141" name="__codelineno-9-141" href="#__codelineno-9-141"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">skip_connection</span> <span class="o">=</span> <span class="n">skip_connection</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-py highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_transform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_transform</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">periods</span><span class="p">:</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">period_emb</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_to_tensor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_keys</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fourier</span><span class="p">:</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fourier_emb</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_tensor</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_to_dict</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_keys</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_transform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_output_transform</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>    <span class="k">return</span> <span class="n">y</span>
</span></code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>在 <code>ppsci/arch/__init__.py</code> 中导入编写的新模型类 <code>NewModel</code>，并添加到 <code>__all__</code> 中</p>
<div class="language-py highlight"><span class="filename">ppsci/arch/__init__.py</span><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="o">...</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="o">...</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="hll"><span class="kn">from</span> <span class="nn">ppsci.arch.new_model</span> <span class="kn">import</span> <span class="n">NewModel</span>
</span></span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>    <span class="o">...</span><span class="p">,</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>    <span class="o">...</span><span class="p">,</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="hll">    <span class="s2">"NewModel"</span><span class="p">,</span>
</span></span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="p">]</span>
</span></code></pre></div>
</li>
</ol>
<p>完成上述新模型代码编写的工作之后，在 <code>demo.py</code> 中，就能通过调用 <code>ppsci.arch.NewModel</code>，实例化刚才编写的模型，如下所示。</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">model</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">NewModel</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="24">2.4 构建方程<a class="headerlink" href="#24" title="Permanent link">¶</a></h3>
<p>如果您的案例问题中涉及到方程计算，那么可以选择使用 PaddleScience 内置的方程，或者编写自己的方程。</p>
<h4 id="241">2.4.1 构建已有方程<a class="headerlink" href="#241" title="Permanent link">¶</a></h4>
<p>PaddleScience 内置了一些常见的方程，如 <code>NavierStokes</code> 方程，如果您想使用这些内置的方程，可以直接
调用 <a href="../api/equation/"><code>ppsci.equation.*</code></a> 下的 API，并填入方程实例化所需的参数，即可快速构建方程。</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># create a Vibration equation</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">viv_equation</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">equation</span><span class="o">.</span><span class="n">Vibration</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></code></pre></div>
<h4 id="242">2.4.2 构建新的方程<a class="headerlink" href="#242" title="Permanent link">¶</a></h4>
<p>当 PaddleScience 内置的方程无法满足您的需求时，您也可以通过新增方程文件并编写方程代码的方式，使用您自定义的方程。</p>
<p>假设需要计算的方程公式如下所示。</p>
<div class="arithmatex">\[
\begin{cases}
    \begin{align}
        \dfrac{\partial u}{\partial x} + \dfrac{\partial u}{\partial y} &amp;= u + 1, \tag{1} \\
        \dfrac{\partial v}{\partial x} + \dfrac{\partial v}{\partial y} &amp;= v. \tag{2}
    \end{align}
\end{cases}
\]</div>
<blockquote>
<p>其中 <span class="arithmatex">\(x\)</span>, <span class="arithmatex">\(y\)</span> 为模型输入，表示<span class="arithmatex">\(x\)</span>、<span class="arithmatex">\(y\)</span>轴坐标；<span class="arithmatex">\(u=u(x,y)\)</span>、<span class="arithmatex">\(v=v(x,y)\)</span> 是模型输出，表示 <span class="arithmatex">\((x,y)\)</span> 处的 <span class="arithmatex">\(x\)</span>、<span class="arithmatex">\(y\)</span> 轴方向速度。</p>
</blockquote>
<p>首先我们需要将上述方程进行适当移项，将含有变量、函数的项移动到等式左侧，含有常数的项移动到等式右侧，方便后续转换成程序代码，如下所示。</p>
<div class="arithmatex">\[
\begin{cases}
    \begin{align}
        \dfrac{\partial u}{\partial x} +  \dfrac{\partial u}{\partial y} - u &amp;= 1, \tag{3}\\
        \dfrac{\partial v}{\partial x} +  \dfrac{\partial v}{\partial y} - v &amp;= 0. \tag{4}
    \end{align}
\end{cases}
\]</div>
<p>然后就可以将上述移项后的方程组根据以下步骤转换成对应的程序代码。</p>
<ol>
<li>
<p>在 <code>ppsci/equation/pde/</code> 下新建方程文件。如果您的方程并不是 PDE 方程，那么需要新建一个方程类文件夹，比如在 <code>ppsci/equation/</code> 下新建 <code>ode</code> 文件夹，再将您的方程文件放在 <code>ode</code> 文件夹下。此处以PDE类的方程 <code>new_pde.py</code> 为例。</p>
</li>
<li>
<p>在 <code>new_pde.py</code> 文件中导入 PaddleScience 的方程基类所在模块 <code>base</code>，并从 <code>base.PDE</code> 派生 <code>Class NewPDE</code>。</p>
<div class="language-py highlight"><span class="filename">ppsci/equation/pde/new_pde.py</span><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kn">from</span> <span class="nn">ppsci.equation.pde</span> <span class="kn">import</span> <span class="n">base</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="k">class</span> <span class="nc">NewPDE</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">PDE</span><span class="p">):</span>
</span></code></pre></div>
</li>
<li>
<p>编写 <code>__init__</code> 代码，用于方程创建时的初始化，在其中定义必要的变量和公式计算过程。PaddleScience 支持使用 sympy 符号计算库创建方程和直接使用 python 函数编写方程，两种方式如下所示。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked id="__tabbed_2_1" name="__tabbed_2" type="radio"><input id="__tabbed_2_2" name="__tabbed_2" type="radio"><div class="tabbed-labels"><label for="__tabbed_2_1">sympy expression</label><label for="__tabbed_2_2">python function</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-py highlight"><span class="filename">ppsci/equation/pde/new_pde.py</span><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kn">from</span> <span class="nn">ppsci.equation.pde</span> <span class="kn">import</span> <span class="n">base</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="k">class</span> <span class="nc">NewPDE</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">PDE</span><span class="p">):</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_symbols</span><span class="p">(</span><span class="s2">"x y"</span><span class="p">)</span> <span class="c1"># 创建自变量 x, y</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_function</span><span class="p">(</span><span class="s2">"u"</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>  <span class="c1"># 创建关于自变量 (x, y) 的函数 u(x,y)</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_function</span><span class="p">(</span><span class="s2">"v"</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>  <span class="c1"># 创建关于自变量 (x, y) 的函数 v(x,y)</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>        <span class="n">expr1</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span>  <span class="c1"># 对应等式(3)左侧表达式</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>        <span class="n">expr2</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">v</span>  <span class="c1"># 对应等式(4)左侧表达式</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">"expr1"</span><span class="p">,</span> <span class="n">expr1</span><span class="p">)</span>  <span class="c1"># 将expr1 的 sympy 表达式对象添加到 NewPDE 对象的公式集合中</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">"expr2"</span><span class="p">,</span> <span class="n">expr2</span><span class="p">)</span>  <span class="c1"># 将expr2 的 sympy 表达式对象添加到 NewPDE 对象的公式集合中</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-py highlight"><span class="filename">ppsci/equation/pde/new_pde.py</span><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kn">from</span> <span class="nn">ppsci.autodiff</span> <span class="kn">import</span> <span class="n">jacobian</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="kn">from</span> <span class="nn">ppsci.equation.pde</span> <span class="kn">import</span> <span class="n">base</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="k">class</span> <span class="nc">NewPDE</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">PDE</span><span class="p">):</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>        <span class="k">def</span> <span class="nf">expr1_compute_func</span><span class="p">(</span><span class="n">out</span><span class="p">):</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">out</span><span class="p">[</span><span class="s2">"y"</span><span class="p">]</span>  <span class="c1"># 从 out 数据字典中取出自变量 x, y 的数据值</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>            <span class="n">u</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s2">"u"</span><span class="p">]</span>  <span class="c1"># 从 out 数据字典中取出因变量 u 的函数值</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>            <span class="n">expr1</span> <span class="o">=</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">u</span>  <span class="c1"># 对应等式(3)左侧表达式计算过程</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>            <span class="k">return</span> <span class="n">expr1</span>  <span class="c1"># 返回计算结果值</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>        <span class="k">def</span> <span class="nf">expr2_compute_func</span><span class="p">(</span><span class="n">out</span><span class="p">):</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">out</span><span class="p">[</span><span class="s2">"y"</span><span class="p">]</span>  <span class="c1"># 从 out 数据字典中取出自变量 x, y 的数据值</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>            <span class="n">v</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="s2">"v"</span><span class="p">]</span>  <span class="c1"># 从 out 数据字典中取出因变量 v 的函数值</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a>            <span class="n">expr2</span> <span class="o">=</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">v</span>  <span class="c1"># 对应等式(4)左侧表达式计算过程</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a>            <span class="k">return</span> <span class="n">expr2</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">"expr1"</span><span class="p">,</span> <span class="n">expr1_compute_func</span><span class="p">)</span>  <span class="c1"># 将 expr1 的计算函数添加到 NewPDE 对象的公式集合中</span>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_equation</span><span class="p">(</span><span class="s2">"expr2"</span><span class="p">,</span> <span class="n">expr2_compute_func</span><span class="p">)</span>  <span class="c1"># 将 expr2 的计算函数添加到 NewPDE 对象的公式集合中</span>
</span></code></pre></div>
</div>
</div>
</div>
</li>
<li>
<p>在 <code>ppsci/equation/__init__.py</code> 中导入编写的新方程类，并添加到 <code>__all__</code> 中</p>
<div class="language-py highlight"><span class="filename">ppsci/equation/__init__.py</span><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="o">...</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="o">...</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="hll"><span class="kn">from</span> <span class="nn">ppsci.equation.pde.new_pde</span> <span class="kn">import</span> <span class="n">NewPDE</span>
</span></span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>    <span class="o">...</span><span class="p">,</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>    <span class="o">...</span><span class="p">,</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="hll">    <span class="s2">"NewPDE"</span><span class="p">,</span>
</span></span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="p">]</span>
</span></code></pre></div>
</li>
</ol>
<p>完成上述新方程代码编写的工作之后，我们就能像 PaddleScience 内置方程一样，以 <code>ppsci.equation.NewPDE</code> 的方式，调用我们编写的新方程类，并用于创建方程实例。</p>
<p>在方程构建完毕后之后，我们需要将所有方程包装为到一个字典中</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">new_pde</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">equation</span><span class="o">.</span><span class="n">NewPDE</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="n">equation</span> <span class="o">=</span> <span class="p">{</span><span class="o">...</span><span class="p">,</span> <span class="s2">"newpde"</span><span class="p">:</span> <span class="n">new_pde</span><span class="p">}</span>
</span></code></pre></div>
<h3 id="25">2.5 构建几何模块[可选]<a class="headerlink" href="#25" title="Permanent link">¶</a></h3>
<p>模型训练、验证时所用的输入、标签数据的来源，根据具体案例场景的不同而变化。大部分基于 PINN 的案例，其数据来自几何形状内部、表面采样得到的坐标点、法向量、SDF 值；而基于数据驱动的方法，其输入、标签数据大多数来自于外部文件，或通过 numpy 等第三方库构造的存放在内存中的数据。本章节主要对第一种情况所需的几何模块进行介绍，第二种情况则不一定需要几何模块，其构造方式可以参考 <a href="#2.6">#2.6 构建约束条件</a>。</p>
<h4 id="251">2.5.1 构建已有几何<a class="headerlink" href="#251" title="Permanent link">¶</a></h4>
<p>PaddleScience 内置了几类常用的几何形状，包括简单几何、复杂几何，如下所示。</p>
<table>
<thead>
<tr>
<th>几何调用方式</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ppsci.geometry.Interval</code></td>
<td>1 维线段几何</td>
</tr>
<tr>
<td><code>ppsci.geometry.Disk</code></td>
<td>2 维圆面几何</td>
</tr>
<tr>
<td><code>ppsci.geometry.Polygon</code></td>
<td>2 维多边形几何</td>
</tr>
<tr>
<td><code>ppsci.geometry.Rectangle</code></td>
<td>2 维矩形几何</td>
</tr>
<tr>
<td><code>ppsci.geometry.Triangle</code></td>
<td>2 维三角形几何</td>
</tr>
<tr>
<td><code>ppsci.geometry.Cuboid</code></td>
<td>3 维立方体几何</td>
</tr>
<tr>
<td><code>ppsci.geometry.Sphere</code></td>
<td>3 维圆球几何</td>
</tr>
<tr>
<td><code>ppsci.geometry.Mesh</code></td>
<td>3 维 Mesh 几何</td>
</tr>
<tr>
<td><code>ppsci.geometry.PointCloud</code></td>
<td>点云几何</td>
</tr>
<tr>
<td><code>ppsci.geometry.TimeDomain</code></td>
<td>1 维时间几何(常用于瞬态问题)</td>
</tr>
<tr>
<td><code>ppsci.geometry.TimeXGeometry</code></td>
<td>1 + N 维带有时间的几何(常用于瞬态问题)</td>
</tr>
</tbody>
</table>
<p>以计算域为 2 维矩形几何为例，实例化一个 x 轴边长为2，y 轴边长为 1，且左下角为点 (-1,-3) 的矩形几何代码如下：</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">LEN_X</span><span class="p">,</span> <span class="n">LEN_Y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span>  <span class="c1"># 定义矩形边长</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">rect</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">LEN_X</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="n">LEN_Y</span><span class="p">])</span>  <span class="c1"># 通过左下角、右上角对角线坐标构造矩形</span>
</span></code></pre></div>
<p>其余的几何体构造方法类似，参考 API 文档的 <a href="../api/geometry/">ppsci.geometry</a> 部分即可。</p>
<h4 id="252">2.5.2 构建新的几何<a class="headerlink" href="#252" title="Permanent link">¶</a></h4>
<p>下面以构建一个新的几何体 —— 2 维椭圆（无旋转）为例进行介绍。</p>
<ol>
<li>
<p>首先我们需要在二维几何的代码文件 <code>ppsci/geometry/geometry_2d.py</code> 中新建椭圆类 <code>Ellipse</code>，并制定其直接父类为 <code>geometry.Geometry</code> 几何基类。
然后根据椭圆的代数表示公式：<span class="arithmatex">\(\dfrac{x^2}{a^2} + \dfrac{y^2}{b^2} = 1\)</span>，可以发现表示一个椭圆需要记录其圆心坐标 <span class="arithmatex">\((x_0,y_0)\)</span>、<span class="arithmatex">\(x\)</span> 轴半径 <span class="arithmatex">\(a\)</span>、<span class="arithmatex">\(y\)</span> 轴半径 <span class="arithmatex">\(b\)</span>。因此该椭圆类的代码如下所示。</p>
<div class="language-py highlight"><span class="filename">ppsci/geometry/geometry_2d.py</span><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">class</span> <span class="nc">Ellipse</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">Geometry</span><span class="p">):</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">y0</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">paddle</span><span class="o">.</span><span class="n">get_default_dtype</span><span class="p">())</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span>
</span></code></pre></div>
</li>
<li>
<p>为椭圆类编写必要的基础方法，如下所示。</p>
<ul>
<li>
<p>判断给定点集是否在椭圆内部</p>
<div class="language-py highlight"><span class="filename">ppsci/geometry/geometry_2d.py</span><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">def</span> <span class="nf">is_inside</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>    <span class="k">return</span> <span class="p">((</span><span class="n">x</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span>
</span></code></pre></div>
</li>
<li>
<p>判断给定点集是否在椭圆边界上</p>
<div class="language-py highlight"><span class="filename">ppsci/geometry/geometry_2d.py</span><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">def</span> <span class="nf">on_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(((</span><span class="n">x</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</span></code></pre></div>
</li>
<li>
<p>在椭圆内部点随机采样(此处使用“拒绝采样法”实现)</p>
<div class="language-py highlight"><span class="filename">ppsci/geometry/geometry_2d.py</span><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">def</span> <span class="nf">random_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="s2">"pseudo"</span><span class="p">):</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>    <span class="n">res_n</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>    <span class="n">max_radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>    <span class="k">while</span> <span class="p">(</span><span class="n">res_n</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">):</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>        <span class="n">rng</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">random</span><span class="p">)</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>        <span class="n">r</span><span class="p">,</span> <span class="n">theta</span> <span class="o">=</span> <span class="n">rng</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">rng</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>        <span class="n">candidate</span> <span class="o">=</span> <span class="n">max_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>        <span class="n">candidate</span> <span class="o">=</span> <span class="n">candidate</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">is_inside</span><span class="p">(</span><span class="n">candidate</span><span class="p">)]</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">res_n</span><span class="p">:</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>            <span class="n">candidate</span> <span class="o">=</span> <span class="n">candidate</span><span class="p">[:</span> <span class="n">res_n</span><span class="p">]</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>        <span class="n">res_n</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidate</span><span class="p">)</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>    <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div>
</li>
<li>
<p>在椭圆边界随机采样(此处基于椭圆参数方程实现)</p>
<div class="language-py highlight"><span class="filename">ppsci/geometry/geometry_2d.py</span><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">def</span> <span class="nf">random_boundary_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="s2">"pseudo"</span><span class="p">):</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>    <span class="n">theta</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">sampler</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">random</span><span class="p">)</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    <span class="k">return</span> <span class="n">X</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span>
</span></code></pre></div>
</li>
</ul>
</li>
<li>
<p>在 <code>ppsci/geometry/__init__.py</code> 中加入椭圆类 <code>Ellipse</code>，如下所示。</p>
<div class="language-py highlight"><span class="filename">ppsci/geometry/__init__.py</span><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="o">...</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="o">...</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="hll"><span class="kn">from</span> <span class="nn">ppsci.geometry.geometry_2d</span> <span class="kn">import</span> <span class="n">Ellipse</span>
</span></span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>    <span class="o">...</span><span class="p">,</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>    <span class="o">...</span><span class="p">,</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="hll">    <span class="s2">"Ellipse"</span><span class="p">,</span>
</span></span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="p">]</span>
</span></code></pre></div>
</li>
</ol>
<p>完成上述实现之后，我们就能以如下方式实例化椭圆类。同样地，建议将所有几何类实例包装在一个字典中，方便后续索引。</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">ellipse</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Ellipse</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="n">geom</span> <span class="o">=</span> <span class="p">{</span><span class="o">...</span><span class="p">,</span> <span class="s2">"ellipse"</span><span class="p">:</span> <span class="n">ellipse</span><span class="p">}</span>
</span></code></pre></div>
<h3 id="26">2.6 构建约束条件<a class="headerlink" href="#26" title="Permanent link">¶</a></h3>
<p>无论是 PINNs 方法还是数据驱动方法，它们总是需要利用数据来指导网络模型的训练，而这一过程在 PaddleScience 中由 <code>Constraint</code>（约束）模块负责。</p>
<h4 id="261">2.6.1 构建已有约束<a class="headerlink" href="#261" title="Permanent link">¶</a></h4>
<p>PaddleScience 内置了一些常见的约束，如下所示。</p>
<table>
<thead>
<tr>
<th>约束名称</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ppsci.constraint.BoundaryConstraint</code></td>
<td>边界约束</td>
</tr>
<tr>
<td><code>ppsci.constraint.InitialConstraint</code></td>
<td>内部点初值约束</td>
</tr>
<tr>
<td><code>ppsci.constraint.IntegralConstraint</code></td>
<td>边界积分约束</td>
</tr>
<tr>
<td><code>ppsci.constraint.InteriorConstraint</code></td>
<td>内部点约束</td>
</tr>
<tr>
<td><code>ppsci.constraint.PeriodicConstraint</code></td>
<td>边界周期约束</td>
</tr>
<tr>
<td><code>ppsci.constraint.SupervisedConstraint</code></td>
<td>监督数据约束</td>
</tr>
</tbody>
</table>
<p>如果您想使用这些内置的约束，可以直接调用 <a href="../api/constraint/"><code>ppsci.constraint.*</code></a> 下的 API，并填入约束实例化所需的参数，即可快速构建约束条件。</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1"># create a SupervisedConstraint</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="n">sup_constraint</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">SupervisedConstraint</span><span class="p">(</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>    <span class="n">train_dataloader_cfg</span><span class="p">,</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>    <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>    <span class="p">{</span><span class="s2">"eta"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"eta"</span><span class="p">],</span> <span class="o">**</span><span class="n">equation</span><span class="p">[</span><span class="s2">"VIV"</span><span class="p">]</span><span class="o">.</span><span class="n">equations</span><span class="p">},</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">"Sup"</span><span class="p">,</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="p">)</span>
</span></code></pre></div>
<p>约束的参数填写方式，请参考对应的 API 文档参数说明和样例代码。</p>
<h4 id="262">2.6.2 构建新的约束<a class="headerlink" href="#262" title="Permanent link">¶</a></h4>
<p>当 PaddleScience 内置的约束无法满足您的需求时，您也可以通过新增约束文件并编写约束代码的方式，使用您自
定义的约束，步骤如下：</p>
<ol>
<li>
<p>在 <code>ppsci/constraint</code> 下新建约束文件（此处以约束 <code>new_constraint.py</code> 为例）</p>
</li>
<li>
<p>在 <code>new_constraint.py</code> 文件中导入 PaddleScience 的约束基类所在模块 <code>base</code>，并让创建的新约束
类（以 <code>Class NewConstraint</code> 为例）从 <code>base.PDE</code> 继承</p>
<div class="language-py highlight"><span class="filename">ppsci/constraint/new_constraint.py</span><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="kn">from</span> <span class="nn">ppsci.constraint</span> <span class="kn">import</span> <span class="n">base</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="k">class</span> <span class="nc">NewConstraint</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Constraint</span><span class="p">):</span>
</span></code></pre></div>
</li>
<li>
<p>编写 <code>__init__</code> 方法，用于约束创建时的初始化。</p>
<div class="language-py highlight"><span class="filename">ppsci/constraint/new_constraint.py</span><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="kn">from</span> <span class="nn">ppsci.constraint</span> <span class="kn">import</span> <span class="n">base</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="k">class</span> <span class="nc">NewConstraint</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Constraint</span><span class="p">):</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>        <span class="o">...</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>        <span class="c1"># initialization</span>
</span></code></pre></div>
</li>
<li>
<p>在 <code>ppsci/constraint/__init__.py</code> 中导入编写的新约束类，并添加到 <code>__all__</code> 中</p>
<div class="language-py highlight"><span class="filename">ppsci/constraint/__init__.py</span><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="o">...</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="o">...</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="hll"><span class="kn">from</span> <span class="nn">ppsci.constraint.new_constraint</span> <span class="kn">import</span> <span class="n">NewConstraint</span>
</span></span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>    <span class="o">...</span><span class="p">,</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>    <span class="o">...</span><span class="p">,</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="hll">    <span class="s2">"NewConstraint"</span><span class="p">,</span>
</span></span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="p">]</span>
</span></code></pre></div>
</li>
</ol>
<p>完成上述新约束代码编写的工作之后，我们就能像 PaddleScience 内置约束一样，以 <code>ppsci.constraint.NewConstraint</code> 的方式，调用我们编写的新约束类，并用于创建约束实例。</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">new_constraint</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">NewConstraint</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="n">constraint</span> <span class="o">=</span> <span class="p">{</span><span class="o">...</span><span class="p">,</span> <span class="n">new_constraint</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">new_constraint</span><span class="p">}</span>
</span></code></pre></div>
<h3 id="27">2.7 定义超参数<a class="headerlink" href="#27" title="Permanent link">¶</a></h3>
<p>在模型开始训练前，需要定义一些训练相关的超参数，如训练轮数、学习率等，如下所示。</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">EPOCHS</span> <span class="o">=</span> <span class="mi">10000</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">LEARNING_RATE</span> <span class="o">=</span> <span class="mf">0.001</span>
</span></code></pre></div>
<h3 id="28">2.8 构建优化器<a class="headerlink" href="#28" title="Permanent link">¶</a></h3>
<p>模型训练时除了模型本身，还需要定义一个用于更新模型参数的优化器，如下所示。</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">optimizer</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)(</span><span class="n">model</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="29">2.9 构建评估器[可选]<a class="headerlink" href="#29" title="Permanent link">¶</a></h3>
<h4 id="291">2.9.1 构建已有评估器<a class="headerlink" href="#291" title="Permanent link">¶</a></h4>
<p>PaddleScience 内置了一些常见的评估器，如下所示。</p>
<table>
<thead>
<tr>
<th>评估器名称</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ppsci.validator.GeometryValidator</code></td>
<td>几何评估器</td>
</tr>
<tr>
<td><code>ppsci.validator.SupervisedValidator</code></td>
<td>监督数据评估器</td>
</tr>
</tbody>
</table>
<p>如果您想使用这些内置的评估器，可以直接调用 <a href="../api/validate/"><code>ppsci.validate.*</code></a> 下的 API，并填入评估器实例化所需的参数，即可快速构建评估器。</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># create a SupervisedValidator</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="n">eta_mse_validator</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">SupervisedValidator</span><span class="p">(</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>    <span class="n">valid_dataloader_cfg</span><span class="p">,</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>    <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>    <span class="p">{</span><span class="s2">"eta"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"eta"</span><span class="p">],</span> <span class="o">**</span><span class="n">equation</span><span class="p">[</span><span class="s2">"VIV"</span><span class="p">]</span><span class="o">.</span><span class="n">equations</span><span class="p">},</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>    <span class="n">metric</span><span class="o">=</span><span class="p">{</span><span class="s2">"MSE"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">MSE</span><span class="p">()},</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">"eta_mse"</span><span class="p">,</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="p">)</span>
</span></code></pre></div>
<h4 id="292">2.9.2 构建新的评估器<a class="headerlink" href="#292" title="Permanent link">¶</a></h4>
<p>当 PaddleScience 内置的评估器无法满足您的需求时，您也可以通过新增评估器文件并编写评估器代码的方式，使
用您自定义的评估器，步骤如下：</p>
<ol>
<li>
<p>在 <code>ppsci/validate</code> 下新建评估器文件（此处以 <code>new_validator.py</code> 为例）。</p>
</li>
<li>
<p>在 <code>new_validator.py</code> 文件中导入 PaddleScience 的评估器基类所在模块 <code>base</code>，并让创建的新评估器类（以 <code>Class NewValidator</code> 为例）从 <code>base.Validator</code> 继承。</p>
<div class="language-py highlight"><span class="filename">ppsci/validate/new_validator.py</span><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kn">from</span> <span class="nn">ppsci.validate</span> <span class="kn">import</span> <span class="n">base</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="k">class</span> <span class="nc">NewValidator</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Validator</span><span class="p">):</span>
</span></code></pre></div>
</li>
<li>
<p>编写 <code>__init__</code> 代码，用于评估器创建时的初始化</p>
<div class="language-py highlight"><span class="filename">ppsci/validate/new_validator.py</span><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="kn">from</span> <span class="nn">ppsci.validate</span> <span class="kn">import</span> <span class="n">base</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="k">class</span> <span class="nc">NewValidator</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Validator</span><span class="p">):</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>        <span class="o">...</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>        <span class="c1"># initialization</span>
</span></code></pre></div>
</li>
<li>
<p>在 <code>ppsci/validate/__init__.py</code> 中导入编写的新评估器类，并添加到 <code>__all__</code> 中。</p>
<div class="language-py highlight"><span class="filename">ppsci/validate/__init__.py</span><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="o">...</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="o">...</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="hll"><span class="kn">from</span> <span class="nn">ppsci.validate.new_validator</span> <span class="kn">import</span> <span class="n">NewValidator</span>
</span></span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>    <span class="o">...</span><span class="p">,</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>    <span class="o">...</span><span class="p">,</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a><span class="hll">    <span class="s2">"NewValidator"</span><span class="p">,</span>
</span></span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="p">]</span>
</span></code></pre></div>
</li>
</ol>
<p>完成上述新评估器代码编写的工作之后，我们就能像 PaddleScience 内置评估器一样，以 <code>ppsci.validate.NewValidator</code> 的方式，调用我们编写的新评估器类，并用于创建评估器实例。同样地，在评估器构建完毕后之后，建议将所有评估器包装到一个字典中方便后续索引。</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="n">new_validator</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">NewValidator</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="n">validator</span> <span class="o">=</span> <span class="p">{</span><span class="o">...</span><span class="p">,</span> <span class="n">new_validator</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">new_validator</span><span class="p">}</span>
</span></code></pre></div>
<h3 id="210">2.10 构建可视化器[可选]<a class="headerlink" href="#210" title="Permanent link">¶</a></h3>
<p>PaddleScience 内置了一些常见的可视化器，如 <code>VisualizerVtu</code> 可视化器等，如果您想使用这些内置的可视
化器，可以直接调用 <a href="../api/visualize/"><code>ppsci.visualizer.*</code></a> 下的 API，并填入可视化器实例化所需的
参数，即可快速构建模型。</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1"># manually collate input data for visualization,</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="c1"># interior+boundary</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="n">vis_points</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">vis_interior_points</span><span class="p">:</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a>    <span class="n">vis_points</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>        <span class="p">(</span><span class="n">vis_interior_points</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">vis_boundary_points</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a>    <span class="p">)</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="n">visualizer</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a>    <span class="s2">"visualize_u_v"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">visualize</span><span class="o">.</span><span class="n">VisualizerVtu</span><span class="p">(</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a>        <span class="n">vis_points</span><span class="p">,</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a>        <span class="p">{</span><span class="s2">"u"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">"u"</span><span class="p">],</span> <span class="s2">"v"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">"v"</span><span class="p">],</span> <span class="s2">"p"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">"p"</span><span class="p">]},</span>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a>        <span class="n">prefix</span><span class="o">=</span><span class="s2">"result_u_v"</span><span class="p">,</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a>    <span class="p">)</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a><span class="p">}</span>
</span></code></pre></div>
<p>如需新增可视化器，步骤与其他模块的新增方法类似，此处不再赘述。</p>
<h3 id="211-solver">2.11 构建Solver<a class="headerlink" href="#211-solver" title="Permanent link">¶</a></h3>
<p><a href="../api/solver/"><code>Solver</code></a> 是 PaddleScience 负责调用训练、评估、可视化的全局管理类。在训练开始前，需要把构建好的模型、约束、优化器等实例传给 <code>Solver</code> 以实例化，再调用它的内置方法进行训练、评估、可视化。</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># initialize solver</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="n">solver</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">Solver</span><span class="p">(</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>    <span class="n">model</span><span class="p">,</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>    <span class="n">constraint</span><span class="p">,</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>    <span class="n">output_dir</span><span class="p">,</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>    <span class="n">optimizer</span><span class="p">,</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>    <span class="n">lr_scheduler</span><span class="p">,</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>    <span class="n">EPOCHS</span><span class="p">,</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>    <span class="n">iters_per_epoch</span><span class="p">,</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>    <span class="n">eval_during_train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>    <span class="n">eval_freq</span><span class="o">=</span><span class="n">eval_freq</span><span class="p">,</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a>    <span class="n">equation</span><span class="o">=</span><span class="n">equation</span><span class="p">,</span>
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a>    <span class="n">validator</span><span class="o">=</span><span class="n">validator</span><span class="p">,</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a>    <span class="n">visualizer</span><span class="o">=</span><span class="n">visualizer</span><span class="p">,</span>
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="p">)</span>
</span></code></pre></div>
<h3 id="212">2.12 编写配置文件[重要]<a class="headerlink" href="#212" title="Permanent link">¶</a></h3>
<details class="info">
<summary>内容较长，点击展开</summary>
<p>经过上述步骤的开发，案例代码的主要部分已经完成。
当我们想基于这份代码运行一些调优实验，从而得到更好的结果，或更好地对运行参数设置进行管理，
则可以利用 PaddleScience 提供的配置管理系统，将实验运行参数从代码中分离出来，写到 <code>yaml</code> 格式的配置文件中，从而更好的管理、记录、调优实验。</p>
<p>以 <code>viv</code> 案例代码为例，在运行时我们需要在适当的位置设置方程参数、STL 文件路径、训练轮数、<code>batch_size</code>、随机种子、学习率等超参数，如下所示。</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="o">...</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="c1"># set dataloader config</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="n">train_dataloader_cfg</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>    <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>        <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"MatDataset"</span><span class="p">,</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>        <span class="s2">"file_path"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">VIV_DATA_PATH</span><span class="p">,</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>        <span class="s2">"input_keys"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"t_f"</span><span class="p">,),</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>        <span class="s2">"label_keys"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"eta"</span><span class="p">,</span> <span class="s2">"f"</span><span class="p">),</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>        <span class="s2">"weight_dict"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"eta"</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a>    <span class="p">},</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a>    <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a>    <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a>        <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a>        <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a>        <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a>    <span class="p">},</span>
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a><span class="p">}</span>
</span><span id="__span-41-18"><a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="o">...</span>
</span><span id="__span-41-19"><a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a><span class="o">...</span>
</span><span id="__span-41-20"><a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a><span class="c1"># set optimizer</span>
</span><span id="__span-41-21"><a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a><span class="n">lr_scheduler</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">Step</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="p">)()</span>
</span><span id="__span-41-22"><a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="o">...</span>
</span></code></pre></div>
<p>这些参数在实验过程中随时可能作为变量而被手动调整，在调整过程中如何避免频繁修改源代码导致试验记录混乱、保障记录完整可追溯便是一大问题，因此 PaddleScience 提供了基于 hydra + omegaconf 的
配置文件管理系统来解决这一问题。</p>
<p>将已有的代码修改成配置文件控制的方式非常简单，只需要将必要的参数写到 <code>yaml</code> 文件中，然后通过 hydra 在程序运行时读取、解析该文件，通过其内容控制实验运行即可，以 <code>viv</code> 案例为例，具体包含以下几个步骤。</p>
<ol>
<li>
<p>则需在代码文件 <code>viv.py</code> 所在目录下新建 <code>conf</code> 文件夹，并在 <code>conf</code> 下新建与 <code>viv.py</code> 同名的 <code>viv.yaml</code> 文件，如下所示。</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>PaddleScience/examples/fsi/
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>├──<span class="w"> </span>viv.py
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="hll">└──<span class="w"> </span>conf
</span></span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="hll"><span class="w">    </span>└──<span class="w"> </span>viv.yaml
</span></span></code></pre></div>
</li>
<li>
<p>将 <code>viv.py</code> 中必要的超参数按照其语义填写到 <code>viv.yaml</code> 的各个层级的配置中，如通用参数 <code>mode</code>、<code>output_dir</code>、<code>seed</code>、方程参数、文件路径等，直接填写在一级层级；而只与模型、训练相关的模型结构参数、训练轮数等，只需分别填写在 <code>MODEL</code>、<code>TRAIN</code> 层级下即可（<code>EVAL</code> 层级同理）。</p>
</li>
<li>
<p>将已有的 <code>train</code> 和 <code>evaluate</code> 函数修改为接受一个参数 <code>cfg</code>（<code>cfg</code> 即为读取进来的 <code>yaml</code> 文件里的内容，并以字典的形式存储），并将其内部的超参数统一改为通过 <code>cfg.xxx</code> 获取而非原先的直接设置为数字或字符串，如下所示。</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="kn">from</span> <span class="nn">omegaconf</span> <span class="kn">import</span> <span class="n">DictConfig</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>    <span class="c1"># 训练代码...</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>    <span class="c1"># 评估代码...</span>
</span></code></pre></div>
</li>
<li>
<p>新建一个 <code>main</code> 函数（同样接受且只接受一个 <code>cfg</code> 参数），它负责根据 <code>cfg.mode</code> 来调用 <code>train</code> 或 <code>evaluate</code> 函数，并 <code>main</code> 函数加上装饰器 <code>@hydra.main(version_base=None, config_path="./conf", config_name="viv.yaml")</code>，如下所示。</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="nd">@hydra</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">version_base</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_path</span><span class="o">=</span><span class="s2">"./conf"</span><span class="p">,</span> <span class="n">config_name</span><span class="o">=</span><span class="s2">"viv.yaml"</span><span class="p">)</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">"train"</span><span class="p">:</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>        <span class="n">train</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>    <span class="k">elif</span> <span class="n">cfg</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">"eval"</span><span class="p">:</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>        <span class="n">evaluate</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"cfg.mode should in ['train', 'eval'], but got '</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">mode</span><span class="si">}</span><span class="s2">'"</span><span class="p">)</span>
</span></code></pre></div>
</li>
<li>
<p>在主程序的启动入口 <code>if __name__ == "__main__":</code> 中启动 <code>main()</code> 即可，如下所示。</p>
<div class="language-py highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</li>
</ol>
<p>全部改造完毕后，<code>viv.py</code> 和 <code>viv.yaml</code> 如下所示。</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked id="__tabbed_3_1" name="__tabbed_3" type="radio"><input id="__tabbed_3_2" name="__tabbed_3" type="radio"><div class="tabbed-labels"><label for="__tabbed_3_1">examples/fsi/viv.py</label><label for="__tabbed_3_2">examples/fsi/conf/viv.yaml</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1">  1</a></span>
<span class="normal"><a href="#__codelineno-46-2">  2</a></span>
<span class="normal"><a href="#__codelineno-46-3">  3</a></span>
<span class="normal"><a href="#__codelineno-46-4">  4</a></span>
<span class="normal"><a href="#__codelineno-46-5">  5</a></span>
<span class="normal"><a href="#__codelineno-46-6">  6</a></span>
<span class="normal"><a href="#__codelineno-46-7">  7</a></span>
<span class="normal"><a href="#__codelineno-46-8">  8</a></span>
<span class="normal"><a href="#__codelineno-46-9">  9</a></span>
<span class="normal"><a href="#__codelineno-46-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-46-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-46-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-46-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-46-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-46-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-46-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-46-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-46-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-46-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-46-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-46-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-46-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-46-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-46-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-46-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-46-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-46-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-46-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-46-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-46-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-46-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-46-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-46-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-46-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-46-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-46-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-46-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-46-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-46-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-46-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-46-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-46-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-46-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-46-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-46-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-46-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-46-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-46-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-46-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-46-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-46-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-46-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-46-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-46-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-46-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-46-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-46-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-46-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-46-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-46-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-46-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-46-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-46-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-46-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-46-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-46-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-46-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-46-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-46-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-46-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-46-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-46-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-46-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-46-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-46-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-46-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-46-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-46-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-46-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-46-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-46-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-46-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-46-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-46-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-46-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-46-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-46-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-46-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-46-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-46-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-46-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-46-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-46-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-46-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-46-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-46-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-46-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-46-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-46-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-46-100">100</a></span>
<span class="normal"><a href="#__codelineno-46-101">101</a></span>
<span class="normal"><a href="#__codelineno-46-102">102</a></span>
<span class="normal"><a href="#__codelineno-46-103">103</a></span>
<span class="normal"><a href="#__codelineno-46-104">104</a></span>
<span class="normal"><a href="#__codelineno-46-105">105</a></span>
<span class="normal"><a href="#__codelineno-46-106">106</a></span>
<span class="normal"><a href="#__codelineno-46-107">107</a></span>
<span class="normal"><a href="#__codelineno-46-108">108</a></span>
<span class="normal"><a href="#__codelineno-46-109">109</a></span>
<span class="normal"><a href="#__codelineno-46-110">110</a></span>
<span class="normal"><a href="#__codelineno-46-111">111</a></span>
<span class="normal"><a href="#__codelineno-46-112">112</a></span>
<span class="normal"><a href="#__codelineno-46-113">113</a></span>
<span class="normal"><a href="#__codelineno-46-114">114</a></span>
<span class="normal"><a href="#__codelineno-46-115">115</a></span>
<span class="normal"><a href="#__codelineno-46-116">116</a></span>
<span class="normal"><a href="#__codelineno-46-117">117</a></span>
<span class="normal"><a href="#__codelineno-46-118">118</a></span>
<span class="normal"><a href="#__codelineno-46-119">119</a></span>
<span class="normal"><a href="#__codelineno-46-120">120</a></span>
<span class="normal"><a href="#__codelineno-46-121">121</a></span>
<span class="normal"><a href="#__codelineno-46-122">122</a></span>
<span class="normal"><a href="#__codelineno-46-123">123</a></span>
<span class="normal"><a href="#__codelineno-46-124">124</a></span>
<span class="normal"><a href="#__codelineno-46-125">125</a></span>
<span class="normal"><a href="#__codelineno-46-126">126</a></span>
<span class="normal"><a href="#__codelineno-46-127">127</a></span>
<span class="normal"><a href="#__codelineno-46-128">128</a></span>
<span class="normal"><a href="#__codelineno-46-129">129</a></span>
<span class="normal"><a href="#__codelineno-46-130">130</a></span>
<span class="normal"><a href="#__codelineno-46-131">131</a></span>
<span class="normal"><a href="#__codelineno-46-132">132</a></span>
<span class="normal"><a href="#__codelineno-46-133">133</a></span>
<span class="normal"><a href="#__codelineno-46-134">134</a></span>
<span class="normal"><a href="#__codelineno-46-135">135</a></span>
<span class="normal"><a href="#__codelineno-46-136">136</a></span>
<span class="normal"><a href="#__codelineno-46-137">137</a></span>
<span class="normal"><a href="#__codelineno-46-138">138</a></span>
<span class="normal"><a href="#__codelineno-46-139">139</a></span>
<span class="normal"><a href="#__codelineno-46-140">140</a></span>
<span class="normal"><a href="#__codelineno-46-141">141</a></span>
<span class="normal"><a href="#__codelineno-46-142">142</a></span>
<span class="normal"><a href="#__codelineno-46-143">143</a></span>
<span class="normal"><a href="#__codelineno-46-144">144</a></span>
<span class="normal"><a href="#__codelineno-46-145">145</a></span>
<span class="normal"><a href="#__codelineno-46-146">146</a></span>
<span class="normal"><a href="#__codelineno-46-147">147</a></span>
<span class="normal"><a href="#__codelineno-46-148">148</a></span>
<span class="normal"><a href="#__codelineno-46-149">149</a></span>
<span class="normal"><a href="#__codelineno-46-150">150</a></span>
<span class="normal"><a href="#__codelineno-46-151">151</a></span>
<span class="normal"><a href="#__codelineno-46-152">152</a></span>
<span class="normal"><a href="#__codelineno-46-153">153</a></span>
<span class="normal"><a href="#__codelineno-46-154">154</a></span>
<span class="normal"><a href="#__codelineno-46-155">155</a></span>
<span class="normal"><a href="#__codelineno-46-156">156</a></span>
<span class="normal"><a href="#__codelineno-46-157">157</a></span>
<span class="normal"><a href="#__codelineno-46-158">158</a></span>
<span class="normal"><a href="#__codelineno-46-159">159</a></span>
<span class="normal"><a href="#__codelineno-46-160">160</a></span>
<span class="normal"><a href="#__codelineno-46-161">161</a></span>
<span class="normal"><a href="#__codelineno-46-162">162</a></span>
<span class="normal"><a href="#__codelineno-46-163">163</a></span>
<span class="normal"><a href="#__codelineno-46-164">164</a></span>
<span class="normal"><a href="#__codelineno-46-165">165</a></span>
<span class="normal"><a href="#__codelineno-46-166">166</a></span>
<span class="normal"><a href="#__codelineno-46-167">167</a></span>
<span class="normal"><a href="#__codelineno-46-168">168</a></span>
<span class="normal"><a href="#__codelineno-46-169">169</a></span>
<span class="normal"><a href="#__codelineno-46-170">170</a></span>
<span class="normal"><a href="#__codelineno-46-171">171</a></span>
<span class="normal"><a href="#__codelineno-46-172">172</a></span>
<span class="normal"><a href="#__codelineno-46-173">173</a></span>
<span class="normal"><a href="#__codelineno-46-174">174</a></span>
<span class="normal"><a href="#__codelineno-46-175">175</a></span>
<span class="normal"><a href="#__codelineno-46-176">176</a></span>
<span class="normal"><a href="#__codelineno-46-177">177</a></span>
<span class="normal"><a href="#__codelineno-46-178">178</a></span>
<span class="normal"><a href="#__codelineno-46-179">179</a></span>
<span class="normal"><a href="#__codelineno-46-180">180</a></span>
<span class="normal"><a href="#__codelineno-46-181">181</a></span>
<span class="normal"><a href="#__codelineno-46-182">182</a></span>
<span class="normal"><a href="#__codelineno-46-183">183</a></span>
<span class="normal"><a href="#__codelineno-46-184">184</a></span>
<span class="normal"><a href="#__codelineno-46-185">185</a></span>
<span class="normal"><a href="#__codelineno-46-186">186</a></span>
<span class="normal"><a href="#__codelineno-46-187">187</a></span>
<span class="normal"><a href="#__codelineno-46-188">188</a></span>
<span class="normal"><a href="#__codelineno-46-189">189</a></span>
<span class="normal"><a href="#__codelineno-46-190">190</a></span>
<span class="normal"><a href="#__codelineno-46-191">191</a></span>
<span class="normal"><a href="#__codelineno-46-192">192</a></span>
<span class="normal"><a href="#__codelineno-46-193">193</a></span>
<span class="normal"><a href="#__codelineno-46-194">194</a></span>
<span class="normal"><a href="#__codelineno-46-195">195</a></span>
<span class="normal"><a href="#__codelineno-46-196">196</a></span>
<span class="normal"><a href="#__codelineno-46-197">197</a></span>
<span class="normal"><a href="#__codelineno-46-198">198</a></span>
<span class="normal"><a href="#__codelineno-46-199">199</a></span>
<span class="normal"><a href="#__codelineno-46-200">200</a></span>
<span class="normal"><a href="#__codelineno-46-201">201</a></span>
<span class="normal"><a href="#__codelineno-46-202">202</a></span>
<span class="normal"><a href="#__codelineno-46-203">203</a></span>
<span class="normal"><a href="#__codelineno-46-204">204</a></span>
<span class="normal"><a href="#__codelineno-46-205">205</a></span>
<span class="normal"><a href="#__codelineno-46-206">206</a></span>
<span class="normal"><a href="#__codelineno-46-207">207</a></span>
<span class="normal"><a href="#__codelineno-46-208">208</a></span>
<span class="normal"><a href="#__codelineno-46-209">209</a></span>
<span class="normal"><a href="#__codelineno-46-210">210</a></span>
<span class="normal"><a href="#__codelineno-46-211">211</a></span>
<span class="normal"><a href="#__codelineno-46-212">212</a></span>
<span class="normal"><a href="#__codelineno-46-213">213</a></span>
<span class="normal"><a href="#__codelineno-46-214">214</a></span>
<span class="normal"><a href="#__codelineno-46-215">215</a></span>
<span class="normal"><a href="#__codelineno-46-216">216</a></span>
<span class="normal"><a href="#__codelineno-46-217">217</a></span>
<span class="normal"><a href="#__codelineno-46-218">218</a></span>
<span class="normal"><a href="#__codelineno-46-219">219</a></span>
<span class="normal"><a href="#__codelineno-46-220">220</a></span>
<span class="normal"><a href="#__codelineno-46-221">221</a></span>
<span class="normal"><a href="#__codelineno-46-222">222</a></span>
<span class="normal"><a href="#__codelineno-46-223">223</a></span>
<span class="normal"><a href="#__codelineno-46-224">224</a></span>
<span class="normal"><a href="#__codelineno-46-225">225</a></span>
<span class="normal"><a href="#__codelineno-46-226">226</a></span>
<span class="normal"><a href="#__codelineno-46-227">227</a></span>
<span class="normal"><a href="#__codelineno-46-228">228</a></span>
<span class="normal"><a href="#__codelineno-46-229">229</a></span>
<span class="normal"><a href="#__codelineno-46-230">230</a></span>
<span class="normal"><a href="#__codelineno-46-231">231</a></span>
<span class="normal"><a href="#__codelineno-46-232">232</a></span>
<span class="normal"><a href="#__codelineno-46-233">233</a></span>
<span class="normal"><a href="#__codelineno-46-234">234</a></span>
<span class="normal"><a href="#__codelineno-46-235">235</a></span>
<span class="normal"><a href="#__codelineno-46-236">236</a></span>
<span class="normal"><a href="#__codelineno-46-237">237</a></span>
<span class="normal"><a href="#__codelineno-46-238">238</a></span>
<span class="normal"><a href="#__codelineno-46-239">239</a></span>
<span class="normal"><a href="#__codelineno-46-240">240</a></span>
<span class="normal"><a href="#__codelineno-46-241">241</a></span>
<span class="normal"><a href="#__codelineno-46-242">242</a></span>
<span class="normal"><a href="#__codelineno-46-243">243</a></span>
<span class="normal"><a href="#__codelineno-46-244">244</a></span>
<span class="normal"><a href="#__codelineno-46-245">245</a></span>
<span class="normal"><a href="#__codelineno-46-246">246</a></span>
<span class="normal"><a href="#__codelineno-46-247">247</a></span>
<span class="normal"><a href="#__codelineno-46-248">248</a></span>
<span class="normal"><a href="#__codelineno-46-249">249</a></span>
<span class="normal"><a href="#__codelineno-46-250">250</a></span>
<span class="normal"><a href="#__codelineno-46-251">251</a></span>
<span class="normal"><a href="#__codelineno-46-252">252</a></span>
<span class="normal"><a href="#__codelineno-46-253">253</a></span>
<span class="normal"><a href="#__codelineno-46-254">254</a></span>
<span class="normal"><a href="#__codelineno-46-255">255</a></span>
<span class="normal"><a href="#__codelineno-46-256">256</a></span>
<span class="normal"><a href="#__codelineno-46-257">257</a></span>
<span class="normal"><a href="#__codelineno-46-258">258</a></span>
<span class="normal"><a href="#__codelineno-46-259">259</a></span>
<span class="normal"><a href="#__codelineno-46-260">260</a></span>
<span class="normal"><a href="#__codelineno-46-261">261</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="c1"># Copyright (c) 2023 PaddlePaddle Authors. All Rights Reserved.</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2"></a>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="c1"># Licensed under the Apache License, Version 2.0 (the "License");</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4"></a><span class="c1"># you may not use this file except in compliance with the License.</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5"></a><span class="c1"># You may obtain a copy of the License at</span>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6"></a>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7"></a><span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8"></a>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9"></a><span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10"></a><span class="c1"># distributed under the License is distributed on an "AS IS" BASIS,</span>
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11"></a><span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12"></a><span class="c1"># See the License for the specific language governing permissions and</span>
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13"></a><span class="c1"># limitations under the License.</span>
</span><span id="__span-46-14"><a id="__codelineno-46-14" name="__codelineno-46-14"></a>
</span><span id="__span-46-15"><a id="__codelineno-46-15" name="__codelineno-46-15"></a><span class="kn">import</span> <span class="nn">hydra</span>
</span><span id="__span-46-16"><a id="__codelineno-46-16" name="__codelineno-46-16"></a><span class="kn">from</span> <span class="nn">omegaconf</span> <span class="kn">import</span> <span class="n">DictConfig</span>
</span><span id="__span-46-17"><a id="__codelineno-46-17" name="__codelineno-46-17"></a>
</span><span id="__span-46-18"><a id="__codelineno-46-18" name="__codelineno-46-18"></a><span class="kn">import</span> <span class="nn">ppsci</span>
</span><span id="__span-46-19"><a id="__codelineno-46-19" name="__codelineno-46-19"></a>
</span><span id="__span-46-20"><a id="__codelineno-46-20" name="__codelineno-46-20"></a>
</span><span id="__span-46-21"><a id="__codelineno-46-21" name="__codelineno-46-21"></a><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
</span><span id="__span-46-22"><a id="__codelineno-46-22" name="__codelineno-46-22"></a>    <span class="c1"># set model</span>
</span><span id="__span-46-23"><a id="__codelineno-46-23" name="__codelineno-46-23"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">MLP</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="o">.</span><span class="n">MODEL</span><span class="p">)</span>
</span><span id="__span-46-24"><a id="__codelineno-46-24" name="__codelineno-46-24"></a>
</span><span id="__span-46-25"><a id="__codelineno-46-25" name="__codelineno-46-25"></a>    <span class="c1"># set equation</span>
</span><span id="__span-46-26"><a id="__codelineno-46-26" name="__codelineno-46-26"></a>    <span class="n">equation</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"VIV"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">equation</span><span class="o">.</span><span class="n">Vibration</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)}</span>
</span><span id="__span-46-27"><a id="__codelineno-46-27" name="__codelineno-46-27"></a>
</span><span id="__span-46-28"><a id="__codelineno-46-28" name="__codelineno-46-28"></a>    <span class="c1"># set constraint</span>
</span><span id="__span-46-29"><a id="__codelineno-46-29" name="__codelineno-46-29"></a>    <span class="n">sup_constraint</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">SupervisedConstraint</span><span class="p">(</span>
</span><span id="__span-46-30"><a id="__codelineno-46-30" name="__codelineno-46-30"></a>        <span class="p">{</span>
</span><span id="__span-46-31"><a id="__codelineno-46-31" name="__codelineno-46-31"></a>            <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-46-32"><a id="__codelineno-46-32" name="__codelineno-46-32"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"MatDataset"</span><span class="p">,</span>
</span><span id="__span-46-33"><a id="__codelineno-46-33" name="__codelineno-46-33"></a>                <span class="s2">"file_path"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">VIV_DATA_PATH</span><span class="p">,</span>
</span><span id="__span-46-34"><a id="__codelineno-46-34" name="__codelineno-46-34"></a>                <span class="s2">"input_keys"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"t_f"</span><span class="p">,),</span>
</span><span id="__span-46-35"><a id="__codelineno-46-35" name="__codelineno-46-35"></a>                <span class="s2">"label_keys"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"eta"</span><span class="p">,</span> <span class="s2">"f"</span><span class="p">),</span>
</span><span id="__span-46-36"><a id="__codelineno-46-36" name="__codelineno-46-36"></a>                <span class="s2">"weight_dict"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"eta"</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
</span><span id="__span-46-37"><a id="__codelineno-46-37" name="__codelineno-46-37"></a>            <span class="p">},</span>
</span><span id="__span-46-38"><a id="__codelineno-46-38" name="__codelineno-46-38"></a>            <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="__span-46-39"><a id="__codelineno-46-39" name="__codelineno-46-39"></a>            <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-46-40"><a id="__codelineno-46-40" name="__codelineno-46-40"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-46-41"><a id="__codelineno-46-41" name="__codelineno-46-41"></a>                <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-46-42"><a id="__codelineno-46-42" name="__codelineno-46-42"></a>                <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-46-43"><a id="__codelineno-46-43" name="__codelineno-46-43"></a>            <span class="p">},</span>
</span><span id="__span-46-44"><a id="__codelineno-46-44" name="__codelineno-46-44"></a>        <span class="p">},</span>
</span><span id="__span-46-45"><a id="__codelineno-46-45" name="__codelineno-46-45"></a>        <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-46-46"><a id="__codelineno-46-46" name="__codelineno-46-46"></a>        <span class="p">{</span><span class="s2">"eta"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"eta"</span><span class="p">],</span> <span class="o">**</span><span class="n">equation</span><span class="p">[</span><span class="s2">"VIV"</span><span class="p">]</span><span class="o">.</span><span class="n">equations</span><span class="p">},</span>
</span><span id="__span-46-47"><a id="__codelineno-46-47" name="__codelineno-46-47"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">"Sup"</span><span class="p">,</span>
</span><span id="__span-46-48"><a id="__codelineno-46-48" name="__codelineno-46-48"></a>    <span class="p">)</span>
</span><span id="__span-46-49"><a id="__codelineno-46-49" name="__codelineno-46-49"></a>    <span class="c1"># wrap constraints together</span>
</span><span id="__span-46-50"><a id="__codelineno-46-50" name="__codelineno-46-50"></a>    <span class="n">constraint</span> <span class="o">=</span> <span class="p">{</span><span class="n">sup_constraint</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">sup_constraint</span><span class="p">}</span>
</span><span id="__span-46-51"><a id="__codelineno-46-51" name="__codelineno-46-51"></a>
</span><span id="__span-46-52"><a id="__codelineno-46-52" name="__codelineno-46-52"></a>    <span class="c1"># set optimizer</span>
</span><span id="__span-46-53"><a id="__codelineno-46-53" name="__codelineno-46-53"></a>    <span class="n">lr_scheduler</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">Step</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="p">)()</span>
</span><span id="__span-46-54"><a id="__codelineno-46-54" name="__codelineno-46-54"></a>    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">lr_scheduler</span><span class="p">)((</span><span class="n">model</span><span class="p">,)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">equation</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span id="__span-46-55"><a id="__codelineno-46-55" name="__codelineno-46-55"></a>
</span><span id="__span-46-56"><a id="__codelineno-46-56" name="__codelineno-46-56"></a>    <span class="c1"># set validator</span>
</span><span id="__span-46-57"><a id="__codelineno-46-57" name="__codelineno-46-57"></a>    <span class="n">eta_l2_validator</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">SupervisedValidator</span><span class="p">(</span>
</span><span id="__span-46-58"><a id="__codelineno-46-58" name="__codelineno-46-58"></a>        <span class="p">{</span>
</span><span id="__span-46-59"><a id="__codelineno-46-59" name="__codelineno-46-59"></a>            <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-46-60"><a id="__codelineno-46-60" name="__codelineno-46-60"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"MatDataset"</span><span class="p">,</span>
</span><span id="__span-46-61"><a id="__codelineno-46-61" name="__codelineno-46-61"></a>                <span class="s2">"file_path"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">VIV_DATA_PATH</span><span class="p">,</span>
</span><span id="__span-46-62"><a id="__codelineno-46-62" name="__codelineno-46-62"></a>                <span class="s2">"input_keys"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"t_f"</span><span class="p">,),</span>
</span><span id="__span-46-63"><a id="__codelineno-46-63" name="__codelineno-46-63"></a>                <span class="s2">"label_keys"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"eta"</span><span class="p">,</span> <span class="s2">"f"</span><span class="p">),</span>
</span><span id="__span-46-64"><a id="__codelineno-46-64" name="__codelineno-46-64"></a>            <span class="p">},</span>
</span><span id="__span-46-65"><a id="__codelineno-46-65" name="__codelineno-46-65"></a>            <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">EVAL</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="__span-46-66"><a id="__codelineno-46-66" name="__codelineno-46-66"></a>        <span class="p">},</span>
</span><span id="__span-46-67"><a id="__codelineno-46-67" name="__codelineno-46-67"></a>        <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-46-68"><a id="__codelineno-46-68" name="__codelineno-46-68"></a>        <span class="p">{</span><span class="s2">"eta"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"eta"</span><span class="p">],</span> <span class="o">**</span><span class="n">equation</span><span class="p">[</span><span class="s2">"VIV"</span><span class="p">]</span><span class="o">.</span><span class="n">equations</span><span class="p">},</span>
</span><span id="__span-46-69"><a id="__codelineno-46-69" name="__codelineno-46-69"></a>        <span class="n">metric</span><span class="o">=</span><span class="p">{</span><span class="s2">"MSE"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">L2Rel</span><span class="p">()},</span>
</span><span id="__span-46-70"><a id="__codelineno-46-70" name="__codelineno-46-70"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">"eta_l2"</span><span class="p">,</span>
</span><span id="__span-46-71"><a id="__codelineno-46-71" name="__codelineno-46-71"></a>    <span class="p">)</span>
</span><span id="__span-46-72"><a id="__codelineno-46-72" name="__codelineno-46-72"></a>    <span class="n">validator</span> <span class="o">=</span> <span class="p">{</span><span class="n">eta_l2_validator</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">eta_l2_validator</span><span class="p">}</span>
</span><span id="__span-46-73"><a id="__codelineno-46-73" name="__codelineno-46-73"></a>
</span><span id="__span-46-74"><a id="__codelineno-46-74" name="__codelineno-46-74"></a>    <span class="c1"># set visualizer(optional)</span>
</span><span id="__span-46-75"><a id="__codelineno-46-75" name="__codelineno-46-75"></a>    <span class="n">visu_mat</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">load_mat_file</span><span class="p">(</span>
</span><span id="__span-46-76"><a id="__codelineno-46-76" name="__codelineno-46-76"></a>        <span class="n">cfg</span><span class="o">.</span><span class="n">VIV_DATA_PATH</span><span class="p">,</span>
</span><span id="__span-46-77"><a id="__codelineno-46-77" name="__codelineno-46-77"></a>        <span class="p">(</span><span class="s2">"t_f"</span><span class="p">,</span> <span class="s2">"eta_gt"</span><span class="p">,</span> <span class="s2">"f_gt"</span><span class="p">),</span>
</span><span id="__span-46-78"><a id="__codelineno-46-78" name="__codelineno-46-78"></a>        <span class="n">alias_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">"eta_gt"</span><span class="p">:</span> <span class="s2">"eta"</span><span class="p">,</span> <span class="s2">"f_gt"</span><span class="p">:</span> <span class="s2">"f"</span><span class="p">},</span>
</span><span id="__span-46-79"><a id="__codelineno-46-79" name="__codelineno-46-79"></a>    <span class="p">)</span>
</span><span id="__span-46-80"><a id="__codelineno-46-80" name="__codelineno-46-80"></a>    <span class="n">visualizer</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-46-81"><a id="__codelineno-46-81" name="__codelineno-46-81"></a>        <span class="s2">"visualize_u"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">visualize</span><span class="o">.</span><span class="n">VisualizerScatter1D</span><span class="p">(</span>
</span><span id="__span-46-82"><a id="__codelineno-46-82" name="__codelineno-46-82"></a>            <span class="n">visu_mat</span><span class="p">,</span>
</span><span id="__span-46-83"><a id="__codelineno-46-83" name="__codelineno-46-83"></a>            <span class="p">(</span><span class="s2">"t_f"</span><span class="p">,),</span>
</span><span id="__span-46-84"><a id="__codelineno-46-84" name="__codelineno-46-84"></a>            <span class="p">{</span>
</span><span id="__span-46-85"><a id="__codelineno-46-85" name="__codelineno-46-85"></a>                <span class="sa">r</span><span class="s2">"$\eta$"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">"eta"</span><span class="p">],</span>  <span class="c1"># plot with latex title</span>
</span><span id="__span-46-86"><a id="__codelineno-46-86" name="__codelineno-46-86"></a>                <span class="sa">r</span><span class="s2">"$\eta_</span><span class="si">{gt}</span><span class="s2">$"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">"eta_gt"</span><span class="p">],</span>  <span class="c1"># plot with latex title</span>
</span><span id="__span-46-87"><a id="__codelineno-46-87" name="__codelineno-46-87"></a>                <span class="sa">r</span><span class="s2">"$f$"</span><span class="p">:</span> <span class="n">equation</span><span class="p">[</span><span class="s2">"VIV"</span><span class="p">]</span><span class="o">.</span><span class="n">equations</span><span class="p">[</span><span class="s2">"f"</span><span class="p">],</span>  <span class="c1"># plot with latex title</span>
</span><span id="__span-46-88"><a id="__codelineno-46-88" name="__codelineno-46-88"></a>                <span class="sa">r</span><span class="s2">"$f_</span><span class="si">{gt}</span><span class="s2">$"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">"f_gt"</span><span class="p">],</span>  <span class="c1"># plot with latex title</span>
</span><span id="__span-46-89"><a id="__codelineno-46-89" name="__codelineno-46-89"></a>            <span class="p">},</span>
</span><span id="__span-46-90"><a id="__codelineno-46-90" name="__codelineno-46-90"></a>            <span class="n">num_timestamps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-46-91"><a id="__codelineno-46-91" name="__codelineno-46-91"></a>            <span class="n">prefix</span><span class="o">=</span><span class="s2">"viv_pred"</span><span class="p">,</span>
</span><span id="__span-46-92"><a id="__codelineno-46-92" name="__codelineno-46-92"></a>        <span class="p">)</span>
</span><span id="__span-46-93"><a id="__codelineno-46-93" name="__codelineno-46-93"></a>    <span class="p">}</span>
</span><span id="__span-46-94"><a id="__codelineno-46-94" name="__codelineno-46-94"></a>
</span><span id="__span-46-95"><a id="__codelineno-46-95" name="__codelineno-46-95"></a>    <span class="c1"># initialize solver</span>
</span><span id="__span-46-96"><a id="__codelineno-46-96" name="__codelineno-46-96"></a>    <span class="n">solver</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">Solver</span><span class="p">(</span>
</span><span id="__span-46-97"><a id="__codelineno-46-97" name="__codelineno-46-97"></a>        <span class="n">model</span><span class="p">,</span>
</span><span id="__span-46-98"><a id="__codelineno-46-98" name="__codelineno-46-98"></a>        <span class="n">constraint</span><span class="p">,</span>
</span><span id="__span-46-99"><a id="__codelineno-46-99" name="__codelineno-46-99"></a>        <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
</span><span id="__span-46-100"><a id="__codelineno-46-100" name="__codelineno-46-100"></a>        <span class="n">equation</span><span class="o">=</span><span class="n">equation</span><span class="p">,</span>
</span><span id="__span-46-101"><a id="__codelineno-46-101" name="__codelineno-46-101"></a>        <span class="n">validator</span><span class="o">=</span><span class="n">validator</span><span class="p">,</span>
</span><span id="__span-46-102"><a id="__codelineno-46-102" name="__codelineno-46-102"></a>        <span class="n">visualizer</span><span class="o">=</span><span class="n">visualizer</span><span class="p">,</span>
</span><span id="__span-46-103"><a id="__codelineno-46-103" name="__codelineno-46-103"></a>        <span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="__span-46-104"><a id="__codelineno-46-104" name="__codelineno-46-104"></a>    <span class="p">)</span>
</span><span id="__span-46-105"><a id="__codelineno-46-105" name="__codelineno-46-105"></a>
</span><span id="__span-46-106"><a id="__codelineno-46-106" name="__codelineno-46-106"></a>    <span class="c1"># train model</span>
</span><span id="__span-46-107"><a id="__codelineno-46-107" name="__codelineno-46-107"></a>    <span class="n">solver</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span><span id="__span-46-108"><a id="__codelineno-46-108" name="__codelineno-46-108"></a>    <span class="c1"># evaluate after finished training</span>
</span><span id="__span-46-109"><a id="__codelineno-46-109" name="__codelineno-46-109"></a>    <span class="n">solver</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span><span id="__span-46-110"><a id="__codelineno-46-110" name="__codelineno-46-110"></a>    <span class="c1"># visualize prediction after finished training</span>
</span><span id="__span-46-111"><a id="__codelineno-46-111" name="__codelineno-46-111"></a>    <span class="n">solver</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span>
</span><span id="__span-46-112"><a id="__codelineno-46-112" name="__codelineno-46-112"></a>
</span><span id="__span-46-113"><a id="__codelineno-46-113" name="__codelineno-46-113"></a>
</span><span id="__span-46-114"><a id="__codelineno-46-114" name="__codelineno-46-114"></a><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
</span><span id="__span-46-115"><a id="__codelineno-46-115" name="__codelineno-46-115"></a>    <span class="c1"># set model</span>
</span><span id="__span-46-116"><a id="__codelineno-46-116" name="__codelineno-46-116"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">MLP</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="o">.</span><span class="n">MODEL</span><span class="p">)</span>
</span><span id="__span-46-117"><a id="__codelineno-46-117" name="__codelineno-46-117"></a>
</span><span id="__span-46-118"><a id="__codelineno-46-118" name="__codelineno-46-118"></a>    <span class="c1"># set equation</span>
</span><span id="__span-46-119"><a id="__codelineno-46-119" name="__codelineno-46-119"></a>    <span class="n">equation</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"VIV"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">equation</span><span class="o">.</span><span class="n">Vibration</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)}</span>
</span><span id="__span-46-120"><a id="__codelineno-46-120" name="__codelineno-46-120"></a>
</span><span id="__span-46-121"><a id="__codelineno-46-121" name="__codelineno-46-121"></a>    <span class="c1"># set validator</span>
</span><span id="__span-46-122"><a id="__codelineno-46-122" name="__codelineno-46-122"></a>    <span class="n">eta_l2_validator</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">SupervisedValidator</span><span class="p">(</span>
</span><span id="__span-46-123"><a id="__codelineno-46-123" name="__codelineno-46-123"></a>        <span class="p">{</span>
</span><span id="__span-46-124"><a id="__codelineno-46-124" name="__codelineno-46-124"></a>            <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-46-125"><a id="__codelineno-46-125" name="__codelineno-46-125"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"MatDataset"</span><span class="p">,</span>
</span><span id="__span-46-126"><a id="__codelineno-46-126" name="__codelineno-46-126"></a>                <span class="s2">"file_path"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">VIV_DATA_PATH</span><span class="p">,</span>
</span><span id="__span-46-127"><a id="__codelineno-46-127" name="__codelineno-46-127"></a>                <span class="s2">"input_keys"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"t_f"</span><span class="p">,),</span>
</span><span id="__span-46-128"><a id="__codelineno-46-128" name="__codelineno-46-128"></a>                <span class="s2">"label_keys"</span><span class="p">:</span> <span class="p">(</span><span class="s2">"eta"</span><span class="p">,</span> <span class="s2">"f"</span><span class="p">),</span>
</span><span id="__span-46-129"><a id="__codelineno-46-129" name="__codelineno-46-129"></a>            <span class="p">},</span>
</span><span id="__span-46-130"><a id="__codelineno-46-130" name="__codelineno-46-130"></a>            <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">EVAL</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="__span-46-131"><a id="__codelineno-46-131" name="__codelineno-46-131"></a>        <span class="p">},</span>
</span><span id="__span-46-132"><a id="__codelineno-46-132" name="__codelineno-46-132"></a>        <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-46-133"><a id="__codelineno-46-133" name="__codelineno-46-133"></a>        <span class="p">{</span><span class="s2">"eta"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"eta"</span><span class="p">],</span> <span class="o">**</span><span class="n">equation</span><span class="p">[</span><span class="s2">"VIV"</span><span class="p">]</span><span class="o">.</span><span class="n">equations</span><span class="p">},</span>
</span><span id="__span-46-134"><a id="__codelineno-46-134" name="__codelineno-46-134"></a>        <span class="n">metric</span><span class="o">=</span><span class="p">{</span><span class="s2">"MSE"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">L2Rel</span><span class="p">()},</span>
</span><span id="__span-46-135"><a id="__codelineno-46-135" name="__codelineno-46-135"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">"eta_l2"</span><span class="p">,</span>
</span><span id="__span-46-136"><a id="__codelineno-46-136" name="__codelineno-46-136"></a>    <span class="p">)</span>
</span><span id="__span-46-137"><a id="__codelineno-46-137" name="__codelineno-46-137"></a>    <span class="n">validator</span> <span class="o">=</span> <span class="p">{</span><span class="n">eta_l2_validator</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">eta_l2_validator</span><span class="p">}</span>
</span><span id="__span-46-138"><a id="__codelineno-46-138" name="__codelineno-46-138"></a>
</span><span id="__span-46-139"><a id="__codelineno-46-139" name="__codelineno-46-139"></a>    <span class="c1"># set visualizer(optional)</span>
</span><span id="__span-46-140"><a id="__codelineno-46-140" name="__codelineno-46-140"></a>    <span class="n">visu_mat</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">load_mat_file</span><span class="p">(</span>
</span><span id="__span-46-141"><a id="__codelineno-46-141" name="__codelineno-46-141"></a>        <span class="n">cfg</span><span class="o">.</span><span class="n">VIV_DATA_PATH</span><span class="p">,</span>
</span><span id="__span-46-142"><a id="__codelineno-46-142" name="__codelineno-46-142"></a>        <span class="p">(</span><span class="s2">"t_f"</span><span class="p">,</span> <span class="s2">"eta_gt"</span><span class="p">,</span> <span class="s2">"f_gt"</span><span class="p">),</span>
</span><span id="__span-46-143"><a id="__codelineno-46-143" name="__codelineno-46-143"></a>        <span class="n">alias_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">"eta_gt"</span><span class="p">:</span> <span class="s2">"eta"</span><span class="p">,</span> <span class="s2">"f_gt"</span><span class="p">:</span> <span class="s2">"f"</span><span class="p">},</span>
</span><span id="__span-46-144"><a id="__codelineno-46-144" name="__codelineno-46-144"></a>    <span class="p">)</span>
</span><span id="__span-46-145"><a id="__codelineno-46-145" name="__codelineno-46-145"></a>
</span><span id="__span-46-146"><a id="__codelineno-46-146" name="__codelineno-46-146"></a>    <span class="n">visualizer</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-46-147"><a id="__codelineno-46-147" name="__codelineno-46-147"></a>        <span class="s2">"visualize_u"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">visualize</span><span class="o">.</span><span class="n">VisualizerScatter1D</span><span class="p">(</span>
</span><span id="__span-46-148"><a id="__codelineno-46-148" name="__codelineno-46-148"></a>            <span class="n">visu_mat</span><span class="p">,</span>
</span><span id="__span-46-149"><a id="__codelineno-46-149" name="__codelineno-46-149"></a>            <span class="p">(</span><span class="s2">"t_f"</span><span class="p">,),</span>
</span><span id="__span-46-150"><a id="__codelineno-46-150" name="__codelineno-46-150"></a>            <span class="p">{</span>
</span><span id="__span-46-151"><a id="__codelineno-46-151" name="__codelineno-46-151"></a>                <span class="sa">r</span><span class="s2">"$\eta$"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">"eta"</span><span class="p">],</span>  <span class="c1"># plot with latex title</span>
</span><span id="__span-46-152"><a id="__codelineno-46-152" name="__codelineno-46-152"></a>                <span class="sa">r</span><span class="s2">"$\eta_</span><span class="si">{gt}</span><span class="s2">$"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">"eta_gt"</span><span class="p">],</span>  <span class="c1"># plot with latex title</span>
</span><span id="__span-46-153"><a id="__codelineno-46-153" name="__codelineno-46-153"></a>                <span class="sa">r</span><span class="s2">"$f$"</span><span class="p">:</span> <span class="n">equation</span><span class="p">[</span><span class="s2">"VIV"</span><span class="p">]</span><span class="o">.</span><span class="n">equations</span><span class="p">[</span><span class="s2">"f"</span><span class="p">],</span>  <span class="c1"># plot with latex title</span>
</span><span id="__span-46-154"><a id="__codelineno-46-154" name="__codelineno-46-154"></a>                <span class="sa">r</span><span class="s2">"$f_</span><span class="si">{gt}</span><span class="s2">$"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">"f_gt"</span><span class="p">],</span>  <span class="c1"># plot with latex title</span>
</span><span id="__span-46-155"><a id="__codelineno-46-155" name="__codelineno-46-155"></a>            <span class="p">},</span>
</span><span id="__span-46-156"><a id="__codelineno-46-156" name="__codelineno-46-156"></a>            <span class="n">num_timestamps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-46-157"><a id="__codelineno-46-157" name="__codelineno-46-157"></a>            <span class="n">prefix</span><span class="o">=</span><span class="s2">"viv_pred"</span><span class="p">,</span>
</span><span id="__span-46-158"><a id="__codelineno-46-158" name="__codelineno-46-158"></a>        <span class="p">)</span>
</span><span id="__span-46-159"><a id="__codelineno-46-159" name="__codelineno-46-159"></a>    <span class="p">}</span>
</span><span id="__span-46-160"><a id="__codelineno-46-160" name="__codelineno-46-160"></a>
</span><span id="__span-46-161"><a id="__codelineno-46-161" name="__codelineno-46-161"></a>    <span class="c1"># initialize solver</span>
</span><span id="__span-46-162"><a id="__codelineno-46-162" name="__codelineno-46-162"></a>    <span class="n">solver</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">Solver</span><span class="p">(</span>
</span><span id="__span-46-163"><a id="__codelineno-46-163" name="__codelineno-46-163"></a>        <span class="n">model</span><span class="p">,</span>
</span><span id="__span-46-164"><a id="__codelineno-46-164" name="__codelineno-46-164"></a>        <span class="n">equation</span><span class="o">=</span><span class="n">equation</span><span class="p">,</span>
</span><span id="__span-46-165"><a id="__codelineno-46-165" name="__codelineno-46-165"></a>        <span class="n">validator</span><span class="o">=</span><span class="n">validator</span><span class="p">,</span>
</span><span id="__span-46-166"><a id="__codelineno-46-166" name="__codelineno-46-166"></a>        <span class="n">visualizer</span><span class="o">=</span><span class="n">visualizer</span><span class="p">,</span>
</span><span id="__span-46-167"><a id="__codelineno-46-167" name="__codelineno-46-167"></a>        <span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="__span-46-168"><a id="__codelineno-46-168" name="__codelineno-46-168"></a>    <span class="p">)</span>
</span><span id="__span-46-169"><a id="__codelineno-46-169" name="__codelineno-46-169"></a>
</span><span id="__span-46-170"><a id="__codelineno-46-170" name="__codelineno-46-170"></a>    <span class="c1"># evaluate</span>
</span><span id="__span-46-171"><a id="__codelineno-46-171" name="__codelineno-46-171"></a>    <span class="n">solver</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span><span id="__span-46-172"><a id="__codelineno-46-172" name="__codelineno-46-172"></a>    <span class="c1"># visualize prediction</span>
</span><span id="__span-46-173"><a id="__codelineno-46-173" name="__codelineno-46-173"></a>    <span class="n">solver</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span>
</span><span id="__span-46-174"><a id="__codelineno-46-174" name="__codelineno-46-174"></a>
</span><span id="__span-46-175"><a id="__codelineno-46-175" name="__codelineno-46-175"></a>
</span><span id="__span-46-176"><a id="__codelineno-46-176" name="__codelineno-46-176"></a><span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
</span><span id="__span-46-177"><a id="__codelineno-46-177" name="__codelineno-46-177"></a>    <span class="kn">from</span> <span class="nn">paddle</span> <span class="kn">import</span> <span class="n">nn</span>
</span><span id="__span-46-178"><a id="__codelineno-46-178" name="__codelineno-46-178"></a>    <span class="kn">from</span> <span class="nn">paddle.static</span> <span class="kn">import</span> <span class="n">InputSpec</span>
</span><span id="__span-46-179"><a id="__codelineno-46-179" name="__codelineno-46-179"></a>
</span><span id="__span-46-180"><a id="__codelineno-46-180" name="__codelineno-46-180"></a>    <span class="c1"># set model</span>
</span><span id="__span-46-181"><a id="__codelineno-46-181" name="__codelineno-46-181"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">MLP</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="o">.</span><span class="n">MODEL</span><span class="p">)</span>
</span><span id="__span-46-182"><a id="__codelineno-46-182" name="__codelineno-46-182"></a>    <span class="c1"># initialize equation</span>
</span><span id="__span-46-183"><a id="__codelineno-46-183" name="__codelineno-46-183"></a>    <span class="n">equation</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"VIV"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">equation</span><span class="o">.</span><span class="n">Vibration</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">)}</span>
</span><span id="__span-46-184"><a id="__codelineno-46-184" name="__codelineno-46-184"></a>    <span class="c1"># initialize solver</span>
</span><span id="__span-46-185"><a id="__codelineno-46-185" name="__codelineno-46-185"></a>    <span class="n">solver</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">Solver</span><span class="p">(</span>
</span><span id="__span-46-186"><a id="__codelineno-46-186" name="__codelineno-46-186"></a>        <span class="n">model</span><span class="p">,</span>
</span><span id="__span-46-187"><a id="__codelineno-46-187" name="__codelineno-46-187"></a>        <span class="n">equation</span><span class="o">=</span><span class="n">equation</span><span class="p">,</span>
</span><span id="__span-46-188"><a id="__codelineno-46-188" name="__codelineno-46-188"></a>        <span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">,</span>
</span><span id="__span-46-189"><a id="__codelineno-46-189" name="__codelineno-46-189"></a>    <span class="p">)</span>
</span><span id="__span-46-190"><a id="__codelineno-46-190" name="__codelineno-46-190"></a>    <span class="c1"># Convert equation to func</span>
</span><span id="__span-46-191"><a id="__codelineno-46-191" name="__codelineno-46-191"></a>    <span class="n">f_func</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span>
</span><span id="__span-46-192"><a id="__codelineno-46-192" name="__codelineno-46-192"></a>        <span class="n">solver</span><span class="o">.</span><span class="n">equation</span><span class="p">[</span><span class="s2">"VIV"</span><span class="p">]</span><span class="o">.</span><span class="n">equations</span><span class="p">[</span><span class="s2">"f"</span><span class="p">],</span>
</span><span id="__span-46-193"><a id="__codelineno-46-193" name="__codelineno-46-193"></a>        <span class="n">solver</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="__span-46-194"><a id="__codelineno-46-194" name="__codelineno-46-194"></a>        <span class="nb">list</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">equation</span><span class="p">[</span><span class="s2">"VIV"</span><span class="p">]</span><span class="o">.</span><span class="n">learnable_parameters</span><span class="p">),</span>
</span><span id="__span-46-195"><a id="__codelineno-46-195" name="__codelineno-46-195"></a>    <span class="p">)</span>
</span><span id="__span-46-196"><a id="__codelineno-46-196" name="__codelineno-46-196"></a>
</span><span id="__span-46-197"><a id="__codelineno-46-197" name="__codelineno-46-197"></a>    <span class="k">class</span> <span class="nc">Wrapped_Model</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Layer</span><span class="p">):</span>
</span><span id="__span-46-198"><a id="__codelineno-46-198" name="__codelineno-46-198"></a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
</span><span id="__span-46-199"><a id="__codelineno-46-199" name="__codelineno-46-199"></a>            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-46-200"><a id="__codelineno-46-200" name="__codelineno-46-200"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
</span><span id="__span-46-201"><a id="__codelineno-46-201" name="__codelineno-46-201"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="__span-46-202"><a id="__codelineno-46-202" name="__codelineno-46-202"></a>
</span><span id="__span-46-203"><a id="__codelineno-46-203" name="__codelineno-46-203"></a>        <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-46-204"><a id="__codelineno-46-204" name="__codelineno-46-204"></a>            <span class="n">model_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-46-205"><a id="__codelineno-46-205" name="__codelineno-46-205"></a>            <span class="n">func_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="__span-46-206"><a id="__codelineno-46-206" name="__codelineno-46-206"></a>            <span class="k">return</span> <span class="p">{</span><span class="o">**</span><span class="n">model_out</span><span class="p">,</span> <span class="s2">"f"</span><span class="p">:</span> <span class="n">func_out</span><span class="p">}</span>
</span><span id="__span-46-207"><a id="__codelineno-46-207" name="__codelineno-46-207"></a>
</span><span id="__span-46-208"><a id="__codelineno-46-208" name="__codelineno-46-208"></a>    <span class="n">solver</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">Wrapped_Model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">f_func</span><span class="p">)</span>
</span><span id="__span-46-209"><a id="__codelineno-46-209" name="__codelineno-46-209"></a>    <span class="c1"># export models</span>
</span><span id="__span-46-210"><a id="__codelineno-46-210" name="__codelineno-46-210"></a>    <span class="n">input_spec</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-46-211"><a id="__codelineno-46-211" name="__codelineno-46-211"></a>        <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">InputSpec</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">"float32"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">input_keys</span><span class="p">},</span>
</span><span id="__span-46-212"><a id="__codelineno-46-212" name="__codelineno-46-212"></a>    <span class="p">]</span>
</span><span id="__span-46-213"><a id="__codelineno-46-213" name="__codelineno-46-213"></a>    <span class="n">solver</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">input_spec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">INFER</span><span class="o">.</span><span class="n">export_path</span><span class="p">,</span> <span class="n">skip_prune_program</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-46-214"><a id="__codelineno-46-214" name="__codelineno-46-214"></a>
</span><span id="__span-46-215"><a id="__codelineno-46-215" name="__codelineno-46-215"></a>
</span><span id="__span-46-216"><a id="__codelineno-46-216" name="__codelineno-46-216"></a><span class="k">def</span> <span class="nf">inference</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
</span><span id="__span-46-217"><a id="__codelineno-46-217" name="__codelineno-46-217"></a>    <span class="kn">from</span> <span class="nn">deploy.python_infer</span> <span class="kn">import</span> <span class="n">pinn_predictor</span>
</span><span id="__span-46-218"><a id="__codelineno-46-218" name="__codelineno-46-218"></a>
</span><span id="__span-46-219"><a id="__codelineno-46-219" name="__codelineno-46-219"></a>    <span class="c1"># set model predictor</span>
</span><span id="__span-46-220"><a id="__codelineno-46-220" name="__codelineno-46-220"></a>    <span class="n">predictor</span> <span class="o">=</span> <span class="n">pinn_predictor</span><span class="o">.</span><span class="n">PINNPredictor</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-46-221"><a id="__codelineno-46-221" name="__codelineno-46-221"></a>
</span><span id="__span-46-222"><a id="__codelineno-46-222" name="__codelineno-46-222"></a>    <span class="n">infer_mat</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">load_mat_file</span><span class="p">(</span>
</span><span id="__span-46-223"><a id="__codelineno-46-223" name="__codelineno-46-223"></a>        <span class="n">cfg</span><span class="o">.</span><span class="n">VIV_DATA_PATH</span><span class="p">,</span>
</span><span id="__span-46-224"><a id="__codelineno-46-224" name="__codelineno-46-224"></a>        <span class="p">(</span><span class="s2">"t_f"</span><span class="p">,</span> <span class="s2">"eta_gt"</span><span class="p">,</span> <span class="s2">"f_gt"</span><span class="p">),</span>
</span><span id="__span-46-225"><a id="__codelineno-46-225" name="__codelineno-46-225"></a>        <span class="n">alias_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">"eta_gt"</span><span class="p">:</span> <span class="s2">"eta"</span><span class="p">,</span> <span class="s2">"f_gt"</span><span class="p">:</span> <span class="s2">"f"</span><span class="p">},</span>
</span><span id="__span-46-226"><a id="__codelineno-46-226" name="__codelineno-46-226"></a>    <span class="p">)</span>
</span><span id="__span-46-227"><a id="__codelineno-46-227" name="__codelineno-46-227"></a>
</span><span id="__span-46-228"><a id="__codelineno-46-228" name="__codelineno-46-228"></a>    <span class="n">input_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">infer_mat</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">INFER</span><span class="o">.</span><span class="n">input_keys</span><span class="p">}</span>
</span><span id="__span-46-229"><a id="__codelineno-46-229" name="__codelineno-46-229"></a>
</span><span id="__span-46-230"><a id="__codelineno-46-230" name="__codelineno-46-230"></a>    <span class="n">output_dict</span> <span class="o">=</span> <span class="n">predictor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_dict</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">INFER</span><span class="o">.</span><span class="n">batch_size</span><span class="p">)</span>
</span><span id="__span-46-231"><a id="__codelineno-46-231" name="__codelineno-46-231"></a>
</span><span id="__span-46-232"><a id="__codelineno-46-232" name="__codelineno-46-232"></a>    <span class="c1"># mapping data to cfg.INFER.output_keys</span>
</span><span id="__span-46-233"><a id="__codelineno-46-233" name="__codelineno-46-233"></a>    <span class="n">output_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-46-234"><a id="__codelineno-46-234" name="__codelineno-46-234"></a>        <span class="n">store_key</span><span class="p">:</span> <span class="n">output_dict</span><span class="p">[</span><span class="n">infer_key</span><span class="p">]</span>
</span><span id="__span-46-235"><a id="__codelineno-46-235" name="__codelineno-46-235"></a>        <span class="k">for</span> <span class="n">store_key</span><span class="p">,</span> <span class="n">infer_key</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">INFER</span><span class="o">.</span><span class="n">output_keys</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="__span-46-236"><a id="__codelineno-46-236" name="__codelineno-46-236"></a>    <span class="p">}</span>
</span><span id="__span-46-237"><a id="__codelineno-46-237" name="__codelineno-46-237"></a>    <span class="n">infer_mat</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">output_dict</span><span class="p">)</span>
</span><span id="__span-46-238"><a id="__codelineno-46-238" name="__codelineno-46-238"></a>
</span><span id="__span-46-239"><a id="__codelineno-46-239" name="__codelineno-46-239"></a>    <span class="n">ppsci</span><span class="o">.</span><span class="n">visualize</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">save_plot_from_1d_dict</span><span class="p">(</span>
</span><span id="__span-46-240"><a id="__codelineno-46-240" name="__codelineno-46-240"></a>        <span class="s2">"./viv_pred"</span><span class="p">,</span> <span class="n">infer_mat</span><span class="p">,</span> <span class="p">(</span><span class="s2">"t_f"</span><span class="p">,),</span> <span class="p">(</span><span class="s2">"eta"</span><span class="p">,</span> <span class="s2">"eta_gt"</span><span class="p">,</span> <span class="s2">"f"</span><span class="p">,</span> <span class="s2">"f_gt"</span><span class="p">)</span>
</span><span id="__span-46-241"><a id="__codelineno-46-241" name="__codelineno-46-241"></a>    <span class="p">)</span>
</span><span id="__span-46-242"><a id="__codelineno-46-242" name="__codelineno-46-242"></a>
</span><span id="__span-46-243"><a id="__codelineno-46-243" name="__codelineno-46-243"></a>
</span><span id="__span-46-244"><a id="__codelineno-46-244" name="__codelineno-46-244"></a><span class="nd">@hydra</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">version_base</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_path</span><span class="o">=</span><span class="s2">"./conf"</span><span class="p">,</span> <span class="n">config_name</span><span class="o">=</span><span class="s2">"viv.yaml"</span><span class="p">)</span>
</span><span id="__span-46-245"><a id="__codelineno-46-245" name="__codelineno-46-245"></a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
</span><span id="__span-46-246"><a id="__codelineno-46-246" name="__codelineno-46-246"></a>    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">"train"</span><span class="p">:</span>
</span><span id="__span-46-247"><a id="__codelineno-46-247" name="__codelineno-46-247"></a>        <span class="n">train</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-46-248"><a id="__codelineno-46-248" name="__codelineno-46-248"></a>    <span class="k">elif</span> <span class="n">cfg</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">"eval"</span><span class="p">:</span>
</span><span id="__span-46-249"><a id="__codelineno-46-249" name="__codelineno-46-249"></a>        <span class="n">evaluate</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-46-250"><a id="__codelineno-46-250" name="__codelineno-46-250"></a>    <span class="k">elif</span> <span class="n">cfg</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">"export"</span><span class="p">:</span>
</span><span id="__span-46-251"><a id="__codelineno-46-251" name="__codelineno-46-251"></a>        <span class="n">export</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-46-252"><a id="__codelineno-46-252" name="__codelineno-46-252"></a>    <span class="k">elif</span> <span class="n">cfg</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">"infer"</span><span class="p">:</span>
</span><span id="__span-46-253"><a id="__codelineno-46-253" name="__codelineno-46-253"></a>        <span class="n">inference</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-46-254"><a id="__codelineno-46-254" name="__codelineno-46-254"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-46-255"><a id="__codelineno-46-255" name="__codelineno-46-255"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="__span-46-256"><a id="__codelineno-46-256" name="__codelineno-46-256"></a>            <span class="sa">f</span><span class="s2">"cfg.mode should in ['train', 'eval', 'export', 'infer'], but got '</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">mode</span><span class="si">}</span><span class="s2">'"</span>
</span><span id="__span-46-257"><a id="__codelineno-46-257" name="__codelineno-46-257"></a>        <span class="p">)</span>
</span><span id="__span-46-258"><a id="__codelineno-46-258" name="__codelineno-46-258"></a>
</span><span id="__span-46-259"><a id="__codelineno-46-259" name="__codelineno-46-259"></a>
</span><span id="__span-46-260"><a id="__codelineno-46-260" name="__codelineno-46-260"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-46-261"><a id="__codelineno-46-261" name="__codelineno-46-261"></a>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-yaml highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-47-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-47-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-47-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-47-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-47-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-47-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-47-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-47-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-47-10">10</a></span>
<span class="normal"><a href="#__codelineno-47-11">11</a></span>
<span class="normal"><a href="#__codelineno-47-12">12</a></span>
<span class="normal"><a href="#__codelineno-47-13">13</a></span>
<span class="normal"><a href="#__codelineno-47-14">14</a></span>
<span class="normal"><a href="#__codelineno-47-15">15</a></span>
<span class="normal"><a href="#__codelineno-47-16">16</a></span>
<span class="normal"><a href="#__codelineno-47-17">17</a></span>
<span class="normal"><a href="#__codelineno-47-18">18</a></span>
<span class="normal"><a href="#__codelineno-47-19">19</a></span>
<span class="normal"><a href="#__codelineno-47-20">20</a></span>
<span class="normal"><a href="#__codelineno-47-21">21</a></span>
<span class="normal"><a href="#__codelineno-47-22">22</a></span>
<span class="normal"><a href="#__codelineno-47-23">23</a></span>
<span class="normal"><a href="#__codelineno-47-24">24</a></span>
<span class="normal"><a href="#__codelineno-47-25">25</a></span>
<span class="normal"><a href="#__codelineno-47-26">26</a></span>
<span class="normal"><a href="#__codelineno-47-27">27</a></span>
<span class="normal"><a href="#__codelineno-47-28">28</a></span>
<span class="normal"><a href="#__codelineno-47-29">29</a></span>
<span class="normal"><a href="#__codelineno-47-30">30</a></span>
<span class="normal"><a href="#__codelineno-47-31">31</a></span>
<span class="normal"><a href="#__codelineno-47-32">32</a></span>
<span class="normal"><a href="#__codelineno-47-33">33</a></span>
<span class="normal"><a href="#__codelineno-47-34">34</a></span>
<span class="normal"><a href="#__codelineno-47-35">35</a></span>
<span class="normal"><a href="#__codelineno-47-36">36</a></span>
<span class="normal"><a href="#__codelineno-47-37">37</a></span>
<span class="normal"><a href="#__codelineno-47-38">38</a></span>
<span class="normal"><a href="#__codelineno-47-39">39</a></span>
<span class="normal"><a href="#__codelineno-47-40">40</a></span>
<span class="normal"><a href="#__codelineno-47-41">41</a></span>
<span class="normal"><a href="#__codelineno-47-42">42</a></span>
<span class="normal"><a href="#__codelineno-47-43">43</a></span>
<span class="normal"><a href="#__codelineno-47-44">44</a></span>
<span class="normal"><a href="#__codelineno-47-45">45</a></span>
<span class="normal"><a href="#__codelineno-47-46">46</a></span>
<span class="normal"><a href="#__codelineno-47-47">47</a></span>
<span class="normal"><a href="#__codelineno-47-48">48</a></span>
<span class="normal"><a href="#__codelineno-47-49">49</a></span>
<span class="normal"><a href="#__codelineno-47-50">50</a></span>
<span class="normal"><a href="#__codelineno-47-51">51</a></span>
<span class="normal"><a href="#__codelineno-47-52">52</a></span>
<span class="normal"><a href="#__codelineno-47-53">53</a></span>
<span class="normal"><a href="#__codelineno-47-54">54</a></span>
<span class="normal"><a href="#__codelineno-47-55">55</a></span>
<span class="normal"><a href="#__codelineno-47-56">56</a></span>
<span class="normal"><a href="#__codelineno-47-57">57</a></span>
<span class="normal"><a href="#__codelineno-47-58">58</a></span>
<span class="normal"><a href="#__codelineno-47-59">59</a></span>
<span class="normal"><a href="#__codelineno-47-60">60</a></span>
<span class="normal"><a href="#__codelineno-47-61">61</a></span>
<span class="normal"><a href="#__codelineno-47-62">62</a></span>
<span class="normal"><a href="#__codelineno-47-63">63</a></span>
<span class="normal"><a href="#__codelineno-47-64">64</a></span>
<span class="normal"><a href="#__codelineno-47-65">65</a></span>
<span class="normal"><a href="#__codelineno-47-66">66</a></span>
<span class="normal"><a href="#__codelineno-47-67">67</a></span>
<span class="normal"><a href="#__codelineno-47-68">68</a></span>
<span class="normal"><a href="#__codelineno-47-69">69</a></span>
<span class="normal"><a href="#__codelineno-47-70">70</a></span>
<span class="normal"><a href="#__codelineno-47-71">71</a></span>
<span class="normal"><a href="#__codelineno-47-72">72</a></span>
<span class="normal"><a href="#__codelineno-47-73">73</a></span>
<span class="normal"><a href="#__codelineno-47-74">74</a></span>
<span class="normal"><a href="#__codelineno-47-75">75</a></span>
<span class="normal"><a href="#__codelineno-47-76">76</a></span>
<span class="normal"><a href="#__codelineno-47-77">77</a></span>
<span class="normal"><a href="#__codelineno-47-78">78</a></span>
<span class="normal"><a href="#__codelineno-47-79">79</a></span>
<span class="normal"><a href="#__codelineno-47-80">80</a></span>
<span class="normal"><a href="#__codelineno-47-81">81</a></span>
<span class="normal"><a href="#__codelineno-47-82">82</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="nt">defaults</span><span class="p">:</span><span class="w"> </span><span class="c1"># (1)</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ppsci_default</span><span class="w"> </span><span class="c1"># (2)</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">TRAIN</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">train_default</span><span class="w"> </span><span class="c1"># (3)</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">TRAIN/ema</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ema_default</span><span class="w"> </span><span class="c1"># (4)</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">TRAIN/swa</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">swa_default</span><span class="w"> </span><span class="c1"># (5)</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">EVAL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eval_default</span><span class="w"> </span><span class="c1"># (6)</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">INFER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infer_default</span><span class="w"> </span><span class="c1"># (7)</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">_self_</span><span class="w"> </span><span class="c1"># (8)</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9"></a>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10"></a><span class="nt">hydra</span><span class="p">:</span>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11"></a><span class="w">  </span><span class="nt">run</span><span class="p">:</span>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12"></a><span class="w">    </span><span class="c1"># dynamic output directory according to running time and override name</span>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13"></a><span class="w">    </span><span class="nt">dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">outputs_VIV/${now:%Y-%m-%d}/${now:%H-%M-%S}/${hydra.job.override_dirname}</span><span class="w"> </span><span class="c1"># (9)</span>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14"></a><span class="w">  </span><span class="nt">job</span><span class="p">:</span>
</span><span id="__span-47-15"><a id="__codelineno-47-15" name="__codelineno-47-15"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${mode}</span><span class="w"> </span><span class="c1"># name of logfile</span>
</span><span id="__span-47-16"><a id="__codelineno-47-16" name="__codelineno-47-16"></a><span class="w">    </span><span class="nt">chdir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"> </span><span class="c1"># keep current working directory unchanged</span>
</span><span id="__span-47-17"><a id="__codelineno-47-17" name="__codelineno-47-17"></a><span class="w">  </span><span class="nt">callbacks</span><span class="p">:</span>
</span><span id="__span-47-18"><a id="__codelineno-47-18" name="__codelineno-47-18"></a><span class="w">    </span><span class="nt">init_callback</span><span class="p">:</span><span class="w"> </span><span class="c1"># (10)</span>
</span><span id="__span-47-19"><a id="__codelineno-47-19" name="__codelineno-47-19"></a><span class="w">      </span><span class="nt">_target_</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ppsci.utils.callbacks.InitCallback</span><span class="w"> </span><span class="c1"># (11)</span>
</span><span id="__span-47-20"><a id="__codelineno-47-20" name="__codelineno-47-20"></a><span class="w">  </span><span class="nt">sweep</span><span class="p">:</span>
</span><span id="__span-47-21"><a id="__codelineno-47-21" name="__codelineno-47-21"></a><span class="w">    </span><span class="c1"># output directory for multirun</span>
</span><span id="__span-47-22"><a id="__codelineno-47-22" name="__codelineno-47-22"></a><span class="w">    </span><span class="nt">dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${hydra.run.dir}</span>
</span><span id="__span-47-23"><a id="__codelineno-47-23" name="__codelineno-47-23"></a><span class="w">    </span><span class="nt">subdir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./</span>
</span><span id="__span-47-24"><a id="__codelineno-47-24" name="__codelineno-47-24"></a>
</span><span id="__span-47-25"><a id="__codelineno-47-25" name="__codelineno-47-25"></a><span class="c1"># general settings</span>
</span><span id="__span-47-26"><a id="__codelineno-47-26" name="__codelineno-47-26"></a><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">train</span><span class="w"> </span><span class="c1"># running mode: train/eval # (12)</span>
</span><span id="__span-47-27"><a id="__codelineno-47-27" name="__codelineno-47-27"></a><span class="nt">seed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">42</span><span class="w"> </span><span class="c1"># (13)</span>
</span><span id="__span-47-28"><a id="__codelineno-47-28" name="__codelineno-47-28"></a><span class="nt">output_dir</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${hydra:run.dir}</span><span class="w"> </span><span class="c1"># (14)</span>
</span><span id="__span-47-29"><a id="__codelineno-47-29" name="__codelineno-47-29"></a><span class="nt">log_freq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span><span class="w"> </span><span class="c1"># (15)</span>
</span><span id="__span-47-30"><a id="__codelineno-47-30" name="__codelineno-47-30"></a><span class="nt">use_tbd</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"> </span><span class="c1"># (16)</span>
</span><span id="__span-47-31"><a id="__codelineno-47-31" name="__codelineno-47-31"></a>
</span><span id="__span-47-32"><a id="__codelineno-47-32" name="__codelineno-47-32"></a><span class="nt">VIV_DATA_PATH</span><span class="p">:</span><span class="w"> </span><span class="s">"./VIV_Training_Neta100.mat"</span><span class="w"> </span><span class="c1"># (17)</span>
</span><span id="__span-47-33"><a id="__codelineno-47-33" name="__codelineno-47-33"></a>
</span><span id="__span-47-34"><a id="__codelineno-47-34" name="__codelineno-47-34"></a><span class="c1"># model settings</span>
</span><span id="__span-47-35"><a id="__codelineno-47-35" name="__codelineno-47-35"></a><span class="nt">MODEL</span><span class="p">:</span><span class="w"> </span><span class="c1"># (18)</span>
</span><span id="__span-47-36"><a id="__codelineno-47-36" name="__codelineno-47-36"></a><span class="w">  </span><span class="nt">input_keys</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"t_f"</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="c1"># (19)</span>
</span><span id="__span-47-37"><a id="__codelineno-47-37" name="__codelineno-47-37"></a><span class="w">  </span><span class="nt">output_keys</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"eta"</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="c1"># (20)</span>
</span><span id="__span-47-38"><a id="__codelineno-47-38" name="__codelineno-47-38"></a><span class="w">  </span><span class="nt">num_layers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class="w"> </span><span class="c1"># (21)</span>
</span><span id="__span-47-39"><a id="__codelineno-47-39" name="__codelineno-47-39"></a><span class="w">  </span><span class="nt">hidden_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span><span class="w"> </span><span class="c1"># (22)</span>
</span><span id="__span-47-40"><a id="__codelineno-47-40" name="__codelineno-47-40"></a><span class="w">  </span><span class="nt">activation</span><span class="p">:</span><span class="w"> </span><span class="s">"tanh"</span><span class="w"> </span><span class="c1"># (23)</span>
</span><span id="__span-47-41"><a id="__codelineno-47-41" name="__codelineno-47-41"></a>
</span><span id="__span-47-42"><a id="__codelineno-47-42" name="__codelineno-47-42"></a><span class="c1"># training settings</span>
</span><span id="__span-47-43"><a id="__codelineno-47-43" name="__codelineno-47-43"></a><span class="nt">TRAIN</span><span class="p">:</span><span class="w"> </span><span class="c1"># (24)</span>
</span><span id="__span-47-44"><a id="__codelineno-47-44" name="__codelineno-47-44"></a><span class="w">  </span><span class="nt">epochs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100000</span><span class="w"> </span><span class="c1"># (25)</span>
</span><span id="__span-47-45"><a id="__codelineno-47-45" name="__codelineno-47-45"></a><span class="w">  </span><span class="nt">iters_per_epoch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># (26)</span>
</span><span id="__span-47-46"><a id="__codelineno-47-46" name="__codelineno-47-46"></a><span class="w">  </span><span class="nt">save_freq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span><span class="w"> </span><span class="c1"># (27)</span>
</span><span id="__span-47-47"><a id="__codelineno-47-47" name="__codelineno-47-47"></a><span class="w">  </span><span class="nt">eval_during_train</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># (28)</span>
</span><span id="__span-47-48"><a id="__codelineno-47-48" name="__codelineno-47-48"></a><span class="w">  </span><span class="nt">eval_freq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span><span class="w"> </span><span class="c1"># (29)</span>
</span><span id="__span-47-49"><a id="__codelineno-47-49" name="__codelineno-47-49"></a><span class="w">  </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span><span class="w"> </span><span class="c1"># (30)</span>
</span><span id="__span-47-50"><a id="__codelineno-47-50" name="__codelineno-47-50"></a><span class="w">  </span><span class="nt">lr_scheduler</span><span class="p">:</span><span class="w"> </span><span class="c1"># (31)</span>
</span><span id="__span-47-51"><a id="__codelineno-47-51" name="__codelineno-47-51"></a><span class="w">    </span><span class="nt">epochs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${TRAIN.epochs}</span><span class="w"> </span><span class="c1"># (32)</span>
</span><span id="__span-47-52"><a id="__codelineno-47-52" name="__codelineno-47-52"></a><span class="w">    </span><span class="nt">iters_per_epoch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${TRAIN.iters_per_epoch}</span><span class="w"> </span><span class="c1"># (33)</span>
</span><span id="__span-47-53"><a id="__codelineno-47-53" name="__codelineno-47-53"></a><span class="w">    </span><span class="nt">learning_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.001</span><span class="w"> </span><span class="c1"># (34)</span>
</span><span id="__span-47-54"><a id="__codelineno-47-54" name="__codelineno-47-54"></a><span class="w">    </span><span class="nt">step_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20000</span><span class="w"> </span><span class="c1"># (35)</span>
</span><span id="__span-47-55"><a id="__codelineno-47-55" name="__codelineno-47-55"></a><span class="w">    </span><span class="nt">gamma</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.9</span><span class="w"> </span><span class="c1"># (36)</span>
</span><span id="__span-47-56"><a id="__codelineno-47-56" name="__codelineno-47-56"></a><span class="w">  </span><span class="nt">pretrained_model_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"> </span><span class="c1"># (37)</span>
</span><span id="__span-47-57"><a id="__codelineno-47-57" name="__codelineno-47-57"></a><span class="w">  </span><span class="nt">checkpoint_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"> </span><span class="c1"># (38)</span>
</span><span id="__span-47-58"><a id="__codelineno-47-58" name="__codelineno-47-58"></a>
</span><span id="__span-47-59"><a id="__codelineno-47-59" name="__codelineno-47-59"></a><span class="c1"># evaluation settings</span>
</span><span id="__span-47-60"><a id="__codelineno-47-60" name="__codelineno-47-60"></a><span class="nt">EVAL</span><span class="p">:</span><span class="w"> </span><span class="c1"># (39)</span>
</span><span id="__span-47-61"><a id="__codelineno-47-61" name="__codelineno-47-61"></a><span class="w">  </span><span class="nt">pretrained_model_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class="w"> </span><span class="c1"># (40)</span>
</span><span id="__span-47-62"><a id="__codelineno-47-62" name="__codelineno-47-62"></a><span class="w">  </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span><span class="w"> </span><span class="c1"># (41)</span>
</span><span id="__span-47-63"><a id="__codelineno-47-63" name="__codelineno-47-63"></a>
</span><span id="__span-47-64"><a id="__codelineno-47-64" name="__codelineno-47-64"></a><span class="c1"># inference settings</span>
</span><span id="__span-47-65"><a id="__codelineno-47-65" name="__codelineno-47-65"></a><span class="nt">INFER</span><span class="p">:</span><span class="w"> </span><span class="c1"># (42)</span>
</span><span id="__span-47-66"><a id="__codelineno-47-66" name="__codelineno-47-66"></a><span class="w">  </span><span class="nt">pretrained_model_path</span><span class="p">:</span><span class="w"> </span><span class="s">"https://paddle-org.bj.bcebos.com/paddlescience/models/viv/viv_pretrained.pdparams"</span><span class="w"> </span><span class="c1"># (43)</span>
</span><span id="__span-47-67"><a id="__codelineno-47-67" name="__codelineno-47-67"></a><span class="w">  </span><span class="nt">export_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./inference/viv</span><span class="w"> </span><span class="c1"># (44)</span>
</span><span id="__span-47-68"><a id="__codelineno-47-68" name="__codelineno-47-68"></a><span class="w">  </span><span class="nt">pdmodel_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${INFER.export_path}.pdmodel</span><span class="w"> </span><span class="c1"># (45)</span>
</span><span id="__span-47-69"><a id="__codelineno-47-69" name="__codelineno-47-69"></a><span class="w">  </span><span class="nt">pdiparams_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${INFER.export_path}.pdiparams</span><span class="w"> </span><span class="c1"># (46)</span>
</span><span id="__span-47-70"><a id="__codelineno-47-70" name="__codelineno-47-70"></a><span class="w">  </span><span class="nt">input_keys</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MODEL.input_keys}</span><span class="w"> </span><span class="c1"># (47)</span>
</span><span id="__span-47-71"><a id="__codelineno-47-71" name="__codelineno-47-71"></a><span class="w">  </span><span class="nt">output_keys</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"eta"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"f"</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="c1"># (48)</span>
</span><span id="__span-47-72"><a id="__codelineno-47-72" name="__codelineno-47-72"></a><span class="w">  </span><span class="nt">device</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpu</span><span class="w"> </span><span class="c1"># (49)</span>
</span><span id="__span-47-73"><a id="__codelineno-47-73" name="__codelineno-47-73"></a><span class="w">  </span><span class="nt">engine</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">native</span><span class="w"> </span><span class="c1"># (50)</span>
</span><span id="__span-47-74"><a id="__codelineno-47-74" name="__codelineno-47-74"></a><span class="w">  </span><span class="nt">precision</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fp32</span><span class="w"> </span><span class="c1"># (51)</span>
</span><span id="__span-47-75"><a id="__codelineno-47-75" name="__codelineno-47-75"></a><span class="w">  </span><span class="nt">onnx_path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${INFER.export_path}.onnx</span><span class="w"> </span><span class="c1"># (52)</span>
</span><span id="__span-47-76"><a id="__codelineno-47-76" name="__codelineno-47-76"></a><span class="w">  </span><span class="nt">ir_optim</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># (53)</span>
</span><span id="__span-47-77"><a id="__codelineno-47-77" name="__codelineno-47-77"></a><span class="w">  </span><span class="nt">min_subgraph_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span><span class="w"> </span><span class="c1"># (54)</span>
</span><span id="__span-47-78"><a id="__codelineno-47-78" name="__codelineno-47-78"></a><span class="w">  </span><span class="nt">gpu_mem</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4000</span><span class="w"> </span><span class="c1"># (55)</span>
</span><span id="__span-47-79"><a id="__codelineno-47-79" name="__codelineno-47-79"></a><span class="w">  </span><span class="nt">gpu_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span><span class="w"> </span><span class="c1"># (56)</span>
</span><span id="__span-47-80"><a id="__codelineno-47-80" name="__codelineno-47-80"></a><span class="w">  </span><span class="nt">max_batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">64</span><span class="w"> </span><span class="c1"># (57)</span>
</span><span id="__span-47-81"><a id="__codelineno-47-81" name="__codelineno-47-81"></a><span class="w">  </span><span class="nt">num_cpu_threads</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"> </span><span class="c1"># (58)</span>
</span><span id="__span-47-82"><a id="__codelineno-47-82" name="__codelineno-47-82"></a><span class="w">  </span><span class="nt">batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span><span class="w"> </span><span class="c1"># (59)</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li><code>defaults:</code> - 定义一系列默认配置项的开头。</li>
<li><code>- ppsci_default</code> - 使用名为<code>ppsci_default</code>的默认配置。</li>
<li><code>- TRAIN: train_default</code> - 在<code>TRAIN</code>命名空间下应用<code>train_default</code>默认配置。</li>
<li><code>- TRAIN/ema: ema_default</code> - 在<code>TRAIN</code>的<code>ema</code>子命名空间下应用<code>ema_default</code>配置。</li>
<li><code>- TRAIN/swa: swa_default</code> - 在<code>TRAIN</code>的<code>swa</code>子命名空间下应用<code>swa_default</code>配置。</li>
<li><code>- EVAL: eval_default</code> - 在<code>EVAL</code>命名空间下应用<code>eval_default</code>默认配置。</li>
<li><code>- INFER: infer_default</code> - 在<code>INFER</code>命名空间下应用<code>infer_default</code>默认配置。</li>
<li><code>- _self_</code> - 表示当前文件本身的配置将被包含，用于覆盖或添加默认设置。</li>
<li><code>dir: outputs_VIV/...</code> - 设置动态输出目录，基于当前时间以及覆盖名称。</li>
<li><code>init_callback:</code> - 定义初始化回调的设置。</li>
<li><code>_target_: ppsci.utils.callbacks.InitCallback</code> - 指定初始化回调的具体实现类或函数。</li>
<li><code>mode: train</code> - 设置当前运行模式为训练模式。</li>
<li><code>seed: 42</code> - 设置全局随机种子为42，以确保实验可重复性。</li>
<li><code>output_dir: ${hydra:run.dir}</code> - 设置输出目录，与Hydra配置的运行目录相同。</li>
<li><code>log_freq: 20</code> - 设置日志记录频率，每20次进行记录。</li>
<li><code>use_tbd: false</code> - 关闭 tensorboard 功能。</li>
<li><code>VIV_DATA_PATH: "./VIV_Training_Neta100.mat"</code> - 指定VIV的数据文件路径（可以其它数据集或超参值）。</li>
<li><code>MODEL:</code> - 开始定义模型相关设置。</li>
<li><code>input_keys: ["t_f"]</code> - 设置模型的输入键为<code>t_f</code>。</li>
<li><code>output_keys: ["eta"]</code> - 设置模型的输出键为<code>eta</code>。</li>
<li><code>num_layers: 5</code> - 设置模型层数为5。</li>
<li><code>hidden_size: 50</code> - 设置模型隐藏层的大小为50。</li>
<li><code>activation: "tanh"</code> - 使用双曲正切函数作为激活函数。</li>
<li><code>TRAIN:</code> - 开始定义训练相关设置。</li>
<li><code>epochs: 100000</code> - 设置训练的总轮数为100000轮。</li>
<li><code>iters_per_epoch: 1</code> - 每个轮次包含1次迭代。</li>
<li><code>save_freq: 10000</code> - 每10000次迭代保存一次模型或检查点。</li>
<li><code>eval_during_train: true</code> - 在训练过程中启用评估。</li>
<li><code>eval_freq: 1000</code> - 每1000次迭代进行一次评估。</li>
<li><code>batch_size: 100</code> - 设置训练批次大小为100。</li>
<li><code>lr_scheduler:</code> - 开始定义学习率调度器的设置。</li>
<li><code>epochs: ${TRAIN.epochs}</code> - 学习率调度器使用的轮数与训练的轮数相同。</li>
<li><code>iters_per_epoch: ${TRAIN.iters_per_epoch}</code> - 学习率调度器使用的每个轮次的迭代数与训练的相同。</li>
<li><code>learning_rate: 0.001</code> - 设置初始学习率为0.001。</li>
<li><code>step_size: 20000</code> - 每20000步调整学习率。</li>
<li><code>gamma: 0.9</code> - 学习率调整的比率为0.9。</li>
<li><code>pretrained_model_path: null</code> - 初始预训练模型路径，可以是实际路径或 url，默认为空表示不使用预训练模型。</li>
<li><code>checkpoint_path: null</code> - 检查点路径，用于指定模型加载的检查点，默认为空表示不加载检查点。</li>
<li><code>EVAL:</code> - 开始定义评估相关设置。</li>
<li><code>pretrained_model_path: null</code> - 评估时使用的预训练模型路径，默认为空表示不使用预训练模型。</li>
<li><code>batch_size: 32</code> - 评估时的批次</li>
<li><code>INFER:</code> - 开始定义推理（推断）相关的设置。</li>
<li><code>pretrained_model_path: "https://..."</code> - 指定预训练模型的路径，可以是实际路径或 url，用于推理。</li>
<li><code>export_path: ./inference/viv</code> - 设置模型导出路径，即推理所需的模型文件保存位置。</li>
<li><code>pdmodel_path: ${INFER.export_path}.pdmodel</code> - 指定Paddle模型的结构文件路径。</li>
<li><code>pdiparams_path: ${INFER.export_path}.pdiparams</code> - 指定Paddle模型的参数文件路径。</li>
<li><code>input_keys: ${MODEL.input_keys}</code> - 推理时使用的输入键与模型定义时相同。</li>
<li><code>output_keys: ["eta", "f"]</code> - 设置推理时的输出键，包括"eta"和"f"。</li>
<li><code>device: gpu</code> - 指定推理使用的设备为GPU。</li>
<li><code>engine: native</code> - 设置推理引擎为原生（可能是指使用特定库或框架的默认引擎）。</li>
<li><code>precision: fp32</code> - 设置推理的精度为32位浮点数。</li>
<li><code>onnx_path: ${INFER.export_path}.onnx</code> - 如果支持，指定ONNX模型文件的路径。</li>
<li><code>ir_optim: true</code> - 启用中间表示（Intermediate Representation）的优化。</li>
<li><code>min_subgraph_size: 10</code> - 设置子图优化的最小大小，用于提升推理性能。</li>
<li><code>gpu_mem: 4000</code> - 指定推理时GPU可使用的内存量（单位可能是MB）。</li>
<li><code>gpu_id: 0</code> - 指定使用哪个GPU进行推理，这里是第一个GPU。</li>
<li><code>max_batch_size: 64</code> - 设置推理时支持的最大批次大小。</li>
<li><code>num_cpu_threads: 4</code> - 指定用于推理的CPU线程数量。</li>
<li><code>batch_size: 16</code> - 设置推理时的实际批次大小为16。</li>
</ol>
</div>
</div>
</div>
</details>
<h3 id="213">2.13 训练<a class="headerlink" href="#213" title="Permanent link">¶</a></h3>
<p>PaddleScience 模型的训练只需调用一行代码。</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="n">solver</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span></code></pre></div>
<h3 id="214">2.14 评估<a class="headerlink" href="#214" title="Permanent link">¶</a></h3>
<p>PaddleScience 模型的评估只需调用一行代码。</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="n">solver</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span></code></pre></div>
<h3 id="215">2.15 可视化[可选]<a class="headerlink" href="#215" title="Permanent link">¶</a></h3>
<p>若 <code>Solver</code> 实例化时传入了 <code>visualizer</code> 参数，则 PaddleScience 模型的可视化只需调用一行代码。</p>
<div class="language-py highlight"><span class="filename">examples/demo/demo.py</span><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="n">solver</span><span class="o">.</span><span class="n">visualize</span><span class="p">()</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">可视化方案</p>
<p>对于一些复杂的案例，<code>Visualizer</code> 的编写成本并不低，并且不是任何数据类型都可以进行方便的可视化。因此可以在训练完成之后，手动构建用于预测的数据字典，再使用 <code>solver.predict</code> 得到模型预测结果，最后利用 <code>matplotlib</code> 等第三方库，对预测结果进行可视化并保存。</p>
</div>
<h2 id="3">3. 编写文档<a class="headerlink" href="#3" title="Permanent link">¶</a></h2>
<p>除了案例代码，PaddleScience 同时存放了对应案例的详细文档，使用 Markdown + <a href="https://www.mkdocs.org/">Mkdocs</a> + <a href="https://squidfunk.github.io/mkdocs-material/">Mkdocs-Material</a> 进行编写和渲染，撰写文档步骤如下。</p>
<h3 id="31">3.1 安装必要依赖包<a class="headerlink" href="#31" title="Permanent link">¶</a></h3>
<p>文档撰写过程中需进行即时渲染，预览文档内容以检查撰写的内容是否有误。因此需要按照如下命令，安装 mkdocs 相关依赖包。</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>docs/requirements.txt<span class="w"> </span>-i<span class="w"> </span>https://pypi.tuna.tsinghua.edu.cn/simple
</span></code></pre></div>
<h3 id="32">3.2 撰写文档内容<a class="headerlink" href="#32" title="Permanent link">¶</a></h3>
<p>PaddleScience 文档基于 <a href="https://squidfunk.github.io/mkdocs-material/">Mkdocs-Material</a>、<a href="https://facelessuser.github.io/pymdown-extensions/extensions/arithmatex/">PyMdown</a> 等插件进行编写，其在 Markdown 语法基础上支持了多种扩展性功能，能极大地提升文档的美观程度和阅读体验。建议参考超链接内的文档内容，选择合适的功能辅助文档撰写。</p>
<h3 id="33-markdownlint">3.3 使用 markdownlint 格式化文档[可选]<a class="headerlink" href="#33-markdownlint" title="Permanent link">¶</a></h3>
<p>如果您使用的开发环境为 VSCode，则推荐安装 <a href="https://marketplace.visualstudio.com/items?itemName=DavidAnson.vscode-markdownlint">markdownlint</a> 扩展。安装完毕后在编写完的文档内：点击右键--&gt;格式化文档即可。</p>
<h3 id="34">3.4 预览文档<a class="headerlink" href="#34" title="Permanent link">¶</a></h3>
<p>在 <code>PaddleScience/</code> 目录下执行以下命令，等待构建完成后，点击显示的链接进入本地网页预览文档内容。</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>mkdocs<span class="w"> </span>serve
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a># ====== 终端打印信息如下 ======
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a># INFO     -  Building documentation...
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a># INFO     -  Cleaning site directory
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a># INFO     -  Documentation built in 20.95 seconds
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a># INFO     -  [07:39:35] Watching paths for changes: 'docs', 'mkdocs.yml'
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a># INFO     -  [07:39:35] Serving on http://127.0.0.1:8000/PaddlePaddle/PaddleScience/
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a># INFO     -  [07:39:41] Browser connected: http://127.0.0.1:58903/PaddlePaddle/PaddleScience/
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a># INFO     -  [07:40:41] Browser connected: http://127.0.0.1:58903/PaddlePaddle/PaddleScience/zh/development/
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">手动指定服务地址和端口号</p>
<p>若默认端口号 8000 被占用，则可以手动指定服务部署的地址和端口，示例如下。</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="c1"># 指定 127.0.0.1 为地址，8687 为端口号</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>mkdocs<span class="w"> </span>serve<span class="w"> </span>-a<span class="w"> </span><span class="m">127</span>.0.0.1:8687
</span></code></pre></div>
</div>
<h2 id="4">4. 整理代码并提交<a class="headerlink" href="#4" title="Permanent link">¶</a></h2>
<h3 id="41-pre-commit">4.1 安装 pre-commit<a class="headerlink" href="#41-pre-commit" title="Permanent link">¶</a></h3>
<p>PaddleScience 是一个开源的代码库，由多人共同参与开发，因此为了保持最终合入的代码风格整洁、一致，
PaddleScience 使用了包括 <a href="https://github.com/PyCQA/isort#installing-isort">isort</a>、<a href="https://github.com/psf/black">black</a> 等自动化代码检查、格式化插件，
让 commit 的代码遵循 python <a href="https://pep8.org/">PEP8</a> 代码风格规范。</p>
<p>因此在 commit 您的代码之前，请务必先执行以下命令安装 <code>pre-commit</code>，否则提交的 PR 会被 code-style 检测到代码未格式化而无法合入。</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>pip<span class="w"> </span>install<span class="w"> </span>pre-commit
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>pre-commit<span class="w"> </span>install
</span></code></pre></div>
<p>关于 pre-commit 的详情请参考 <a href="https://www.paddlepaddle.org.cn/documentation/docs/zh/develop/dev_guides/git_guides/codestyle_check_guide_cn.html">Paddle 代码风格检查指南</a></p>
<h3 id="42">4.2 整理代码<a class="headerlink" href="#42" title="Permanent link">¶</a></h3>
<p>在完成范例编写与训练后，确认结果无误，就可以整理代码。
使用 git 命令将所有新增、修改的代码文件以及必要的文档、图片等一并上传到自己仓库的 <code>dev_model</code> 分支上。</p>
<h3 id="43-pull-request">4.3 提交 pull request<a class="headerlink" href="#43-pull-request" title="Permanent link">¶</a></h3>
<p>在 github 网页端切换到 <code>dev_model</code> 分支，并点击 "Contribute"，再点击 "Open pull request" 按钮，
将含有您的代码、文档、图片等内容的 <code>dev_model</code> 分支作为合入请求贡献到 PaddleScience。</p></div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">May 20, 2024</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="创建日期">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">April 23, 2023</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 - 2023 PaddlePaddle
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "navigation.sections", "navigation.top", "search.suggest", "navigation.instant", "content.code.copy", "content.code.select", "content.code.annotate", "search.highlight", "content.tabs.link", "content.action.edit", "content.action.view"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": {"alias": true, "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8d2eff1.min.js"></script>
      
        <script src="../../javascripts/bd_statistics.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="../../javascripts/contributors.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>