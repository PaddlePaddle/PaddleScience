
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="An out-of-the-box open source library for scientific computing based on deep learning.">
      
      
        <meta name="author" content="PaddlePaddle">
      
      
        <link rel="canonical" href="https://github.com/PaddlePaddle/PaddleScience/zh/examples/heat_exchanger/">
      
      
        <link rel="prev" href="../topopt/">
      
      
        <link rel="next" href="../heat_pinn/">
      
      
      <link rel="icon" href="../../../images/icons/favcion.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.27">
    
    
      
        <title>Heat_Exchanger - PaddleScience Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      

  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M256 512a256 256 0 1 0 0-512 256 256 0 1 0 0 512zm-86.2-346.7c7.9-22.3 29.1-37.3 52.8-37.3h58.3c34.9 0 63.1 28.3 63.1 63.1 0 22.6-12.1 43.5-31.7 54.8L280 264.4c-.2 13-10.9 23.6-24 23.6-13.3 0-24-10.7-24-24v-13.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1 0-8.4-6.8-15.1-15.1-15.1h-58.3c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM224 352a32 32 0 1 1 64 0 32 32 0 1 1-64 0z"/></svg>');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Serif SC";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#heat_exchanger" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="PaddleScience Docs" class="md-header__button md-logo" aria-label="PaddleScience Docs" data-md-component="logo">
      
  <img src="../../../images/icons/paddle.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PaddleScience Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Heat_Exchanger
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="选择当前语言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/zh/" hreflang="zh" class="md-select__link">
              简体中文
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/en/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/PaddlePaddle/PaddleScience" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    PaddleScience
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../.." class="md-tabs__link">
          
  
  PaddleScience

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../allen_cahn/" class="md-tabs__link">
          
  
  经典案例

        </a>
      </li>
    
  

    
  

    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api/arch/" class="md-tabs__link">
          
  
  API 文档

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../user_guide/" class="md-tabs__link">
        
  
    
  
  使用指南

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../development/" class="md-tabs__link">
          
  
  开发与复现指南

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../technical_doc/" class="md-tabs__link">
        
  
    
  
  技术稿件

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../cooperation/" class="md-tabs__link">
        
  
    
  
  共创计划

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="https://aistudio.baidu.com/aistudio/projectoverview/public?topic=15" class="md-tabs__link">
        
  
    
  
  实训社区

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="PaddleScience Docs" class="md-nav__button md-logo" aria-label="PaddleScience Docs" data-md-component="logo">
      
  <img src="../../../images/icons/paddle.png" alt="logo">

    </a>
    PaddleScience Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/PaddlePaddle/PaddleScience" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    PaddleScience
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    PaddleScience
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            PaddleScience
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    主页
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    功能介绍
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install_setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    安装使用
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    快速开始
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    学习资料
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    经典案例
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            经典案例
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
     
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
             
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1_1" id="__nav_2_1_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    数学(AI for Math)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_1">
            <span class="md-nav__icon md-icon"></span>
            数学(AI for Math)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../allen_cahn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AllenCahn
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deephpms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DeepHPMs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deeponet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DeepONet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../euler_beam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Euler_Beam
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../laplace2d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Laplace2D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lorenz/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lorenz_transform_physx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pirbn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PIRBN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rossler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rossler_transform_physx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../volterra_ide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Volterra_IDE
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nlsmb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NLSMB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../xpinns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    XPINN
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1_2" id="__nav_2_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    技术科学(AI for Technology)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1_2">
            <span class="md-nav__icon md-icon"></span>
            技术科学(AI for Technology)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1_2_1" id="__nav_2_1_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    流体
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2_1">
            <span class="md-nav__icon md-icon"></span>
            流体
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../amgnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AMGNet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../aneurysm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aneurysm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bubble/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BubbleNet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cfdgcn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CFDGCN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cylinder2d_unsteady/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cylinder2D_unsteady
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cylinder2d_unsteady_transformer_physx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cylinder2D_unsteady_transform_physx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../darcy2d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Darcy2D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deepcfd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DeepCFD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ldc2d_steady/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LDC2D_steady
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ldc2d_unsteady/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LDC2D_unsteady
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../labelfree_DNN_surrogate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Labelfree_DNN_surrogate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nsfnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NSFNets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../phycrnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PhyCRNet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shock_wave/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ShockWave
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tempoGAN/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tempoGAN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nsfnet4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NSFNet4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../viv/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ViV
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_1_2_2" id="__nav_2_1_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    结构
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2_2">
            <span class="md-nav__icon md-icon"></span>
            结构
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../biharmonic2d/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Biharmonic2D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bracket/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bracket
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../control_arm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Control_arm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../epnn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EPNN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../phylstm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Phy-LSTM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../topopt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TopOpt
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2_3" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1_2_3" id="__nav_2_1_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    传热
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_2_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1_2_3">
            <span class="md-nav__icon md-icon"></span>
            传热
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Heat_Exchanger
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Heat_Exchanger
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 背景简介
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. 背景简介">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 换热器
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. 问题定义
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. 问题定义">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 问题描述
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-pi-deeponet" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 PI-DeepONet模型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. 问题求解
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. 问题求解">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 模型构建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 计算域构建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 输入数据构建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 方程构建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35" class="md-nav__link">
    <span class="md-ellipsis">
      3.5 约束构建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36" class="md-nav__link">
    <span class="md-ellipsis">
      3.6 优化器构建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37" class="md-nav__link">
    <span class="md-ellipsis">
      3.7 评估器构建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#38" class="md-nav__link">
    <span class="md-ellipsis">
      3.8 模型训练
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#39" class="md-nav__link">
    <span class="md-ellipsis">
      3.9 结果可视化
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4. 完整代码
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5. 结果展示
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../heat_pinn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Heat_PINN
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../phygeonet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PhyGeoNet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../chip_heat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chip_heat
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_3" >
        
          
          <label class="md-nav__link" for="__nav_2_1_3" id="__nav_2_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    材料科学(AI for Material)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_3">
            <span class="md-nav__icon md-icon"></span>
            材料科学(AI for Material)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hpinns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hPINNs
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_4" >
        
          
          <label class="md-nav__link" for="__nav_2_1_4" id="__nav_2_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    地球科学(AI for Earth Science)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_4">
            <span class="md-nav__icon md-icon"></span>
            地球科学(AI for Earth Science)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fourcastnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FourCastNet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nowcastnet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NowcastNet
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dgmr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DGMR
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../earthformer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EarthFormer
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API 文档
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API 文档
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ppsci
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            ppsci
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/arch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.arch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/autodiff/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.autodiff
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/constraint/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.constraint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_4" >
        
          
          <label class="md-nav__link" for="__nav_3_1_4" id="__nav_3_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ppsci.data
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_4">
            <span class="md-nav__icon md-icon"></span>
            ppsci.data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data/dataset/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.data.dataset
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data/process/transform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.data.transform
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/data/process/batch_transform/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.data.batch_transform
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/equation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.equation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/geometry/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.geometry
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_7" >
        
          
          <label class="md-nav__link" for="__nav_3_1_7" id="__nav_3_1_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ppsci.loss
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_7">
            <span class="md-nav__icon md-icon"></span>
            ppsci.loss
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/loss/loss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.loss.loss
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/loss/mtl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.loss.mtl
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/metric/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.metric
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_9" >
        
          
          <label class="md-nav__link" for="__nav_3_1_9" id="__nav_3_1_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ppsci.optimizer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_9">
            <span class="md-nav__icon md-icon"></span>
            ppsci.optimizer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/optimizer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.optimizer.optimizer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/lr_scheduler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.optimizer.lr_scheduler
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/solver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.solver
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1_11" >
        
          
          <label class="md-nav__link" for="__nav_3_1_11" id="__nav_3_1_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ppsci.utils
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1_11">
            <span class="md-nav__icon md-icon"></span>
            ppsci.utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/utils/checker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.checker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/utils/expression/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.expression
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/utils/initializer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.initializer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/utils/logger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.logger
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/utils/misc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.misc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/utils/ema/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.ema
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/utils/reader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.reader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/utils/writer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.writer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/utils/save_load/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.save_load
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/utils/symbolic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.utils.symbolic
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/validate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.validate
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/visualize/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.visualize
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/experimental/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.experimental
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/probability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ppsci.probability
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    deploy
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            deploy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/depoly/python_infer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    deploy.python_infer
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    使用指南
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    开发与复现指南
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            开发与复现指南
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    开发指南
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reproduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    复现指南
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technical_doc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    技术稿件
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cooperation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    共创计划
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://aistudio.baidu.com/aistudio/projectoverview/public?topic=15" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    实训社区
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 背景简介
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. 背景简介">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11" class="md-nav__link">
    <span class="md-ellipsis">
      1.1 换热器
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. 问题定义
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. 问题定义">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 问题描述
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-pi-deeponet" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 PI-DeepONet模型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. 问题求解
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. 问题求解">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 模型构建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 计算域构建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 输入数据构建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 方程构建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35" class="md-nav__link">
    <span class="md-ellipsis">
      3.5 约束构建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36" class="md-nav__link">
    <span class="md-ellipsis">
      3.6 优化器构建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#37" class="md-nav__link">
    <span class="md-ellipsis">
      3.7 评估器构建
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#38" class="md-nav__link">
    <span class="md-ellipsis">
      3.8 模型训练
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#39" class="md-nav__link">
    <span class="md-ellipsis">
      3.9 结果可视化
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4. 完整代码
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5. 结果展示
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  
<nav class="md-tags" >
  
    
    
    
      <a href="../../tags/#" class="md-tag">方程符号化定义</a>
    
  
    
    
    
      <a href="../../tags/#" class="md-tag">几何形状定义</a>
    
  
    
    
    
      <a href="../../tags/#heatexchanger" class="md-tag">HeatExchanger方程</a>
    
  
</nav>


  
    <a href="https://github.com/PaddlePaddle/PaddleScience/edit/develop/docs/zh/examples/heat_exchanger.md" title="编辑此页" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/PaddlePaddle/PaddleScience/raw/develop/docs/zh/examples/heat_exchanger.md" title="查看本页的源代码" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0 8a5 5 0 0 1-5-5 5 5 0 0 1 5-5 5 5 0 0 1 5 5 5 5 0 0 1-5 5m0-12.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5Z"/></svg>
    </a>
  


<div><h1 id="heat_exchanger">Heat_Exchanger<a class="headerlink" href="#heat_exchanger" title="Permanent link">¶</a></h1>
<p><a href="https://aistudio.baidu.com/projectdetail/8041447" class="md-button md-button--primary" style>AI Studio快速体验</a></p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:4"><input checked id="__tabbed_1_1" name="__tabbed_1" type="radio"><input id="__tabbed_1_2" name="__tabbed_1" type="radio"><input id="__tabbed_1_3" name="__tabbed_1" type="radio"><input id="__tabbed_1_4" name="__tabbed_1" type="radio"><div class="tabbed-labels"><label for="__tabbed_1_1">模型训练命令</label><label for="__tabbed_1_2">模型评估命令</label><label for="__tabbed_1_3">模型导出命令</label><label for="__tabbed_1_4">模型推理命令</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>python<span class="w"> </span>heat_exchanger.py
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>python<span class="w"> </span>heat_exchanger.py<span class="w"> </span><span class="nv">mode</span><span class="o">=</span><span class="nb">eval</span><span class="w"> </span>EVAL.pretrained_model_path<span class="o">=</span>https://paddle-org.bj.bcebos.com/paddlescience/models/HEDeepONet/HEDeepONet_pretrained.pdparams
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>python<span class="w"> </span>heat_exchanger.py<span class="w"> </span><span class="nv">mode</span><span class="o">=</span><span class="nb">export</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>python<span class="w"> </span>heat_exchanger.py<span class="w"> </span><span class="nv">mode</span><span class="o">=</span>infer
</span></code></pre></div>
</div>
</div>
</div>
<table>
<thead>
<tr>
<th style="text-align: left;">预训练模型</th>
<th style="text-align: left;">指标</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><a href="https://paddle-org.bj.bcebos.com/paddlescience/models/HEDeepONet/HEDeepONet_pretrained.pdparams">heat_exchanger_pretrained.pdparams</a></td>
<td style="text-align: left;">The L2 norm error between the actual heat exchanger efficiency and the predicted heat exchanger efficiency: 0.02087<br>MSE.heat_boundary(interior_mse): 0.52005<br>MSE.cold_boundary(interior_mse): 0.16590<br>MSE.wall(interior_mse): 0.01203</td>
</tr>
</tbody>
</table>
<h2 id="1">1. 背景简介<a class="headerlink" href="#1" title="Permanent link">¶</a></h2>
<h3 id="11">1.1 换热器<a class="headerlink" href="#11" title="Permanent link">¶</a></h3>
<p>换热器（亦称为热交换器或热交换设备）是用来使热量从热流体传递到冷流体，以满足规定的工艺要求的装置，是对流传热及热传导的一种工业应用。</p>
<p>在一般空调设备中都有换热器，即空调室内机和室外机的冷热排；换热器作放热用时称为“冷凝器”，作吸热用时称为“蒸发器”，冷媒在此二者的物理反应相反。所以家用空调机作为冷气机时，室内机的换热器称作蒸发器，室外机的则称为冷凝器；换做暖气机的角色时，则相反称之，如图所示为蒸发循环制冷系统。研究换热器热仿真可以为优化设计、提高性能和可靠性、节能减排以及新技术研发提供重要的参考和指导。</p>
<figure>
<p><a class="glightbox" href="https://paddle-org.bj.bcebos.com/paddlescience/docs/HEDeepONet/heat_exchanger.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img align="center" alt="heat_exchanger.png" loading="lazy" src="https://paddle-org.bj.bcebos.com/paddlescience/docs/HEDeepONet/heat_exchanger.png" style="height:80%;width:80%"></a>
  </p>
<figcaption> 蒸发循环制冷系统</figcaption>
</figure>
<p>换热器在工程和科学领域具有多方面的重要性，其作用和价值主要体现在以下几个方面：</p>
<ul>
<li>能源转换效率：换热器在能源转换中扮演着重要角色。通过优化热能的传递和利用，能够提高发电厂、工业生产和其他能源转换过程的效率。它们有助于将燃料中的热能转化为电能或机械能，最大限度地利用能源资源。</li>
<li>工业生产优化：在化工、石油、制药等行业中，换热器用于加热、冷却、蒸馏和蒸发等工艺。通过有效的换热器设计和运用，可以改善生产效率、控制温度和压力，提高产品质量，并且减少能源消耗。</li>
<li>温度控制与调节：换热器可以用于控制温度。在工业生产中，保持适当的温度对于反应速率、产品质量和设备寿命至关重要。换热器能够帮助调节和维持系统的温度在理想的操作范围内。</li>
<li>环境保护与可持续发展：通过提高能源转换效率和工业生产过程中的能源利用率，换热器有助于减少对自然资源的依赖，并降低对环境的负面影响。能源效率的提高也可以减少温室气体排放，有利于环境保护和可持续发展。</li>
<li>工程设计与创新：在工程设计领域，换热器的优化设计和创新推动了工程技术的发展。不断改进的换热器设计能够提高性能、减少空间占用并适应多种复杂工艺需求。</li>
</ul>
<p>综上所述，换热器在工程和科学领域中的重要性体现在其对能源利用效率、工业生产过程优化、温度控制、环境保护和工程技术创新等方面的重要贡献。这些方面的不断改进和创新推动着工程技术的发展，有助于解决能源和环境方面的重要挑战。</p>
<h2 id="2">2. 问题定义<a class="headerlink" href="#2" title="Permanent link">¶</a></h2>
<h3 id="21">2.1 问题描述<a class="headerlink" href="#21" title="Permanent link">¶</a></h3>
<p>假设换热器内部流体流动是一维的，如图所示。</p>
<figure>
<p><a class="glightbox" href="https://paddle-org.bj.bcebos.com/paddlescience/docs/HEDeepONet/1DHE.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img align="center" alt="1DHE.png" loading="lazy" src="https://paddle-org.bj.bcebos.com/paddlescience/docs/HEDeepONet/1DHE.png" style="height:80%;width:80%"></a></p>
</figure>
<p>忽略壁面的传热热阻和轴向热传导；与外界无热量交换，如图所示。则冷热流体和传热壁面三个节点的能量守恒方程分别为：</p>
<div class="arithmatex">\[
\begin{aligned}
&amp; L\left(\frac{q_m c_p}{v}\right)_{\mathrm{c}} \frac{\partial T_{\mathrm{c}}}{\partial \tau}-L\left(q_m c_p\right)_{\mathrm{c}} \frac{\partial T_{\mathrm{c}}}{\partial x}=\left(\eta_{\mathrm{o}} \alpha A\right)_{\mathrm{c}}\left(T_{\mathrm{w}}-T_{\mathrm{c}}\right), \\
&amp; L\left(\frac{q_m c_p}{v}\right)_{\mathrm{h}} \frac{\partial T_{\mathrm{h}}}{\partial \tau}+L\left(q_m c_p\right)_{\mathrm{h}} \frac{\partial T_{\mathrm{h}}}{\partial x}=\left(\eta_{\mathrm{o}} \alpha A\right)_{\mathrm{h}}\left(T_{\mathrm{w}}-T_{\mathrm{h}}\right), \\
&amp; \left(M c_p\right)_{\mathrm{w}} \frac{\partial T_{\mathrm{w}}}{\partial \tau}=\left(\eta_{\mathrm{o}} \alpha A\right)_{\mathrm{h}}\left(T_{\mathrm{h}}-T_{\mathrm{w}}\right)+\left(\eta_{\mathrm{o}} \alpha A\right)_{\mathrm{c}}\left(T_{\mathrm{c}}-T_{\mathrm{w}}\right).
\end{aligned}
\]</div>
<p>其中:</p>
<ul>
<li><span class="arithmatex">\(T\)</span> 代表温度，</li>
<li><span class="arithmatex">\(q_m\)</span> 代表质量流量，</li>
<li><span class="arithmatex">\(c_p\)</span> 代表比热容，</li>
<li><span class="arithmatex">\(v\)</span> 代表流速，</li>
<li><span class="arithmatex">\(L\)</span> 代表流动长度，</li>
<li><span class="arithmatex">\(\eta_{\mathrm{o}}\)</span> 代表翅片表面效率，</li>
<li><span class="arithmatex">\(\alpha\)</span> 代表传热系数，</li>
<li><span class="arithmatex">\(A\)</span> 代表传热面积，</li>
<li><span class="arithmatex">\(M\)</span> 代表传热结构的质量，</li>
<li><span class="arithmatex">\(\tau\)</span> 代表对应时间，</li>
<li><span class="arithmatex">\(x\)</span> 代表流动方向，</li>
<li>下标 <span class="arithmatex">\(\mathrm{h}\)</span>、<span class="arithmatex">\(\mathrm{c}\)</span> 和 <span class="arithmatex">\(\mathrm{w}\)</span> 分别表示热边流体、冷边流体和换热壁面。</li>
</ul>
<p>换热器冷、热流体进出口参数满足能量守恒, 即:</p>
<div class="arithmatex">\[
\left(q_m c_p\right)_{\mathrm{h}}\left(T_{\mathrm{h}, \text { in }}-T_{\mathrm{h}, \text { out }}\right)=\left(q_m c_p\right)_c\left(T_{\mathrm{c}, \text {out }}-T_{\mathrm{c}, \text {in }}\right).
\]</div>
<p>换热器效率 <span class="arithmatex">\(\eta\)</span> 为实际传热量与理论最大的传热量之比，即：</p>
<div class="arithmatex">\[
\eta=\frac{\left(q_m c_p\right)_{\mathrm{h}}\left(T_{\mathrm{h}, \text { in }}-T_{\mathrm{h}, \text { out }}\right)}{\left(q_m c_p\right)_{\text {min }}\left(T_{\mathrm{h}, \text { in }}-T_{\mathrm{c}, \text { in }}\right)},
\]</div>
<p>式中，下标 <span class="arithmatex">\(min\)</span> 表示冷热流体热容较小值。</p>
<h3 id="22-pi-deeponet">2.2 PI-DeepONet模型<a class="headerlink" href="#22-pi-deeponet" title="Permanent link">¶</a></h3>
<p>PI-DeepONet模型，将 DeepONet 和 PINN 方法相结合，是一种结合了物理信息和算子学习的深度神经网络模型。这种模型可以通过控制方程的物理信息来增强 DeepONet 模型，同时可以将不同的 PDE 配置分别作为不同的分支网络的输入数据，从而可以有效地用于在各种（参数和非参数）PDE 配置下进行超快速的模型预测。</p>
<p>对于换热器问题，PI-DeepONet 模型可以表示为如图所示的模型结构：</p>
<figure>
<p><a class="glightbox" href="https://paddle-org.bj.bcebos.com/paddlescience/docs/HEDeepONet/PI-DeepONet.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img align="center" alt="PI-DeepONet.png" loading="lazy" src="https://paddle-org.bj.bcebos.com/paddlescience/docs/HEDeepONet/PI-DeepONet.png" style="height:80%;width:80%"></a></p>
</figure>
<p>如图所示，我们一共使用了 2 个分支网络和一个主干网络，分支网络分别输入热边的质量流量和冷边的质量流量，主干网络输入一维坐标点坐标和时间信息。每个分支网和主干网均输出 <span class="arithmatex">\(q\)</span> 维特征向量，通过Hadamard（逐元素）乘积组合所有这些输出特征，然后将所得向量相加为预测温度场的标量输出。</p>
<h2 id="3">3. 问题求解<a class="headerlink" href="#3" title="Permanent link">¶</a></h2>
<p>接下来开始讲解如何将该问题一步一步地转化为 PaddleScience 代码，用深度学习的方法求解该换热器热仿真问题。为了快速理解 PaddleScience，接下来仅对模型构建、约束构建等关键步骤进行阐述，而其余细节请参考<a href="../../api/arch/">API文档</a>。</p>
<h3 id="31">3.1 模型构建<a class="headerlink" href="#31" title="Permanent link">¶</a></h3>
<p>在换热器热仿真问题中，每一个已知的坐标点 <span class="arithmatex">\((t, x)\)</span> 和每一组热边的质量流量和冷边的质量流量 <span class="arithmatex">\((q_{mh}, q_{mc})\)</span> 都对应一组热边流体的温度 <span class="arithmatex">\(T_h\)</span> 、冷边流体的温度 <span class="arithmatex">\(T_c\)</span> 和换热壁面的温度 <span class="arithmatex">\(T_h\)</span> 三个待求解的未知量。我们在这里使用 2 个分支网络和一个主干网络，3 个网络均为 MLP(Multilayer Perceptron, 多层感知机) 。 2 个分支网络分别表示 <span class="arithmatex">\((q_{mh}, q_{mc})\)</span> 到输出函数 <span class="arithmatex">\((b_1，b_2)\)</span> 的映射函数 <span class="arithmatex">\(f_1，f_2: \mathbb{R}^2 \to \mathbb{R}^{3q}\)</span>，即：</p>
<div class="arithmatex">\[
\begin{aligned}
b_1 &amp;= f_1(q_{mh}),\\
b_2 &amp;= f_2(q_{mc}).
\end{aligned}
\]</div>
<p>上式中 <span class="arithmatex">\(f_1,f_2\)</span> 均为 MLP 模型，<span class="arithmatex">\((b_1，b_2)\)</span> 分别为两个分支网络的输出函数，<span class="arithmatex">\(3q\)</span> 为输出函数的维数。主干网络表示 <span class="arithmatex">\((t, x)\)</span> 到输出函数 <span class="arithmatex">\(t_0\)</span> 的映射函数 <span class="arithmatex">\(f_3: \mathbb{R}^2 \to \mathbb{R}^{3q}\)</span>，即：</p>
<div class="arithmatex">\[
\begin{aligned}
t_0 &amp;= f_3(t,x).
\end{aligned}
\]</div>
<p>上式中 <span class="arithmatex">\(f_3\)</span> 为 MLP 模型，<span class="arithmatex">\((t_0)\)</span> 为主支网络的输出函数，<span class="arithmatex">\(3q\)</span> 为输出函数的维数。我们可以将两个分支网络和主干网络的输出函数 <span class="arithmatex">\((b_1,b_2, t_0)\)</span> 分成3组，然后对每一组的输出函数分别进行Hadamard（逐元素）乘积再相加得到标量温度场，即：</p>
<div class="arithmatex">\[
\begin{aligned}
T_h &amp;= \sum_{i=1}^q b_1^ib_2^i t_0^i,\\
T_c &amp;= \sum_{i=q+1}^{2q} b_1^ib_2^i t_0^i,\\
T_w &amp;= \sum_{i=2q+1}^{3q} b_1^ib_2^i t_0^i.
\end{aligned}
\]</div>
<p>我们定义 PaddleScience 内置的 HEDeepONets 模型类，并调用，PaddleScience 代码表示如下</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-33">33</a></span>
<span class="normal"><a href="#__codelineno-4-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33"></a><span class="c1"># set model</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34"></a><span class="n">model</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">HEDeepONets</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="o">.</span><span class="n">MODEL</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p>这样我们就实例化出了一个拥有 3 个 MLP 模型的 HEDeepONets 模型，每个分支网络包含 9 层隐藏神经元，每层神经元数为 256，主干网络包含 6 层隐藏神经元，每层神经元数为 128，使用 "swish" 作为激活函数，并包含三个输出函数 <span class="arithmatex">\(T_h,T_c,T_w\)</span> 的神经网络模型 <code>model</code>。</p>
<h3 id="32">3.2 计算域构建<a class="headerlink" href="#32" title="Permanent link">¶</a></h3>
<p>对本文中换热器问题构造训练区域，即以 [0, 1] 的一维区域，且时间域为 21 个时刻 [0,1,2,...,21]，该区域可以直接使用 PaddleScience 内置的空间几何 <code>Interval</code> 和时间域 <code>TimeDomain</code>，组合成时间-空间的 <code>TimeXGeometry</code> 计算域。代码如下</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-36">36</a></span>
<span class="normal"><a href="#__codelineno-5-37">37</a></span>
<span class="normal"><a href="#__codelineno-5-38">38</a></span>
<span class="normal"><a href="#__codelineno-5-39">39</a></span>
<span class="normal"><a href="#__codelineno-5-40">40</a></span>
<span class="normal"><a href="#__codelineno-5-41">41</a></span>
<span class="normal"><a href="#__codelineno-5-42">42</a></span>
<span class="normal"><a href="#__codelineno-5-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36"></a><span class="c1"># set time-geometry</span>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37"></a><span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38"></a><span class="n">geom</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39"></a>    <span class="s2">"time_rect"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TimeXGeometry</span><span class="p">(</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40"></a>        <span class="n">ppsci</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TimeDomain</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">timestamps</span><span class="o">=</span><span class="n">timestamps</span><span class="p">),</span>
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41"></a>        <span class="n">ppsci</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Interval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">DL</span><span class="p">),</span>
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42"></a>    <span class="p">)</span>
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<details class="tip" open="open">
<summary>提示</summary>
<p><code>Rectangle</code> 和 <code>TimeDomain</code> 是两种可以单独使用的 <code>Geometry</code> 派生类。</p>
<p>如输入数据只来自于二维矩形几何域，则可以直接使用 <code>ppsci.geometry.Rectangle(...)</code> 创建空间几何域对象；</p>
<p>如输入数据只来自一维时间域，则可以直接使用 <code>ppsci.geometry.TimeDomain(...)</code> 构建时间域对象。</p>
</details>
<h3 id="33">3.3 输入数据构建<a class="headerlink" href="#33" title="Permanent link">¶</a></h3>
<ul>
<li>通过 <code>TimeXGeometry</code> 计算域来构建输入的时间和空间均匀数据，</li>
<li>通过 <code>np.random.rand</code> 来生成 (0,2) 之间的随机数，这些随机数用于构建热边和冷边的质量流量的训练和测试数据。</li>
</ul>
<p>对时间、空间均匀数据和热边、冷边的质量流量数据进行组合，得到最终的训练和测试输入数据。代码如下</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-45">45</a></span>
<span class="normal"><a href="#__codelineno-6-46">46</a></span>
<span class="normal"><a href="#__codelineno-6-47">47</a></span>
<span class="normal"><a href="#__codelineno-6-48">48</a></span>
<span class="normal"><a href="#__codelineno-6-49">49</a></span>
<span class="normal"><a href="#__codelineno-6-50">50</a></span>
<span class="normal"><a href="#__codelineno-6-51">51</a></span>
<span class="normal"><a href="#__codelineno-6-52">52</a></span>
<span class="normal"><a href="#__codelineno-6-53">53</a></span>
<span class="normal"><a href="#__codelineno-6-54">54</a></span>
<span class="normal"><a href="#__codelineno-6-55">55</a></span>
<span class="normal"><a href="#__codelineno-6-56">56</a></span>
<span class="normal"><a href="#__codelineno-6-57">57</a></span>
<span class="normal"><a href="#__codelineno-6-58">58</a></span>
<span class="normal"><a href="#__codelineno-6-59">59</a></span>
<span class="normal"><a href="#__codelineno-6-60">60</a></span>
<span class="normal"><a href="#__codelineno-6-61">61</a></span>
<span class="normal"><a href="#__codelineno-6-62">62</a></span>
<span class="normal"><a href="#__codelineno-6-63">63</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-45"><a id="__codelineno-6-45" name="__codelineno-6-45"></a><span class="c1"># Generate train data and eval data</span>
</span><span id="__span-6-46"><a id="__codelineno-6-46" name="__codelineno-6-46"></a><span class="n">visu_input</span> <span class="o">=</span> <span class="n">geom</span><span class="p">[</span><span class="s2">"time_rect"</span><span class="p">]</span><span class="o">.</span><span class="n">sample_interior</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span> <span class="n">evenly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-6-47"><a id="__codelineno-6-47" name="__codelineno-6-47"></a><span class="n">data_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NQM</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="__span-6-48"><a id="__codelineno-6-48" name="__codelineno-6-48"></a><span class="n">data_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NQM</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="__span-6-49"><a id="__codelineno-6-49" name="__codelineno-6-49"></a><span class="n">data_h</span> <span class="o">=</span> <span class="n">data_h</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"float32"</span><span class="p">)</span>
</span><span id="__span-6-50"><a id="__codelineno-6-50" name="__codelineno-6-50"></a><span class="n">data_c</span> <span class="o">=</span> <span class="n">data_c</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"float32"</span><span class="p">)</span>
</span><span id="__span-6-51"><a id="__codelineno-6-51" name="__codelineno-6-51"></a><span class="n">test_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"float32"</span><span class="p">)</span>
</span><span id="__span-6-52"><a id="__codelineno-6-52" name="__codelineno-6-52"></a><span class="n">test_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"float32"</span><span class="p">)</span>
</span><span id="__span-6-53"><a id="__codelineno-6-53" name="__codelineno-6-53"></a><span class="c1"># rearrange train data and eval data</span>
</span><span id="__span-6-54"><a id="__codelineno-6-54" name="__codelineno-6-54"></a><span class="n">points</span> <span class="o">=</span> <span class="n">visu_input</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-6-55"><a id="__codelineno-6-55" name="__codelineno-6-55"></a><span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NQM</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-6-56"><a id="__codelineno-6-56" name="__codelineno-6-56"></a><span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NQM</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-6-57"><a id="__codelineno-6-57" name="__codelineno-6-57"></a><span class="n">points</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">data_h</span><span class="p">,</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-6-58"><a id="__codelineno-6-58" name="__codelineno-6-58"></a><span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NQM</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-6-59"><a id="__codelineno-6-59" name="__codelineno-6-59"></a><span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NQM</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-6-60"><a id="__codelineno-6-60" name="__codelineno-6-60"></a><span class="n">points</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NQM</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-6-61"><a id="__codelineno-6-61" name="__codelineno-6-61"></a><span class="n">points</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">data_c</span><span class="p">,</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NQM</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-6-62"><a id="__codelineno-6-62" name="__codelineno-6-62"></a><span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">test_h</span><span class="p">,</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-6-63"><a id="__codelineno-6-63" name="__codelineno-6-63"></a><span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">test_c</span><span class="p">,</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span></code></pre></div></td></tr></table></div>
<p>然后对训练数据按照空间坐标和时间进行分类，将训练数据和测试数据分类成左边界数据、内部数据、右边界数据以及初值数据。代码如下</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-7-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-7-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-7-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-7-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-7-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-7-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-7-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-7-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-7-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-7-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-7-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-7-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-7-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-7-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-7-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-7-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-7-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-7-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-7-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-7-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-7-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-7-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-7-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-7-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-7-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-7-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-7-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-7-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-7-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-7-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-7-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-7-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-7-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-7-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-7-100">100</a></span>
<span class="normal"><a href="#__codelineno-7-101">101</a></span>
<span class="normal"><a href="#__codelineno-7-102">102</a></span>
<span class="normal"><a href="#__codelineno-7-103">103</a></span>
<span class="normal"><a href="#__codelineno-7-104">104</a></span>
<span class="normal"><a href="#__codelineno-7-105">105</a></span>
<span class="normal"><a href="#__codelineno-7-106">106</a></span>
<span class="normal"><a href="#__codelineno-7-107">107</a></span>
<span class="normal"><a href="#__codelineno-7-108">108</a></span>
<span class="normal"><a href="#__codelineno-7-109">109</a></span>
<span class="normal"><a href="#__codelineno-7-110">110</a></span>
<span class="normal"><a href="#__codelineno-7-111">111</a></span>
<span class="normal"><a href="#__codelineno-7-112">112</a></span>
<span class="normal"><a href="#__codelineno-7-113">113</a></span>
<span class="normal"><a href="#__codelineno-7-114">114</a></span>
<span class="normal"><a href="#__codelineno-7-115">115</a></span>
<span class="normal"><a href="#__codelineno-7-116">116</a></span>
<span class="normal"><a href="#__codelineno-7-117">117</a></span>
<span class="normal"><a href="#__codelineno-7-118">118</a></span>
<span class="normal"><a href="#__codelineno-7-119">119</a></span>
<span class="normal"><a href="#__codelineno-7-120">120</a></span>
<span class="normal"><a href="#__codelineno-7-121">121</a></span>
<span class="normal"><a href="#__codelineno-7-122">122</a></span>
<span class="normal"><a href="#__codelineno-7-123">123</a></span>
<span class="normal"><a href="#__codelineno-7-124">124</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-65"><a id="__codelineno-7-65" name="__codelineno-7-65"></a><span class="n">left_indices</span> <span class="o">=</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="__span-7-66"><a id="__codelineno-7-66" name="__codelineno-7-66"></a><span class="n">right_indices</span> <span class="o">=</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">==</span> <span class="n">cfg</span><span class="o">.</span><span class="n">DL</span>
</span><span id="__span-7-67"><a id="__codelineno-7-67" name="__codelineno-7-67"></a><span class="n">interior_indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">!=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">DL</span><span class="p">)</span>
</span><span id="__span-7-68"><a id="__codelineno-7-68" name="__codelineno-7-68"></a><span class="n">left_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">left_indices</span><span class="p">)</span>
</span><span id="__span-7-69"><a id="__codelineno-7-69" name="__codelineno-7-69"></a><span class="n">right_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">right_indices</span><span class="p">)</span>
</span><span id="__span-7-70"><a id="__codelineno-7-70" name="__codelineno-7-70"></a><span class="n">interior_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">interior_indices</span><span class="p">)</span>
</span><span id="__span-7-71"><a id="__codelineno-7-71" name="__codelineno-7-71"></a>
</span><span id="__span-7-72"><a id="__codelineno-7-72" name="__codelineno-7-72"></a><span class="n">left_indices1</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="__span-7-73"><a id="__codelineno-7-73" name="__codelineno-7-73"></a><span class="n">right_indices1</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">==</span> <span class="n">cfg</span><span class="o">.</span><span class="n">DL</span>
</span><span id="__span-7-74"><a id="__codelineno-7-74" name="__codelineno-7-74"></a><span class="n">interior_indices1</span> <span class="o">=</span> <span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">!=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">DL</span><span class="p">)</span>
</span><span id="__span-7-75"><a id="__codelineno-7-75" name="__codelineno-7-75"></a><span class="n">initial_indices1</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">]</span> <span class="o">==</span> <span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-7-76"><a id="__codelineno-7-76" name="__codelineno-7-76"></a><span class="n">left_indices1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">left_indices1</span><span class="p">)</span>
</span><span id="__span-7-77"><a id="__codelineno-7-77" name="__codelineno-7-77"></a><span class="n">right_indices1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">right_indices1</span><span class="p">)</span>
</span><span id="__span-7-78"><a id="__codelineno-7-78" name="__codelineno-7-78"></a><span class="n">interior_indices1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">interior_indices1</span><span class="p">)</span>
</span><span id="__span-7-79"><a id="__codelineno-7-79" name="__codelineno-7-79"></a><span class="n">initial_indices1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">initial_indices1</span><span class="p">)</span>
</span><span id="__span-7-80"><a id="__codelineno-7-80" name="__codelineno-7-80"></a>
</span><span id="__span-7-81"><a id="__codelineno-7-81" name="__codelineno-7-81"></a><span class="c1"># Classification train data</span>
</span><span id="__span-7-82"><a id="__codelineno-7-82" name="__codelineno-7-82"></a><span class="n">left_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-7-83"><a id="__codelineno-7-83" name="__codelineno-7-83"></a>    <span class="s2">"x"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">][</span><span class="n">left_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-84"><a id="__codelineno-7-84" name="__codelineno-7-84"></a>    <span class="s2">"t"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">][</span><span class="n">left_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-85"><a id="__codelineno-7-85" name="__codelineno-7-85"></a>    <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">][</span><span class="n">left_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-86"><a id="__codelineno-7-86" name="__codelineno-7-86"></a>    <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">][</span><span class="n">left_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-87"><a id="__codelineno-7-87" name="__codelineno-7-87"></a><span class="p">}</span>
</span><span id="__span-7-88"><a id="__codelineno-7-88" name="__codelineno-7-88"></a><span class="n">right_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-7-89"><a id="__codelineno-7-89" name="__codelineno-7-89"></a>    <span class="s2">"x"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">][</span><span class="n">right_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-90"><a id="__codelineno-7-90" name="__codelineno-7-90"></a>    <span class="s2">"t"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">][</span><span class="n">right_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-91"><a id="__codelineno-7-91" name="__codelineno-7-91"></a>    <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">][</span><span class="n">right_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-92"><a id="__codelineno-7-92" name="__codelineno-7-92"></a>    <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">][</span><span class="n">right_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-93"><a id="__codelineno-7-93" name="__codelineno-7-93"></a><span class="p">}</span>
</span><span id="__span-7-94"><a id="__codelineno-7-94" name="__codelineno-7-94"></a><span class="n">interior_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-7-95"><a id="__codelineno-7-95" name="__codelineno-7-95"></a>    <span class="s2">"x"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span>
</span><span id="__span-7-96"><a id="__codelineno-7-96" name="__codelineno-7-96"></a>    <span class="s2">"t"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span>
</span><span id="__span-7-97"><a id="__codelineno-7-97" name="__codelineno-7-97"></a>    <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">],</span>
</span><span id="__span-7-98"><a id="__codelineno-7-98" name="__codelineno-7-98"></a>    <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">],</span>
</span><span id="__span-7-99"><a id="__codelineno-7-99" name="__codelineno-7-99"></a><span class="p">}</span>
</span><span id="__span-7-100"><a id="__codelineno-7-100" name="__codelineno-7-100"></a><span class="n">initial_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-7-101"><a id="__codelineno-7-101" name="__codelineno-7-101"></a>    <span class="s2">"x"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">][</span><span class="n">initial_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-102"><a id="__codelineno-7-102" name="__codelineno-7-102"></a>    <span class="s2">"t"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">][</span><span class="n">initial_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-7-103"><a id="__codelineno-7-103" name="__codelineno-7-103"></a>    <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">][</span><span class="n">initial_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-104"><a id="__codelineno-7-104" name="__codelineno-7-104"></a>    <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">][</span><span class="n">initial_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-105"><a id="__codelineno-7-105" name="__codelineno-7-105"></a><span class="p">}</span>
</span><span id="__span-7-106"><a id="__codelineno-7-106" name="__codelineno-7-106"></a><span class="c1"># Classification eval data</span>
</span><span id="__span-7-107"><a id="__codelineno-7-107" name="__codelineno-7-107"></a><span class="n">test_left_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-7-108"><a id="__codelineno-7-108" name="__codelineno-7-108"></a>    <span class="s2">"x"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">][</span><span class="n">left_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-109"><a id="__codelineno-7-109" name="__codelineno-7-109"></a>    <span class="s2">"t"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"t"</span><span class="p">][</span><span class="n">left_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-110"><a id="__codelineno-7-110" name="__codelineno-7-110"></a>    <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">][</span><span class="n">left_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-111"><a id="__codelineno-7-111" name="__codelineno-7-111"></a>    <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">][</span><span class="n">left_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-112"><a id="__codelineno-7-112" name="__codelineno-7-112"></a><span class="p">}</span>
</span><span id="__span-7-113"><a id="__codelineno-7-113" name="__codelineno-7-113"></a><span class="n">test_right_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-7-114"><a id="__codelineno-7-114" name="__codelineno-7-114"></a>    <span class="s2">"x"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">][</span><span class="n">right_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-115"><a id="__codelineno-7-115" name="__codelineno-7-115"></a>    <span class="s2">"t"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"t"</span><span class="p">][</span><span class="n">right_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-116"><a id="__codelineno-7-116" name="__codelineno-7-116"></a>    <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">][</span><span class="n">right_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-117"><a id="__codelineno-7-117" name="__codelineno-7-117"></a>    <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">][</span><span class="n">right_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-7-118"><a id="__codelineno-7-118" name="__codelineno-7-118"></a><span class="p">}</span>
</span><span id="__span-7-119"><a id="__codelineno-7-119" name="__codelineno-7-119"></a><span class="n">test_interior_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-7-120"><a id="__codelineno-7-120" name="__codelineno-7-120"></a>    <span class="s2">"x"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span>
</span><span id="__span-7-121"><a id="__codelineno-7-121" name="__codelineno-7-121"></a>    <span class="s2">"t"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span>
</span><span id="__span-7-122"><a id="__codelineno-7-122" name="__codelineno-7-122"></a>    <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">],</span>
</span><span id="__span-7-123"><a id="__codelineno-7-123" name="__codelineno-7-123"></a>    <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">],</span>
</span><span id="__span-7-124"><a id="__codelineno-7-124" name="__codelineno-7-124"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="34">3.4 方程构建<a class="headerlink" href="#34" title="Permanent link">¶</a></h3>
<p>换热器热仿真问题由 <a href="#21">2.1 问题描述</a> 中描述的方程组成，这里我们定义 PaddleScience 内置的 <code>HeatEquation</code> 方程类来构建该方程。指定该类的参数均为1，代码如下</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-126">126</a></span>
<span class="normal"><a href="#__codelineno-8-127">127</a></span>
<span class="normal"><a href="#__codelineno-8-128">128</a></span>
<span class="normal"><a href="#__codelineno-8-129">129</a></span>
<span class="normal"><a href="#__codelineno-8-130">130</a></span>
<span class="normal"><a href="#__codelineno-8-131">131</a></span>
<span class="normal"><a href="#__codelineno-8-132">132</a></span>
<span class="normal"><a href="#__codelineno-8-133">133</a></span>
<span class="normal"><a href="#__codelineno-8-134">134</a></span>
<span class="normal"><a href="#__codelineno-8-135">135</a></span>
<span class="normal"><a href="#__codelineno-8-136">136</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-126"><a id="__codelineno-8-126" name="__codelineno-8-126"></a><span class="c1"># set equation</span>
</span><span id="__span-8-127"><a id="__codelineno-8-127" name="__codelineno-8-127"></a><span class="n">equation</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-8-128"><a id="__codelineno-8-128" name="__codelineno-8-128"></a>    <span class="s2">"heat_exchanger"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">equation</span><span class="o">.</span><span class="n">HeatExchanger</span><span class="p">(</span>
</span><span id="__span-8-129"><a id="__codelineno-8-129" name="__codelineno-8-129"></a>        <span class="n">cfg</span><span class="o">.</span><span class="n">alpha_h</span> <span class="o">/</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">L</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">cp_h</span><span class="p">),</span>
</span><span id="__span-8-130"><a id="__codelineno-8-130" name="__codelineno-8-130"></a>        <span class="n">cfg</span><span class="o">.</span><span class="n">alpha_c</span> <span class="o">/</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">L</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">cp_c</span><span class="p">),</span>
</span><span id="__span-8-131"><a id="__codelineno-8-131" name="__codelineno-8-131"></a>        <span class="n">cfg</span><span class="o">.</span><span class="n">v_h</span><span class="p">,</span>
</span><span id="__span-8-132"><a id="__codelineno-8-132" name="__codelineno-8-132"></a>        <span class="n">cfg</span><span class="o">.</span><span class="n">v_c</span><span class="p">,</span>
</span><span id="__span-8-133"><a id="__codelineno-8-133" name="__codelineno-8-133"></a>        <span class="n">cfg</span><span class="o">.</span><span class="n">alpha_h</span> <span class="o">/</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">M</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">cp_w</span><span class="p">),</span>
</span><span id="__span-8-134"><a id="__codelineno-8-134" name="__codelineno-8-134"></a>        <span class="n">cfg</span><span class="o">.</span><span class="n">alpha_c</span> <span class="o">/</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">M</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">cp_w</span><span class="p">),</span>
</span><span id="__span-8-135"><a id="__codelineno-8-135" name="__codelineno-8-135"></a>    <span class="p">)</span>
</span><span id="__span-8-136"><a id="__codelineno-8-136" name="__codelineno-8-136"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="35">3.5 约束构建<a class="headerlink" href="#35" title="Permanent link">¶</a></h3>
<p>换热器热仿真问题由 <a href="#21">2.1 问题描述</a> 中描述的方程组成，我们设置以下边界条件：</p>
<div class="arithmatex">\[
\begin{aligned}
T_h(t,0) &amp;= 10,\\
T_c(t,1) &amp;= 1.
\end{aligned}
\]</div>
<p>同时，我们设置初值条件：</p>
<div class="arithmatex">\[
\begin{aligned}
T_h(0,x) &amp;= 10,\\
T_c(0,x) &amp;= 1,\\
T_w(0,x) &amp;= 5.5.
\end{aligned}
\]</div>
<p>此时我们对左边界数据、内部数据、右边界数据以及初值数据设置四个约束条件，接下来使用 PaddleScience 内置的 <code>SupervisedConstraint</code> 构建上述四种约束条件，代码如下</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-138">138</a></span>
<span class="normal"><a href="#__codelineno-9-139">139</a></span>
<span class="normal"><a href="#__codelineno-9-140">140</a></span>
<span class="normal"><a href="#__codelineno-9-141">141</a></span>
<span class="normal"><a href="#__codelineno-9-142">142</a></span>
<span class="normal"><a href="#__codelineno-9-143">143</a></span>
<span class="normal"><a href="#__codelineno-9-144">144</a></span>
<span class="normal"><a href="#__codelineno-9-145">145</a></span>
<span class="normal"><a href="#__codelineno-9-146">146</a></span>
<span class="normal"><a href="#__codelineno-9-147">147</a></span>
<span class="normal"><a href="#__codelineno-9-148">148</a></span>
<span class="normal"><a href="#__codelineno-9-149">149</a></span>
<span class="normal"><a href="#__codelineno-9-150">150</a></span>
<span class="normal"><a href="#__codelineno-9-151">151</a></span>
<span class="normal"><a href="#__codelineno-9-152">152</a></span>
<span class="normal"><a href="#__codelineno-9-153">153</a></span>
<span class="normal"><a href="#__codelineno-9-154">154</a></span>
<span class="normal"><a href="#__codelineno-9-155">155</a></span>
<span class="normal"><a href="#__codelineno-9-156">156</a></span>
<span class="normal"><a href="#__codelineno-9-157">157</a></span>
<span class="normal"><a href="#__codelineno-9-158">158</a></span>
<span class="normal"><a href="#__codelineno-9-159">159</a></span>
<span class="normal"><a href="#__codelineno-9-160">160</a></span>
<span class="normal"><a href="#__codelineno-9-161">161</a></span>
<span class="normal"><a href="#__codelineno-9-162">162</a></span>
<span class="normal"><a href="#__codelineno-9-163">163</a></span>
<span class="normal"><a href="#__codelineno-9-164">164</a></span>
<span class="normal"><a href="#__codelineno-9-165">165</a></span>
<span class="normal"><a href="#__codelineno-9-166">166</a></span>
<span class="normal"><a href="#__codelineno-9-167">167</a></span>
<span class="normal"><a href="#__codelineno-9-168">168</a></span>
<span class="normal"><a href="#__codelineno-9-169">169</a></span>
<span class="normal"><a href="#__codelineno-9-170">170</a></span>
<span class="normal"><a href="#__codelineno-9-171">171</a></span>
<span class="normal"><a href="#__codelineno-9-172">172</a></span>
<span class="normal"><a href="#__codelineno-9-173">173</a></span>
<span class="normal"><a href="#__codelineno-9-174">174</a></span>
<span class="normal"><a href="#__codelineno-9-175">175</a></span>
<span class="normal"><a href="#__codelineno-9-176">176</a></span>
<span class="normal"><a href="#__codelineno-9-177">177</a></span>
<span class="normal"><a href="#__codelineno-9-178">178</a></span>
<span class="normal"><a href="#__codelineno-9-179">179</a></span>
<span class="normal"><a href="#__codelineno-9-180">180</a></span>
<span class="normal"><a href="#__codelineno-9-181">181</a></span>
<span class="normal"><a href="#__codelineno-9-182">182</a></span>
<span class="normal"><a href="#__codelineno-9-183">183</a></span>
<span class="normal"><a href="#__codelineno-9-184">184</a></span>
<span class="normal"><a href="#__codelineno-9-185">185</a></span>
<span class="normal"><a href="#__codelineno-9-186">186</a></span>
<span class="normal"><a href="#__codelineno-9-187">187</a></span>
<span class="normal"><a href="#__codelineno-9-188">188</a></span>
<span class="normal"><a href="#__codelineno-9-189">189</a></span>
<span class="normal"><a href="#__codelineno-9-190">190</a></span>
<span class="normal"><a href="#__codelineno-9-191">191</a></span>
<span class="normal"><a href="#__codelineno-9-192">192</a></span>
<span class="normal"><a href="#__codelineno-9-193">193</a></span>
<span class="normal"><a href="#__codelineno-9-194">194</a></span>
<span class="normal"><a href="#__codelineno-9-195">195</a></span>
<span class="normal"><a href="#__codelineno-9-196">196</a></span>
<span class="normal"><a href="#__codelineno-9-197">197</a></span>
<span class="normal"><a href="#__codelineno-9-198">198</a></span>
<span class="normal"><a href="#__codelineno-9-199">199</a></span>
<span class="normal"><a href="#__codelineno-9-200">200</a></span>
<span class="normal"><a href="#__codelineno-9-201">201</a></span>
<span class="normal"><a href="#__codelineno-9-202">202</a></span>
<span class="normal"><a href="#__codelineno-9-203">203</a></span>
<span class="normal"><a href="#__codelineno-9-204">204</a></span>
<span class="normal"><a href="#__codelineno-9-205">205</a></span>
<span class="normal"><a href="#__codelineno-9-206">206</a></span>
<span class="normal"><a href="#__codelineno-9-207">207</a></span>
<span class="normal"><a href="#__codelineno-9-208">208</a></span>
<span class="normal"><a href="#__codelineno-9-209">209</a></span>
<span class="normal"><a href="#__codelineno-9-210">210</a></span>
<span class="normal"><a href="#__codelineno-9-211">211</a></span>
<span class="normal"><a href="#__codelineno-9-212">212</a></span>
<span class="normal"><a href="#__codelineno-9-213">213</a></span>
<span class="normal"><a href="#__codelineno-9-214">214</a></span>
<span class="normal"><a href="#__codelineno-9-215">215</a></span>
<span class="normal"><a href="#__codelineno-9-216">216</a></span>
<span class="normal"><a href="#__codelineno-9-217">217</a></span>
<span class="normal"><a href="#__codelineno-9-218">218</a></span>
<span class="normal"><a href="#__codelineno-9-219">219</a></span>
<span class="normal"><a href="#__codelineno-9-220">220</a></span>
<span class="normal"><a href="#__codelineno-9-221">221</a></span>
<span class="normal"><a href="#__codelineno-9-222">222</a></span>
<span class="normal"><a href="#__codelineno-9-223">223</a></span>
<span class="normal"><a href="#__codelineno-9-224">224</a></span>
<span class="normal"><a href="#__codelineno-9-225">225</a></span>
<span class="normal"><a href="#__codelineno-9-226">226</a></span>
<span class="normal"><a href="#__codelineno-9-227">227</a></span>
<span class="normal"><a href="#__codelineno-9-228">228</a></span>
<span class="normal"><a href="#__codelineno-9-229">229</a></span>
<span class="normal"><a href="#__codelineno-9-230">230</a></span>
<span class="normal"><a href="#__codelineno-9-231">231</a></span>
<span class="normal"><a href="#__codelineno-9-232">232</a></span>
<span class="normal"><a href="#__codelineno-9-233">233</a></span>
<span class="normal"><a href="#__codelineno-9-234">234</a></span>
<span class="normal"><a href="#__codelineno-9-235">235</a></span>
<span class="normal"><a href="#__codelineno-9-236">236</a></span>
<span class="normal"><a href="#__codelineno-9-237">237</a></span>
<span class="normal"><a href="#__codelineno-9-238">238</a></span>
<span class="normal"><a href="#__codelineno-9-239">239</a></span>
<span class="normal"><a href="#__codelineno-9-240">240</a></span>
<span class="normal"><a href="#__codelineno-9-241">241</a></span>
<span class="normal"><a href="#__codelineno-9-242">242</a></span>
<span class="normal"><a href="#__codelineno-9-243">243</a></span>
<span class="normal"><a href="#__codelineno-9-244">244</a></span>
<span class="normal"><a href="#__codelineno-9-245">245</a></span>
<span class="normal"><a href="#__codelineno-9-246">246</a></span>
<span class="normal"><a href="#__codelineno-9-247">247</a></span>
<span class="normal"><a href="#__codelineno-9-248">248</a></span>
<span class="normal"><a href="#__codelineno-9-249">249</a></span>
<span class="normal"><a href="#__codelineno-9-250">250</a></span>
<span class="normal"><a href="#__codelineno-9-251">251</a></span>
<span class="normal"><a href="#__codelineno-9-252">252</a></span>
<span class="normal"><a href="#__codelineno-9-253">253</a></span>
<span class="normal"><a href="#__codelineno-9-254">254</a></span>
<span class="normal"><a href="#__codelineno-9-255">255</a></span>
<span class="normal"><a href="#__codelineno-9-256">256</a></span>
<span class="normal"><a href="#__codelineno-9-257">257</a></span>
<span class="normal"><a href="#__codelineno-9-258">258</a></span>
<span class="normal"><a href="#__codelineno-9-259">259</a></span>
<span class="normal"><a href="#__codelineno-9-260">260</a></span>
<span class="normal"><a href="#__codelineno-9-261">261</a></span>
<span class="normal"><a href="#__codelineno-9-262">262</a></span>
<span class="normal"><a href="#__codelineno-9-263">263</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-138"><a id="__codelineno-9-138" name="__codelineno-9-138"></a><span class="c1"># set constraint</span>
</span><span id="__span-9-139"><a id="__codelineno-9-139" name="__codelineno-9-139"></a><span class="n">bc_label</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-9-140"><a id="__codelineno-9-140" name="__codelineno-9-140"></a>    <span class="s2">"T_h"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">left_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-9-141"><a id="__codelineno-9-141" name="__codelineno-9-141"></a><span class="p">}</span>
</span><span id="__span-9-142"><a id="__codelineno-9-142" name="__codelineno-9-142"></a><span class="n">interior_label</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-9-143"><a id="__codelineno-9-143" name="__codelineno-9-143"></a>    <span class="s2">"heat_boundary"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-9-144"><a id="__codelineno-9-144" name="__codelineno-9-144"></a>    <span class="s2">"cold_boundary"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-9-145"><a id="__codelineno-9-145" name="__codelineno-9-145"></a>    <span class="s2">"wall"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-9-146"><a id="__codelineno-9-146" name="__codelineno-9-146"></a><span class="p">}</span>
</span><span id="__span-9-147"><a id="__codelineno-9-147" name="__codelineno-9-147"></a><span class="n">initial_label</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-9-148"><a id="__codelineno-9-148" name="__codelineno-9-148"></a>    <span class="s2">"T_h"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">initial_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-9-149"><a id="__codelineno-9-149" name="__codelineno-9-149"></a>    <span class="s2">"T_c"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">initial_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-9-150"><a id="__codelineno-9-150" name="__codelineno-9-150"></a>    <span class="s2">"T_w"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">initial_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-9-151"><a id="__codelineno-9-151" name="__codelineno-9-151"></a><span class="p">}</span>
</span><span id="__span-9-152"><a id="__codelineno-9-152" name="__codelineno-9-152"></a>
</span><span id="__span-9-153"><a id="__codelineno-9-153" name="__codelineno-9-153"></a><span class="n">left_sup_constraint</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">SupervisedConstraint</span><span class="p">(</span>
</span><span id="__span-9-154"><a id="__codelineno-9-154" name="__codelineno-9-154"></a>    <span class="p">{</span>
</span><span id="__span-9-155"><a id="__codelineno-9-155" name="__codelineno-9-155"></a>        <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-9-156"><a id="__codelineno-9-156" name="__codelineno-9-156"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"NamedArrayDataset"</span><span class="p">,</span>
</span><span id="__span-9-157"><a id="__codelineno-9-157" name="__codelineno-9-157"></a>            <span class="s2">"input"</span><span class="p">:</span> <span class="n">left_data</span><span class="p">,</span>
</span><span id="__span-9-158"><a id="__codelineno-9-158" name="__codelineno-9-158"></a>            <span class="s2">"label"</span><span class="p">:</span> <span class="n">bc_label</span><span class="p">,</span>
</span><span id="__span-9-159"><a id="__codelineno-9-159" name="__codelineno-9-159"></a>            <span class="s2">"weight"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-9-160"><a id="__codelineno-9-160" name="__codelineno-9-160"></a>                <span class="s2">"T_h"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span>
</span><span id="__span-9-161"><a id="__codelineno-9-161" name="__codelineno-9-161"></a>                    <span class="n">left_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">left_sup_constraint</span><span class="o">.</span><span class="n">T_h</span>
</span><span id="__span-9-162"><a id="__codelineno-9-162" name="__codelineno-9-162"></a>                <span class="p">)</span>
</span><span id="__span-9-163"><a id="__codelineno-9-163" name="__codelineno-9-163"></a>            <span class="p">},</span>
</span><span id="__span-9-164"><a id="__codelineno-9-164" name="__codelineno-9-164"></a>        <span class="p">},</span>
</span><span id="__span-9-165"><a id="__codelineno-9-165" name="__codelineno-9-165"></a>        <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="__span-9-166"><a id="__codelineno-9-166" name="__codelineno-9-166"></a>        <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-9-167"><a id="__codelineno-9-167" name="__codelineno-9-167"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-9-168"><a id="__codelineno-9-168" name="__codelineno-9-168"></a>            <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-9-169"><a id="__codelineno-9-169" name="__codelineno-9-169"></a>            <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-9-170"><a id="__codelineno-9-170" name="__codelineno-9-170"></a>        <span class="p">},</span>
</span><span id="__span-9-171"><a id="__codelineno-9-171" name="__codelineno-9-171"></a>    <span class="p">},</span>
</span><span id="__span-9-172"><a id="__codelineno-9-172" name="__codelineno-9-172"></a>    <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-9-173"><a id="__codelineno-9-173" name="__codelineno-9-173"></a>    <span class="n">output_expr</span><span class="o">=</span><span class="p">{</span><span class="s2">"T_h"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"T_h"</span><span class="p">]</span> <span class="o">-</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_hin</span><span class="p">},</span>
</span><span id="__span-9-174"><a id="__codelineno-9-174" name="__codelineno-9-174"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">"left_sup"</span><span class="p">,</span>
</span><span id="__span-9-175"><a id="__codelineno-9-175" name="__codelineno-9-175"></a><span class="p">)</span>
</span><span id="__span-9-176"><a id="__codelineno-9-176" name="__codelineno-9-176"></a><span class="n">right_sup_constraint</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">SupervisedConstraint</span><span class="p">(</span>
</span><span id="__span-9-177"><a id="__codelineno-9-177" name="__codelineno-9-177"></a>    <span class="p">{</span>
</span><span id="__span-9-178"><a id="__codelineno-9-178" name="__codelineno-9-178"></a>        <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-9-179"><a id="__codelineno-9-179" name="__codelineno-9-179"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"NamedArrayDataset"</span><span class="p">,</span>
</span><span id="__span-9-180"><a id="__codelineno-9-180" name="__codelineno-9-180"></a>            <span class="s2">"input"</span><span class="p">:</span> <span class="n">right_data</span><span class="p">,</span>
</span><span id="__span-9-181"><a id="__codelineno-9-181" name="__codelineno-9-181"></a>            <span class="s2">"label"</span><span class="p">:</span> <span class="n">bc_label</span><span class="p">,</span>
</span><span id="__span-9-182"><a id="__codelineno-9-182" name="__codelineno-9-182"></a>            <span class="s2">"weight"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-9-183"><a id="__codelineno-9-183" name="__codelineno-9-183"></a>                <span class="s2">"T_h"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span>
</span><span id="__span-9-184"><a id="__codelineno-9-184" name="__codelineno-9-184"></a>                    <span class="n">right_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">right_sup_constraint</span><span class="o">.</span><span class="n">T_h</span>
</span><span id="__span-9-185"><a id="__codelineno-9-185" name="__codelineno-9-185"></a>                <span class="p">)</span>
</span><span id="__span-9-186"><a id="__codelineno-9-186" name="__codelineno-9-186"></a>            <span class="p">},</span>
</span><span id="__span-9-187"><a id="__codelineno-9-187" name="__codelineno-9-187"></a>        <span class="p">},</span>
</span><span id="__span-9-188"><a id="__codelineno-9-188" name="__codelineno-9-188"></a>        <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="__span-9-189"><a id="__codelineno-9-189" name="__codelineno-9-189"></a>        <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-9-190"><a id="__codelineno-9-190" name="__codelineno-9-190"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-9-191"><a id="__codelineno-9-191" name="__codelineno-9-191"></a>            <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-9-192"><a id="__codelineno-9-192" name="__codelineno-9-192"></a>            <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-9-193"><a id="__codelineno-9-193" name="__codelineno-9-193"></a>        <span class="p">},</span>
</span><span id="__span-9-194"><a id="__codelineno-9-194" name="__codelineno-9-194"></a>    <span class="p">},</span>
</span><span id="__span-9-195"><a id="__codelineno-9-195" name="__codelineno-9-195"></a>    <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-9-196"><a id="__codelineno-9-196" name="__codelineno-9-196"></a>    <span class="n">output_expr</span><span class="o">=</span><span class="p">{</span><span class="s2">"T_h"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"T_c"</span><span class="p">]</span> <span class="o">-</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_cin</span><span class="p">},</span>
</span><span id="__span-9-197"><a id="__codelineno-9-197" name="__codelineno-9-197"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">"right_sup"</span><span class="p">,</span>
</span><span id="__span-9-198"><a id="__codelineno-9-198" name="__codelineno-9-198"></a><span class="p">)</span>
</span><span id="__span-9-199"><a id="__codelineno-9-199" name="__codelineno-9-199"></a><span class="n">interior_sup_constraint</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">SupervisedConstraint</span><span class="p">(</span>
</span><span id="__span-9-200"><a id="__codelineno-9-200" name="__codelineno-9-200"></a>    <span class="p">{</span>
</span><span id="__span-9-201"><a id="__codelineno-9-201" name="__codelineno-9-201"></a>        <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-9-202"><a id="__codelineno-9-202" name="__codelineno-9-202"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"NamedArrayDataset"</span><span class="p">,</span>
</span><span id="__span-9-203"><a id="__codelineno-9-203" name="__codelineno-9-203"></a>            <span class="s2">"input"</span><span class="p">:</span> <span class="n">interior_data</span><span class="p">,</span>
</span><span id="__span-9-204"><a id="__codelineno-9-204" name="__codelineno-9-204"></a>            <span class="s2">"label"</span><span class="p">:</span> <span class="n">interior_label</span><span class="p">,</span>
</span><span id="__span-9-205"><a id="__codelineno-9-205" name="__codelineno-9-205"></a>            <span class="s2">"weight"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-9-206"><a id="__codelineno-9-206" name="__codelineno-9-206"></a>                <span class="s2">"heat_boundary"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span>
</span><span id="__span-9-207"><a id="__codelineno-9-207" name="__codelineno-9-207"></a>                    <span class="n">interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span>
</span><span id="__span-9-208"><a id="__codelineno-9-208" name="__codelineno-9-208"></a>                    <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">interior_sup_constraint</span><span class="o">.</span><span class="n">heat_boundary</span><span class="p">,</span>
</span><span id="__span-9-209"><a id="__codelineno-9-209" name="__codelineno-9-209"></a>                <span class="p">),</span>
</span><span id="__span-9-210"><a id="__codelineno-9-210" name="__codelineno-9-210"></a>                <span class="s2">"cold_boundary"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span>
</span><span id="__span-9-211"><a id="__codelineno-9-211" name="__codelineno-9-211"></a>                    <span class="n">interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span>
</span><span id="__span-9-212"><a id="__codelineno-9-212" name="__codelineno-9-212"></a>                    <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">interior_sup_constraint</span><span class="o">.</span><span class="n">cold_boundary</span><span class="p">,</span>
</span><span id="__span-9-213"><a id="__codelineno-9-213" name="__codelineno-9-213"></a>                <span class="p">),</span>
</span><span id="__span-9-214"><a id="__codelineno-9-214" name="__codelineno-9-214"></a>                <span class="s2">"wall"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span>
</span><span id="__span-9-215"><a id="__codelineno-9-215" name="__codelineno-9-215"></a>                    <span class="n">interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span>
</span><span id="__span-9-216"><a id="__codelineno-9-216" name="__codelineno-9-216"></a>                    <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">interior_sup_constraint</span><span class="o">.</span><span class="n">wall</span><span class="p">,</span>
</span><span id="__span-9-217"><a id="__codelineno-9-217" name="__codelineno-9-217"></a>                <span class="p">),</span>
</span><span id="__span-9-218"><a id="__codelineno-9-218" name="__codelineno-9-218"></a>            <span class="p">},</span>
</span><span id="__span-9-219"><a id="__codelineno-9-219" name="__codelineno-9-219"></a>        <span class="p">},</span>
</span><span id="__span-9-220"><a id="__codelineno-9-220" name="__codelineno-9-220"></a>        <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="__span-9-221"><a id="__codelineno-9-221" name="__codelineno-9-221"></a>        <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-9-222"><a id="__codelineno-9-222" name="__codelineno-9-222"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-9-223"><a id="__codelineno-9-223" name="__codelineno-9-223"></a>            <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-9-224"><a id="__codelineno-9-224" name="__codelineno-9-224"></a>            <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-9-225"><a id="__codelineno-9-225" name="__codelineno-9-225"></a>        <span class="p">},</span>
</span><span id="__span-9-226"><a id="__codelineno-9-226" name="__codelineno-9-226"></a>    <span class="p">},</span>
</span><span id="__span-9-227"><a id="__codelineno-9-227" name="__codelineno-9-227"></a>    <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-9-228"><a id="__codelineno-9-228" name="__codelineno-9-228"></a>    <span class="n">output_expr</span><span class="o">=</span><span class="n">equation</span><span class="p">[</span><span class="s2">"heat_exchanger"</span><span class="p">]</span><span class="o">.</span><span class="n">equations</span><span class="p">,</span>
</span><span id="__span-9-229"><a id="__codelineno-9-229" name="__codelineno-9-229"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">"interior_sup"</span><span class="p">,</span>
</span><span id="__span-9-230"><a id="__codelineno-9-230" name="__codelineno-9-230"></a><span class="p">)</span>
</span><span id="__span-9-231"><a id="__codelineno-9-231" name="__codelineno-9-231"></a><span class="n">initial_sup_constraint</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">SupervisedConstraint</span><span class="p">(</span>
</span><span id="__span-9-232"><a id="__codelineno-9-232" name="__codelineno-9-232"></a>    <span class="p">{</span>
</span><span id="__span-9-233"><a id="__codelineno-9-233" name="__codelineno-9-233"></a>        <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-9-234"><a id="__codelineno-9-234" name="__codelineno-9-234"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"NamedArrayDataset"</span><span class="p">,</span>
</span><span id="__span-9-235"><a id="__codelineno-9-235" name="__codelineno-9-235"></a>            <span class="s2">"input"</span><span class="p">:</span> <span class="n">initial_data</span><span class="p">,</span>
</span><span id="__span-9-236"><a id="__codelineno-9-236" name="__codelineno-9-236"></a>            <span class="s2">"label"</span><span class="p">:</span> <span class="n">initial_label</span><span class="p">,</span>
</span><span id="__span-9-237"><a id="__codelineno-9-237" name="__codelineno-9-237"></a>            <span class="s2">"weight"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-9-238"><a id="__codelineno-9-238" name="__codelineno-9-238"></a>                <span class="s2">"T_h"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span>
</span><span id="__span-9-239"><a id="__codelineno-9-239" name="__codelineno-9-239"></a>                    <span class="n">initial_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">initial_sup_constraint</span><span class="o">.</span><span class="n">T_h</span>
</span><span id="__span-9-240"><a id="__codelineno-9-240" name="__codelineno-9-240"></a>                <span class="p">),</span>
</span><span id="__span-9-241"><a id="__codelineno-9-241" name="__codelineno-9-241"></a>                <span class="s2">"T_c"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span>
</span><span id="__span-9-242"><a id="__codelineno-9-242" name="__codelineno-9-242"></a>                    <span class="n">initial_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">initial_sup_constraint</span><span class="o">.</span><span class="n">T_c</span>
</span><span id="__span-9-243"><a id="__codelineno-9-243" name="__codelineno-9-243"></a>                <span class="p">),</span>
</span><span id="__span-9-244"><a id="__codelineno-9-244" name="__codelineno-9-244"></a>                <span class="s2">"T_w"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span>
</span><span id="__span-9-245"><a id="__codelineno-9-245" name="__codelineno-9-245"></a>                    <span class="n">initial_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">initial_sup_constraint</span><span class="o">.</span><span class="n">T_w</span>
</span><span id="__span-9-246"><a id="__codelineno-9-246" name="__codelineno-9-246"></a>                <span class="p">),</span>
</span><span id="__span-9-247"><a id="__codelineno-9-247" name="__codelineno-9-247"></a>            <span class="p">},</span>
</span><span id="__span-9-248"><a id="__codelineno-9-248" name="__codelineno-9-248"></a>        <span class="p">},</span>
</span><span id="__span-9-249"><a id="__codelineno-9-249" name="__codelineno-9-249"></a>        <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="__span-9-250"><a id="__codelineno-9-250" name="__codelineno-9-250"></a>        <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-9-251"><a id="__codelineno-9-251" name="__codelineno-9-251"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-9-252"><a id="__codelineno-9-252" name="__codelineno-9-252"></a>            <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-9-253"><a id="__codelineno-9-253" name="__codelineno-9-253"></a>            <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-9-254"><a id="__codelineno-9-254" name="__codelineno-9-254"></a>        <span class="p">},</span>
</span><span id="__span-9-255"><a id="__codelineno-9-255" name="__codelineno-9-255"></a>    <span class="p">},</span>
</span><span id="__span-9-256"><a id="__codelineno-9-256" name="__codelineno-9-256"></a>    <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-9-257"><a id="__codelineno-9-257" name="__codelineno-9-257"></a>    <span class="n">output_expr</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-9-258"><a id="__codelineno-9-258" name="__codelineno-9-258"></a>        <span class="s2">"T_h"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"T_h"</span><span class="p">]</span> <span class="o">-</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_hin</span><span class="p">,</span>
</span><span id="__span-9-259"><a id="__codelineno-9-259" name="__codelineno-9-259"></a>        <span class="s2">"T_c"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"T_c"</span><span class="p">]</span> <span class="o">-</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_cin</span><span class="p">,</span>
</span><span id="__span-9-260"><a id="__codelineno-9-260" name="__codelineno-9-260"></a>        <span class="s2">"T_w"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"T_w"</span><span class="p">]</span> <span class="o">-</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_win</span><span class="p">,</span>
</span><span id="__span-9-261"><a id="__codelineno-9-261" name="__codelineno-9-261"></a>    <span class="p">},</span>
</span><span id="__span-9-262"><a id="__codelineno-9-262" name="__codelineno-9-262"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">"initial_sup"</span><span class="p">,</span>
</span><span id="__span-9-263"><a id="__codelineno-9-263" name="__codelineno-9-263"></a><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<p><code>SupervisedConstraint</code> 的第一个参数是监督约束的读取配置，其中 <code>“dataset”</code> 字段表示使用的训练数据集信息，各个字段分别表示：</p>
<ol>
<li><code>name</code>： 数据集类型，此处 <code>"NamedArrayDataset"</code> 表示分 batch 顺序读取数据；</li>
<li><code>input</code>： 输入变量名；</li>
<li><code>label</code>： 标签变量名；</li>
<li><code>weight</code>： 权重大小。</li>
</ol>
<p>"sampler" 字段定义了使用的 <code>Sampler</code> 类名为 <code>BatchSampler</code>，另外还指定了该类初始化时参数 <code>drop_last</code> 为 <code>False</code>、<code>shuffle</code> 为 <code>True</code>。</p>
<p>第二个参数是损失函数，此处我们选用常用的 MSE 函数，且 <code>reduction</code> 为 <code>"mean"</code>，即我们会将参与计算的所有数据点产生的损失项求和取平均；</p>
<p>第三个参数是约束条件的名字，我们需要给每一个约束条件命名，方便后续对其索引。</p>
<p>在微分方程约束和监督约束构建完毕之后，以我们刚才的命名为关键字，封装到一个字典中，方便后续访问。</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-264">264</a></span>
<span class="normal"><a href="#__codelineno-10-265">265</a></span>
<span class="normal"><a href="#__codelineno-10-266">266</a></span>
<span class="normal"><a href="#__codelineno-10-267">267</a></span>
<span class="normal"><a href="#__codelineno-10-268">268</a></span>
<span class="normal"><a href="#__codelineno-10-269">269</a></span>
<span class="normal"><a href="#__codelineno-10-270">270</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-264"><a id="__codelineno-10-264" name="__codelineno-10-264"></a><span class="c1"># wrap constraints together</span>
</span><span id="__span-10-265"><a id="__codelineno-10-265" name="__codelineno-10-265"></a><span class="n">constraint</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-10-266"><a id="__codelineno-10-266" name="__codelineno-10-266"></a>    <span class="n">left_sup_constraint</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">left_sup_constraint</span><span class="p">,</span>
</span><span id="__span-10-267"><a id="__codelineno-10-267" name="__codelineno-10-267"></a>    <span class="n">right_sup_constraint</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">right_sup_constraint</span><span class="p">,</span>
</span><span id="__span-10-268"><a id="__codelineno-10-268" name="__codelineno-10-268"></a>    <span class="n">interior_sup_constraint</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">interior_sup_constraint</span><span class="p">,</span>
</span><span id="__span-10-269"><a id="__codelineno-10-269" name="__codelineno-10-269"></a>    <span class="n">initial_sup_constraint</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">initial_sup_constraint</span><span class="p">,</span>
</span><span id="__span-10-270"><a id="__codelineno-10-270" name="__codelineno-10-270"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="36">3.6 优化器构建<a class="headerlink" href="#36" title="Permanent link">¶</a></h3>
<p>接下来我们需要指定学习率，学习率设为 0.001，训练过程会调用优化器来更新模型参数，此处选择较为常用的 <code>Adam</code> 优化器。</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-272">272</a></span>
<span class="normal"><a href="#__codelineno-11-273">273</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-272"><a id="__codelineno-11-272" name="__codelineno-11-272"></a><span class="c1"># set optimizer</span>
</span><span id="__span-11-273"><a id="__codelineno-11-273" name="__codelineno-11-273"></a><span class="n">optimizer</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">learning_rate</span><span class="p">)(</span><span class="n">model</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="37">3.7 评估器构建<a class="headerlink" href="#37" title="Permanent link">¶</a></h3>
<p>在训练过程中通常会按一定轮数间隔，用验证集（测试集）评估当前模型的训练情况，我们使用 <code>ppsci.validate.SupervisedValidator</code> 构建评估器。</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-275">275</a></span>
<span class="normal"><a href="#__codelineno-12-276">276</a></span>
<span class="normal"><a href="#__codelineno-12-277">277</a></span>
<span class="normal"><a href="#__codelineno-12-278">278</a></span>
<span class="normal"><a href="#__codelineno-12-279">279</a></span>
<span class="normal"><a href="#__codelineno-12-280">280</a></span>
<span class="normal"><a href="#__codelineno-12-281">281</a></span>
<span class="normal"><a href="#__codelineno-12-282">282</a></span>
<span class="normal"><a href="#__codelineno-12-283">283</a></span>
<span class="normal"><a href="#__codelineno-12-284">284</a></span>
<span class="normal"><a href="#__codelineno-12-285">285</a></span>
<span class="normal"><a href="#__codelineno-12-286">286</a></span>
<span class="normal"><a href="#__codelineno-12-287">287</a></span>
<span class="normal"><a href="#__codelineno-12-288">288</a></span>
<span class="normal"><a href="#__codelineno-12-289">289</a></span>
<span class="normal"><a href="#__codelineno-12-290">290</a></span>
<span class="normal"><a href="#__codelineno-12-291">291</a></span>
<span class="normal"><a href="#__codelineno-12-292">292</a></span>
<span class="normal"><a href="#__codelineno-12-293">293</a></span>
<span class="normal"><a href="#__codelineno-12-294">294</a></span>
<span class="normal"><a href="#__codelineno-12-295">295</a></span>
<span class="normal"><a href="#__codelineno-12-296">296</a></span>
<span class="normal"><a href="#__codelineno-12-297">297</a></span>
<span class="normal"><a href="#__codelineno-12-298">298</a></span>
<span class="normal"><a href="#__codelineno-12-299">299</a></span>
<span class="normal"><a href="#__codelineno-12-300">300</a></span>
<span class="normal"><a href="#__codelineno-12-301">301</a></span>
<span class="normal"><a href="#__codelineno-12-302">302</a></span>
<span class="normal"><a href="#__codelineno-12-303">303</a></span>
<span class="normal"><a href="#__codelineno-12-304">304</a></span>
<span class="normal"><a href="#__codelineno-12-305">305</a></span>
<span class="normal"><a href="#__codelineno-12-306">306</a></span>
<span class="normal"><a href="#__codelineno-12-307">307</a></span>
<span class="normal"><a href="#__codelineno-12-308">308</a></span>
<span class="normal"><a href="#__codelineno-12-309">309</a></span>
<span class="normal"><a href="#__codelineno-12-310">310</a></span>
<span class="normal"><a href="#__codelineno-12-311">311</a></span>
<span class="normal"><a href="#__codelineno-12-312">312</a></span>
<span class="normal"><a href="#__codelineno-12-313">313</a></span>
<span class="normal"><a href="#__codelineno-12-314">314</a></span>
<span class="normal"><a href="#__codelineno-12-315">315</a></span>
<span class="normal"><a href="#__codelineno-12-316">316</a></span>
<span class="normal"><a href="#__codelineno-12-317">317</a></span>
<span class="normal"><a href="#__codelineno-12-318">318</a></span>
<span class="normal"><a href="#__codelineno-12-319">319</a></span>
<span class="normal"><a href="#__codelineno-12-320">320</a></span>
<span class="normal"><a href="#__codelineno-12-321">321</a></span>
<span class="normal"><a href="#__codelineno-12-322">322</a></span>
<span class="normal"><a href="#__codelineno-12-323">323</a></span>
<span class="normal"><a href="#__codelineno-12-324">324</a></span>
<span class="normal"><a href="#__codelineno-12-325">325</a></span>
<span class="normal"><a href="#__codelineno-12-326">326</a></span>
<span class="normal"><a href="#__codelineno-12-327">327</a></span>
<span class="normal"><a href="#__codelineno-12-328">328</a></span>
<span class="normal"><a href="#__codelineno-12-329">329</a></span>
<span class="normal"><a href="#__codelineno-12-330">330</a></span>
<span class="normal"><a href="#__codelineno-12-331">331</a></span>
<span class="normal"><a href="#__codelineno-12-332">332</a></span>
<span class="normal"><a href="#__codelineno-12-333">333</a></span>
<span class="normal"><a href="#__codelineno-12-334">334</a></span>
<span class="normal"><a href="#__codelineno-12-335">335</a></span>
<span class="normal"><a href="#__codelineno-12-336">336</a></span>
<span class="normal"><a href="#__codelineno-12-337">337</a></span>
<span class="normal"><a href="#__codelineno-12-338">338</a></span>
<span class="normal"><a href="#__codelineno-12-339">339</a></span>
<span class="normal"><a href="#__codelineno-12-340">340</a></span>
<span class="normal"><a href="#__codelineno-12-341">341</a></span>
<span class="normal"><a href="#__codelineno-12-342">342</a></span>
<span class="normal"><a href="#__codelineno-12-343">343</a></span>
<span class="normal"><a href="#__codelineno-12-344">344</a></span>
<span class="normal"><a href="#__codelineno-12-345">345</a></span>
<span class="normal"><a href="#__codelineno-12-346">346</a></span>
<span class="normal"><a href="#__codelineno-12-347">347</a></span>
<span class="normal"><a href="#__codelineno-12-348">348</a></span>
<span class="normal"><a href="#__codelineno-12-349">349</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-275"><a id="__codelineno-12-275" name="__codelineno-12-275"></a><span class="c1"># set validator</span>
</span><span id="__span-12-276"><a id="__codelineno-12-276" name="__codelineno-12-276"></a><span class="n">test_bc_label</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-12-277"><a id="__codelineno-12-277" name="__codelineno-12-277"></a>    <span class="s2">"T_h"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">test_left_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-12-278"><a id="__codelineno-12-278" name="__codelineno-12-278"></a><span class="p">}</span>
</span><span id="__span-12-279"><a id="__codelineno-12-279" name="__codelineno-12-279"></a><span class="n">test_interior_label</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-12-280"><a id="__codelineno-12-280" name="__codelineno-12-280"></a>    <span class="s2">"heat_boundary"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="__span-12-281"><a id="__codelineno-12-281" name="__codelineno-12-281"></a>        <span class="p">[</span><span class="n">test_interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span>
</span><span id="__span-12-282"><a id="__codelineno-12-282" name="__codelineno-12-282"></a>    <span class="p">),</span>
</span><span id="__span-12-283"><a id="__codelineno-12-283" name="__codelineno-12-283"></a>    <span class="s2">"cold_boundary"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="__span-12-284"><a id="__codelineno-12-284" name="__codelineno-12-284"></a>        <span class="p">[</span><span class="n">test_interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span>
</span><span id="__span-12-285"><a id="__codelineno-12-285" name="__codelineno-12-285"></a>    <span class="p">),</span>
</span><span id="__span-12-286"><a id="__codelineno-12-286" name="__codelineno-12-286"></a>    <span class="s2">"wall"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">test_interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-12-287"><a id="__codelineno-12-287" name="__codelineno-12-287"></a><span class="p">}</span>
</span><span id="__span-12-288"><a id="__codelineno-12-288" name="__codelineno-12-288"></a><span class="n">left_validator</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">SupervisedValidator</span><span class="p">(</span>
</span><span id="__span-12-289"><a id="__codelineno-12-289" name="__codelineno-12-289"></a>    <span class="p">{</span>
</span><span id="__span-12-290"><a id="__codelineno-12-290" name="__codelineno-12-290"></a>        <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-12-291"><a id="__codelineno-12-291" name="__codelineno-12-291"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"NamedArrayDataset"</span><span class="p">,</span>
</span><span id="__span-12-292"><a id="__codelineno-12-292" name="__codelineno-12-292"></a>            <span class="s2">"input"</span><span class="p">:</span> <span class="n">test_left_data</span><span class="p">,</span>
</span><span id="__span-12-293"><a id="__codelineno-12-293" name="__codelineno-12-293"></a>            <span class="s2">"label"</span><span class="p">:</span> <span class="n">test_bc_label</span><span class="p">,</span>
</span><span id="__span-12-294"><a id="__codelineno-12-294" name="__codelineno-12-294"></a>        <span class="p">},</span>
</span><span id="__span-12-295"><a id="__codelineno-12-295" name="__codelineno-12-295"></a>        <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span>
</span><span id="__span-12-296"><a id="__codelineno-12-296" name="__codelineno-12-296"></a>        <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-12-297"><a id="__codelineno-12-297" name="__codelineno-12-297"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-12-298"><a id="__codelineno-12-298" name="__codelineno-12-298"></a>            <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-12-299"><a id="__codelineno-12-299" name="__codelineno-12-299"></a>            <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-12-300"><a id="__codelineno-12-300" name="__codelineno-12-300"></a>        <span class="p">},</span>
</span><span id="__span-12-301"><a id="__codelineno-12-301" name="__codelineno-12-301"></a>    <span class="p">},</span>
</span><span id="__span-12-302"><a id="__codelineno-12-302" name="__codelineno-12-302"></a>    <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-12-303"><a id="__codelineno-12-303" name="__codelineno-12-303"></a>    <span class="n">output_expr</span><span class="o">=</span><span class="p">{</span><span class="s2">"T_h"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"T_h"</span><span class="p">]</span> <span class="o">-</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_hin</span><span class="p">},</span>
</span><span id="__span-12-304"><a id="__codelineno-12-304" name="__codelineno-12-304"></a>    <span class="n">metric</span><span class="o">=</span><span class="p">{</span><span class="s2">"MSE"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">MSE</span><span class="p">()},</span>
</span><span id="__span-12-305"><a id="__codelineno-12-305" name="__codelineno-12-305"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">"left_mse"</span><span class="p">,</span>
</span><span id="__span-12-306"><a id="__codelineno-12-306" name="__codelineno-12-306"></a><span class="p">)</span>
</span><span id="__span-12-307"><a id="__codelineno-12-307" name="__codelineno-12-307"></a><span class="n">right_validator</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">SupervisedValidator</span><span class="p">(</span>
</span><span id="__span-12-308"><a id="__codelineno-12-308" name="__codelineno-12-308"></a>    <span class="p">{</span>
</span><span id="__span-12-309"><a id="__codelineno-12-309" name="__codelineno-12-309"></a>        <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-12-310"><a id="__codelineno-12-310" name="__codelineno-12-310"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"NamedArrayDataset"</span><span class="p">,</span>
</span><span id="__span-12-311"><a id="__codelineno-12-311" name="__codelineno-12-311"></a>            <span class="s2">"input"</span><span class="p">:</span> <span class="n">test_right_data</span><span class="p">,</span>
</span><span id="__span-12-312"><a id="__codelineno-12-312" name="__codelineno-12-312"></a>            <span class="s2">"label"</span><span class="p">:</span> <span class="n">test_bc_label</span><span class="p">,</span>
</span><span id="__span-12-313"><a id="__codelineno-12-313" name="__codelineno-12-313"></a>        <span class="p">},</span>
</span><span id="__span-12-314"><a id="__codelineno-12-314" name="__codelineno-12-314"></a>        <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span>
</span><span id="__span-12-315"><a id="__codelineno-12-315" name="__codelineno-12-315"></a>        <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-12-316"><a id="__codelineno-12-316" name="__codelineno-12-316"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-12-317"><a id="__codelineno-12-317" name="__codelineno-12-317"></a>            <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-12-318"><a id="__codelineno-12-318" name="__codelineno-12-318"></a>            <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-12-319"><a id="__codelineno-12-319" name="__codelineno-12-319"></a>        <span class="p">},</span>
</span><span id="__span-12-320"><a id="__codelineno-12-320" name="__codelineno-12-320"></a>    <span class="p">},</span>
</span><span id="__span-12-321"><a id="__codelineno-12-321" name="__codelineno-12-321"></a>    <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-12-322"><a id="__codelineno-12-322" name="__codelineno-12-322"></a>    <span class="n">output_expr</span><span class="o">=</span><span class="p">{</span><span class="s2">"T_h"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"T_c"</span><span class="p">]</span> <span class="o">-</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_cin</span><span class="p">},</span>
</span><span id="__span-12-323"><a id="__codelineno-12-323" name="__codelineno-12-323"></a>    <span class="n">metric</span><span class="o">=</span><span class="p">{</span><span class="s2">"MSE"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">MSE</span><span class="p">()},</span>
</span><span id="__span-12-324"><a id="__codelineno-12-324" name="__codelineno-12-324"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">"right_mse"</span><span class="p">,</span>
</span><span id="__span-12-325"><a id="__codelineno-12-325" name="__codelineno-12-325"></a><span class="p">)</span>
</span><span id="__span-12-326"><a id="__codelineno-12-326" name="__codelineno-12-326"></a><span class="n">interior_validator</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">SupervisedValidator</span><span class="p">(</span>
</span><span id="__span-12-327"><a id="__codelineno-12-327" name="__codelineno-12-327"></a>    <span class="p">{</span>
</span><span id="__span-12-328"><a id="__codelineno-12-328" name="__codelineno-12-328"></a>        <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-12-329"><a id="__codelineno-12-329" name="__codelineno-12-329"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"NamedArrayDataset"</span><span class="p">,</span>
</span><span id="__span-12-330"><a id="__codelineno-12-330" name="__codelineno-12-330"></a>            <span class="s2">"input"</span><span class="p">:</span> <span class="n">test_interior_data</span><span class="p">,</span>
</span><span id="__span-12-331"><a id="__codelineno-12-331" name="__codelineno-12-331"></a>            <span class="s2">"label"</span><span class="p">:</span> <span class="n">test_interior_label</span><span class="p">,</span>
</span><span id="__span-12-332"><a id="__codelineno-12-332" name="__codelineno-12-332"></a>        <span class="p">},</span>
</span><span id="__span-12-333"><a id="__codelineno-12-333" name="__codelineno-12-333"></a>        <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span>
</span><span id="__span-12-334"><a id="__codelineno-12-334" name="__codelineno-12-334"></a>        <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-12-335"><a id="__codelineno-12-335" name="__codelineno-12-335"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-12-336"><a id="__codelineno-12-336" name="__codelineno-12-336"></a>            <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-12-337"><a id="__codelineno-12-337" name="__codelineno-12-337"></a>            <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-12-338"><a id="__codelineno-12-338" name="__codelineno-12-338"></a>        <span class="p">},</span>
</span><span id="__span-12-339"><a id="__codelineno-12-339" name="__codelineno-12-339"></a>    <span class="p">},</span>
</span><span id="__span-12-340"><a id="__codelineno-12-340" name="__codelineno-12-340"></a>    <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-12-341"><a id="__codelineno-12-341" name="__codelineno-12-341"></a>    <span class="n">output_expr</span><span class="o">=</span><span class="n">equation</span><span class="p">[</span><span class="s2">"heat_exchanger"</span><span class="p">]</span><span class="o">.</span><span class="n">equations</span><span class="p">,</span>
</span><span id="__span-12-342"><a id="__codelineno-12-342" name="__codelineno-12-342"></a>    <span class="n">metric</span><span class="o">=</span><span class="p">{</span><span class="s2">"MSE"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">MSE</span><span class="p">()},</span>
</span><span id="__span-12-343"><a id="__codelineno-12-343" name="__codelineno-12-343"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">"interior_mse"</span><span class="p">,</span>
</span><span id="__span-12-344"><a id="__codelineno-12-344" name="__codelineno-12-344"></a><span class="p">)</span>
</span><span id="__span-12-345"><a id="__codelineno-12-345" name="__codelineno-12-345"></a><span class="n">validator</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-12-346"><a id="__codelineno-12-346" name="__codelineno-12-346"></a>    <span class="n">left_validator</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">left_validator</span><span class="p">,</span>
</span><span id="__span-12-347"><a id="__codelineno-12-347" name="__codelineno-12-347"></a>    <span class="n">right_validator</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">right_validator</span><span class="p">,</span>
</span><span id="__span-12-348"><a id="__codelineno-12-348" name="__codelineno-12-348"></a>    <span class="n">interior_validator</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">interior_validator</span><span class="p">,</span>
</span><span id="__span-12-349"><a id="__codelineno-12-349" name="__codelineno-12-349"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<p>配置与 <a href="#35">3.5 约束构建</a> 的设置类似。</p>
<h3 id="38">3.8 模型训练<a class="headerlink" href="#38" title="Permanent link">¶</a></h3>
<p>完成上述设置之后，只需要将上述实例化的对象按顺序传递给 <code>ppsci.solver.Solver</code>，然后启动训练、评估。</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-351">351</a></span>
<span class="normal"><a href="#__codelineno-13-352">352</a></span>
<span class="normal"><a href="#__codelineno-13-353">353</a></span>
<span class="normal"><a href="#__codelineno-13-354">354</a></span>
<span class="normal"><a href="#__codelineno-13-355">355</a></span>
<span class="normal"><a href="#__codelineno-13-356">356</a></span>
<span class="normal"><a href="#__codelineno-13-357">357</a></span>
<span class="normal"><a href="#__codelineno-13-358">358</a></span>
<span class="normal"><a href="#__codelineno-13-359">359</a></span>
<span class="normal"><a href="#__codelineno-13-360">360</a></span>
<span class="normal"><a href="#__codelineno-13-361">361</a></span>
<span class="normal"><a href="#__codelineno-13-362">362</a></span>
<span class="normal"><a href="#__codelineno-13-363">363</a></span>
<span class="normal"><a href="#__codelineno-13-364">364</a></span>
<span class="normal"><a href="#__codelineno-13-365">365</a></span>
<span class="normal"><a href="#__codelineno-13-366">366</a></span>
<span class="normal"><a href="#__codelineno-13-367">367</a></span>
<span class="normal"><a href="#__codelineno-13-368">368</a></span>
<span class="normal"><a href="#__codelineno-13-369">369</a></span>
<span class="normal"><a href="#__codelineno-13-370">370</a></span>
<span class="normal"><a href="#__codelineno-13-371">371</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-13-351"><a id="__codelineno-13-351" name="__codelineno-13-351"></a><span class="c1"># initialize solver</span>
</span><span id="__span-13-352"><a id="__codelineno-13-352" name="__codelineno-13-352"></a><span class="n">solver</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">Solver</span><span class="p">(</span>
</span><span id="__span-13-353"><a id="__codelineno-13-353" name="__codelineno-13-353"></a>    <span class="n">model</span><span class="p">,</span>
</span><span id="__span-13-354"><a id="__codelineno-13-354" name="__codelineno-13-354"></a>    <span class="n">constraint</span><span class="p">,</span>
</span><span id="__span-13-355"><a id="__codelineno-13-355" name="__codelineno-13-355"></a>    <span class="n">cfg</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span>
</span><span id="__span-13-356"><a id="__codelineno-13-356" name="__codelineno-13-356"></a>    <span class="n">optimizer</span><span class="p">,</span>
</span><span id="__span-13-357"><a id="__codelineno-13-357" name="__codelineno-13-357"></a>    <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-13-358"><a id="__codelineno-13-358" name="__codelineno-13-358"></a>    <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span>
</span><span id="__span-13-359"><a id="__codelineno-13-359" name="__codelineno-13-359"></a>    <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">iters_per_epoch</span><span class="p">,</span>
</span><span id="__span-13-360"><a id="__codelineno-13-360" name="__codelineno-13-360"></a>    <span class="n">eval_during_train</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">eval_during_train</span><span class="p">,</span>
</span><span id="__span-13-361"><a id="__codelineno-13-361" name="__codelineno-13-361"></a>    <span class="n">eval_freq</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">eval_freq</span><span class="p">,</span>
</span><span id="__span-13-362"><a id="__codelineno-13-362" name="__codelineno-13-362"></a>    <span class="n">equation</span><span class="o">=</span><span class="n">equation</span><span class="p">,</span>
</span><span id="__span-13-363"><a id="__codelineno-13-363" name="__codelineno-13-363"></a>    <span class="n">geom</span><span class="o">=</span><span class="n">geom</span><span class="p">,</span>
</span><span id="__span-13-364"><a id="__codelineno-13-364" name="__codelineno-13-364"></a>    <span class="n">validator</span><span class="o">=</span><span class="n">validator</span><span class="p">,</span>
</span><span id="__span-13-365"><a id="__codelineno-13-365" name="__codelineno-13-365"></a><span class="p">)</span>
</span><span id="__span-13-366"><a id="__codelineno-13-366" name="__codelineno-13-366"></a><span class="c1"># train model</span>
</span><span id="__span-13-367"><a id="__codelineno-13-367" name="__codelineno-13-367"></a><span class="n">solver</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span><span id="__span-13-368"><a id="__codelineno-13-368" name="__codelineno-13-368"></a><span class="c1"># evaluate after finished training</span>
</span><span id="__span-13-369"><a id="__codelineno-13-369" name="__codelineno-13-369"></a><span class="n">solver</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span><span id="__span-13-370"><a id="__codelineno-13-370" name="__codelineno-13-370"></a><span class="c1"># plotting iteration/epoch-loss curve.</span>
</span><span id="__span-13-371"><a id="__codelineno-13-371" name="__codelineno-13-371"></a><span class="n">solver</span><span class="o">.</span><span class="n">plot_loss_history</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="39">3.9 结果可视化<a class="headerlink" href="#39" title="Permanent link">¶</a></h3>
<p>最后在给定的可视化区域上进行预测并可视化，设冷边和热边的质量流量均为1，可视化数据是区域内的一维点集，每个时刻 <span class="arithmatex">\(t\)</span> 对应的坐标是 <span class="arithmatex">\(x^i\)</span>，对应值是 <span class="arithmatex">\((T_h^{i}, T_c^i, T_w^i)\)</span>，在此我们画出 <span class="arithmatex">\(T_h,T_c,T_w\)</span> 随时间的变化图像。同时根据换热器效率的公式计算出换热器效率 <span class="arithmatex">\(\eta\)</span> ，画出换热器效率 <span class="arithmatex">\(\eta\)</span> 随时间的变化图像，代码如下：</p>
<div class="language-py highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-373">373</a></span>
<span class="normal"><a href="#__codelineno-14-374">374</a></span>
<span class="normal"><a href="#__codelineno-14-375">375</a></span>
<span class="normal"><a href="#__codelineno-14-376">376</a></span>
<span class="normal"><a href="#__codelineno-14-377">377</a></span>
<span class="normal"><a href="#__codelineno-14-378">378</a></span>
<span class="normal"><a href="#__codelineno-14-379">379</a></span>
<span class="normal"><a href="#__codelineno-14-380">380</a></span>
<span class="normal"><a href="#__codelineno-14-381">381</a></span>
<span class="normal"><a href="#__codelineno-14-382">382</a></span>
<span class="normal"><a href="#__codelineno-14-383">383</a></span>
<span class="normal"><a href="#__codelineno-14-384">384</a></span>
<span class="normal"><a href="#__codelineno-14-385">385</a></span>
<span class="normal"><a href="#__codelineno-14-386">386</a></span>
<span class="normal"><a href="#__codelineno-14-387">387</a></span>
<span class="normal"><a href="#__codelineno-14-388">388</a></span>
<span class="normal"><a href="#__codelineno-14-389">389</a></span>
<span class="normal"><a href="#__codelineno-14-390">390</a></span>
<span class="normal"><a href="#__codelineno-14-391">391</a></span>
<span class="normal"><a href="#__codelineno-14-392">392</a></span>
<span class="normal"><a href="#__codelineno-14-393">393</a></span>
<span class="normal"><a href="#__codelineno-14-394">394</a></span>
<span class="normal"><a href="#__codelineno-14-395">395</a></span>
<span class="normal"><a href="#__codelineno-14-396">396</a></span>
<span class="normal"><a href="#__codelineno-14-397">397</a></span>
<span class="normal"><a href="#__codelineno-14-398">398</a></span>
<span class="normal"><a href="#__codelineno-14-399">399</a></span>
<span class="normal"><a href="#__codelineno-14-400">400</a></span>
<span class="normal"><a href="#__codelineno-14-401">401</a></span>
<span class="normal"><a href="#__codelineno-14-402">402</a></span>
<span class="normal"><a href="#__codelineno-14-403">403</a></span>
<span class="normal"><a href="#__codelineno-14-404">404</a></span>
<span class="normal"><a href="#__codelineno-14-405">405</a></span>
<span class="normal"><a href="#__codelineno-14-406">406</a></span>
<span class="normal"><a href="#__codelineno-14-407">407</a></span>
<span class="normal"><a href="#__codelineno-14-408">408</a></span>
<span class="normal"><a href="#__codelineno-14-409">409</a></span>
<span class="normal"><a href="#__codelineno-14-410">410</a></span>
<span class="normal"><a href="#__codelineno-14-411">411</a></span>
<span class="normal"><a href="#__codelineno-14-412">412</a></span>
<span class="normal"><a href="#__codelineno-14-413">413</a></span>
<span class="normal"><a href="#__codelineno-14-414">414</a></span>
<span class="normal"><a href="#__codelineno-14-415">415</a></span>
<span class="normal"><a href="#__codelineno-14-416">416</a></span>
<span class="normal"><a href="#__codelineno-14-417">417</a></span>
<span class="normal"><a href="#__codelineno-14-418">418</a></span>
<span class="normal"><a href="#__codelineno-14-419">419</a></span>
<span class="normal"><a href="#__codelineno-14-420">420</a></span>
<span class="normal"><a href="#__codelineno-14-421">421</a></span>
<span class="normal"><a href="#__codelineno-14-422">422</a></span>
<span class="normal"><a href="#__codelineno-14-423">423</a></span>
<span class="normal"><a href="#__codelineno-14-424">424</a></span>
<span class="normal"><a href="#__codelineno-14-425">425</a></span>
<span class="normal"><a href="#__codelineno-14-426">426</a></span>
<span class="normal"><a href="#__codelineno-14-427">427</a></span>
<span class="normal"><a href="#__codelineno-14-428">428</a></span>
<span class="normal"><a href="#__codelineno-14-429">429</a></span>
<span class="normal"><a href="#__codelineno-14-430">430</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-14-373"><a id="__codelineno-14-373" name="__codelineno-14-373"></a>    <span class="c1"># visualize prediction after finished training</span>
</span><span id="__span-14-374"><a id="__codelineno-14-374" name="__codelineno-14-374"></a>    <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">qm_h</span><span class="p">)</span>
</span><span id="__span-14-375"><a id="__codelineno-14-375" name="__codelineno-14-375"></a>    <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">qm_c</span><span class="p">)</span>
</span><span id="__span-14-376"><a id="__codelineno-14-376" name="__codelineno-14-376"></a>    <span class="n">pred</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">visu_input</span><span class="p">,</span> <span class="n">return_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-14-377"><a id="__codelineno-14-377" name="__codelineno-14-377"></a>    <span class="n">plot</span><span class="p">(</span><span class="n">visu_input</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-14-378"><a id="__codelineno-14-378" name="__codelineno-14-378"></a>
</span><span id="__span-14-379"><a id="__codelineno-14-379" name="__codelineno-14-379"></a>
</span><span id="__span-14-380"><a id="__codelineno-14-380" name="__codelineno-14-380"></a><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
</span><span id="__span-14-381"><a id="__codelineno-14-381" name="__codelineno-14-381"></a>    <span class="c1"># set random seed for reproducibility</span>
</span><span id="__span-14-382"><a id="__codelineno-14-382" name="__codelineno-14-382"></a>    <span class="n">ppsci</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">set_random_seed</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
</span><span id="__span-14-383"><a id="__codelineno-14-383" name="__codelineno-14-383"></a>    <span class="c1"># initialize logger</span>
</span><span id="__span-14-384"><a id="__codelineno-14-384" name="__codelineno-14-384"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">init_logger</span><span class="p">(</span><span class="s2">"ppsci"</span><span class="p">,</span> <span class="n">osp</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">mode</span><span class="si">}</span><span class="s2">.log"</span><span class="p">),</span> <span class="s2">"info"</span><span class="p">)</span>
</span><span id="__span-14-385"><a id="__codelineno-14-385" name="__codelineno-14-385"></a>
</span><span id="__span-14-386"><a id="__codelineno-14-386" name="__codelineno-14-386"></a>    <span class="c1"># set model</span>
</span><span id="__span-14-387"><a id="__codelineno-14-387" name="__codelineno-14-387"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">HEDeepONets</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="o">.</span><span class="n">MODEL</span><span class="p">)</span>
</span><span id="__span-14-388"><a id="__codelineno-14-388" name="__codelineno-14-388"></a>
</span><span id="__span-14-389"><a id="__codelineno-14-389" name="__codelineno-14-389"></a>    <span class="c1"># set time-geometry</span>
</span><span id="__span-14-390"><a id="__codelineno-14-390" name="__codelineno-14-390"></a>    <span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-14-391"><a id="__codelineno-14-391" name="__codelineno-14-391"></a>    <span class="n">geom</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-14-392"><a id="__codelineno-14-392" name="__codelineno-14-392"></a>        <span class="s2">"time_rect"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TimeXGeometry</span><span class="p">(</span>
</span><span id="__span-14-393"><a id="__codelineno-14-393" name="__codelineno-14-393"></a>            <span class="n">ppsci</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TimeDomain</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">timestamps</span><span class="o">=</span><span class="n">timestamps</span><span class="p">),</span>
</span><span id="__span-14-394"><a id="__codelineno-14-394" name="__codelineno-14-394"></a>            <span class="n">ppsci</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Interval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">DL</span><span class="p">),</span>
</span><span id="__span-14-395"><a id="__codelineno-14-395" name="__codelineno-14-395"></a>        <span class="p">)</span>
</span><span id="__span-14-396"><a id="__codelineno-14-396" name="__codelineno-14-396"></a>    <span class="p">}</span>
</span><span id="__span-14-397"><a id="__codelineno-14-397" name="__codelineno-14-397"></a>
</span><span id="__span-14-398"><a id="__codelineno-14-398" name="__codelineno-14-398"></a>    <span class="c1"># Generate eval data</span>
</span><span id="__span-14-399"><a id="__codelineno-14-399" name="__codelineno-14-399"></a>    <span class="n">visu_input</span> <span class="o">=</span> <span class="n">geom</span><span class="p">[</span><span class="s2">"time_rect"</span><span class="p">]</span><span class="o">.</span><span class="n">sample_interior</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span> <span class="n">evenly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-14-400"><a id="__codelineno-14-400" name="__codelineno-14-400"></a>    <span class="n">test_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"float32"</span><span class="p">)</span>
</span><span id="__span-14-401"><a id="__codelineno-14-401" name="__codelineno-14-401"></a>    <span class="n">test_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"float32"</span><span class="p">)</span>
</span><span id="__span-14-402"><a id="__codelineno-14-402" name="__codelineno-14-402"></a>    <span class="c1"># rearrange train data and eval data</span>
</span><span id="__span-14-403"><a id="__codelineno-14-403" name="__codelineno-14-403"></a>    <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">test_h</span><span class="p">,</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-14-404"><a id="__codelineno-14-404" name="__codelineno-14-404"></a>    <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">test_c</span><span class="p">,</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-14-405"><a id="__codelineno-14-405" name="__codelineno-14-405"></a>
</span><span id="__span-14-406"><a id="__codelineno-14-406" name="__codelineno-14-406"></a>    <span class="n">left_indices</span> <span class="o">=</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="__span-14-407"><a id="__codelineno-14-407" name="__codelineno-14-407"></a>    <span class="n">right_indices</span> <span class="o">=</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">==</span> <span class="n">cfg</span><span class="o">.</span><span class="n">DL</span>
</span><span id="__span-14-408"><a id="__codelineno-14-408" name="__codelineno-14-408"></a>    <span class="n">interior_indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">!=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">DL</span><span class="p">)</span>
</span><span id="__span-14-409"><a id="__codelineno-14-409" name="__codelineno-14-409"></a>    <span class="n">left_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">left_indices</span><span class="p">)</span>
</span><span id="__span-14-410"><a id="__codelineno-14-410" name="__codelineno-14-410"></a>    <span class="n">right_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">right_indices</span><span class="p">)</span>
</span><span id="__span-14-411"><a id="__codelineno-14-411" name="__codelineno-14-411"></a>    <span class="n">interior_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">interior_indices</span><span class="p">)</span>
</span><span id="__span-14-412"><a id="__codelineno-14-412" name="__codelineno-14-412"></a>
</span><span id="__span-14-413"><a id="__codelineno-14-413" name="__codelineno-14-413"></a>    <span class="c1"># Classification eval data</span>
</span><span id="__span-14-414"><a id="__codelineno-14-414" name="__codelineno-14-414"></a>    <span class="n">test_left_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-14-415"><a id="__codelineno-14-415" name="__codelineno-14-415"></a>        <span class="s2">"x"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">][</span><span class="n">left_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-14-416"><a id="__codelineno-14-416" name="__codelineno-14-416"></a>        <span class="s2">"t"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"t"</span><span class="p">][</span><span class="n">left_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-14-417"><a id="__codelineno-14-417" name="__codelineno-14-417"></a>        <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">][</span><span class="n">left_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-14-418"><a id="__codelineno-14-418" name="__codelineno-14-418"></a>        <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">][</span><span class="n">left_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-14-419"><a id="__codelineno-14-419" name="__codelineno-14-419"></a>    <span class="p">}</span>
</span><span id="__span-14-420"><a id="__codelineno-14-420" name="__codelineno-14-420"></a>    <span class="n">test_right_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-14-421"><a id="__codelineno-14-421" name="__codelineno-14-421"></a>        <span class="s2">"x"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">][</span><span class="n">right_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-14-422"><a id="__codelineno-14-422" name="__codelineno-14-422"></a>        <span class="s2">"t"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"t"</span><span class="p">][</span><span class="n">right_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-14-423"><a id="__codelineno-14-423" name="__codelineno-14-423"></a>        <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">][</span><span class="n">right_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-14-424"><a id="__codelineno-14-424" name="__codelineno-14-424"></a>        <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">][</span><span class="n">right_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-14-425"><a id="__codelineno-14-425" name="__codelineno-14-425"></a>    <span class="p">}</span>
</span><span id="__span-14-426"><a id="__codelineno-14-426" name="__codelineno-14-426"></a>    <span class="n">test_interior_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-14-427"><a id="__codelineno-14-427" name="__codelineno-14-427"></a>        <span class="s2">"x"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span>
</span><span id="__span-14-428"><a id="__codelineno-14-428" name="__codelineno-14-428"></a>        <span class="s2">"t"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span>
</span><span id="__span-14-429"><a id="__codelineno-14-429" name="__codelineno-14-429"></a>        <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">],</span>
</span><span id="__span-14-430"><a id="__codelineno-14-430" name="__codelineno-14-430"></a>        <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">],</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="4">4. 完整代码<a class="headerlink" href="#4" title="Permanent link">¶</a></h2>
<div class="language-py highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">heat_exchanger.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">  1</a></span>
<span class="normal"><a href="#__codelineno-15-2">  2</a></span>
<span class="normal"><a href="#__codelineno-15-3">  3</a></span>
<span class="normal"><a href="#__codelineno-15-4">  4</a></span>
<span class="normal"><a href="#__codelineno-15-5">  5</a></span>
<span class="normal"><a href="#__codelineno-15-6">  6</a></span>
<span class="normal"><a href="#__codelineno-15-7">  7</a></span>
<span class="normal"><a href="#__codelineno-15-8">  8</a></span>
<span class="normal"><a href="#__codelineno-15-9">  9</a></span>
<span class="normal"><a href="#__codelineno-15-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-15-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-15-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-15-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-15-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-15-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-15-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-15-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-15-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-15-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-15-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-15-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-15-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-15-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-15-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-15-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-15-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-15-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-15-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-15-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-15-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-15-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-15-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-15-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-15-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-15-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-15-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-15-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-15-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-15-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-15-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-15-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-15-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-15-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-15-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-15-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-15-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-15-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-15-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-15-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-15-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-15-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-15-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-15-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-15-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-15-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-15-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-15-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-15-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-15-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-15-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-15-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-15-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-15-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-15-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-15-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-15-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-15-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-15-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-15-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-15-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-15-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-15-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-15-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-15-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-15-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-15-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-15-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-15-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-15-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-15-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-15-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-15-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-15-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-15-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-15-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-15-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-15-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-15-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-15-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-15-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-15-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-15-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-15-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-15-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-15-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-15-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-15-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-15-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-15-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-15-100">100</a></span>
<span class="normal"><a href="#__codelineno-15-101">101</a></span>
<span class="normal"><a href="#__codelineno-15-102">102</a></span>
<span class="normal"><a href="#__codelineno-15-103">103</a></span>
<span class="normal"><a href="#__codelineno-15-104">104</a></span>
<span class="normal"><a href="#__codelineno-15-105">105</a></span>
<span class="normal"><a href="#__codelineno-15-106">106</a></span>
<span class="normal"><a href="#__codelineno-15-107">107</a></span>
<span class="normal"><a href="#__codelineno-15-108">108</a></span>
<span class="normal"><a href="#__codelineno-15-109">109</a></span>
<span class="normal"><a href="#__codelineno-15-110">110</a></span>
<span class="normal"><a href="#__codelineno-15-111">111</a></span>
<span class="normal"><a href="#__codelineno-15-112">112</a></span>
<span class="normal"><a href="#__codelineno-15-113">113</a></span>
<span class="normal"><a href="#__codelineno-15-114">114</a></span>
<span class="normal"><a href="#__codelineno-15-115">115</a></span>
<span class="normal"><a href="#__codelineno-15-116">116</a></span>
<span class="normal"><a href="#__codelineno-15-117">117</a></span>
<span class="normal"><a href="#__codelineno-15-118">118</a></span>
<span class="normal"><a href="#__codelineno-15-119">119</a></span>
<span class="normal"><a href="#__codelineno-15-120">120</a></span>
<span class="normal"><a href="#__codelineno-15-121">121</a></span>
<span class="normal"><a href="#__codelineno-15-122">122</a></span>
<span class="normal"><a href="#__codelineno-15-123">123</a></span>
<span class="normal"><a href="#__codelineno-15-124">124</a></span>
<span class="normal"><a href="#__codelineno-15-125">125</a></span>
<span class="normal"><a href="#__codelineno-15-126">126</a></span>
<span class="normal"><a href="#__codelineno-15-127">127</a></span>
<span class="normal"><a href="#__codelineno-15-128">128</a></span>
<span class="normal"><a href="#__codelineno-15-129">129</a></span>
<span class="normal"><a href="#__codelineno-15-130">130</a></span>
<span class="normal"><a href="#__codelineno-15-131">131</a></span>
<span class="normal"><a href="#__codelineno-15-132">132</a></span>
<span class="normal"><a href="#__codelineno-15-133">133</a></span>
<span class="normal"><a href="#__codelineno-15-134">134</a></span>
<span class="normal"><a href="#__codelineno-15-135">135</a></span>
<span class="normal"><a href="#__codelineno-15-136">136</a></span>
<span class="normal"><a href="#__codelineno-15-137">137</a></span>
<span class="normal"><a href="#__codelineno-15-138">138</a></span>
<span class="normal"><a href="#__codelineno-15-139">139</a></span>
<span class="normal"><a href="#__codelineno-15-140">140</a></span>
<span class="normal"><a href="#__codelineno-15-141">141</a></span>
<span class="normal"><a href="#__codelineno-15-142">142</a></span>
<span class="normal"><a href="#__codelineno-15-143">143</a></span>
<span class="normal"><a href="#__codelineno-15-144">144</a></span>
<span class="normal"><a href="#__codelineno-15-145">145</a></span>
<span class="normal"><a href="#__codelineno-15-146">146</a></span>
<span class="normal"><a href="#__codelineno-15-147">147</a></span>
<span class="normal"><a href="#__codelineno-15-148">148</a></span>
<span class="normal"><a href="#__codelineno-15-149">149</a></span>
<span class="normal"><a href="#__codelineno-15-150">150</a></span>
<span class="normal"><a href="#__codelineno-15-151">151</a></span>
<span class="normal"><a href="#__codelineno-15-152">152</a></span>
<span class="normal"><a href="#__codelineno-15-153">153</a></span>
<span class="normal"><a href="#__codelineno-15-154">154</a></span>
<span class="normal"><a href="#__codelineno-15-155">155</a></span>
<span class="normal"><a href="#__codelineno-15-156">156</a></span>
<span class="normal"><a href="#__codelineno-15-157">157</a></span>
<span class="normal"><a href="#__codelineno-15-158">158</a></span>
<span class="normal"><a href="#__codelineno-15-159">159</a></span>
<span class="normal"><a href="#__codelineno-15-160">160</a></span>
<span class="normal"><a href="#__codelineno-15-161">161</a></span>
<span class="normal"><a href="#__codelineno-15-162">162</a></span>
<span class="normal"><a href="#__codelineno-15-163">163</a></span>
<span class="normal"><a href="#__codelineno-15-164">164</a></span>
<span class="normal"><a href="#__codelineno-15-165">165</a></span>
<span class="normal"><a href="#__codelineno-15-166">166</a></span>
<span class="normal"><a href="#__codelineno-15-167">167</a></span>
<span class="normal"><a href="#__codelineno-15-168">168</a></span>
<span class="normal"><a href="#__codelineno-15-169">169</a></span>
<span class="normal"><a href="#__codelineno-15-170">170</a></span>
<span class="normal"><a href="#__codelineno-15-171">171</a></span>
<span class="normal"><a href="#__codelineno-15-172">172</a></span>
<span class="normal"><a href="#__codelineno-15-173">173</a></span>
<span class="normal"><a href="#__codelineno-15-174">174</a></span>
<span class="normal"><a href="#__codelineno-15-175">175</a></span>
<span class="normal"><a href="#__codelineno-15-176">176</a></span>
<span class="normal"><a href="#__codelineno-15-177">177</a></span>
<span class="normal"><a href="#__codelineno-15-178">178</a></span>
<span class="normal"><a href="#__codelineno-15-179">179</a></span>
<span class="normal"><a href="#__codelineno-15-180">180</a></span>
<span class="normal"><a href="#__codelineno-15-181">181</a></span>
<span class="normal"><a href="#__codelineno-15-182">182</a></span>
<span class="normal"><a href="#__codelineno-15-183">183</a></span>
<span class="normal"><a href="#__codelineno-15-184">184</a></span>
<span class="normal"><a href="#__codelineno-15-185">185</a></span>
<span class="normal"><a href="#__codelineno-15-186">186</a></span>
<span class="normal"><a href="#__codelineno-15-187">187</a></span>
<span class="normal"><a href="#__codelineno-15-188">188</a></span>
<span class="normal"><a href="#__codelineno-15-189">189</a></span>
<span class="normal"><a href="#__codelineno-15-190">190</a></span>
<span class="normal"><a href="#__codelineno-15-191">191</a></span>
<span class="normal"><a href="#__codelineno-15-192">192</a></span>
<span class="normal"><a href="#__codelineno-15-193">193</a></span>
<span class="normal"><a href="#__codelineno-15-194">194</a></span>
<span class="normal"><a href="#__codelineno-15-195">195</a></span>
<span class="normal"><a href="#__codelineno-15-196">196</a></span>
<span class="normal"><a href="#__codelineno-15-197">197</a></span>
<span class="normal"><a href="#__codelineno-15-198">198</a></span>
<span class="normal"><a href="#__codelineno-15-199">199</a></span>
<span class="normal"><a href="#__codelineno-15-200">200</a></span>
<span class="normal"><a href="#__codelineno-15-201">201</a></span>
<span class="normal"><a href="#__codelineno-15-202">202</a></span>
<span class="normal"><a href="#__codelineno-15-203">203</a></span>
<span class="normal"><a href="#__codelineno-15-204">204</a></span>
<span class="normal"><a href="#__codelineno-15-205">205</a></span>
<span class="normal"><a href="#__codelineno-15-206">206</a></span>
<span class="normal"><a href="#__codelineno-15-207">207</a></span>
<span class="normal"><a href="#__codelineno-15-208">208</a></span>
<span class="normal"><a href="#__codelineno-15-209">209</a></span>
<span class="normal"><a href="#__codelineno-15-210">210</a></span>
<span class="normal"><a href="#__codelineno-15-211">211</a></span>
<span class="normal"><a href="#__codelineno-15-212">212</a></span>
<span class="normal"><a href="#__codelineno-15-213">213</a></span>
<span class="normal"><a href="#__codelineno-15-214">214</a></span>
<span class="normal"><a href="#__codelineno-15-215">215</a></span>
<span class="normal"><a href="#__codelineno-15-216">216</a></span>
<span class="normal"><a href="#__codelineno-15-217">217</a></span>
<span class="normal"><a href="#__codelineno-15-218">218</a></span>
<span class="normal"><a href="#__codelineno-15-219">219</a></span>
<span class="normal"><a href="#__codelineno-15-220">220</a></span>
<span class="normal"><a href="#__codelineno-15-221">221</a></span>
<span class="normal"><a href="#__codelineno-15-222">222</a></span>
<span class="normal"><a href="#__codelineno-15-223">223</a></span>
<span class="normal"><a href="#__codelineno-15-224">224</a></span>
<span class="normal"><a href="#__codelineno-15-225">225</a></span>
<span class="normal"><a href="#__codelineno-15-226">226</a></span>
<span class="normal"><a href="#__codelineno-15-227">227</a></span>
<span class="normal"><a href="#__codelineno-15-228">228</a></span>
<span class="normal"><a href="#__codelineno-15-229">229</a></span>
<span class="normal"><a href="#__codelineno-15-230">230</a></span>
<span class="normal"><a href="#__codelineno-15-231">231</a></span>
<span class="normal"><a href="#__codelineno-15-232">232</a></span>
<span class="normal"><a href="#__codelineno-15-233">233</a></span>
<span class="normal"><a href="#__codelineno-15-234">234</a></span>
<span class="normal"><a href="#__codelineno-15-235">235</a></span>
<span class="normal"><a href="#__codelineno-15-236">236</a></span>
<span class="normal"><a href="#__codelineno-15-237">237</a></span>
<span class="normal"><a href="#__codelineno-15-238">238</a></span>
<span class="normal"><a href="#__codelineno-15-239">239</a></span>
<span class="normal"><a href="#__codelineno-15-240">240</a></span>
<span class="normal"><a href="#__codelineno-15-241">241</a></span>
<span class="normal"><a href="#__codelineno-15-242">242</a></span>
<span class="normal"><a href="#__codelineno-15-243">243</a></span>
<span class="normal"><a href="#__codelineno-15-244">244</a></span>
<span class="normal"><a href="#__codelineno-15-245">245</a></span>
<span class="normal"><a href="#__codelineno-15-246">246</a></span>
<span class="normal"><a href="#__codelineno-15-247">247</a></span>
<span class="normal"><a href="#__codelineno-15-248">248</a></span>
<span class="normal"><a href="#__codelineno-15-249">249</a></span>
<span class="normal"><a href="#__codelineno-15-250">250</a></span>
<span class="normal"><a href="#__codelineno-15-251">251</a></span>
<span class="normal"><a href="#__codelineno-15-252">252</a></span>
<span class="normal"><a href="#__codelineno-15-253">253</a></span>
<span class="normal"><a href="#__codelineno-15-254">254</a></span>
<span class="normal"><a href="#__codelineno-15-255">255</a></span>
<span class="normal"><a href="#__codelineno-15-256">256</a></span>
<span class="normal"><a href="#__codelineno-15-257">257</a></span>
<span class="normal"><a href="#__codelineno-15-258">258</a></span>
<span class="normal"><a href="#__codelineno-15-259">259</a></span>
<span class="normal"><a href="#__codelineno-15-260">260</a></span>
<span class="normal"><a href="#__codelineno-15-261">261</a></span>
<span class="normal"><a href="#__codelineno-15-262">262</a></span>
<span class="normal"><a href="#__codelineno-15-263">263</a></span>
<span class="normal"><a href="#__codelineno-15-264">264</a></span>
<span class="normal"><a href="#__codelineno-15-265">265</a></span>
<span class="normal"><a href="#__codelineno-15-266">266</a></span>
<span class="normal"><a href="#__codelineno-15-267">267</a></span>
<span class="normal"><a href="#__codelineno-15-268">268</a></span>
<span class="normal"><a href="#__codelineno-15-269">269</a></span>
<span class="normal"><a href="#__codelineno-15-270">270</a></span>
<span class="normal"><a href="#__codelineno-15-271">271</a></span>
<span class="normal"><a href="#__codelineno-15-272">272</a></span>
<span class="normal"><a href="#__codelineno-15-273">273</a></span>
<span class="normal"><a href="#__codelineno-15-274">274</a></span>
<span class="normal"><a href="#__codelineno-15-275">275</a></span>
<span class="normal"><a href="#__codelineno-15-276">276</a></span>
<span class="normal"><a href="#__codelineno-15-277">277</a></span>
<span class="normal"><a href="#__codelineno-15-278">278</a></span>
<span class="normal"><a href="#__codelineno-15-279">279</a></span>
<span class="normal"><a href="#__codelineno-15-280">280</a></span>
<span class="normal"><a href="#__codelineno-15-281">281</a></span>
<span class="normal"><a href="#__codelineno-15-282">282</a></span>
<span class="normal"><a href="#__codelineno-15-283">283</a></span>
<span class="normal"><a href="#__codelineno-15-284">284</a></span>
<span class="normal"><a href="#__codelineno-15-285">285</a></span>
<span class="normal"><a href="#__codelineno-15-286">286</a></span>
<span class="normal"><a href="#__codelineno-15-287">287</a></span>
<span class="normal"><a href="#__codelineno-15-288">288</a></span>
<span class="normal"><a href="#__codelineno-15-289">289</a></span>
<span class="normal"><a href="#__codelineno-15-290">290</a></span>
<span class="normal"><a href="#__codelineno-15-291">291</a></span>
<span class="normal"><a href="#__codelineno-15-292">292</a></span>
<span class="normal"><a href="#__codelineno-15-293">293</a></span>
<span class="normal"><a href="#__codelineno-15-294">294</a></span>
<span class="normal"><a href="#__codelineno-15-295">295</a></span>
<span class="normal"><a href="#__codelineno-15-296">296</a></span>
<span class="normal"><a href="#__codelineno-15-297">297</a></span>
<span class="normal"><a href="#__codelineno-15-298">298</a></span>
<span class="normal"><a href="#__codelineno-15-299">299</a></span>
<span class="normal"><a href="#__codelineno-15-300">300</a></span>
<span class="normal"><a href="#__codelineno-15-301">301</a></span>
<span class="normal"><a href="#__codelineno-15-302">302</a></span>
<span class="normal"><a href="#__codelineno-15-303">303</a></span>
<span class="normal"><a href="#__codelineno-15-304">304</a></span>
<span class="normal"><a href="#__codelineno-15-305">305</a></span>
<span class="normal"><a href="#__codelineno-15-306">306</a></span>
<span class="normal"><a href="#__codelineno-15-307">307</a></span>
<span class="normal"><a href="#__codelineno-15-308">308</a></span>
<span class="normal"><a href="#__codelineno-15-309">309</a></span>
<span class="normal"><a href="#__codelineno-15-310">310</a></span>
<span class="normal"><a href="#__codelineno-15-311">311</a></span>
<span class="normal"><a href="#__codelineno-15-312">312</a></span>
<span class="normal"><a href="#__codelineno-15-313">313</a></span>
<span class="normal"><a href="#__codelineno-15-314">314</a></span>
<span class="normal"><a href="#__codelineno-15-315">315</a></span>
<span class="normal"><a href="#__codelineno-15-316">316</a></span>
<span class="normal"><a href="#__codelineno-15-317">317</a></span>
<span class="normal"><a href="#__codelineno-15-318">318</a></span>
<span class="normal"><a href="#__codelineno-15-319">319</a></span>
<span class="normal"><a href="#__codelineno-15-320">320</a></span>
<span class="normal"><a href="#__codelineno-15-321">321</a></span>
<span class="normal"><a href="#__codelineno-15-322">322</a></span>
<span class="normal"><a href="#__codelineno-15-323">323</a></span>
<span class="normal"><a href="#__codelineno-15-324">324</a></span>
<span class="normal"><a href="#__codelineno-15-325">325</a></span>
<span class="normal"><a href="#__codelineno-15-326">326</a></span>
<span class="normal"><a href="#__codelineno-15-327">327</a></span>
<span class="normal"><a href="#__codelineno-15-328">328</a></span>
<span class="normal"><a href="#__codelineno-15-329">329</a></span>
<span class="normal"><a href="#__codelineno-15-330">330</a></span>
<span class="normal"><a href="#__codelineno-15-331">331</a></span>
<span class="normal"><a href="#__codelineno-15-332">332</a></span>
<span class="normal"><a href="#__codelineno-15-333">333</a></span>
<span class="normal"><a href="#__codelineno-15-334">334</a></span>
<span class="normal"><a href="#__codelineno-15-335">335</a></span>
<span class="normal"><a href="#__codelineno-15-336">336</a></span>
<span class="normal"><a href="#__codelineno-15-337">337</a></span>
<span class="normal"><a href="#__codelineno-15-338">338</a></span>
<span class="normal"><a href="#__codelineno-15-339">339</a></span>
<span class="normal"><a href="#__codelineno-15-340">340</a></span>
<span class="normal"><a href="#__codelineno-15-341">341</a></span>
<span class="normal"><a href="#__codelineno-15-342">342</a></span>
<span class="normal"><a href="#__codelineno-15-343">343</a></span>
<span class="normal"><a href="#__codelineno-15-344">344</a></span>
<span class="normal"><a href="#__codelineno-15-345">345</a></span>
<span class="normal"><a href="#__codelineno-15-346">346</a></span>
<span class="normal"><a href="#__codelineno-15-347">347</a></span>
<span class="normal"><a href="#__codelineno-15-348">348</a></span>
<span class="normal"><a href="#__codelineno-15-349">349</a></span>
<span class="normal"><a href="#__codelineno-15-350">350</a></span>
<span class="normal"><a href="#__codelineno-15-351">351</a></span>
<span class="normal"><a href="#__codelineno-15-352">352</a></span>
<span class="normal"><a href="#__codelineno-15-353">353</a></span>
<span class="normal"><a href="#__codelineno-15-354">354</a></span>
<span class="normal"><a href="#__codelineno-15-355">355</a></span>
<span class="normal"><a href="#__codelineno-15-356">356</a></span>
<span class="normal"><a href="#__codelineno-15-357">357</a></span>
<span class="normal"><a href="#__codelineno-15-358">358</a></span>
<span class="normal"><a href="#__codelineno-15-359">359</a></span>
<span class="normal"><a href="#__codelineno-15-360">360</a></span>
<span class="normal"><a href="#__codelineno-15-361">361</a></span>
<span class="normal"><a href="#__codelineno-15-362">362</a></span>
<span class="normal"><a href="#__codelineno-15-363">363</a></span>
<span class="normal"><a href="#__codelineno-15-364">364</a></span>
<span class="normal"><a href="#__codelineno-15-365">365</a></span>
<span class="normal"><a href="#__codelineno-15-366">366</a></span>
<span class="normal"><a href="#__codelineno-15-367">367</a></span>
<span class="normal"><a href="#__codelineno-15-368">368</a></span>
<span class="normal"><a href="#__codelineno-15-369">369</a></span>
<span class="normal"><a href="#__codelineno-15-370">370</a></span>
<span class="normal"><a href="#__codelineno-15-371">371</a></span>
<span class="normal"><a href="#__codelineno-15-372">372</a></span>
<span class="normal"><a href="#__codelineno-15-373">373</a></span>
<span class="normal"><a href="#__codelineno-15-374">374</a></span>
<span class="normal"><a href="#__codelineno-15-375">375</a></span>
<span class="normal"><a href="#__codelineno-15-376">376</a></span>
<span class="normal"><a href="#__codelineno-15-377">377</a></span>
<span class="normal"><a href="#__codelineno-15-378">378</a></span>
<span class="normal"><a href="#__codelineno-15-379">379</a></span>
<span class="normal"><a href="#__codelineno-15-380">380</a></span>
<span class="normal"><a href="#__codelineno-15-381">381</a></span>
<span class="normal"><a href="#__codelineno-15-382">382</a></span>
<span class="normal"><a href="#__codelineno-15-383">383</a></span>
<span class="normal"><a href="#__codelineno-15-384">384</a></span>
<span class="normal"><a href="#__codelineno-15-385">385</a></span>
<span class="normal"><a href="#__codelineno-15-386">386</a></span>
<span class="normal"><a href="#__codelineno-15-387">387</a></span>
<span class="normal"><a href="#__codelineno-15-388">388</a></span>
<span class="normal"><a href="#__codelineno-15-389">389</a></span>
<span class="normal"><a href="#__codelineno-15-390">390</a></span>
<span class="normal"><a href="#__codelineno-15-391">391</a></span>
<span class="normal"><a href="#__codelineno-15-392">392</a></span>
<span class="normal"><a href="#__codelineno-15-393">393</a></span>
<span class="normal"><a href="#__codelineno-15-394">394</a></span>
<span class="normal"><a href="#__codelineno-15-395">395</a></span>
<span class="normal"><a href="#__codelineno-15-396">396</a></span>
<span class="normal"><a href="#__codelineno-15-397">397</a></span>
<span class="normal"><a href="#__codelineno-15-398">398</a></span>
<span class="normal"><a href="#__codelineno-15-399">399</a></span>
<span class="normal"><a href="#__codelineno-15-400">400</a></span>
<span class="normal"><a href="#__codelineno-15-401">401</a></span>
<span class="normal"><a href="#__codelineno-15-402">402</a></span>
<span class="normal"><a href="#__codelineno-15-403">403</a></span>
<span class="normal"><a href="#__codelineno-15-404">404</a></span>
<span class="normal"><a href="#__codelineno-15-405">405</a></span>
<span class="normal"><a href="#__codelineno-15-406">406</a></span>
<span class="normal"><a href="#__codelineno-15-407">407</a></span>
<span class="normal"><a href="#__codelineno-15-408">408</a></span>
<span class="normal"><a href="#__codelineno-15-409">409</a></span>
<span class="normal"><a href="#__codelineno-15-410">410</a></span>
<span class="normal"><a href="#__codelineno-15-411">411</a></span>
<span class="normal"><a href="#__codelineno-15-412">412</a></span>
<span class="normal"><a href="#__codelineno-15-413">413</a></span>
<span class="normal"><a href="#__codelineno-15-414">414</a></span>
<span class="normal"><a href="#__codelineno-15-415">415</a></span>
<span class="normal"><a href="#__codelineno-15-416">416</a></span>
<span class="normal"><a href="#__codelineno-15-417">417</a></span>
<span class="normal"><a href="#__codelineno-15-418">418</a></span>
<span class="normal"><a href="#__codelineno-15-419">419</a></span>
<span class="normal"><a href="#__codelineno-15-420">420</a></span>
<span class="normal"><a href="#__codelineno-15-421">421</a></span>
<span class="normal"><a href="#__codelineno-15-422">422</a></span>
<span class="normal"><a href="#__codelineno-15-423">423</a></span>
<span class="normal"><a href="#__codelineno-15-424">424</a></span>
<span class="normal"><a href="#__codelineno-15-425">425</a></span>
<span class="normal"><a href="#__codelineno-15-426">426</a></span>
<span class="normal"><a href="#__codelineno-15-427">427</a></span>
<span class="normal"><a href="#__codelineno-15-428">428</a></span>
<span class="normal"><a href="#__codelineno-15-429">429</a></span>
<span class="normal"><a href="#__codelineno-15-430">430</a></span>
<span class="normal"><a href="#__codelineno-15-431">431</a></span>
<span class="normal"><a href="#__codelineno-15-432">432</a></span>
<span class="normal"><a href="#__codelineno-15-433">433</a></span>
<span class="normal"><a href="#__codelineno-15-434">434</a></span>
<span class="normal"><a href="#__codelineno-15-435">435</a></span>
<span class="normal"><a href="#__codelineno-15-436">436</a></span>
<span class="normal"><a href="#__codelineno-15-437">437</a></span>
<span class="normal"><a href="#__codelineno-15-438">438</a></span>
<span class="normal"><a href="#__codelineno-15-439">439</a></span>
<span class="normal"><a href="#__codelineno-15-440">440</a></span>
<span class="normal"><a href="#__codelineno-15-441">441</a></span>
<span class="normal"><a href="#__codelineno-15-442">442</a></span>
<span class="normal"><a href="#__codelineno-15-443">443</a></span>
<span class="normal"><a href="#__codelineno-15-444">444</a></span>
<span class="normal"><a href="#__codelineno-15-445">445</a></span>
<span class="normal"><a href="#__codelineno-15-446">446</a></span>
<span class="normal"><a href="#__codelineno-15-447">447</a></span>
<span class="normal"><a href="#__codelineno-15-448">448</a></span>
<span class="normal"><a href="#__codelineno-15-449">449</a></span>
<span class="normal"><a href="#__codelineno-15-450">450</a></span>
<span class="normal"><a href="#__codelineno-15-451">451</a></span>
<span class="normal"><a href="#__codelineno-15-452">452</a></span>
<span class="normal"><a href="#__codelineno-15-453">453</a></span>
<span class="normal"><a href="#__codelineno-15-454">454</a></span>
<span class="normal"><a href="#__codelineno-15-455">455</a></span>
<span class="normal"><a href="#__codelineno-15-456">456</a></span>
<span class="normal"><a href="#__codelineno-15-457">457</a></span>
<span class="normal"><a href="#__codelineno-15-458">458</a></span>
<span class="normal"><a href="#__codelineno-15-459">459</a></span>
<span class="normal"><a href="#__codelineno-15-460">460</a></span>
<span class="normal"><a href="#__codelineno-15-461">461</a></span>
<span class="normal"><a href="#__codelineno-15-462">462</a></span>
<span class="normal"><a href="#__codelineno-15-463">463</a></span>
<span class="normal"><a href="#__codelineno-15-464">464</a></span>
<span class="normal"><a href="#__codelineno-15-465">465</a></span>
<span class="normal"><a href="#__codelineno-15-466">466</a></span>
<span class="normal"><a href="#__codelineno-15-467">467</a></span>
<span class="normal"><a href="#__codelineno-15-468">468</a></span>
<span class="normal"><a href="#__codelineno-15-469">469</a></span>
<span class="normal"><a href="#__codelineno-15-470">470</a></span>
<span class="normal"><a href="#__codelineno-15-471">471</a></span>
<span class="normal"><a href="#__codelineno-15-472">472</a></span>
<span class="normal"><a href="#__codelineno-15-473">473</a></span>
<span class="normal"><a href="#__codelineno-15-474">474</a></span>
<span class="normal"><a href="#__codelineno-15-475">475</a></span>
<span class="normal"><a href="#__codelineno-15-476">476</a></span>
<span class="normal"><a href="#__codelineno-15-477">477</a></span>
<span class="normal"><a href="#__codelineno-15-478">478</a></span>
<span class="normal"><a href="#__codelineno-15-479">479</a></span>
<span class="normal"><a href="#__codelineno-15-480">480</a></span>
<span class="normal"><a href="#__codelineno-15-481">481</a></span>
<span class="normal"><a href="#__codelineno-15-482">482</a></span>
<span class="normal"><a href="#__codelineno-15-483">483</a></span>
<span class="normal"><a href="#__codelineno-15-484">484</a></span>
<span class="normal"><a href="#__codelineno-15-485">485</a></span>
<span class="normal"><a href="#__codelineno-15-486">486</a></span>
<span class="normal"><a href="#__codelineno-15-487">487</a></span>
<span class="normal"><a href="#__codelineno-15-488">488</a></span>
<span class="normal"><a href="#__codelineno-15-489">489</a></span>
<span class="normal"><a href="#__codelineno-15-490">490</a></span>
<span class="normal"><a href="#__codelineno-15-491">491</a></span>
<span class="normal"><a href="#__codelineno-15-492">492</a></span>
<span class="normal"><a href="#__codelineno-15-493">493</a></span>
<span class="normal"><a href="#__codelineno-15-494">494</a></span>
<span class="normal"><a href="#__codelineno-15-495">495</a></span>
<span class="normal"><a href="#__codelineno-15-496">496</a></span>
<span class="normal"><a href="#__codelineno-15-497">497</a></span>
<span class="normal"><a href="#__codelineno-15-498">498</a></span>
<span class="normal"><a href="#__codelineno-15-499">499</a></span>
<span class="normal"><a href="#__codelineno-15-500">500</a></span>
<span class="normal"><a href="#__codelineno-15-501">501</a></span>
<span class="normal"><a href="#__codelineno-15-502">502</a></span>
<span class="normal"><a href="#__codelineno-15-503">503</a></span>
<span class="normal"><a href="#__codelineno-15-504">504</a></span>
<span class="normal"><a href="#__codelineno-15-505">505</a></span>
<span class="normal"><a href="#__codelineno-15-506">506</a></span>
<span class="normal"><a href="#__codelineno-15-507">507</a></span>
<span class="normal"><a href="#__codelineno-15-508">508</a></span>
<span class="normal"><a href="#__codelineno-15-509">509</a></span>
<span class="normal"><a href="#__codelineno-15-510">510</a></span>
<span class="normal"><a href="#__codelineno-15-511">511</a></span>
<span class="normal"><a href="#__codelineno-15-512">512</a></span>
<span class="normal"><a href="#__codelineno-15-513">513</a></span>
<span class="normal"><a href="#__codelineno-15-514">514</a></span>
<span class="normal"><a href="#__codelineno-15-515">515</a></span>
<span class="normal"><a href="#__codelineno-15-516">516</a></span>
<span class="normal"><a href="#__codelineno-15-517">517</a></span>
<span class="normal"><a href="#__codelineno-15-518">518</a></span>
<span class="normal"><a href="#__codelineno-15-519">519</a></span>
<span class="normal"><a href="#__codelineno-15-520">520</a></span>
<span class="normal"><a href="#__codelineno-15-521">521</a></span>
<span class="normal"><a href="#__codelineno-15-522">522</a></span>
<span class="normal"><a href="#__codelineno-15-523">523</a></span>
<span class="normal"><a href="#__codelineno-15-524">524</a></span>
<span class="normal"><a href="#__codelineno-15-525">525</a></span>
<span class="normal"><a href="#__codelineno-15-526">526</a></span>
<span class="normal"><a href="#__codelineno-15-527">527</a></span>
<span class="normal"><a href="#__codelineno-15-528">528</a></span>
<span class="normal"><a href="#__codelineno-15-529">529</a></span>
<span class="normal"><a href="#__codelineno-15-530">530</a></span>
<span class="normal"><a href="#__codelineno-15-531">531</a></span>
<span class="normal"><a href="#__codelineno-15-532">532</a></span>
<span class="normal"><a href="#__codelineno-15-533">533</a></span>
<span class="normal"><a href="#__codelineno-15-534">534</a></span>
<span class="normal"><a href="#__codelineno-15-535">535</a></span>
<span class="normal"><a href="#__codelineno-15-536">536</a></span>
<span class="normal"><a href="#__codelineno-15-537">537</a></span>
<span class="normal"><a href="#__codelineno-15-538">538</a></span>
<span class="normal"><a href="#__codelineno-15-539">539</a></span>
<span class="normal"><a href="#__codelineno-15-540">540</a></span>
<span class="normal"><a href="#__codelineno-15-541">541</a></span>
<span class="normal"><a href="#__codelineno-15-542">542</a></span>
<span class="normal"><a href="#__codelineno-15-543">543</a></span>
<span class="normal"><a href="#__codelineno-15-544">544</a></span>
<span class="normal"><a href="#__codelineno-15-545">545</a></span>
<span class="normal"><a href="#__codelineno-15-546">546</a></span>
<span class="normal"><a href="#__codelineno-15-547">547</a></span>
<span class="normal"><a href="#__codelineno-15-548">548</a></span>
<span class="normal"><a href="#__codelineno-15-549">549</a></span>
<span class="normal"><a href="#__codelineno-15-550">550</a></span>
<span class="normal"><a href="#__codelineno-15-551">551</a></span>
<span class="normal"><a href="#__codelineno-15-552">552</a></span>
<span class="normal"><a href="#__codelineno-15-553">553</a></span>
<span class="normal"><a href="#__codelineno-15-554">554</a></span>
<span class="normal"><a href="#__codelineno-15-555">555</a></span>
<span class="normal"><a href="#__codelineno-15-556">556</a></span>
<span class="normal"><a href="#__codelineno-15-557">557</a></span>
<span class="normal"><a href="#__codelineno-15-558">558</a></span>
<span class="normal"><a href="#__codelineno-15-559">559</a></span>
<span class="normal"><a href="#__codelineno-15-560">560</a></span>
<span class="normal"><a href="#__codelineno-15-561">561</a></span>
<span class="normal"><a href="#__codelineno-15-562">562</a></span>
<span class="normal"><a href="#__codelineno-15-563">563</a></span>
<span class="normal"><a href="#__codelineno-15-564">564</a></span>
<span class="normal"><a href="#__codelineno-15-565">565</a></span>
<span class="normal"><a href="#__codelineno-15-566">566</a></span>
<span class="normal"><a href="#__codelineno-15-567">567</a></span>
<span class="normal"><a href="#__codelineno-15-568">568</a></span>
<span class="normal"><a href="#__codelineno-15-569">569</a></span>
<span class="normal"><a href="#__codelineno-15-570">570</a></span>
<span class="normal"><a href="#__codelineno-15-571">571</a></span>
<span class="normal"><a href="#__codelineno-15-572">572</a></span>
<span class="normal"><a href="#__codelineno-15-573">573</a></span>
<span class="normal"><a href="#__codelineno-15-574">574</a></span>
<span class="normal"><a href="#__codelineno-15-575">575</a></span>
<span class="normal"><a href="#__codelineno-15-576">576</a></span>
<span class="normal"><a href="#__codelineno-15-577">577</a></span>
<span class="normal"><a href="#__codelineno-15-578">578</a></span>
<span class="normal"><a href="#__codelineno-15-579">579</a></span>
<span class="normal"><a href="#__codelineno-15-580">580</a></span>
<span class="normal"><a href="#__codelineno-15-581">581</a></span>
<span class="normal"><a href="#__codelineno-15-582">582</a></span>
<span class="normal"><a href="#__codelineno-15-583">583</a></span>
<span class="normal"><a href="#__codelineno-15-584">584</a></span>
<span class="normal"><a href="#__codelineno-15-585">585</a></span>
<span class="normal"><a href="#__codelineno-15-586">586</a></span>
<span class="normal"><a href="#__codelineno-15-587">587</a></span>
<span class="normal"><a href="#__codelineno-15-588">588</a></span>
<span class="normal"><a href="#__codelineno-15-589">589</a></span>
<span class="normal"><a href="#__codelineno-15-590">590</a></span>
<span class="normal"><a href="#__codelineno-15-591">591</a></span>
<span class="normal"><a href="#__codelineno-15-592">592</a></span>
<span class="normal"><a href="#__codelineno-15-593">593</a></span>
<span class="normal"><a href="#__codelineno-15-594">594</a></span>
<span class="normal"><a href="#__codelineno-15-595">595</a></span>
<span class="normal"><a href="#__codelineno-15-596">596</a></span>
<span class="normal"><a href="#__codelineno-15-597">597</a></span>
<span class="normal"><a href="#__codelineno-15-598">598</a></span>
<span class="normal"><a href="#__codelineno-15-599">599</a></span>
<span class="normal"><a href="#__codelineno-15-600">600</a></span>
<span class="normal"><a href="#__codelineno-15-601">601</a></span>
<span class="normal"><a href="#__codelineno-15-602">602</a></span>
<span class="normal"><a href="#__codelineno-15-603">603</a></span>
<span class="normal"><a href="#__codelineno-15-604">604</a></span>
<span class="normal"><a href="#__codelineno-15-605">605</a></span>
<span class="normal"><a href="#__codelineno-15-606">606</a></span>
<span class="normal"><a href="#__codelineno-15-607">607</a></span>
<span class="normal"><a href="#__codelineno-15-608">608</a></span>
<span class="normal"><a href="#__codelineno-15-609">609</a></span>
<span class="normal"><a href="#__codelineno-15-610">610</a></span>
<span class="normal"><a href="#__codelineno-15-611">611</a></span>
<span class="normal"><a href="#__codelineno-15-612">612</a></span>
<span class="normal"><a href="#__codelineno-15-613">613</a></span>
<span class="normal"><a href="#__codelineno-15-614">614</a></span>
<span class="normal"><a href="#__codelineno-15-615">615</a></span>
<span class="normal"><a href="#__codelineno-15-616">616</a></span>
<span class="normal"><a href="#__codelineno-15-617">617</a></span>
<span class="normal"><a href="#__codelineno-15-618">618</a></span>
<span class="normal"><a href="#__codelineno-15-619">619</a></span>
<span class="normal"><a href="#__codelineno-15-620">620</a></span>
<span class="normal"><a href="#__codelineno-15-621">621</a></span>
<span class="normal"><a href="#__codelineno-15-622">622</a></span>
<span class="normal"><a href="#__codelineno-15-623">623</a></span>
<span class="normal"><a href="#__codelineno-15-624">624</a></span>
<span class="normal"><a href="#__codelineno-15-625">625</a></span>
<span class="normal"><a href="#__codelineno-15-626">626</a></span>
<span class="normal"><a href="#__codelineno-15-627">627</a></span>
<span class="normal"><a href="#__codelineno-15-628">628</a></span>
<span class="normal"><a href="#__codelineno-15-629">629</a></span>
<span class="normal"><a href="#__codelineno-15-630">630</a></span>
<span class="normal"><a href="#__codelineno-15-631">631</a></span>
<span class="normal"><a href="#__codelineno-15-632">632</a></span>
<span class="normal"><a href="#__codelineno-15-633">633</a></span>
<span class="normal"><a href="#__codelineno-15-634">634</a></span>
<span class="normal"><a href="#__codelineno-15-635">635</a></span>
<span class="normal"><a href="#__codelineno-15-636">636</a></span>
<span class="normal"><a href="#__codelineno-15-637">637</a></span>
<span class="normal"><a href="#__codelineno-15-638">638</a></span>
<span class="normal"><a href="#__codelineno-15-639">639</a></span>
<span class="normal"><a href="#__codelineno-15-640">640</a></span>
<span class="normal"><a href="#__codelineno-15-641">641</a></span>
<span class="normal"><a href="#__codelineno-15-642">642</a></span>
<span class="normal"><a href="#__codelineno-15-643">643</a></span>
<span class="normal"><a href="#__codelineno-15-644">644</a></span>
<span class="normal"><a href="#__codelineno-15-645">645</a></span>
<span class="normal"><a href="#__codelineno-15-646">646</a></span>
<span class="normal"><a href="#__codelineno-15-647">647</a></span>
<span class="normal"><a href="#__codelineno-15-648">648</a></span>
<span class="normal"><a href="#__codelineno-15-649">649</a></span>
<span class="normal"><a href="#__codelineno-15-650">650</a></span>
<span class="normal"><a href="#__codelineno-15-651">651</a></span>
<span class="normal"><a href="#__codelineno-15-652">652</a></span>
<span class="normal"><a href="#__codelineno-15-653">653</a></span>
<span class="normal"><a href="#__codelineno-15-654">654</a></span>
<span class="normal"><a href="#__codelineno-15-655">655</a></span>
<span class="normal"><a href="#__codelineno-15-656">656</a></span>
<span class="normal"><a href="#__codelineno-15-657">657</a></span>
<span class="normal"><a href="#__codelineno-15-658">658</a></span>
<span class="normal"><a href="#__codelineno-15-659">659</a></span>
<span class="normal"><a href="#__codelineno-15-660">660</a></span>
<span class="normal"><a href="#__codelineno-15-661">661</a></span>
<span class="normal"><a href="#__codelineno-15-662">662</a></span>
<span class="normal"><a href="#__codelineno-15-663">663</a></span>
<span class="normal"><a href="#__codelineno-15-664">664</a></span>
<span class="normal"><a href="#__codelineno-15-665">665</a></span>
<span class="normal"><a href="#__codelineno-15-666">666</a></span>
<span class="normal"><a href="#__codelineno-15-667">667</a></span>
<span class="normal"><a href="#__codelineno-15-668">668</a></span>
<span class="normal"><a href="#__codelineno-15-669">669</a></span>
<span class="normal"><a href="#__codelineno-15-670">670</a></span>
<span class="normal"><a href="#__codelineno-15-671">671</a></span>
<span class="normal"><a href="#__codelineno-15-672">672</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="c1"># Copyright (c) 2023 PaddlePaddle Authors. All Rights Reserved.</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2"></a>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="c1"># Licensed under the Apache License, Version 2.0 (the "License");</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="c1"># you may not use this file except in compliance with the License.</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="c1"># You may obtain a copy of the License at</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6"></a>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8"></a>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="c1"># distributed under the License is distributed on an "AS IS" BASIS,</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="c1"># See the License for the specific language governing permissions and</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="c1"># limitations under the License.</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14"></a>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15"></a>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">path</span> <span class="k">as</span> <span class="n">osp</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17"></a>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="kn">import</span> <span class="nn">hydra</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="kn">from</span> <span class="nn">omegaconf</span> <span class="kn">import</span> <span class="n">DictConfig</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22"></a>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23"></a><span class="kn">import</span> <span class="nn">ppsci</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24"></a><span class="kn">from</span> <span class="nn">ppsci.utils</span> <span class="kn">import</span> <span class="n">logger</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25"></a>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26"></a>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27"></a><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28"></a>    <span class="c1"># set random seed for reproducibility</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29"></a>    <span class="n">ppsci</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">set_random_seed</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30"></a>    <span class="c1"># initialize logger</span>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">init_logger</span><span class="p">(</span><span class="s2">"ppsci"</span><span class="p">,</span> <span class="n">osp</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">mode</span><span class="si">}</span><span class="s2">.log"</span><span class="p">),</span> <span class="s2">"info"</span><span class="p">)</span>
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32"></a>
</span><span id="__span-15-33"><a id="__codelineno-15-33" name="__codelineno-15-33"></a>    <span class="c1"># set model</span>
</span><span id="__span-15-34"><a id="__codelineno-15-34" name="__codelineno-15-34"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">HEDeepONets</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="o">.</span><span class="n">MODEL</span><span class="p">)</span>
</span><span id="__span-15-35"><a id="__codelineno-15-35" name="__codelineno-15-35"></a>
</span><span id="__span-15-36"><a id="__codelineno-15-36" name="__codelineno-15-36"></a>    <span class="c1"># set time-geometry</span>
</span><span id="__span-15-37"><a id="__codelineno-15-37" name="__codelineno-15-37"></a>    <span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-15-38"><a id="__codelineno-15-38" name="__codelineno-15-38"></a>    <span class="n">geom</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-39"><a id="__codelineno-15-39" name="__codelineno-15-39"></a>        <span class="s2">"time_rect"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TimeXGeometry</span><span class="p">(</span>
</span><span id="__span-15-40"><a id="__codelineno-15-40" name="__codelineno-15-40"></a>            <span class="n">ppsci</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TimeDomain</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">timestamps</span><span class="o">=</span><span class="n">timestamps</span><span class="p">),</span>
</span><span id="__span-15-41"><a id="__codelineno-15-41" name="__codelineno-15-41"></a>            <span class="n">ppsci</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Interval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">DL</span><span class="p">),</span>
</span><span id="__span-15-42"><a id="__codelineno-15-42" name="__codelineno-15-42"></a>        <span class="p">)</span>
</span><span id="__span-15-43"><a id="__codelineno-15-43" name="__codelineno-15-43"></a>    <span class="p">}</span>
</span><span id="__span-15-44"><a id="__codelineno-15-44" name="__codelineno-15-44"></a>
</span><span id="__span-15-45"><a id="__codelineno-15-45" name="__codelineno-15-45"></a>    <span class="c1"># Generate train data and eval data</span>
</span><span id="__span-15-46"><a id="__codelineno-15-46" name="__codelineno-15-46"></a>    <span class="n">visu_input</span> <span class="o">=</span> <span class="n">geom</span><span class="p">[</span><span class="s2">"time_rect"</span><span class="p">]</span><span class="o">.</span><span class="n">sample_interior</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span> <span class="n">evenly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-15-47"><a id="__codelineno-15-47" name="__codelineno-15-47"></a>    <span class="n">data_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NQM</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="__span-15-48"><a id="__codelineno-15-48" name="__codelineno-15-48"></a>    <span class="n">data_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NQM</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span>
</span><span id="__span-15-49"><a id="__codelineno-15-49" name="__codelineno-15-49"></a>    <span class="n">data_h</span> <span class="o">=</span> <span class="n">data_h</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"float32"</span><span class="p">)</span>
</span><span id="__span-15-50"><a id="__codelineno-15-50" name="__codelineno-15-50"></a>    <span class="n">data_c</span> <span class="o">=</span> <span class="n">data_c</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"float32"</span><span class="p">)</span>
</span><span id="__span-15-51"><a id="__codelineno-15-51" name="__codelineno-15-51"></a>    <span class="n">test_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"float32"</span><span class="p">)</span>
</span><span id="__span-15-52"><a id="__codelineno-15-52" name="__codelineno-15-52"></a>    <span class="n">test_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"float32"</span><span class="p">)</span>
</span><span id="__span-15-53"><a id="__codelineno-15-53" name="__codelineno-15-53"></a>    <span class="c1"># rearrange train data and eval data</span>
</span><span id="__span-15-54"><a id="__codelineno-15-54" name="__codelineno-15-54"></a>    <span class="n">points</span> <span class="o">=</span> <span class="n">visu_input</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-15-55"><a id="__codelineno-15-55" name="__codelineno-15-55"></a>    <span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NQM</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-15-56"><a id="__codelineno-15-56" name="__codelineno-15-56"></a>    <span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NQM</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-15-57"><a id="__codelineno-15-57" name="__codelineno-15-57"></a>    <span class="n">points</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">data_h</span><span class="p">,</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-15-58"><a id="__codelineno-15-58" name="__codelineno-15-58"></a>    <span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NQM</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-15-59"><a id="__codelineno-15-59" name="__codelineno-15-59"></a>    <span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NQM</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-15-60"><a id="__codelineno-15-60" name="__codelineno-15-60"></a>    <span class="n">points</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NQM</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-15-61"><a id="__codelineno-15-61" name="__codelineno-15-61"></a>    <span class="n">points</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">data_c</span><span class="p">,</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NQM</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-15-62"><a id="__codelineno-15-62" name="__codelineno-15-62"></a>    <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">test_h</span><span class="p">,</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-15-63"><a id="__codelineno-15-63" name="__codelineno-15-63"></a>    <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">test_c</span><span class="p">,</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-15-64"><a id="__codelineno-15-64" name="__codelineno-15-64"></a>
</span><span id="__span-15-65"><a id="__codelineno-15-65" name="__codelineno-15-65"></a>    <span class="n">left_indices</span> <span class="o">=</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="__span-15-66"><a id="__codelineno-15-66" name="__codelineno-15-66"></a>    <span class="n">right_indices</span> <span class="o">=</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">==</span> <span class="n">cfg</span><span class="o">.</span><span class="n">DL</span>
</span><span id="__span-15-67"><a id="__codelineno-15-67" name="__codelineno-15-67"></a>    <span class="n">interior_indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">!=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">DL</span><span class="p">)</span>
</span><span id="__span-15-68"><a id="__codelineno-15-68" name="__codelineno-15-68"></a>    <span class="n">left_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">left_indices</span><span class="p">)</span>
</span><span id="__span-15-69"><a id="__codelineno-15-69" name="__codelineno-15-69"></a>    <span class="n">right_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">right_indices</span><span class="p">)</span>
</span><span id="__span-15-70"><a id="__codelineno-15-70" name="__codelineno-15-70"></a>    <span class="n">interior_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">interior_indices</span><span class="p">)</span>
</span><span id="__span-15-71"><a id="__codelineno-15-71" name="__codelineno-15-71"></a>
</span><span id="__span-15-72"><a id="__codelineno-15-72" name="__codelineno-15-72"></a>    <span class="n">left_indices1</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="__span-15-73"><a id="__codelineno-15-73" name="__codelineno-15-73"></a>    <span class="n">right_indices1</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">==</span> <span class="n">cfg</span><span class="o">.</span><span class="n">DL</span>
</span><span id="__span-15-74"><a id="__codelineno-15-74" name="__codelineno-15-74"></a>    <span class="n">interior_indices1</span> <span class="o">=</span> <span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">!=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">DL</span><span class="p">)</span>
</span><span id="__span-15-75"><a id="__codelineno-15-75" name="__codelineno-15-75"></a>    <span class="n">initial_indices1</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">]</span> <span class="o">==</span> <span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-15-76"><a id="__codelineno-15-76" name="__codelineno-15-76"></a>    <span class="n">left_indices1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">left_indices1</span><span class="p">)</span>
</span><span id="__span-15-77"><a id="__codelineno-15-77" name="__codelineno-15-77"></a>    <span class="n">right_indices1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">right_indices1</span><span class="p">)</span>
</span><span id="__span-15-78"><a id="__codelineno-15-78" name="__codelineno-15-78"></a>    <span class="n">interior_indices1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">interior_indices1</span><span class="p">)</span>
</span><span id="__span-15-79"><a id="__codelineno-15-79" name="__codelineno-15-79"></a>    <span class="n">initial_indices1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">initial_indices1</span><span class="p">)</span>
</span><span id="__span-15-80"><a id="__codelineno-15-80" name="__codelineno-15-80"></a>
</span><span id="__span-15-81"><a id="__codelineno-15-81" name="__codelineno-15-81"></a>    <span class="c1"># Classification train data</span>
</span><span id="__span-15-82"><a id="__codelineno-15-82" name="__codelineno-15-82"></a>    <span class="n">left_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-83"><a id="__codelineno-15-83" name="__codelineno-15-83"></a>        <span class="s2">"x"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">][</span><span class="n">left_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-84"><a id="__codelineno-15-84" name="__codelineno-15-84"></a>        <span class="s2">"t"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">][</span><span class="n">left_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-85"><a id="__codelineno-15-85" name="__codelineno-15-85"></a>        <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">][</span><span class="n">left_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-86"><a id="__codelineno-15-86" name="__codelineno-15-86"></a>        <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">][</span><span class="n">left_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-87"><a id="__codelineno-15-87" name="__codelineno-15-87"></a>    <span class="p">}</span>
</span><span id="__span-15-88"><a id="__codelineno-15-88" name="__codelineno-15-88"></a>    <span class="n">right_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-89"><a id="__codelineno-15-89" name="__codelineno-15-89"></a>        <span class="s2">"x"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">][</span><span class="n">right_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-90"><a id="__codelineno-15-90" name="__codelineno-15-90"></a>        <span class="s2">"t"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">][</span><span class="n">right_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-91"><a id="__codelineno-15-91" name="__codelineno-15-91"></a>        <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">][</span><span class="n">right_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-92"><a id="__codelineno-15-92" name="__codelineno-15-92"></a>        <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">][</span><span class="n">right_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-93"><a id="__codelineno-15-93" name="__codelineno-15-93"></a>    <span class="p">}</span>
</span><span id="__span-15-94"><a id="__codelineno-15-94" name="__codelineno-15-94"></a>    <span class="n">interior_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-95"><a id="__codelineno-15-95" name="__codelineno-15-95"></a>        <span class="s2">"x"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span>
</span><span id="__span-15-96"><a id="__codelineno-15-96" name="__codelineno-15-96"></a>        <span class="s2">"t"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span>
</span><span id="__span-15-97"><a id="__codelineno-15-97" name="__codelineno-15-97"></a>        <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">],</span>
</span><span id="__span-15-98"><a id="__codelineno-15-98" name="__codelineno-15-98"></a>        <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">],</span>
</span><span id="__span-15-99"><a id="__codelineno-15-99" name="__codelineno-15-99"></a>    <span class="p">}</span>
</span><span id="__span-15-100"><a id="__codelineno-15-100" name="__codelineno-15-100"></a>    <span class="n">initial_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-101"><a id="__codelineno-15-101" name="__codelineno-15-101"></a>        <span class="s2">"x"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"x"</span><span class="p">][</span><span class="n">initial_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-102"><a id="__codelineno-15-102" name="__codelineno-15-102"></a>        <span class="s2">"t"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"t"</span><span class="p">][</span><span class="n">initial_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-15-103"><a id="__codelineno-15-103" name="__codelineno-15-103"></a>        <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">][</span><span class="n">initial_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-104"><a id="__codelineno-15-104" name="__codelineno-15-104"></a>        <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">points</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">][</span><span class="n">initial_indices1</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-105"><a id="__codelineno-15-105" name="__codelineno-15-105"></a>    <span class="p">}</span>
</span><span id="__span-15-106"><a id="__codelineno-15-106" name="__codelineno-15-106"></a>    <span class="c1"># Classification eval data</span>
</span><span id="__span-15-107"><a id="__codelineno-15-107" name="__codelineno-15-107"></a>    <span class="n">test_left_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-108"><a id="__codelineno-15-108" name="__codelineno-15-108"></a>        <span class="s2">"x"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">][</span><span class="n">left_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-109"><a id="__codelineno-15-109" name="__codelineno-15-109"></a>        <span class="s2">"t"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"t"</span><span class="p">][</span><span class="n">left_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-110"><a id="__codelineno-15-110" name="__codelineno-15-110"></a>        <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">][</span><span class="n">left_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-111"><a id="__codelineno-15-111" name="__codelineno-15-111"></a>        <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">][</span><span class="n">left_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-112"><a id="__codelineno-15-112" name="__codelineno-15-112"></a>    <span class="p">}</span>
</span><span id="__span-15-113"><a id="__codelineno-15-113" name="__codelineno-15-113"></a>    <span class="n">test_right_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-114"><a id="__codelineno-15-114" name="__codelineno-15-114"></a>        <span class="s2">"x"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">][</span><span class="n">right_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-115"><a id="__codelineno-15-115" name="__codelineno-15-115"></a>        <span class="s2">"t"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"t"</span><span class="p">][</span><span class="n">right_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-116"><a id="__codelineno-15-116" name="__codelineno-15-116"></a>        <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">][</span><span class="n">right_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-117"><a id="__codelineno-15-117" name="__codelineno-15-117"></a>        <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">][</span><span class="n">right_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-118"><a id="__codelineno-15-118" name="__codelineno-15-118"></a>    <span class="p">}</span>
</span><span id="__span-15-119"><a id="__codelineno-15-119" name="__codelineno-15-119"></a>    <span class="n">test_interior_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-120"><a id="__codelineno-15-120" name="__codelineno-15-120"></a>        <span class="s2">"x"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span>
</span><span id="__span-15-121"><a id="__codelineno-15-121" name="__codelineno-15-121"></a>        <span class="s2">"t"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span>
</span><span id="__span-15-122"><a id="__codelineno-15-122" name="__codelineno-15-122"></a>        <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">],</span>
</span><span id="__span-15-123"><a id="__codelineno-15-123" name="__codelineno-15-123"></a>        <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">],</span>
</span><span id="__span-15-124"><a id="__codelineno-15-124" name="__codelineno-15-124"></a>    <span class="p">}</span>
</span><span id="__span-15-125"><a id="__codelineno-15-125" name="__codelineno-15-125"></a>
</span><span id="__span-15-126"><a id="__codelineno-15-126" name="__codelineno-15-126"></a>    <span class="c1"># set equation</span>
</span><span id="__span-15-127"><a id="__codelineno-15-127" name="__codelineno-15-127"></a>    <span class="n">equation</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-128"><a id="__codelineno-15-128" name="__codelineno-15-128"></a>        <span class="s2">"heat_exchanger"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">equation</span><span class="o">.</span><span class="n">HeatExchanger</span><span class="p">(</span>
</span><span id="__span-15-129"><a id="__codelineno-15-129" name="__codelineno-15-129"></a>            <span class="n">cfg</span><span class="o">.</span><span class="n">alpha_h</span> <span class="o">/</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">L</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">cp_h</span><span class="p">),</span>
</span><span id="__span-15-130"><a id="__codelineno-15-130" name="__codelineno-15-130"></a>            <span class="n">cfg</span><span class="o">.</span><span class="n">alpha_c</span> <span class="o">/</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">L</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">cp_c</span><span class="p">),</span>
</span><span id="__span-15-131"><a id="__codelineno-15-131" name="__codelineno-15-131"></a>            <span class="n">cfg</span><span class="o">.</span><span class="n">v_h</span><span class="p">,</span>
</span><span id="__span-15-132"><a id="__codelineno-15-132" name="__codelineno-15-132"></a>            <span class="n">cfg</span><span class="o">.</span><span class="n">v_c</span><span class="p">,</span>
</span><span id="__span-15-133"><a id="__codelineno-15-133" name="__codelineno-15-133"></a>            <span class="n">cfg</span><span class="o">.</span><span class="n">alpha_h</span> <span class="o">/</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">M</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">cp_w</span><span class="p">),</span>
</span><span id="__span-15-134"><a id="__codelineno-15-134" name="__codelineno-15-134"></a>            <span class="n">cfg</span><span class="o">.</span><span class="n">alpha_c</span> <span class="o">/</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">M</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">cp_w</span><span class="p">),</span>
</span><span id="__span-15-135"><a id="__codelineno-15-135" name="__codelineno-15-135"></a>        <span class="p">)</span>
</span><span id="__span-15-136"><a id="__codelineno-15-136" name="__codelineno-15-136"></a>    <span class="p">}</span>
</span><span id="__span-15-137"><a id="__codelineno-15-137" name="__codelineno-15-137"></a>
</span><span id="__span-15-138"><a id="__codelineno-15-138" name="__codelineno-15-138"></a>    <span class="c1"># set constraint</span>
</span><span id="__span-15-139"><a id="__codelineno-15-139" name="__codelineno-15-139"></a>    <span class="n">bc_label</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-140"><a id="__codelineno-15-140" name="__codelineno-15-140"></a>        <span class="s2">"T_h"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">left_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-15-141"><a id="__codelineno-15-141" name="__codelineno-15-141"></a>    <span class="p">}</span>
</span><span id="__span-15-142"><a id="__codelineno-15-142" name="__codelineno-15-142"></a>    <span class="n">interior_label</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-143"><a id="__codelineno-15-143" name="__codelineno-15-143"></a>        <span class="s2">"heat_boundary"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-15-144"><a id="__codelineno-15-144" name="__codelineno-15-144"></a>        <span class="s2">"cold_boundary"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-15-145"><a id="__codelineno-15-145" name="__codelineno-15-145"></a>        <span class="s2">"wall"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-15-146"><a id="__codelineno-15-146" name="__codelineno-15-146"></a>    <span class="p">}</span>
</span><span id="__span-15-147"><a id="__codelineno-15-147" name="__codelineno-15-147"></a>    <span class="n">initial_label</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-148"><a id="__codelineno-15-148" name="__codelineno-15-148"></a>        <span class="s2">"T_h"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">initial_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-15-149"><a id="__codelineno-15-149" name="__codelineno-15-149"></a>        <span class="s2">"T_c"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">initial_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-15-150"><a id="__codelineno-15-150" name="__codelineno-15-150"></a>        <span class="s2">"T_w"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">initial_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-15-151"><a id="__codelineno-15-151" name="__codelineno-15-151"></a>    <span class="p">}</span>
</span><span id="__span-15-152"><a id="__codelineno-15-152" name="__codelineno-15-152"></a>
</span><span id="__span-15-153"><a id="__codelineno-15-153" name="__codelineno-15-153"></a>    <span class="n">left_sup_constraint</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">SupervisedConstraint</span><span class="p">(</span>
</span><span id="__span-15-154"><a id="__codelineno-15-154" name="__codelineno-15-154"></a>        <span class="p">{</span>
</span><span id="__span-15-155"><a id="__codelineno-15-155" name="__codelineno-15-155"></a>            <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-156"><a id="__codelineno-15-156" name="__codelineno-15-156"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"NamedArrayDataset"</span><span class="p">,</span>
</span><span id="__span-15-157"><a id="__codelineno-15-157" name="__codelineno-15-157"></a>                <span class="s2">"input"</span><span class="p">:</span> <span class="n">left_data</span><span class="p">,</span>
</span><span id="__span-15-158"><a id="__codelineno-15-158" name="__codelineno-15-158"></a>                <span class="s2">"label"</span><span class="p">:</span> <span class="n">bc_label</span><span class="p">,</span>
</span><span id="__span-15-159"><a id="__codelineno-15-159" name="__codelineno-15-159"></a>                <span class="s2">"weight"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-160"><a id="__codelineno-15-160" name="__codelineno-15-160"></a>                    <span class="s2">"T_h"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span>
</span><span id="__span-15-161"><a id="__codelineno-15-161" name="__codelineno-15-161"></a>                        <span class="n">left_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">left_sup_constraint</span><span class="o">.</span><span class="n">T_h</span>
</span><span id="__span-15-162"><a id="__codelineno-15-162" name="__codelineno-15-162"></a>                    <span class="p">)</span>
</span><span id="__span-15-163"><a id="__codelineno-15-163" name="__codelineno-15-163"></a>                <span class="p">},</span>
</span><span id="__span-15-164"><a id="__codelineno-15-164" name="__codelineno-15-164"></a>            <span class="p">},</span>
</span><span id="__span-15-165"><a id="__codelineno-15-165" name="__codelineno-15-165"></a>            <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="__span-15-166"><a id="__codelineno-15-166" name="__codelineno-15-166"></a>            <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-167"><a id="__codelineno-15-167" name="__codelineno-15-167"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-15-168"><a id="__codelineno-15-168" name="__codelineno-15-168"></a>                <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-15-169"><a id="__codelineno-15-169" name="__codelineno-15-169"></a>                <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-15-170"><a id="__codelineno-15-170" name="__codelineno-15-170"></a>            <span class="p">},</span>
</span><span id="__span-15-171"><a id="__codelineno-15-171" name="__codelineno-15-171"></a>        <span class="p">},</span>
</span><span id="__span-15-172"><a id="__codelineno-15-172" name="__codelineno-15-172"></a>        <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-15-173"><a id="__codelineno-15-173" name="__codelineno-15-173"></a>        <span class="n">output_expr</span><span class="o">=</span><span class="p">{</span><span class="s2">"T_h"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"T_h"</span><span class="p">]</span> <span class="o">-</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_hin</span><span class="p">},</span>
</span><span id="__span-15-174"><a id="__codelineno-15-174" name="__codelineno-15-174"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">"left_sup"</span><span class="p">,</span>
</span><span id="__span-15-175"><a id="__codelineno-15-175" name="__codelineno-15-175"></a>    <span class="p">)</span>
</span><span id="__span-15-176"><a id="__codelineno-15-176" name="__codelineno-15-176"></a>    <span class="n">right_sup_constraint</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">SupervisedConstraint</span><span class="p">(</span>
</span><span id="__span-15-177"><a id="__codelineno-15-177" name="__codelineno-15-177"></a>        <span class="p">{</span>
</span><span id="__span-15-178"><a id="__codelineno-15-178" name="__codelineno-15-178"></a>            <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-179"><a id="__codelineno-15-179" name="__codelineno-15-179"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"NamedArrayDataset"</span><span class="p">,</span>
</span><span id="__span-15-180"><a id="__codelineno-15-180" name="__codelineno-15-180"></a>                <span class="s2">"input"</span><span class="p">:</span> <span class="n">right_data</span><span class="p">,</span>
</span><span id="__span-15-181"><a id="__codelineno-15-181" name="__codelineno-15-181"></a>                <span class="s2">"label"</span><span class="p">:</span> <span class="n">bc_label</span><span class="p">,</span>
</span><span id="__span-15-182"><a id="__codelineno-15-182" name="__codelineno-15-182"></a>                <span class="s2">"weight"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-183"><a id="__codelineno-15-183" name="__codelineno-15-183"></a>                    <span class="s2">"T_h"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span>
</span><span id="__span-15-184"><a id="__codelineno-15-184" name="__codelineno-15-184"></a>                        <span class="n">right_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">right_sup_constraint</span><span class="o">.</span><span class="n">T_h</span>
</span><span id="__span-15-185"><a id="__codelineno-15-185" name="__codelineno-15-185"></a>                    <span class="p">)</span>
</span><span id="__span-15-186"><a id="__codelineno-15-186" name="__codelineno-15-186"></a>                <span class="p">},</span>
</span><span id="__span-15-187"><a id="__codelineno-15-187" name="__codelineno-15-187"></a>            <span class="p">},</span>
</span><span id="__span-15-188"><a id="__codelineno-15-188" name="__codelineno-15-188"></a>            <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="__span-15-189"><a id="__codelineno-15-189" name="__codelineno-15-189"></a>            <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-190"><a id="__codelineno-15-190" name="__codelineno-15-190"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-15-191"><a id="__codelineno-15-191" name="__codelineno-15-191"></a>                <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-15-192"><a id="__codelineno-15-192" name="__codelineno-15-192"></a>                <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-15-193"><a id="__codelineno-15-193" name="__codelineno-15-193"></a>            <span class="p">},</span>
</span><span id="__span-15-194"><a id="__codelineno-15-194" name="__codelineno-15-194"></a>        <span class="p">},</span>
</span><span id="__span-15-195"><a id="__codelineno-15-195" name="__codelineno-15-195"></a>        <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-15-196"><a id="__codelineno-15-196" name="__codelineno-15-196"></a>        <span class="n">output_expr</span><span class="o">=</span><span class="p">{</span><span class="s2">"T_h"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"T_c"</span><span class="p">]</span> <span class="o">-</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_cin</span><span class="p">},</span>
</span><span id="__span-15-197"><a id="__codelineno-15-197" name="__codelineno-15-197"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">"right_sup"</span><span class="p">,</span>
</span><span id="__span-15-198"><a id="__codelineno-15-198" name="__codelineno-15-198"></a>    <span class="p">)</span>
</span><span id="__span-15-199"><a id="__codelineno-15-199" name="__codelineno-15-199"></a>    <span class="n">interior_sup_constraint</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">SupervisedConstraint</span><span class="p">(</span>
</span><span id="__span-15-200"><a id="__codelineno-15-200" name="__codelineno-15-200"></a>        <span class="p">{</span>
</span><span id="__span-15-201"><a id="__codelineno-15-201" name="__codelineno-15-201"></a>            <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-202"><a id="__codelineno-15-202" name="__codelineno-15-202"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"NamedArrayDataset"</span><span class="p">,</span>
</span><span id="__span-15-203"><a id="__codelineno-15-203" name="__codelineno-15-203"></a>                <span class="s2">"input"</span><span class="p">:</span> <span class="n">interior_data</span><span class="p">,</span>
</span><span id="__span-15-204"><a id="__codelineno-15-204" name="__codelineno-15-204"></a>                <span class="s2">"label"</span><span class="p">:</span> <span class="n">interior_label</span><span class="p">,</span>
</span><span id="__span-15-205"><a id="__codelineno-15-205" name="__codelineno-15-205"></a>                <span class="s2">"weight"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-206"><a id="__codelineno-15-206" name="__codelineno-15-206"></a>                    <span class="s2">"heat_boundary"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span>
</span><span id="__span-15-207"><a id="__codelineno-15-207" name="__codelineno-15-207"></a>                        <span class="n">interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span>
</span><span id="__span-15-208"><a id="__codelineno-15-208" name="__codelineno-15-208"></a>                        <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">interior_sup_constraint</span><span class="o">.</span><span class="n">heat_boundary</span><span class="p">,</span>
</span><span id="__span-15-209"><a id="__codelineno-15-209" name="__codelineno-15-209"></a>                    <span class="p">),</span>
</span><span id="__span-15-210"><a id="__codelineno-15-210" name="__codelineno-15-210"></a>                    <span class="s2">"cold_boundary"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span>
</span><span id="__span-15-211"><a id="__codelineno-15-211" name="__codelineno-15-211"></a>                        <span class="n">interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span>
</span><span id="__span-15-212"><a id="__codelineno-15-212" name="__codelineno-15-212"></a>                        <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">interior_sup_constraint</span><span class="o">.</span><span class="n">cold_boundary</span><span class="p">,</span>
</span><span id="__span-15-213"><a id="__codelineno-15-213" name="__codelineno-15-213"></a>                    <span class="p">),</span>
</span><span id="__span-15-214"><a id="__codelineno-15-214" name="__codelineno-15-214"></a>                    <span class="s2">"wall"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span>
</span><span id="__span-15-215"><a id="__codelineno-15-215" name="__codelineno-15-215"></a>                        <span class="n">interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span>
</span><span id="__span-15-216"><a id="__codelineno-15-216" name="__codelineno-15-216"></a>                        <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">interior_sup_constraint</span><span class="o">.</span><span class="n">wall</span><span class="p">,</span>
</span><span id="__span-15-217"><a id="__codelineno-15-217" name="__codelineno-15-217"></a>                    <span class="p">),</span>
</span><span id="__span-15-218"><a id="__codelineno-15-218" name="__codelineno-15-218"></a>                <span class="p">},</span>
</span><span id="__span-15-219"><a id="__codelineno-15-219" name="__codelineno-15-219"></a>            <span class="p">},</span>
</span><span id="__span-15-220"><a id="__codelineno-15-220" name="__codelineno-15-220"></a>            <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="__span-15-221"><a id="__codelineno-15-221" name="__codelineno-15-221"></a>            <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-222"><a id="__codelineno-15-222" name="__codelineno-15-222"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-15-223"><a id="__codelineno-15-223" name="__codelineno-15-223"></a>                <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-15-224"><a id="__codelineno-15-224" name="__codelineno-15-224"></a>                <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-15-225"><a id="__codelineno-15-225" name="__codelineno-15-225"></a>            <span class="p">},</span>
</span><span id="__span-15-226"><a id="__codelineno-15-226" name="__codelineno-15-226"></a>        <span class="p">},</span>
</span><span id="__span-15-227"><a id="__codelineno-15-227" name="__codelineno-15-227"></a>        <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-15-228"><a id="__codelineno-15-228" name="__codelineno-15-228"></a>        <span class="n">output_expr</span><span class="o">=</span><span class="n">equation</span><span class="p">[</span><span class="s2">"heat_exchanger"</span><span class="p">]</span><span class="o">.</span><span class="n">equations</span><span class="p">,</span>
</span><span id="__span-15-229"><a id="__codelineno-15-229" name="__codelineno-15-229"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">"interior_sup"</span><span class="p">,</span>
</span><span id="__span-15-230"><a id="__codelineno-15-230" name="__codelineno-15-230"></a>    <span class="p">)</span>
</span><span id="__span-15-231"><a id="__codelineno-15-231" name="__codelineno-15-231"></a>    <span class="n">initial_sup_constraint</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">SupervisedConstraint</span><span class="p">(</span>
</span><span id="__span-15-232"><a id="__codelineno-15-232" name="__codelineno-15-232"></a>        <span class="p">{</span>
</span><span id="__span-15-233"><a id="__codelineno-15-233" name="__codelineno-15-233"></a>            <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-234"><a id="__codelineno-15-234" name="__codelineno-15-234"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"NamedArrayDataset"</span><span class="p">,</span>
</span><span id="__span-15-235"><a id="__codelineno-15-235" name="__codelineno-15-235"></a>                <span class="s2">"input"</span><span class="p">:</span> <span class="n">initial_data</span><span class="p">,</span>
</span><span id="__span-15-236"><a id="__codelineno-15-236" name="__codelineno-15-236"></a>                <span class="s2">"label"</span><span class="p">:</span> <span class="n">initial_label</span><span class="p">,</span>
</span><span id="__span-15-237"><a id="__codelineno-15-237" name="__codelineno-15-237"></a>                <span class="s2">"weight"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-238"><a id="__codelineno-15-238" name="__codelineno-15-238"></a>                    <span class="s2">"T_h"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span>
</span><span id="__span-15-239"><a id="__codelineno-15-239" name="__codelineno-15-239"></a>                        <span class="n">initial_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">initial_sup_constraint</span><span class="o">.</span><span class="n">T_h</span>
</span><span id="__span-15-240"><a id="__codelineno-15-240" name="__codelineno-15-240"></a>                    <span class="p">),</span>
</span><span id="__span-15-241"><a id="__codelineno-15-241" name="__codelineno-15-241"></a>                    <span class="s2">"T_c"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span>
</span><span id="__span-15-242"><a id="__codelineno-15-242" name="__codelineno-15-242"></a>                        <span class="n">initial_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">initial_sup_constraint</span><span class="o">.</span><span class="n">T_c</span>
</span><span id="__span-15-243"><a id="__codelineno-15-243" name="__codelineno-15-243"></a>                    <span class="p">),</span>
</span><span id="__span-15-244"><a id="__codelineno-15-244" name="__codelineno-15-244"></a>                    <span class="s2">"T_w"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span>
</span><span id="__span-15-245"><a id="__codelineno-15-245" name="__codelineno-15-245"></a>                        <span class="n">initial_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">initial_sup_constraint</span><span class="o">.</span><span class="n">T_w</span>
</span><span id="__span-15-246"><a id="__codelineno-15-246" name="__codelineno-15-246"></a>                    <span class="p">),</span>
</span><span id="__span-15-247"><a id="__codelineno-15-247" name="__codelineno-15-247"></a>                <span class="p">},</span>
</span><span id="__span-15-248"><a id="__codelineno-15-248" name="__codelineno-15-248"></a>            <span class="p">},</span>
</span><span id="__span-15-249"><a id="__codelineno-15-249" name="__codelineno-15-249"></a>            <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
</span><span id="__span-15-250"><a id="__codelineno-15-250" name="__codelineno-15-250"></a>            <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-251"><a id="__codelineno-15-251" name="__codelineno-15-251"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-15-252"><a id="__codelineno-15-252" name="__codelineno-15-252"></a>                <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-15-253"><a id="__codelineno-15-253" name="__codelineno-15-253"></a>                <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-15-254"><a id="__codelineno-15-254" name="__codelineno-15-254"></a>            <span class="p">},</span>
</span><span id="__span-15-255"><a id="__codelineno-15-255" name="__codelineno-15-255"></a>        <span class="p">},</span>
</span><span id="__span-15-256"><a id="__codelineno-15-256" name="__codelineno-15-256"></a>        <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-15-257"><a id="__codelineno-15-257" name="__codelineno-15-257"></a>        <span class="n">output_expr</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-15-258"><a id="__codelineno-15-258" name="__codelineno-15-258"></a>            <span class="s2">"T_h"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"T_h"</span><span class="p">]</span> <span class="o">-</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_hin</span><span class="p">,</span>
</span><span id="__span-15-259"><a id="__codelineno-15-259" name="__codelineno-15-259"></a>            <span class="s2">"T_c"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"T_c"</span><span class="p">]</span> <span class="o">-</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_cin</span><span class="p">,</span>
</span><span id="__span-15-260"><a id="__codelineno-15-260" name="__codelineno-15-260"></a>            <span class="s2">"T_w"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"T_w"</span><span class="p">]</span> <span class="o">-</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_win</span><span class="p">,</span>
</span><span id="__span-15-261"><a id="__codelineno-15-261" name="__codelineno-15-261"></a>        <span class="p">},</span>
</span><span id="__span-15-262"><a id="__codelineno-15-262" name="__codelineno-15-262"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">"initial_sup"</span><span class="p">,</span>
</span><span id="__span-15-263"><a id="__codelineno-15-263" name="__codelineno-15-263"></a>    <span class="p">)</span>
</span><span id="__span-15-264"><a id="__codelineno-15-264" name="__codelineno-15-264"></a>    <span class="c1"># wrap constraints together</span>
</span><span id="__span-15-265"><a id="__codelineno-15-265" name="__codelineno-15-265"></a>    <span class="n">constraint</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-266"><a id="__codelineno-15-266" name="__codelineno-15-266"></a>        <span class="n">left_sup_constraint</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">left_sup_constraint</span><span class="p">,</span>
</span><span id="__span-15-267"><a id="__codelineno-15-267" name="__codelineno-15-267"></a>        <span class="n">right_sup_constraint</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">right_sup_constraint</span><span class="p">,</span>
</span><span id="__span-15-268"><a id="__codelineno-15-268" name="__codelineno-15-268"></a>        <span class="n">interior_sup_constraint</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">interior_sup_constraint</span><span class="p">,</span>
</span><span id="__span-15-269"><a id="__codelineno-15-269" name="__codelineno-15-269"></a>        <span class="n">initial_sup_constraint</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">initial_sup_constraint</span><span class="p">,</span>
</span><span id="__span-15-270"><a id="__codelineno-15-270" name="__codelineno-15-270"></a>    <span class="p">}</span>
</span><span id="__span-15-271"><a id="__codelineno-15-271" name="__codelineno-15-271"></a>
</span><span id="__span-15-272"><a id="__codelineno-15-272" name="__codelineno-15-272"></a>    <span class="c1"># set optimizer</span>
</span><span id="__span-15-273"><a id="__codelineno-15-273" name="__codelineno-15-273"></a>    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">learning_rate</span><span class="p">)(</span><span class="n">model</span><span class="p">)</span>
</span><span id="__span-15-274"><a id="__codelineno-15-274" name="__codelineno-15-274"></a>
</span><span id="__span-15-275"><a id="__codelineno-15-275" name="__codelineno-15-275"></a>    <span class="c1"># set validator</span>
</span><span id="__span-15-276"><a id="__codelineno-15-276" name="__codelineno-15-276"></a>    <span class="n">test_bc_label</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-277"><a id="__codelineno-15-277" name="__codelineno-15-277"></a>        <span class="s2">"T_h"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">test_left_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-15-278"><a id="__codelineno-15-278" name="__codelineno-15-278"></a>    <span class="p">}</span>
</span><span id="__span-15-279"><a id="__codelineno-15-279" name="__codelineno-15-279"></a>    <span class="n">test_interior_label</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-280"><a id="__codelineno-15-280" name="__codelineno-15-280"></a>        <span class="s2">"heat_boundary"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="__span-15-281"><a id="__codelineno-15-281" name="__codelineno-15-281"></a>            <span class="p">[</span><span class="n">test_interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span>
</span><span id="__span-15-282"><a id="__codelineno-15-282" name="__codelineno-15-282"></a>        <span class="p">),</span>
</span><span id="__span-15-283"><a id="__codelineno-15-283" name="__codelineno-15-283"></a>        <span class="s2">"cold_boundary"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="__span-15-284"><a id="__codelineno-15-284" name="__codelineno-15-284"></a>            <span class="p">[</span><span class="n">test_interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span>
</span><span id="__span-15-285"><a id="__codelineno-15-285" name="__codelineno-15-285"></a>        <span class="p">),</span>
</span><span id="__span-15-286"><a id="__codelineno-15-286" name="__codelineno-15-286"></a>        <span class="s2">"wall"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">test_interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-15-287"><a id="__codelineno-15-287" name="__codelineno-15-287"></a>    <span class="p">}</span>
</span><span id="__span-15-288"><a id="__codelineno-15-288" name="__codelineno-15-288"></a>    <span class="n">left_validator</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">SupervisedValidator</span><span class="p">(</span>
</span><span id="__span-15-289"><a id="__codelineno-15-289" name="__codelineno-15-289"></a>        <span class="p">{</span>
</span><span id="__span-15-290"><a id="__codelineno-15-290" name="__codelineno-15-290"></a>            <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-291"><a id="__codelineno-15-291" name="__codelineno-15-291"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"NamedArrayDataset"</span><span class="p">,</span>
</span><span id="__span-15-292"><a id="__codelineno-15-292" name="__codelineno-15-292"></a>                <span class="s2">"input"</span><span class="p">:</span> <span class="n">test_left_data</span><span class="p">,</span>
</span><span id="__span-15-293"><a id="__codelineno-15-293" name="__codelineno-15-293"></a>                <span class="s2">"label"</span><span class="p">:</span> <span class="n">test_bc_label</span><span class="p">,</span>
</span><span id="__span-15-294"><a id="__codelineno-15-294" name="__codelineno-15-294"></a>            <span class="p">},</span>
</span><span id="__span-15-295"><a id="__codelineno-15-295" name="__codelineno-15-295"></a>            <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span>
</span><span id="__span-15-296"><a id="__codelineno-15-296" name="__codelineno-15-296"></a>            <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-297"><a id="__codelineno-15-297" name="__codelineno-15-297"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-15-298"><a id="__codelineno-15-298" name="__codelineno-15-298"></a>                <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-15-299"><a id="__codelineno-15-299" name="__codelineno-15-299"></a>                <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-15-300"><a id="__codelineno-15-300" name="__codelineno-15-300"></a>            <span class="p">},</span>
</span><span id="__span-15-301"><a id="__codelineno-15-301" name="__codelineno-15-301"></a>        <span class="p">},</span>
</span><span id="__span-15-302"><a id="__codelineno-15-302" name="__codelineno-15-302"></a>        <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-15-303"><a id="__codelineno-15-303" name="__codelineno-15-303"></a>        <span class="n">output_expr</span><span class="o">=</span><span class="p">{</span><span class="s2">"T_h"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"T_h"</span><span class="p">]</span> <span class="o">-</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_hin</span><span class="p">},</span>
</span><span id="__span-15-304"><a id="__codelineno-15-304" name="__codelineno-15-304"></a>        <span class="n">metric</span><span class="o">=</span><span class="p">{</span><span class="s2">"MSE"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">MSE</span><span class="p">()},</span>
</span><span id="__span-15-305"><a id="__codelineno-15-305" name="__codelineno-15-305"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">"left_mse"</span><span class="p">,</span>
</span><span id="__span-15-306"><a id="__codelineno-15-306" name="__codelineno-15-306"></a>    <span class="p">)</span>
</span><span id="__span-15-307"><a id="__codelineno-15-307" name="__codelineno-15-307"></a>    <span class="n">right_validator</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">SupervisedValidator</span><span class="p">(</span>
</span><span id="__span-15-308"><a id="__codelineno-15-308" name="__codelineno-15-308"></a>        <span class="p">{</span>
</span><span id="__span-15-309"><a id="__codelineno-15-309" name="__codelineno-15-309"></a>            <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-310"><a id="__codelineno-15-310" name="__codelineno-15-310"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"NamedArrayDataset"</span><span class="p">,</span>
</span><span id="__span-15-311"><a id="__codelineno-15-311" name="__codelineno-15-311"></a>                <span class="s2">"input"</span><span class="p">:</span> <span class="n">test_right_data</span><span class="p">,</span>
</span><span id="__span-15-312"><a id="__codelineno-15-312" name="__codelineno-15-312"></a>                <span class="s2">"label"</span><span class="p">:</span> <span class="n">test_bc_label</span><span class="p">,</span>
</span><span id="__span-15-313"><a id="__codelineno-15-313" name="__codelineno-15-313"></a>            <span class="p">},</span>
</span><span id="__span-15-314"><a id="__codelineno-15-314" name="__codelineno-15-314"></a>            <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span>
</span><span id="__span-15-315"><a id="__codelineno-15-315" name="__codelineno-15-315"></a>            <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-316"><a id="__codelineno-15-316" name="__codelineno-15-316"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-15-317"><a id="__codelineno-15-317" name="__codelineno-15-317"></a>                <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-15-318"><a id="__codelineno-15-318" name="__codelineno-15-318"></a>                <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-15-319"><a id="__codelineno-15-319" name="__codelineno-15-319"></a>            <span class="p">},</span>
</span><span id="__span-15-320"><a id="__codelineno-15-320" name="__codelineno-15-320"></a>        <span class="p">},</span>
</span><span id="__span-15-321"><a id="__codelineno-15-321" name="__codelineno-15-321"></a>        <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-15-322"><a id="__codelineno-15-322" name="__codelineno-15-322"></a>        <span class="n">output_expr</span><span class="o">=</span><span class="p">{</span><span class="s2">"T_h"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"T_c"</span><span class="p">]</span> <span class="o">-</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_cin</span><span class="p">},</span>
</span><span id="__span-15-323"><a id="__codelineno-15-323" name="__codelineno-15-323"></a>        <span class="n">metric</span><span class="o">=</span><span class="p">{</span><span class="s2">"MSE"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">MSE</span><span class="p">()},</span>
</span><span id="__span-15-324"><a id="__codelineno-15-324" name="__codelineno-15-324"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">"right_mse"</span><span class="p">,</span>
</span><span id="__span-15-325"><a id="__codelineno-15-325" name="__codelineno-15-325"></a>    <span class="p">)</span>
</span><span id="__span-15-326"><a id="__codelineno-15-326" name="__codelineno-15-326"></a>    <span class="n">interior_validator</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">SupervisedValidator</span><span class="p">(</span>
</span><span id="__span-15-327"><a id="__codelineno-15-327" name="__codelineno-15-327"></a>        <span class="p">{</span>
</span><span id="__span-15-328"><a id="__codelineno-15-328" name="__codelineno-15-328"></a>            <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-329"><a id="__codelineno-15-329" name="__codelineno-15-329"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"NamedArrayDataset"</span><span class="p">,</span>
</span><span id="__span-15-330"><a id="__codelineno-15-330" name="__codelineno-15-330"></a>                <span class="s2">"input"</span><span class="p">:</span> <span class="n">test_interior_data</span><span class="p">,</span>
</span><span id="__span-15-331"><a id="__codelineno-15-331" name="__codelineno-15-331"></a>                <span class="s2">"label"</span><span class="p">:</span> <span class="n">test_interior_label</span><span class="p">,</span>
</span><span id="__span-15-332"><a id="__codelineno-15-332" name="__codelineno-15-332"></a>            <span class="p">},</span>
</span><span id="__span-15-333"><a id="__codelineno-15-333" name="__codelineno-15-333"></a>            <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span>
</span><span id="__span-15-334"><a id="__codelineno-15-334" name="__codelineno-15-334"></a>            <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-335"><a id="__codelineno-15-335" name="__codelineno-15-335"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-15-336"><a id="__codelineno-15-336" name="__codelineno-15-336"></a>                <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-15-337"><a id="__codelineno-15-337" name="__codelineno-15-337"></a>                <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-15-338"><a id="__codelineno-15-338" name="__codelineno-15-338"></a>            <span class="p">},</span>
</span><span id="__span-15-339"><a id="__codelineno-15-339" name="__codelineno-15-339"></a>        <span class="p">},</span>
</span><span id="__span-15-340"><a id="__codelineno-15-340" name="__codelineno-15-340"></a>        <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-15-341"><a id="__codelineno-15-341" name="__codelineno-15-341"></a>        <span class="n">output_expr</span><span class="o">=</span><span class="n">equation</span><span class="p">[</span><span class="s2">"heat_exchanger"</span><span class="p">]</span><span class="o">.</span><span class="n">equations</span><span class="p">,</span>
</span><span id="__span-15-342"><a id="__codelineno-15-342" name="__codelineno-15-342"></a>        <span class="n">metric</span><span class="o">=</span><span class="p">{</span><span class="s2">"MSE"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">MSE</span><span class="p">()},</span>
</span><span id="__span-15-343"><a id="__codelineno-15-343" name="__codelineno-15-343"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">"interior_mse"</span><span class="p">,</span>
</span><span id="__span-15-344"><a id="__codelineno-15-344" name="__codelineno-15-344"></a>    <span class="p">)</span>
</span><span id="__span-15-345"><a id="__codelineno-15-345" name="__codelineno-15-345"></a>    <span class="n">validator</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-346"><a id="__codelineno-15-346" name="__codelineno-15-346"></a>        <span class="n">left_validator</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">left_validator</span><span class="p">,</span>
</span><span id="__span-15-347"><a id="__codelineno-15-347" name="__codelineno-15-347"></a>        <span class="n">right_validator</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">right_validator</span><span class="p">,</span>
</span><span id="__span-15-348"><a id="__codelineno-15-348" name="__codelineno-15-348"></a>        <span class="n">interior_validator</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">interior_validator</span><span class="p">,</span>
</span><span id="__span-15-349"><a id="__codelineno-15-349" name="__codelineno-15-349"></a>    <span class="p">}</span>
</span><span id="__span-15-350"><a id="__codelineno-15-350" name="__codelineno-15-350"></a>
</span><span id="__span-15-351"><a id="__codelineno-15-351" name="__codelineno-15-351"></a>    <span class="c1"># initialize solver</span>
</span><span id="__span-15-352"><a id="__codelineno-15-352" name="__codelineno-15-352"></a>    <span class="n">solver</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">Solver</span><span class="p">(</span>
</span><span id="__span-15-353"><a id="__codelineno-15-353" name="__codelineno-15-353"></a>        <span class="n">model</span><span class="p">,</span>
</span><span id="__span-15-354"><a id="__codelineno-15-354" name="__codelineno-15-354"></a>        <span class="n">constraint</span><span class="p">,</span>
</span><span id="__span-15-355"><a id="__codelineno-15-355" name="__codelineno-15-355"></a>        <span class="n">cfg</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span>
</span><span id="__span-15-356"><a id="__codelineno-15-356" name="__codelineno-15-356"></a>        <span class="n">optimizer</span><span class="p">,</span>
</span><span id="__span-15-357"><a id="__codelineno-15-357" name="__codelineno-15-357"></a>        <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-15-358"><a id="__codelineno-15-358" name="__codelineno-15-358"></a>        <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">epochs</span><span class="p">,</span>
</span><span id="__span-15-359"><a id="__codelineno-15-359" name="__codelineno-15-359"></a>        <span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">iters_per_epoch</span><span class="p">,</span>
</span><span id="__span-15-360"><a id="__codelineno-15-360" name="__codelineno-15-360"></a>        <span class="n">eval_during_train</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">eval_during_train</span><span class="p">,</span>
</span><span id="__span-15-361"><a id="__codelineno-15-361" name="__codelineno-15-361"></a>        <span class="n">eval_freq</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">TRAIN</span><span class="o">.</span><span class="n">eval_freq</span><span class="p">,</span>
</span><span id="__span-15-362"><a id="__codelineno-15-362" name="__codelineno-15-362"></a>        <span class="n">equation</span><span class="o">=</span><span class="n">equation</span><span class="p">,</span>
</span><span id="__span-15-363"><a id="__codelineno-15-363" name="__codelineno-15-363"></a>        <span class="n">geom</span><span class="o">=</span><span class="n">geom</span><span class="p">,</span>
</span><span id="__span-15-364"><a id="__codelineno-15-364" name="__codelineno-15-364"></a>        <span class="n">validator</span><span class="o">=</span><span class="n">validator</span><span class="p">,</span>
</span><span id="__span-15-365"><a id="__codelineno-15-365" name="__codelineno-15-365"></a>    <span class="p">)</span>
</span><span id="__span-15-366"><a id="__codelineno-15-366" name="__codelineno-15-366"></a>    <span class="c1"># train model</span>
</span><span id="__span-15-367"><a id="__codelineno-15-367" name="__codelineno-15-367"></a>    <span class="n">solver</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
</span><span id="__span-15-368"><a id="__codelineno-15-368" name="__codelineno-15-368"></a>    <span class="c1"># evaluate after finished training</span>
</span><span id="__span-15-369"><a id="__codelineno-15-369" name="__codelineno-15-369"></a>    <span class="n">solver</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span><span id="__span-15-370"><a id="__codelineno-15-370" name="__codelineno-15-370"></a>    <span class="c1"># plotting iteration/epoch-loss curve.</span>
</span><span id="__span-15-371"><a id="__codelineno-15-371" name="__codelineno-15-371"></a>    <span class="n">solver</span><span class="o">.</span><span class="n">plot_loss_history</span><span class="p">()</span>
</span><span id="__span-15-372"><a id="__codelineno-15-372" name="__codelineno-15-372"></a>
</span><span id="__span-15-373"><a id="__codelineno-15-373" name="__codelineno-15-373"></a>    <span class="c1"># visualize prediction after finished training</span>
</span><span id="__span-15-374"><a id="__codelineno-15-374" name="__codelineno-15-374"></a>    <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">qm_h</span><span class="p">)</span>
</span><span id="__span-15-375"><a id="__codelineno-15-375" name="__codelineno-15-375"></a>    <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">qm_c</span><span class="p">)</span>
</span><span id="__span-15-376"><a id="__codelineno-15-376" name="__codelineno-15-376"></a>    <span class="n">pred</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">visu_input</span><span class="p">,</span> <span class="n">return_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-15-377"><a id="__codelineno-15-377" name="__codelineno-15-377"></a>    <span class="n">plot</span><span class="p">(</span><span class="n">visu_input</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-15-378"><a id="__codelineno-15-378" name="__codelineno-15-378"></a>
</span><span id="__span-15-379"><a id="__codelineno-15-379" name="__codelineno-15-379"></a>
</span><span id="__span-15-380"><a id="__codelineno-15-380" name="__codelineno-15-380"></a><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
</span><span id="__span-15-381"><a id="__codelineno-15-381" name="__codelineno-15-381"></a>    <span class="c1"># set random seed for reproducibility</span>
</span><span id="__span-15-382"><a id="__codelineno-15-382" name="__codelineno-15-382"></a>    <span class="n">ppsci</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">set_random_seed</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
</span><span id="__span-15-383"><a id="__codelineno-15-383" name="__codelineno-15-383"></a>    <span class="c1"># initialize logger</span>
</span><span id="__span-15-384"><a id="__codelineno-15-384" name="__codelineno-15-384"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">init_logger</span><span class="p">(</span><span class="s2">"ppsci"</span><span class="p">,</span> <span class="n">osp</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">mode</span><span class="si">}</span><span class="s2">.log"</span><span class="p">),</span> <span class="s2">"info"</span><span class="p">)</span>
</span><span id="__span-15-385"><a id="__codelineno-15-385" name="__codelineno-15-385"></a>
</span><span id="__span-15-386"><a id="__codelineno-15-386" name="__codelineno-15-386"></a>    <span class="c1"># set model</span>
</span><span id="__span-15-387"><a id="__codelineno-15-387" name="__codelineno-15-387"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">HEDeepONets</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="o">.</span><span class="n">MODEL</span><span class="p">)</span>
</span><span id="__span-15-388"><a id="__codelineno-15-388" name="__codelineno-15-388"></a>
</span><span id="__span-15-389"><a id="__codelineno-15-389" name="__codelineno-15-389"></a>    <span class="c1"># set time-geometry</span>
</span><span id="__span-15-390"><a id="__codelineno-15-390" name="__codelineno-15-390"></a>    <span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-15-391"><a id="__codelineno-15-391" name="__codelineno-15-391"></a>    <span class="n">geom</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-392"><a id="__codelineno-15-392" name="__codelineno-15-392"></a>        <span class="s2">"time_rect"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TimeXGeometry</span><span class="p">(</span>
</span><span id="__span-15-393"><a id="__codelineno-15-393" name="__codelineno-15-393"></a>            <span class="n">ppsci</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TimeDomain</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">timestamps</span><span class="o">=</span><span class="n">timestamps</span><span class="p">),</span>
</span><span id="__span-15-394"><a id="__codelineno-15-394" name="__codelineno-15-394"></a>            <span class="n">ppsci</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Interval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">DL</span><span class="p">),</span>
</span><span id="__span-15-395"><a id="__codelineno-15-395" name="__codelineno-15-395"></a>        <span class="p">)</span>
</span><span id="__span-15-396"><a id="__codelineno-15-396" name="__codelineno-15-396"></a>    <span class="p">}</span>
</span><span id="__span-15-397"><a id="__codelineno-15-397" name="__codelineno-15-397"></a>
</span><span id="__span-15-398"><a id="__codelineno-15-398" name="__codelineno-15-398"></a>    <span class="c1"># Generate eval data</span>
</span><span id="__span-15-399"><a id="__codelineno-15-399" name="__codelineno-15-399"></a>    <span class="n">visu_input</span> <span class="o">=</span> <span class="n">geom</span><span class="p">[</span><span class="s2">"time_rect"</span><span class="p">]</span><span class="o">.</span><span class="n">sample_interior</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span> <span class="n">evenly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-15-400"><a id="__codelineno-15-400" name="__codelineno-15-400"></a>    <span class="n">test_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"float32"</span><span class="p">)</span>
</span><span id="__span-15-401"><a id="__codelineno-15-401" name="__codelineno-15-401"></a>    <span class="n">test_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"float32"</span><span class="p">)</span>
</span><span id="__span-15-402"><a id="__codelineno-15-402" name="__codelineno-15-402"></a>    <span class="c1"># rearrange train data and eval data</span>
</span><span id="__span-15-403"><a id="__codelineno-15-403" name="__codelineno-15-403"></a>    <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">test_h</span><span class="p">,</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-15-404"><a id="__codelineno-15-404" name="__codelineno-15-404"></a>    <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">test_c</span><span class="p">,</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-15-405"><a id="__codelineno-15-405" name="__codelineno-15-405"></a>
</span><span id="__span-15-406"><a id="__codelineno-15-406" name="__codelineno-15-406"></a>    <span class="n">left_indices</span> <span class="o">=</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="__span-15-407"><a id="__codelineno-15-407" name="__codelineno-15-407"></a>    <span class="n">right_indices</span> <span class="o">=</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">==</span> <span class="n">cfg</span><span class="o">.</span><span class="n">DL</span>
</span><span id="__span-15-408"><a id="__codelineno-15-408" name="__codelineno-15-408"></a>    <span class="n">interior_indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span> <span class="o">!=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">DL</span><span class="p">)</span>
</span><span id="__span-15-409"><a id="__codelineno-15-409" name="__codelineno-15-409"></a>    <span class="n">left_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">left_indices</span><span class="p">)</span>
</span><span id="__span-15-410"><a id="__codelineno-15-410" name="__codelineno-15-410"></a>    <span class="n">right_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">right_indices</span><span class="p">)</span>
</span><span id="__span-15-411"><a id="__codelineno-15-411" name="__codelineno-15-411"></a>    <span class="n">interior_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">interior_indices</span><span class="p">)</span>
</span><span id="__span-15-412"><a id="__codelineno-15-412" name="__codelineno-15-412"></a>
</span><span id="__span-15-413"><a id="__codelineno-15-413" name="__codelineno-15-413"></a>    <span class="c1"># Classification eval data</span>
</span><span id="__span-15-414"><a id="__codelineno-15-414" name="__codelineno-15-414"></a>    <span class="n">test_left_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-415"><a id="__codelineno-15-415" name="__codelineno-15-415"></a>        <span class="s2">"x"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">][</span><span class="n">left_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-416"><a id="__codelineno-15-416" name="__codelineno-15-416"></a>        <span class="s2">"t"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"t"</span><span class="p">][</span><span class="n">left_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-417"><a id="__codelineno-15-417" name="__codelineno-15-417"></a>        <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">][</span><span class="n">left_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-418"><a id="__codelineno-15-418" name="__codelineno-15-418"></a>        <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">][</span><span class="n">left_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-419"><a id="__codelineno-15-419" name="__codelineno-15-419"></a>    <span class="p">}</span>
</span><span id="__span-15-420"><a id="__codelineno-15-420" name="__codelineno-15-420"></a>    <span class="n">test_right_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-421"><a id="__codelineno-15-421" name="__codelineno-15-421"></a>        <span class="s2">"x"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">][</span><span class="n">right_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-422"><a id="__codelineno-15-422" name="__codelineno-15-422"></a>        <span class="s2">"t"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"t"</span><span class="p">][</span><span class="n">right_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-423"><a id="__codelineno-15-423" name="__codelineno-15-423"></a>        <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">][</span><span class="n">right_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-424"><a id="__codelineno-15-424" name="__codelineno-15-424"></a>        <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">][</span><span class="n">right_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="__span-15-425"><a id="__codelineno-15-425" name="__codelineno-15-425"></a>    <span class="p">}</span>
</span><span id="__span-15-426"><a id="__codelineno-15-426" name="__codelineno-15-426"></a>    <span class="n">test_interior_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-427"><a id="__codelineno-15-427" name="__codelineno-15-427"></a>        <span class="s2">"x"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span>
</span><span id="__span-15-428"><a id="__codelineno-15-428" name="__codelineno-15-428"></a>        <span class="s2">"t"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"t"</span><span class="p">],</span>
</span><span id="__span-15-429"><a id="__codelineno-15-429" name="__codelineno-15-429"></a>        <span class="s2">"qm_h"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">],</span>
</span><span id="__span-15-430"><a id="__codelineno-15-430" name="__codelineno-15-430"></a>        <span class="s2">"qm_c"</span><span class="p">:</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">],</span>
</span><span id="__span-15-431"><a id="__codelineno-15-431" name="__codelineno-15-431"></a>    <span class="p">}</span>
</span><span id="__span-15-432"><a id="__codelineno-15-432" name="__codelineno-15-432"></a>
</span><span id="__span-15-433"><a id="__codelineno-15-433" name="__codelineno-15-433"></a>    <span class="c1"># set equation</span>
</span><span id="__span-15-434"><a id="__codelineno-15-434" name="__codelineno-15-434"></a>    <span class="n">equation</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-435"><a id="__codelineno-15-435" name="__codelineno-15-435"></a>        <span class="s2">"heat_exchanger"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">equation</span><span class="o">.</span><span class="n">HeatExchanger</span><span class="p">(</span>
</span><span id="__span-15-436"><a id="__codelineno-15-436" name="__codelineno-15-436"></a>            <span class="n">cfg</span><span class="o">.</span><span class="n">alpha_h</span> <span class="o">/</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">L</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">cp_h</span><span class="p">),</span>
</span><span id="__span-15-437"><a id="__codelineno-15-437" name="__codelineno-15-437"></a>            <span class="n">cfg</span><span class="o">.</span><span class="n">alpha_c</span> <span class="o">/</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">L</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">cp_c</span><span class="p">),</span>
</span><span id="__span-15-438"><a id="__codelineno-15-438" name="__codelineno-15-438"></a>            <span class="n">cfg</span><span class="o">.</span><span class="n">v_h</span><span class="p">,</span>
</span><span id="__span-15-439"><a id="__codelineno-15-439" name="__codelineno-15-439"></a>            <span class="n">cfg</span><span class="o">.</span><span class="n">v_c</span><span class="p">,</span>
</span><span id="__span-15-440"><a id="__codelineno-15-440" name="__codelineno-15-440"></a>            <span class="n">cfg</span><span class="o">.</span><span class="n">alpha_h</span> <span class="o">/</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">M</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">cp_w</span><span class="p">),</span>
</span><span id="__span-15-441"><a id="__codelineno-15-441" name="__codelineno-15-441"></a>            <span class="n">cfg</span><span class="o">.</span><span class="n">alpha_c</span> <span class="o">/</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">M</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">cp_w</span><span class="p">),</span>
</span><span id="__span-15-442"><a id="__codelineno-15-442" name="__codelineno-15-442"></a>        <span class="p">)</span>
</span><span id="__span-15-443"><a id="__codelineno-15-443" name="__codelineno-15-443"></a>    <span class="p">}</span>
</span><span id="__span-15-444"><a id="__codelineno-15-444" name="__codelineno-15-444"></a>
</span><span id="__span-15-445"><a id="__codelineno-15-445" name="__codelineno-15-445"></a>    <span class="c1"># set validator</span>
</span><span id="__span-15-446"><a id="__codelineno-15-446" name="__codelineno-15-446"></a>    <span class="n">test_bc_label</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-447"><a id="__codelineno-15-447" name="__codelineno-15-447"></a>        <span class="s2">"T_h"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">test_left_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-15-448"><a id="__codelineno-15-448" name="__codelineno-15-448"></a>    <span class="p">}</span>
</span><span id="__span-15-449"><a id="__codelineno-15-449" name="__codelineno-15-449"></a>    <span class="n">test_interior_label</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-450"><a id="__codelineno-15-450" name="__codelineno-15-450"></a>        <span class="s2">"heat_boundary"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="__span-15-451"><a id="__codelineno-15-451" name="__codelineno-15-451"></a>            <span class="p">[</span><span class="n">test_interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span>
</span><span id="__span-15-452"><a id="__codelineno-15-452" name="__codelineno-15-452"></a>        <span class="p">),</span>
</span><span id="__span-15-453"><a id="__codelineno-15-453" name="__codelineno-15-453"></a>        <span class="s2">"cold_boundary"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="__span-15-454"><a id="__codelineno-15-454" name="__codelineno-15-454"></a>            <span class="p">[</span><span class="n">test_interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span>
</span><span id="__span-15-455"><a id="__codelineno-15-455" name="__codelineno-15-455"></a>        <span class="p">),</span>
</span><span id="__span-15-456"><a id="__codelineno-15-456" name="__codelineno-15-456"></a>        <span class="s2">"wall"</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">test_interior_data</span><span class="p">[</span><span class="s2">"x"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"float32"</span><span class="p">),</span>
</span><span id="__span-15-457"><a id="__codelineno-15-457" name="__codelineno-15-457"></a>    <span class="p">}</span>
</span><span id="__span-15-458"><a id="__codelineno-15-458" name="__codelineno-15-458"></a>    <span class="n">left_validator</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">SupervisedValidator</span><span class="p">(</span>
</span><span id="__span-15-459"><a id="__codelineno-15-459" name="__codelineno-15-459"></a>        <span class="p">{</span>
</span><span id="__span-15-460"><a id="__codelineno-15-460" name="__codelineno-15-460"></a>            <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-461"><a id="__codelineno-15-461" name="__codelineno-15-461"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"NamedArrayDataset"</span><span class="p">,</span>
</span><span id="__span-15-462"><a id="__codelineno-15-462" name="__codelineno-15-462"></a>                <span class="s2">"input"</span><span class="p">:</span> <span class="n">test_left_data</span><span class="p">,</span>
</span><span id="__span-15-463"><a id="__codelineno-15-463" name="__codelineno-15-463"></a>                <span class="s2">"label"</span><span class="p">:</span> <span class="n">test_bc_label</span><span class="p">,</span>
</span><span id="__span-15-464"><a id="__codelineno-15-464" name="__codelineno-15-464"></a>            <span class="p">},</span>
</span><span id="__span-15-465"><a id="__codelineno-15-465" name="__codelineno-15-465"></a>            <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span>
</span><span id="__span-15-466"><a id="__codelineno-15-466" name="__codelineno-15-466"></a>            <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-467"><a id="__codelineno-15-467" name="__codelineno-15-467"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-15-468"><a id="__codelineno-15-468" name="__codelineno-15-468"></a>                <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-15-469"><a id="__codelineno-15-469" name="__codelineno-15-469"></a>                <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-15-470"><a id="__codelineno-15-470" name="__codelineno-15-470"></a>            <span class="p">},</span>
</span><span id="__span-15-471"><a id="__codelineno-15-471" name="__codelineno-15-471"></a>        <span class="p">},</span>
</span><span id="__span-15-472"><a id="__codelineno-15-472" name="__codelineno-15-472"></a>        <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-15-473"><a id="__codelineno-15-473" name="__codelineno-15-473"></a>        <span class="n">output_expr</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-15-474"><a id="__codelineno-15-474" name="__codelineno-15-474"></a>            <span class="s2">"T_h"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"T_h"</span><span class="p">]</span> <span class="o">-</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_hin</span><span class="p">,</span>
</span><span id="__span-15-475"><a id="__codelineno-15-475" name="__codelineno-15-475"></a>        <span class="p">},</span>
</span><span id="__span-15-476"><a id="__codelineno-15-476" name="__codelineno-15-476"></a>        <span class="n">metric</span><span class="o">=</span><span class="p">{</span><span class="s2">"MSE"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">MSE</span><span class="p">()},</span>
</span><span id="__span-15-477"><a id="__codelineno-15-477" name="__codelineno-15-477"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">"left_mse"</span><span class="p">,</span>
</span><span id="__span-15-478"><a id="__codelineno-15-478" name="__codelineno-15-478"></a>    <span class="p">)</span>
</span><span id="__span-15-479"><a id="__codelineno-15-479" name="__codelineno-15-479"></a>    <span class="n">right_validator</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">SupervisedValidator</span><span class="p">(</span>
</span><span id="__span-15-480"><a id="__codelineno-15-480" name="__codelineno-15-480"></a>        <span class="p">{</span>
</span><span id="__span-15-481"><a id="__codelineno-15-481" name="__codelineno-15-481"></a>            <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-482"><a id="__codelineno-15-482" name="__codelineno-15-482"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"NamedArrayDataset"</span><span class="p">,</span>
</span><span id="__span-15-483"><a id="__codelineno-15-483" name="__codelineno-15-483"></a>                <span class="s2">"input"</span><span class="p">:</span> <span class="n">test_right_data</span><span class="p">,</span>
</span><span id="__span-15-484"><a id="__codelineno-15-484" name="__codelineno-15-484"></a>                <span class="s2">"label"</span><span class="p">:</span> <span class="n">test_bc_label</span><span class="p">,</span>
</span><span id="__span-15-485"><a id="__codelineno-15-485" name="__codelineno-15-485"></a>            <span class="p">},</span>
</span><span id="__span-15-486"><a id="__codelineno-15-486" name="__codelineno-15-486"></a>            <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span>
</span><span id="__span-15-487"><a id="__codelineno-15-487" name="__codelineno-15-487"></a>            <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-488"><a id="__codelineno-15-488" name="__codelineno-15-488"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-15-489"><a id="__codelineno-15-489" name="__codelineno-15-489"></a>                <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-15-490"><a id="__codelineno-15-490" name="__codelineno-15-490"></a>                <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-15-491"><a id="__codelineno-15-491" name="__codelineno-15-491"></a>            <span class="p">},</span>
</span><span id="__span-15-492"><a id="__codelineno-15-492" name="__codelineno-15-492"></a>        <span class="p">},</span>
</span><span id="__span-15-493"><a id="__codelineno-15-493" name="__codelineno-15-493"></a>        <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-15-494"><a id="__codelineno-15-494" name="__codelineno-15-494"></a>        <span class="n">output_expr</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-15-495"><a id="__codelineno-15-495" name="__codelineno-15-495"></a>            <span class="s2">"T_h"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">out</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s2">"T_c"</span><span class="p">]</span> <span class="o">-</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_cin</span><span class="p">,</span>
</span><span id="__span-15-496"><a id="__codelineno-15-496" name="__codelineno-15-496"></a>        <span class="p">},</span>
</span><span id="__span-15-497"><a id="__codelineno-15-497" name="__codelineno-15-497"></a>        <span class="n">metric</span><span class="o">=</span><span class="p">{</span><span class="s2">"MSE"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">MSE</span><span class="p">()},</span>
</span><span id="__span-15-498"><a id="__codelineno-15-498" name="__codelineno-15-498"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">"right_mse"</span><span class="p">,</span>
</span><span id="__span-15-499"><a id="__codelineno-15-499" name="__codelineno-15-499"></a>    <span class="p">)</span>
</span><span id="__span-15-500"><a id="__codelineno-15-500" name="__codelineno-15-500"></a>    <span class="n">interior_validator</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">validate</span><span class="o">.</span><span class="n">SupervisedValidator</span><span class="p">(</span>
</span><span id="__span-15-501"><a id="__codelineno-15-501" name="__codelineno-15-501"></a>        <span class="p">{</span>
</span><span id="__span-15-502"><a id="__codelineno-15-502" name="__codelineno-15-502"></a>            <span class="s2">"dataset"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-503"><a id="__codelineno-15-503" name="__codelineno-15-503"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"NamedArrayDataset"</span><span class="p">,</span>
</span><span id="__span-15-504"><a id="__codelineno-15-504" name="__codelineno-15-504"></a>                <span class="s2">"input"</span><span class="p">:</span> <span class="n">test_interior_data</span><span class="p">,</span>
</span><span id="__span-15-505"><a id="__codelineno-15-505" name="__codelineno-15-505"></a>                <span class="s2">"label"</span><span class="p">:</span> <span class="n">test_interior_label</span><span class="p">,</span>
</span><span id="__span-15-506"><a id="__codelineno-15-506" name="__codelineno-15-506"></a>            <span class="p">},</span>
</span><span id="__span-15-507"><a id="__codelineno-15-507" name="__codelineno-15-507"></a>            <span class="s2">"batch_size"</span><span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span>
</span><span id="__span-15-508"><a id="__codelineno-15-508" name="__codelineno-15-508"></a>            <span class="s2">"sampler"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-15-509"><a id="__codelineno-15-509" name="__codelineno-15-509"></a>                <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"BatchSampler"</span><span class="p">,</span>
</span><span id="__span-15-510"><a id="__codelineno-15-510" name="__codelineno-15-510"></a>                <span class="s2">"drop_last"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-15-511"><a id="__codelineno-15-511" name="__codelineno-15-511"></a>                <span class="s2">"shuffle"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-15-512"><a id="__codelineno-15-512" name="__codelineno-15-512"></a>            <span class="p">},</span>
</span><span id="__span-15-513"><a id="__codelineno-15-513" name="__codelineno-15-513"></a>        <span class="p">},</span>
</span><span id="__span-15-514"><a id="__codelineno-15-514" name="__codelineno-15-514"></a>        <span class="n">ppsci</span><span class="o">.</span><span class="n">loss</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="s2">"mean"</span><span class="p">),</span>
</span><span id="__span-15-515"><a id="__codelineno-15-515" name="__codelineno-15-515"></a>        <span class="n">output_expr</span><span class="o">=</span><span class="n">equation</span><span class="p">[</span><span class="s2">"heat_exchanger"</span><span class="p">]</span><span class="o">.</span><span class="n">equations</span><span class="p">,</span>
</span><span id="__span-15-516"><a id="__codelineno-15-516" name="__codelineno-15-516"></a>        <span class="n">metric</span><span class="o">=</span><span class="p">{</span><span class="s2">"MSE"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">metric</span><span class="o">.</span><span class="n">MSE</span><span class="p">()},</span>
</span><span id="__span-15-517"><a id="__codelineno-15-517" name="__codelineno-15-517"></a>        <span class="n">name</span><span class="o">=</span><span class="s2">"interior_mse"</span><span class="p">,</span>
</span><span id="__span-15-518"><a id="__codelineno-15-518" name="__codelineno-15-518"></a>    <span class="p">)</span>
</span><span id="__span-15-519"><a id="__codelineno-15-519" name="__codelineno-15-519"></a>    <span class="n">validator</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-520"><a id="__codelineno-15-520" name="__codelineno-15-520"></a>        <span class="n">left_validator</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">left_validator</span><span class="p">,</span>
</span><span id="__span-15-521"><a id="__codelineno-15-521" name="__codelineno-15-521"></a>        <span class="n">right_validator</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">right_validator</span><span class="p">,</span>
</span><span id="__span-15-522"><a id="__codelineno-15-522" name="__codelineno-15-522"></a>        <span class="n">interior_validator</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">interior_validator</span><span class="p">,</span>
</span><span id="__span-15-523"><a id="__codelineno-15-523" name="__codelineno-15-523"></a>    <span class="p">}</span>
</span><span id="__span-15-524"><a id="__codelineno-15-524" name="__codelineno-15-524"></a>
</span><span id="__span-15-525"><a id="__codelineno-15-525" name="__codelineno-15-525"></a>    <span class="c1"># directly evaluate pretrained model(optional)</span>
</span><span id="__span-15-526"><a id="__codelineno-15-526" name="__codelineno-15-526"></a>    <span class="n">solver</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">Solver</span><span class="p">(</span>
</span><span id="__span-15-527"><a id="__codelineno-15-527" name="__codelineno-15-527"></a>        <span class="n">model</span><span class="p">,</span>
</span><span id="__span-15-528"><a id="__codelineno-15-528" name="__codelineno-15-528"></a>        <span class="n">output_dir</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span>
</span><span id="__span-15-529"><a id="__codelineno-15-529" name="__codelineno-15-529"></a>        <span class="n">equation</span><span class="o">=</span><span class="n">equation</span><span class="p">,</span>
</span><span id="__span-15-530"><a id="__codelineno-15-530" name="__codelineno-15-530"></a>        <span class="n">geom</span><span class="o">=</span><span class="n">geom</span><span class="p">,</span>
</span><span id="__span-15-531"><a id="__codelineno-15-531" name="__codelineno-15-531"></a>        <span class="n">validator</span><span class="o">=</span><span class="n">validator</span><span class="p">,</span>
</span><span id="__span-15-532"><a id="__codelineno-15-532" name="__codelineno-15-532"></a>        <span class="n">pretrained_model_path</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">EVAL</span><span class="o">.</span><span class="n">pretrained_model_path</span><span class="p">,</span>
</span><span id="__span-15-533"><a id="__codelineno-15-533" name="__codelineno-15-533"></a>    <span class="p">)</span>
</span><span id="__span-15-534"><a id="__codelineno-15-534" name="__codelineno-15-534"></a>    <span class="n">solver</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
</span><span id="__span-15-535"><a id="__codelineno-15-535" name="__codelineno-15-535"></a>
</span><span id="__span-15-536"><a id="__codelineno-15-536" name="__codelineno-15-536"></a>    <span class="c1"># visualize prediction after finished training</span>
</span><span id="__span-15-537"><a id="__codelineno-15-537" name="__codelineno-15-537"></a>    <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">qm_h</span><span class="p">)</span>
</span><span id="__span-15-538"><a id="__codelineno-15-538" name="__codelineno-15-538"></a>    <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">qm_c</span><span class="p">)</span>
</span><span id="__span-15-539"><a id="__codelineno-15-539" name="__codelineno-15-539"></a>    <span class="n">pred</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">visu_input</span><span class="p">,</span> <span class="n">return_numpy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-15-540"><a id="__codelineno-15-540" name="__codelineno-15-540"></a>    <span class="n">plot</span><span class="p">(</span><span class="n">visu_input</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-15-541"><a id="__codelineno-15-541" name="__codelineno-15-541"></a>
</span><span id="__span-15-542"><a id="__codelineno-15-542" name="__codelineno-15-542"></a>
</span><span id="__span-15-543"><a id="__codelineno-15-543" name="__codelineno-15-543"></a><span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
</span><span id="__span-15-544"><a id="__codelineno-15-544" name="__codelineno-15-544"></a>    <span class="c1"># set model</span>
</span><span id="__span-15-545"><a id="__codelineno-15-545" name="__codelineno-15-545"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">arch</span><span class="o">.</span><span class="n">HEDeepONets</span><span class="p">(</span><span class="o">**</span><span class="n">cfg</span><span class="o">.</span><span class="n">MODEL</span><span class="p">)</span>
</span><span id="__span-15-546"><a id="__codelineno-15-546" name="__codelineno-15-546"></a>
</span><span id="__span-15-547"><a id="__codelineno-15-547" name="__codelineno-15-547"></a>    <span class="c1"># initialize solver</span>
</span><span id="__span-15-548"><a id="__codelineno-15-548" name="__codelineno-15-548"></a>    <span class="n">solver</span> <span class="o">=</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">Solver</span><span class="p">(</span>
</span><span id="__span-15-549"><a id="__codelineno-15-549" name="__codelineno-15-549"></a>        <span class="n">model</span><span class="p">,</span>
</span><span id="__span-15-550"><a id="__codelineno-15-550" name="__codelineno-15-550"></a>        <span class="n">pretrained_model_path</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">INFER</span><span class="o">.</span><span class="n">pretrained_model_path</span><span class="p">,</span>
</span><span id="__span-15-551"><a id="__codelineno-15-551" name="__codelineno-15-551"></a>    <span class="p">)</span>
</span><span id="__span-15-552"><a id="__codelineno-15-552" name="__codelineno-15-552"></a>    <span class="c1"># export model</span>
</span><span id="__span-15-553"><a id="__codelineno-15-553" name="__codelineno-15-553"></a>    <span class="kn">from</span> <span class="nn">paddle.static</span> <span class="kn">import</span> <span class="n">InputSpec</span>
</span><span id="__span-15-554"><a id="__codelineno-15-554" name="__codelineno-15-554"></a>
</span><span id="__span-15-555"><a id="__codelineno-15-555" name="__codelineno-15-555"></a>    <span class="n">input_spec</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-15-556"><a id="__codelineno-15-556" name="__codelineno-15-556"></a>        <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">InputSpec</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">"float32"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">input_keys</span><span class="p">},</span>
</span><span id="__span-15-557"><a id="__codelineno-15-557" name="__codelineno-15-557"></a>    <span class="p">]</span>
</span><span id="__span-15-558"><a id="__codelineno-15-558" name="__codelineno-15-558"></a>    <span class="n">solver</span><span class="o">.</span><span class="n">export</span><span class="p">(</span><span class="n">input_spec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">INFER</span><span class="o">.</span><span class="n">export_path</span><span class="p">)</span>
</span><span id="__span-15-559"><a id="__codelineno-15-559" name="__codelineno-15-559"></a>
</span><span id="__span-15-560"><a id="__codelineno-15-560" name="__codelineno-15-560"></a>
</span><span id="__span-15-561"><a id="__codelineno-15-561" name="__codelineno-15-561"></a><span class="k">def</span> <span class="nf">inference</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
</span><span id="__span-15-562"><a id="__codelineno-15-562" name="__codelineno-15-562"></a>    <span class="kn">from</span> <span class="nn">deploy.python_infer</span> <span class="kn">import</span> <span class="n">pinn_predictor</span>
</span><span id="__span-15-563"><a id="__codelineno-15-563" name="__codelineno-15-563"></a>
</span><span id="__span-15-564"><a id="__codelineno-15-564" name="__codelineno-15-564"></a>    <span class="n">predictor</span> <span class="o">=</span> <span class="n">pinn_predictor</span><span class="o">.</span><span class="n">PINNPredictor</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-15-565"><a id="__codelineno-15-565" name="__codelineno-15-565"></a>
</span><span id="__span-15-566"><a id="__codelineno-15-566" name="__codelineno-15-566"></a>    <span class="c1"># set time-geometry</span>
</span><span id="__span-15-567"><a id="__codelineno-15-567" name="__codelineno-15-567"></a>    <span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-15-568"><a id="__codelineno-15-568" name="__codelineno-15-568"></a>    <span class="n">geom</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-569"><a id="__codelineno-15-569" name="__codelineno-15-569"></a>        <span class="s2">"time_rect"</span><span class="p">:</span> <span class="n">ppsci</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TimeXGeometry</span><span class="p">(</span>
</span><span id="__span-15-570"><a id="__codelineno-15-570" name="__codelineno-15-570"></a>            <span class="n">ppsci</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">TimeDomain</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">timestamps</span><span class="o">=</span><span class="n">timestamps</span><span class="p">),</span>
</span><span id="__span-15-571"><a id="__codelineno-15-571" name="__codelineno-15-571"></a>            <span class="n">ppsci</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">Interval</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">DL</span><span class="p">),</span>
</span><span id="__span-15-572"><a id="__codelineno-15-572" name="__codelineno-15-572"></a>        <span class="p">)</span>
</span><span id="__span-15-573"><a id="__codelineno-15-573" name="__codelineno-15-573"></a>    <span class="p">}</span>
</span><span id="__span-15-574"><a id="__codelineno-15-574" name="__codelineno-15-574"></a>    <span class="n">input_dict</span> <span class="o">=</span> <span class="n">geom</span><span class="p">[</span><span class="s2">"time_rect"</span><span class="p">]</span><span class="o">.</span><span class="n">sample_interior</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span> <span class="n">evenly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-15-575"><a id="__codelineno-15-575" name="__codelineno-15-575"></a>    <span class="n">test_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"float32"</span><span class="p">)</span>
</span><span id="__span-15-576"><a id="__codelineno-15-576" name="__codelineno-15-576"></a>    <span class="n">test_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"float32"</span><span class="p">)</span>
</span><span id="__span-15-577"><a id="__codelineno-15-577" name="__codelineno-15-577"></a>    <span class="c1"># rearrange train data and eval data</span>
</span><span id="__span-15-578"><a id="__codelineno-15-578" name="__codelineno-15-578"></a>    <span class="n">input_dict</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">test_h</span><span class="p">,</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-15-579"><a id="__codelineno-15-579" name="__codelineno-15-579"></a>    <span class="n">input_dict</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">test_c</span><span class="p">,</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-15-580"><a id="__codelineno-15-580" name="__codelineno-15-580"></a>    <span class="n">input_dict</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">input_dict</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">qm_h</span><span class="p">)</span>
</span><span id="__span-15-581"><a id="__codelineno-15-581" name="__codelineno-15-581"></a>    <span class="n">input_dict</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">input_dict</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">qm_c</span><span class="p">)</span>
</span><span id="__span-15-582"><a id="__codelineno-15-582" name="__codelineno-15-582"></a>    <span class="n">output_dict</span> <span class="o">=</span> <span class="n">predictor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
</span><span id="__span-15-583"><a id="__codelineno-15-583" name="__codelineno-15-583"></a>        <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">input_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">cfg</span><span class="o">.</span><span class="n">INFER</span><span class="o">.</span><span class="n">input_keys</span><span class="p">},</span> <span class="n">cfg</span><span class="o">.</span><span class="n">INFER</span><span class="o">.</span><span class="n">batch_size</span>
</span><span id="__span-15-584"><a id="__codelineno-15-584" name="__codelineno-15-584"></a>    <span class="p">)</span>
</span><span id="__span-15-585"><a id="__codelineno-15-585" name="__codelineno-15-585"></a>
</span><span id="__span-15-586"><a id="__codelineno-15-586" name="__codelineno-15-586"></a>    <span class="c1"># mapping data to cfg.INFER.output_keys</span>
</span><span id="__span-15-587"><a id="__codelineno-15-587" name="__codelineno-15-587"></a>    <span class="n">output_dict</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-15-588"><a id="__codelineno-15-588" name="__codelineno-15-588"></a>        <span class="n">store_key</span><span class="p">:</span> <span class="n">output_dict</span><span class="p">[</span><span class="n">infer_key</span><span class="p">]</span>
</span><span id="__span-15-589"><a id="__codelineno-15-589" name="__codelineno-15-589"></a>        <span class="k">for</span> <span class="n">store_key</span><span class="p">,</span> <span class="n">infer_key</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">MODEL</span><span class="o">.</span><span class="n">output_keys</span><span class="p">,</span> <span class="n">output_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="__span-15-590"><a id="__codelineno-15-590" name="__codelineno-15-590"></a>    <span class="p">}</span>
</span><span id="__span-15-591"><a id="__codelineno-15-591" name="__codelineno-15-591"></a>    <span class="n">plot</span><span class="p">(</span><span class="n">input_dict</span><span class="p">,</span> <span class="n">output_dict</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-15-592"><a id="__codelineno-15-592" name="__codelineno-15-592"></a>
</span><span id="__span-15-593"><a id="__codelineno-15-593" name="__codelineno-15-593"></a>
</span><span id="__span-15-594"><a id="__codelineno-15-594" name="__codelineno-15-594"></a><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">visu_input</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
</span><span id="__span-15-595"><a id="__codelineno-15-595" name="__codelineno-15-595"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"x"</span><span class="p">][:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span><span class="p">]</span>
</span><span id="__span-15-596"><a id="__codelineno-15-596" name="__codelineno-15-596"></a>    <span class="c1"># plot temperature of heat boundary</span>
</span><span id="__span-15-597"><a id="__codelineno-15-597" name="__codelineno-15-597"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="__span-15-598"><a id="__codelineno-15-598" name="__codelineno-15-598"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="s2">"T_h"</span><span class="p">][:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_hin</span><span class="p">)</span>
</span><span id="__span-15-599"><a id="__codelineno-15-599" name="__codelineno-15-599"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"t = 0.0 s"</span><span class="p">)</span>
</span><span id="__span-15-600"><a id="__codelineno-15-600" name="__codelineno-15-600"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="__span-15-601"><a id="__codelineno-15-601" name="__codelineno-15-601"></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="s2">"T_h"</span><span class="p">][</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="__span-15-602"><a id="__codelineno-15-602" name="__codelineno-15-602"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">"t = </span><span class="si">{</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.1</span><span class="si">:</span><span class="s2">,.1f</span><span class="si">}</span><span class="s2"> s"</span><span class="p">)</span>
</span><span id="__span-15-603"><a id="__codelineno-15-603" name="__codelineno-15-603"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"A"</span><span class="p">)</span>
</span><span id="__span-15-604"><a id="__codelineno-15-604" name="__codelineno-15-604"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$T_h$"</span><span class="p">)</span>
</span><span id="__span-15-605"><a id="__codelineno-15-605" name="__codelineno-15-605"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="__span-15-606"><a id="__codelineno-15-606" name="__codelineno-15-606"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</span><span id="__span-15-607"><a id="__codelineno-15-607" name="__codelineno-15-607"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">"T_h.png"</span><span class="p">)</span>
</span><span id="__span-15-608"><a id="__codelineno-15-608" name="__codelineno-15-608"></a>    <span class="c1"># plot temperature of cold boundary</span>
</span><span id="__span-15-609"><a id="__codelineno-15-609" name="__codelineno-15-609"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="__span-15-610"><a id="__codelineno-15-610" name="__codelineno-15-610"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="s2">"T_c"</span><span class="p">][:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_cin</span><span class="p">)</span>
</span><span id="__span-15-611"><a id="__codelineno-15-611" name="__codelineno-15-611"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"t = 0.0 s"</span><span class="p">)</span>
</span><span id="__span-15-612"><a id="__codelineno-15-612" name="__codelineno-15-612"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="__span-15-613"><a id="__codelineno-15-613" name="__codelineno-15-613"></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="s2">"T_c"</span><span class="p">][</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="__span-15-614"><a id="__codelineno-15-614" name="__codelineno-15-614"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">"t = </span><span class="si">{</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.1</span><span class="si">:</span><span class="s2">,.1f</span><span class="si">}</span><span class="s2"> s"</span><span class="p">)</span>
</span><span id="__span-15-615"><a id="__codelineno-15-615" name="__codelineno-15-615"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"A"</span><span class="p">)</span>
</span><span id="__span-15-616"><a id="__codelineno-15-616" name="__codelineno-15-616"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$T_c$"</span><span class="p">)</span>
</span><span id="__span-15-617"><a id="__codelineno-15-617" name="__codelineno-15-617"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="__span-15-618"><a id="__codelineno-15-618" name="__codelineno-15-618"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</span><span id="__span-15-619"><a id="__codelineno-15-619" name="__codelineno-15-619"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">"T_c.png"</span><span class="p">)</span>
</span><span id="__span-15-620"><a id="__codelineno-15-620" name="__codelineno-15-620"></a>    <span class="c1"># plot temperature of wall</span>
</span><span id="__span-15-621"><a id="__codelineno-15-621" name="__codelineno-15-621"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="__span-15-622"><a id="__codelineno-15-622" name="__codelineno-15-622"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="s2">"T_w"</span><span class="p">][:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span><span class="p">],</span> <span class="n">cfg</span><span class="o">.</span><span class="n">T_win</span><span class="p">)</span>
</span><span id="__span-15-623"><a id="__codelineno-15-623" name="__codelineno-15-623"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">"t = 0.0 s"</span><span class="p">)</span>
</span><span id="__span-15-624"><a id="__codelineno-15-624" name="__codelineno-15-624"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="__span-15-625"><a id="__codelineno-15-625" name="__codelineno-15-625"></a>        <span class="n">y</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="s2">"T_w"</span><span class="p">][</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
</span><span id="__span-15-626"><a id="__codelineno-15-626" name="__codelineno-15-626"></a>        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">"t = </span><span class="si">{</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.1</span><span class="si">:</span><span class="s2">,.1f</span><span class="si">}</span><span class="s2"> s"</span><span class="p">)</span>
</span><span id="__span-15-627"><a id="__codelineno-15-627" name="__codelineno-15-627"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"A"</span><span class="p">)</span>
</span><span id="__span-15-628"><a id="__codelineno-15-628" name="__codelineno-15-628"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$T_w$"</span><span class="p">)</span>
</span><span id="__span-15-629"><a id="__codelineno-15-629" name="__codelineno-15-629"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="__span-15-630"><a id="__codelineno-15-630" name="__codelineno-15-630"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</span><span id="__span-15-631"><a id="__codelineno-15-631" name="__codelineno-15-631"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">"T_w.png"</span><span class="p">)</span>
</span><span id="__span-15-632"><a id="__codelineno-15-632" name="__codelineno-15-632"></a>    <span class="c1"># plot the heat exchanger efficiency as a function of time.</span>
</span><span id="__span-15-633"><a id="__codelineno-15-633" name="__codelineno-15-633"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="__span-15-634"><a id="__codelineno-15-634" name="__codelineno-15-634"></a>    <span class="n">qm_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_c"</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="__span-15-635"><a id="__codelineno-15-635" name="__codelineno-15-635"></a>    <span class="n">eta</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-15-636"><a id="__codelineno-15-636" name="__codelineno-15-636"></a>        <span class="n">visu_input</span><span class="p">[</span><span class="s2">"qm_h"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-15-637"><a id="__codelineno-15-637" name="__codelineno-15-637"></a>        <span class="o">*</span> <span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="s2">"T_h"</span><span class="p">][::</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span><span class="p">]</span> <span class="o">-</span> <span class="n">pred</span><span class="p">[</span><span class="s2">"T_h"</span><span class="p">][</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span><span class="p">])</span>
</span><span id="__span-15-638"><a id="__codelineno-15-638" name="__codelineno-15-638"></a>        <span class="o">/</span> <span class="p">(</span>
</span><span id="__span-15-639"><a id="__codelineno-15-639" name="__codelineno-15-639"></a>            <span class="n">qm_min</span>
</span><span id="__span-15-640"><a id="__codelineno-15-640" name="__codelineno-15-640"></a>            <span class="o">*</span> <span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="s2">"T_h"</span><span class="p">][::</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span><span class="p">]</span> <span class="o">-</span> <span class="n">pred</span><span class="p">[</span><span class="s2">"T_c"</span><span class="p">][</span><span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">::</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NPOINT</span><span class="p">])</span>
</span><span id="__span-15-641"><a id="__codelineno-15-641" name="__codelineno-15-641"></a>        <span class="p">)</span>
</span><span id="__span-15-642"><a id="__codelineno-15-642" name="__codelineno-15-642"></a>    <span class="p">)</span>
</span><span id="__span-15-643"><a id="__codelineno-15-643" name="__codelineno-15-643"></a>    <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">cfg</span><span class="o">.</span><span class="n">NTIME</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="__span-15-644"><a id="__codelineno-15-644" name="__codelineno-15-644"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">eta</span><span class="p">)</span>
</span><span id="__span-15-645"><a id="__codelineno-15-645" name="__codelineno-15-645"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"time"</span><span class="p">)</span>
</span><span id="__span-15-646"><a id="__codelineno-15-646" name="__codelineno-15-646"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">"$\eta$"</span><span class="p">)</span>
</span><span id="__span-15-647"><a id="__codelineno-15-647" name="__codelineno-15-647"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</span><span id="__span-15-648"><a id="__codelineno-15-648" name="__codelineno-15-648"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">"eta.png"</span><span class="p">)</span>
</span><span id="__span-15-649"><a id="__codelineno-15-649" name="__codelineno-15-649"></a>    <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">eta</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">cfg</span><span class="o">.</span><span class="n">eta_true</span><span class="p">)</span>
</span><span id="__span-15-650"><a id="__codelineno-15-650" name="__codelineno-15-650"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="__span-15-651"><a id="__codelineno-15-651" name="__codelineno-15-651"></a>        <span class="sa">f</span><span class="s2">"The L2 norm error between the actual heat exchanger efficiency and the predicted heat exchanger efficiency is </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-15-652"><a id="__codelineno-15-652" name="__codelineno-15-652"></a>    <span class="p">)</span>
</span><span id="__span-15-653"><a id="__codelineno-15-653" name="__codelineno-15-653"></a>
</span><span id="__span-15-654"><a id="__codelineno-15-654" name="__codelineno-15-654"></a>
</span><span id="__span-15-655"><a id="__codelineno-15-655" name="__codelineno-15-655"></a><span class="nd">@hydra</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">version_base</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">config_path</span><span class="o">=</span><span class="s2">"./conf"</span><span class="p">,</span> <span class="n">config_name</span><span class="o">=</span><span class="s2">"heat_exchanger.yaml"</span><span class="p">)</span>
</span><span id="__span-15-656"><a id="__codelineno-15-656" name="__codelineno-15-656"></a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">cfg</span><span class="p">:</span> <span class="n">DictConfig</span><span class="p">):</span>
</span><span id="__span-15-657"><a id="__codelineno-15-657" name="__codelineno-15-657"></a>    <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">"train"</span><span class="p">:</span>
</span><span id="__span-15-658"><a id="__codelineno-15-658" name="__codelineno-15-658"></a>        <span class="n">train</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-15-659"><a id="__codelineno-15-659" name="__codelineno-15-659"></a>    <span class="k">elif</span> <span class="n">cfg</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">"eval"</span><span class="p">:</span>
</span><span id="__span-15-660"><a id="__codelineno-15-660" name="__codelineno-15-660"></a>        <span class="n">evaluate</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-15-661"><a id="__codelineno-15-661" name="__codelineno-15-661"></a>    <span class="k">elif</span> <span class="n">cfg</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">"export"</span><span class="p">:</span>
</span><span id="__span-15-662"><a id="__codelineno-15-662" name="__codelineno-15-662"></a>        <span class="n">export</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-15-663"><a id="__codelineno-15-663" name="__codelineno-15-663"></a>    <span class="k">elif</span> <span class="n">cfg</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">"infer"</span><span class="p">:</span>
</span><span id="__span-15-664"><a id="__codelineno-15-664" name="__codelineno-15-664"></a>        <span class="n">inference</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="__span-15-665"><a id="__codelineno-15-665" name="__codelineno-15-665"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-15-666"><a id="__codelineno-15-666" name="__codelineno-15-666"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="__span-15-667"><a id="__codelineno-15-667" name="__codelineno-15-667"></a>            <span class="sa">f</span><span class="s2">"cfg.mode should in ['train', 'eval', 'export', 'infer'], but got '</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">mode</span><span class="si">}</span><span class="s2">'"</span>
</span><span id="__span-15-668"><a id="__codelineno-15-668" name="__codelineno-15-668"></a>        <span class="p">)</span>
</span><span id="__span-15-669"><a id="__codelineno-15-669" name="__codelineno-15-669"></a>
</span><span id="__span-15-670"><a id="__codelineno-15-670" name="__codelineno-15-670"></a>
</span><span id="__span-15-671"><a id="__codelineno-15-671" name="__codelineno-15-671"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-15-672"><a id="__codelineno-15-672" name="__codelineno-15-672"></a>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="5">5. 结果展示<a class="headerlink" href="#5" title="Permanent link">¶</a></h2>
<p>如图所示为不同时刻热边温度、冷边温度、壁面温度 <span class="arithmatex">\(T_h, T_c, T_w\)</span> 随传热面积 <span class="arithmatex">\(A\)</span> 的变化图像以及换热器效率 <span class="arithmatex">\(\eta\)</span> 随时间的变化图像。</p>
<details class="info" open="open">
<summary>说明</summary>
<p>本案例只作为demo展示，尚未进行充分调优，下方部分展示结果可能与 OpenFOAM 存在一定差别。</p>
</details>
<figure>
<p><a class="glightbox" href="https://paddle-org.bj.bcebos.com/paddlescience/docs/HEDeepONet/T_h.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img align="center" alt="T_h.png" loading="lazy" src="https://paddle-org.bj.bcebos.com/paddlescience/docs/HEDeepONet/T_h.png" style="height:80%;width:80%"></a>
  </p>
<figcaption> 不同时刻热边温度 T_h 随传热面积 A 的变化图像</figcaption>
</figure>
<figure>
<p><a class="glightbox" href="https://paddle-org.bj.bcebos.com/paddlescience/docs/HEDeepONet/T_c.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img align="center" alt="T_c.png" loading="lazy" src="https://paddle-org.bj.bcebos.com/paddlescience/docs/HEDeepONet/T_c.png" style="height:80%;width:80%"></a>
  </p>
<figcaption> 不同时刻冷边温度 T_c 随传热面积 A 的变化图像</figcaption>
</figure>
<figure>
<p><a class="glightbox" href="https://paddle-org.bj.bcebos.com/paddlescience/docs/HEDeepONet/T_w.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img align="center" alt="T_w.png" loading="lazy" src="https://paddle-org.bj.bcebos.com/paddlescience/docs/HEDeepONet/T_w.png" style="height:80%;width:80%"></a>
  </p>
<figcaption> 不同时刻壁面温度 T_w 随传热面积 A 的变化图像</figcaption>
</figure>
<figure>
<p><a class="glightbox" href="https://paddle-org.bj.bcebos.com/paddlescience/docs/HEDeepONet/eta.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img align="center" alt="eta.png" loading="lazy" src="https://paddle-org.bj.bcebos.com/paddlescience/docs/HEDeepONet/eta.png" style="height:80%;width:80%"></a>
  </p>
<figcaption> 换热器效率随时间的变化图像</figcaption>
</figure>
<p>从图中可以看出：</p>
<ul>
<li>热边温度在 <span class="arithmatex">\(A=1\)</span> 处随时间的变化逐渐递减，冷边温度在 <span class="arithmatex">\(A=0\)</span> 处随时间的变化逐渐递增；</li>
<li>壁面温度在 <span class="arithmatex">\(A=1\)</span> 处随时间的变化逐渐递减，在 <span class="arithmatex">\(A=0\)</span> 处随时间的变化逐渐递增；</li>
<li>换热器效率随时间的变化逐渐递增，在 <span class="arithmatex">\(t=21\)</span> 时达到最大值。</li>
</ul>
<p>同时我们可以假设热边质量流量和冷边质量流量相等，即 <span class="arithmatex">\(q_h=q_c\)</span>，定义传热单元数：</p>
<div class="arithmatex">\[
NTU = \dfrac{Ak}{(q_mc)_{min}}.
\]</div>
<p>对不同的传热单元数，我们可以分别计算对应的换热器效率，并画出换热器效率随传热单元数的变化图像，如图所示。</p>
<figure>
<p><a class="glightbox" href="https://paddle-org.bj.bcebos.com/paddlescience/docs/HEDeepONet/eta-1.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img align="center" alt="eta-1.png" loading="lazy" src="https://paddle-org.bj.bcebos.com/paddlescience/docs/HEDeepONet/eta-1.png" style="height:80%;width:80%"></a>
  </p>
<figcaption> 换热器效率随传热单元数的变化图像</figcaption>
</figure>
<p>从图中可以看出：换热器效率随传热单元数的变化逐渐递增，这也符合实际的换热器效率随传热单元数的变化规律。</p></div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">June 19, 2024</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="创建日期">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">June 19, 2024</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 - 2023 PaddlePaddle
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.tracking", "navigation.sections", "navigation.top", "search.suggest", "navigation.instant", "content.code.copy", "content.code.select", "content.code.annotate", "search.highlight", "content.tabs.link", "content.action.edit", "content.action.view"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": {"alias": true, "provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
        <script src="../../../javascripts/bd_statistics.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="../../../javascripts/contributors.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>